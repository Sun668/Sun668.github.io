<!DOCTYPE html>
<html lang>
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sunra.top","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="AA，全名叫做Addressable，可寻址资源，可以将一个完整的游戏资源进行拆分，达到减小安装包和内存使用的的目的。">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity Addressable 可寻址插件">
<meta property="og:url" content="https://sunra.top/2021/10/21/unity-addressable/index.html">
<meta property="og:site_name" content="Origin of Ray">
<meta property="og:description" content="AA，全名叫做Addressable，可寻址资源，可以将一个完整的游戏资源进行拆分，达到减小安装包和内存使用的的目的。">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797743/origin-of-ray/asynccode_xa4cfj.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797760/origin-of-ray/asynccode_jvazqc.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797779/origin-of-ray/asynccode_t5fj9o.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797801/origin-of-ray/asynccode_r2modb.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797817/origin-of-ray/asynccode_mk5enp.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797838/origin-of-ray/asynccode_ynz30x.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797858/origin-of-ray/asynccode_gr5p4o.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797904/origin-of-ray/asynccode_uap8mg.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797954/origin-of-ray/asynccode_yu3bb0.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797988/origin-of-ray/asynccode_nztazp.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798017/origin-of-ray/asynccode_kmqek9.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798046/origin-of-ray/asynccode_wrhuvq.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798075/origin-of-ray/asynccode_qte6kw.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798103/origin-of-ray/asynccode_srtfwi.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798132/origin-of-ray/asynccode_x3muax.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798165/origin-of-ray/asynccode_bb7fds.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798203/origin-of-ray/asynccode_kz9djw.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798251/origin-of-ray/asynccode_gvx9k7.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798285/origin-of-ray/asynccode_qatfim.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798320/origin-of-ray/asynccode_xelzim.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798359/origin-of-ray/asynccode_bswc6q.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798402/origin-of-ray/asynccode_tpamc1.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798505/origin-of-ray/asynccode_t4wq3q.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798583/origin-of-ray/asynccode_cylsxa.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798641/origin-of-ray/asynccode_cb3h3c.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798659/origin-of-ray/asynccode_wbj3xx.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798691/origin-of-ray/asynccode_jwfgen.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798713/origin-of-ray/asynccode_swsy1k.png">
<meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798749/origin-of-ray/asynccode_hpjuhj.png">
<meta property="og:updated_time" content="2023-04-16T12:09:13.747Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity Addressable 可寻址插件">
<meta name="twitter:description" content="AA，全名叫做Addressable，可寻址资源，可以将一个完整的游戏资源进行拆分，达到减小安装包和内存使用的的目的。">
<meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797743/origin-of-ray/asynccode_xa4cfj.png">

<link rel="canonical" href="https://sunra.top/2021/10/21/unity-addressable/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'default'
  };
</script>

  <title>Unity Addressable 可寻址插件 | Origin of Ray</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-KEJ1L66CKC');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Origin of Ray" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Origin of Ray</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一起探索互联网的秘密</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://sunra.top/2021/10/21/unity-addressable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg">
      <meta itemprop="name" content="Ray Sun">
      <meta itemprop="description" content="拨开互联网的迷雾">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Origin of Ray">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Unity Addressable 可寻址插件
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-21 14:16:03" itemprop="dateCreated datePublished" datetime="2021-10-21T14:16:03+08:00">2021-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-16 20:09:13" itemprop="dateModified" datetime="2023-04-16T20:09:13+08:00">2023-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>AA，全名叫做Addressable，可寻址资源，可以将一个完整的游戏资源进行拆分，达到减小安装包和内存使用的的目的。</p>
<a id="more"></a>
<h1 id="安装与初始化"><a href="#安装与初始化" class="headerlink" title="安装与初始化"></a>安装与初始化</h1><ul>
<li>安装：Windows -&gt; Package Manager，搜索Addressable并安装。</li>
</ul>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797743/origin-of-ray/asynccode_xa4cfj.png" alt="img"></p>
<ul>
<li>初始化：Window -&gt; Asset Management -&gt; Addressables -&gt; Group</li>
</ul>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797760/origin-of-ray/asynccode_jvazqc.png" alt="img"></p>
<p>之后在Assets文件夹下会多一个叫做AddressableAssetData的文件夹</p>
<h1 id="AddressableAssetData目录"><a href="#AddressableAssetData目录" class="headerlink" title="AddressableAssetData目录"></a>AddressableAssetData目录</h1><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797779/origin-of-ray/asynccode_t5fj9o.png" alt="img"></p>
<p>根目录下的AddressableAssetSetting中保存的是所有的AA基础配置</p>
<p>AssetGroups目录下的是当前的Group，初始化以后，默认是有两个，BuildInData和DefaultLocalGroup</p>
<p>AssetGroups/Schemas下面的是三个schema，第一个属于第一个Group，后两个属于第二个Group</p>
<p>AssetGroupTemplate下面的是Group的Template，也就是我们新建Group时候的模版，默认只有一个PackdAsset，也就是我们新建的时候只能选择从这个模版新建，或者新建一个空的Group</p>
<p>DataBuilders内部是四个BuildScript，是Build或者PlayMode的脚本，需要先配置在AA基础配置中（我们也可以写自己的BuildScript，然后在这里添加以后可以使用），即</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797801/origin-of-ray/asynccode_r2modb.png" alt="img"></p>
<p>然后可以在PlayMode中使用（前三个）</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797817/origin-of-ray/asynccode_mk5enp.png" alt="img"></p>
<p>以及Build中使用（第四个）</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797838/origin-of-ray/asynccode_ynz30x.png" alt="img"></p>
<h1 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h1><h2 id="Profile：配置打包的地址和Target平台变量"><a href="#Profile：配置打包的地址和Target平台变量" class="headerlink" title="Profile：配置打包的地址和Target平台变量"></a>Profile：配置打包的地址和Target平台变量</h2><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797858/origin-of-ray/asynccode_gr5p4o.png" alt="img"></p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797904/origin-of-ray/asynccode_uap8mg.png" alt="img"></p>
<ul>
<li><p><strong>Square brackets [ ]</strong>: Addressables 在构建时评估方括号包围的条目。 这些条目可以是其他配置文件变量（例如 [BuildTarget]）或代码变量（例如 UnityEditor.EditorUserBuildSettings.activeBuildTarget）。 在构建期间，当它处理您的组时，Addressables 评估方括号内的字符串并将结果写入目录。</p>
</li>
<li><p><strong>Curly brackets { }</strong>: Addressables 在运行时评估用大括号括起来的条目。 您可以使用运行时类的代码变量（例如 {UnityEngine.AddressableAssets.Addressables.RuntimePath}）</p>
</li>
<li><p>[BuildTarget] 方括号里可以使用Unity的全局变量</p>
</li>
<li><p>{Addressable.AddressableConfig.server_android_url} 大括号中可以直接引用类中的静态变量</p>
</li>
<li><p>BuildTarget：打包的目的平台</p>
</li>
<li>LocalBuildPath：本地资源打包的路径</li>
<li>LocalLoadPath：本地资源的加载路径</li>
<li>RemoteBuildPath：远程资源的打包路径</li>
<li>RemoteLoadPath：远程资源的加载路径</li>
</ul>
<h2 id="启用Remote资源发布"><a href="#启用Remote资源发布" class="headerlink" title="启用Remote资源发布"></a>启用Remote资源发布</h2><p>启用Build Remote Catalog，然后Build &amp; Load Paths设置为custom，就可以选择上面说的profile中的五个变量了，这里能够显示根据Profile中的配置计算出来的实际路径。</p>
<p>比如，我们目前的BuildTarget是OSX，所以此时RemoteBuildPath的ServerData/[BuildTarget]计算的结果就是ServerData/StandaloneOSX</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797954/origin-of-ray/asynccode_yu3bb0.png" alt="img"></p>
<p>不启动这个也可以，照样可以打包Local和Remote的资源，并且也可以加载远程的资源，但是如果不启动这个，就不能为Remote资源的单独生成带有时间戳或者版本号的Catalog（本来就会在streamAsset文件夹下有一个包含Local和Remote的Catalog），也就不能根据Remote的Catalog去不更新App而单独更新资源，详细内容参考这里：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/RemoteContentDistribution.html#content-catalogs" rel="external nofollow noopener noreferrer" target="_blank">Remote content distribution | Addressables | 1.18.16</a></p>
<h2 id="创建新的Group-Template（可选）"><a href="#创建新的Group-Template（可选）" class="headerlink" title="创建新的Group Template（可选）"></a>创建新的Group Template（可选）</h2><p>我们创建新的Group时，需要根据从某个Template来创建。默认在AddressableAssetData/AssetGroupTemplates下有一个PackedAsset的模版，所以我们在create 新的 group时只有一个选项：</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634797988/origin-of-ray/asynccode_nztazp.png" alt="img"></p>
<h3 id="新建Template"><a href="#新建Template" class="headerlink" title="新建Template"></a>新建Template</h3><p>如果您创建自己的构建脚本或需要额外设置的实用程序，您可以在您自己的架构对象中定义这些设置并创建您自己的组模板：</p>
<ul>
<li>使用“项目”面板导航到 Assets 文件夹中的所需位置。</li>
<li>创建一个空白组模板（menu: <strong>Assets &gt; Addressables &gt; Group Templates &gt; Blank Group Templates</strong>）。</li>
<li>为模板指定一个合适的名称。</li>
<li>如果需要，在“Inspector”窗口中添加说明。</li>
<li>单击添加架构按钮并从架构列表中进行选择。</li>
<li>继续添加schema，直到所有必需的模式都添加到列表中。</li>
</ul>
<p>如果您使用默认构建脚本，则组必须使用内容打包和加载架构。 如果您使用内容更新版本，则组必须包含内容更新限制架构。 有关更多信息，请参阅构建。</p>
<h3 id="为Template添加Schema"><a href="#为Template添加Schema" class="headerlink" title="为Template添加Schema"></a>为Template添加Schema</h3><p>The built-in schemas include:</p>
<ul>
<li><p><strong>Content Packing &amp; Loading</strong>: this is the main Addressables schema used by the default build script and defines the settings for building and loading Addressable assets.</p>
</li>
<li><p><strong>Content Update Restrictions</strong>: defines settings for making differential updates of a previous build. See <a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/Builds.html" rel="external nofollow noopener noreferrer" target="_blank">Builds</a> for more information about update builds.</p>
</li>
<li><p><strong>Resources and Built In Scenes</strong>: a special-purpose schema defining settings for which types of built-in assets to display in the <strong>Built In Data</strong> group.</p>
</li>
</ul>
<p>这三个Schema在Library/PackageCache/com.unity.addressables@1.18.16/Editor/Settings/GroupSchemas中</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798017/origin-of-ray/asynccode_kmqek9.png" alt="img"></p>
<h3 id="创建自定义的Schema"><a href="#创建自定义的Schema" class="headerlink" title="创建自定义的Schema"></a>创建自定义的Schema</h3><p>To create your own schema, extend the <a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEditor.AddressableAssets.Settings.AddressableAssetGroupSchema.html" rel="external nofollow noopener noreferrer" target="_blank">AddressableAssetGroupSchema</a> class (which is a kind of ScriptableObject).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">using UnityEditor.AddressableAssets.Settings;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class __CustomSchema __: AddressableAssetGroupSchema</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   public string CustomDescription;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Once you have defined your custom schema object, you can add it to existing groups and group templates using the Add Schema buttons found on the Inspector windows of those entities.</p>
<h2 id="创建新的Group用于打包为远程bundle"><a href="#创建新的Group用于打包为远程bundle" class="headerlink" title="创建新的Group用于打包为远程bundle"></a>创建新的Group用于打包为远程bundle</h2><p>如果上一步创建了Template，则可以直接根据Template创建Group，如果没有，则选择创建Blank的Group，然后通过Add Schema，添加两个基本的schema</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798046/origin-of-ray/asynccode_wrhuvq.png" alt="img"></p>
<p>然后将buildPath和loadPath设置为remote的。</p>
<p>这个时候，我们就可以看到</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798075/origin-of-ray/asynccode_qte6kw.png" alt="img"></p>
<p>多了两个schema，即为我们刚才add的两个schema</p>
<h2 id="将资源标记为可寻址"><a href="#将资源标记为可寻址" class="headerlink" title="将资源标记为可寻址"></a>将资源标记为可寻址</h2><p>选择某个资源，在Inspector中勾选Addressable</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798103/origin-of-ray/asynccode_srtfwi.png" alt="img"></p>
<p>默认会将资源放到Default Local Group中</p>
<p>我们选择两个资源标记为可寻址，一个就放在默认位置，一个移动到我们新创建的Remote Group</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798132/origin-of-ray/asynccode_x3muax.png" alt="img"></p>
<h1 id="如何管理AA资源"><a href="#如何管理AA资源" class="headerlink" title="如何管理AA资源"></a><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/AddressableAssetsDevelopmentCycle.html" rel="external nofollow noopener noreferrer" target="_blank">如何管理AA资源</a></h1><p>几个基本的参考原则：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/AddressableAssetsDevelopmentCycle.html#organizing-addressable-assets" rel="external nofollow noopener noreferrer" target="_blank">Managing Addressables in the Editor | Addressables | 1.18.16</a></p>
<h2 id="AA资源打包后会占用多少体积"><a href="#AA资源打包后会占用多少体积" class="headerlink" title="AA资源打包后会占用多少体积"></a>AA资源打包后会占用多少体积</h2><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798165/origin-of-ray/asynccode_bb7fds.png" alt="img"></p>
<p>如果您在多个类别中使用相同的资产，那么 Unity 在构建时会制作资产的副本，而不是共享单个实例。 例如，如果您在内置场景中使用了一个材质，并且也在位于 Resources 文件夹中的预制件中使用了它，那么您最终会在构建中拥有该材质的两个副本——即使材质资产本身不是 位于资源。 如果您随后将同一材料标记为可寻址，则最终会得到三份副本。 （项目 StreamingAssets 文件夹中的文件永远不能被该文件夹外的资产引用。）</p>
<p>所以，尽量不使用Resources文件夹。</p>
<p>在构建播放器之前，您必须对可寻址资产进行内容构建。 在播放器构建期间，Unity 将您的本地 Addressables 复制到 StreamingAssets 文件夹，以便它们与您放置在 StreamingAssets 中的任何资产一起包含在构建中。 （这些资产在构建过程结束时被删除。）您有责任将内容构建生成的远程 Addressables 文件上传到您的托管服务。 有关更多信息，</p>
<p>当您将资产添加到 Addressables 组时，该资产会在您进行内容构建时打包到 AssetBundle 中。 如果资产引用其他资产（称为依赖项），则如何处理这些依赖项取决于它们是否也是可寻址的。 可寻址的依赖项根据它们所在组的设置打包到 AssetBundle 中——这可能是与引用资产相同的包或不同的包。 不可寻址的依赖项包含在其引用资产的包中。</p>
<p>如果多个 Addressable 引用相同的非 Addressable 资产，则非 Addressable 资产的副本包含在每个包含引用 Addressable 的包中。</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798203/origin-of-ray/asynccode_kz9djw.png" alt="img"></p>
<p>当一项资产隐式包含在多个包中时，可能会发生一个微妙的后果，即可以在运行时实例化该资产的多个实例，而不是您的游戏逻辑所期望的单个实例。 如果您在运行时更改实例状态，则只有来自同一包的对象才能看到更改，因为所有其他资产现在都有自己的单独实例，而不是共享公共实例。</p>
<p>为了消除这种重复，您可以将依赖项设为可寻址资产并将其包含在现有包之一中或将其添加到不同的包中。 一旦您使依赖项成为可寻址的，每当您加载引用它的可寻址对象之一时，就会加载它所属的包。</p>
<p>请注意，当您引用另一个包中的资产时，必须 在加载当前包中的任何资产时加载该包，而不仅仅是包含引用的资产。 尽管没有加载其他 AssetBundle 中的任何资产，但加载包有其自身的运行时成本</p>
<h2 id="AA资源应该拆分多少Group"><a href="#AA资源应该拆分多少Group" class="headerlink" title="AA资源应该拆分多少Group"></a>AA资源应该拆分多少Group</h2><p>过多的危险：</p>
<ul>
<li>每个包都有内存开销。 这与该页面上概述的许多因素有关，但简而言之，这种开销可能很大。 如果您预计一次将 100 个甚至 1000 个包加载到内存中，这可能意味着大量内存被消耗掉。</li>
<li>下载包有并发限制。 如果您同时需要 1000 个捆绑包，则不可能同时下载所有捆绑包。 将下载一些数字，当它们完成时，将触发更多。 在实践中，这是一个相当小的问题，如此小以至于您通常会受到下载的总大小的限制，而不是它被分成多少个包。</li>
<li>捆绑信息会使目录膨胀。 为了能够下载或加载目录，我们会存储有关您的捆绑包的基于字符串的信息。 数以千计的数据包可以大大增加目录的大小。</li>
<li>重复资产的可能性更大。 假设两个材料被标记为可寻址，并且每个都依赖于相同的纹理。 如果它们在同一个包中，则纹理被拉入一次，并被两者引用。 如果它们在单独的包中，并且纹理本身不是可寻址的，那么它将被复制。 然后您需要将纹理标记为可寻址，接受重复，或将材料放在同一个包中。</li>
</ul>
<p>捆绑太少的危险：</p>
<ul>
<li><p>UnityWebRequest（我们用来下载）不会恢复失败的下载。 因此，如果正在下载大包并且您的用户失去连接，则一旦他们重新获得连接，下载就会重新开始。</p>
</li>
<li><p>物品可以从捆绑包中单独加载，但不能单独卸载。 例如，如果你在一个包中有 10 个材料，加载所有 10 个，然后告诉 Addressables 释放其中的 9 个，所有 10 个都可能在内存中。 有关更多信息，请参阅内存管理。</p>
</li>
</ul>
<h1 id="如何在运行时使用AA资源"><a href="#如何在运行时使用AA资源" class="headerlink" title="如何在运行时使用AA资源"></a><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/RuntimeAddressables.html" rel="external nofollow noopener noreferrer" target="_blank">如何在运行时使用AA资源</a></h1><p>一旦您将可寻址资产组织成组并内置到AssetBundles中，您仍然必须加载、实例化并最终在运行时发布它们。</p>
<p>首先是一些AA资源在内存中的行为，可以帮助我们更好地管理AA资源，从而优化内存的使用</p>
<h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/MemoryManagement.html" rel="external nofollow noopener noreferrer" target="_blank">内存管理</a></h2><p>Addressables 系统通过保持它加载的每个项目的引用计数来管理用于加载资产和包的内存。</p>
<p>当一个 Addressable 被加载时，系统增加引用计数；当资产被释放时，系统会减少引用计数。当一个 Addressable 的引用计数归零时，它就有资格被卸载。当您显式加载可寻址资产时，您还必须在完成后释放该资产。</p>
<p>避免“内存泄漏”（不再需要后仍保留在内存中的资产）的基本经验法则是将每次对加载函数的调用与对释放函数的调用进行镜像。您可以使用对资产实例本身的引用或使用原始加载操作返回的结果句柄来释放资产。</p>
<p>但是请注意，释放的资产不一定会立即从内存中卸载。资产使用的内存在它所属的 AssetBundle 也被卸载之前不会被释放。（释放的资产也可以通过调用<a href="https://docs.unity3d.com/2019.4/Documentation/ScriptReference/Resources.UnloadUnusedAssets.html" rel="external nofollow noopener noreferrer" target="_blank">Resources.UnloadUnusedAssets</a>卸载，但这往往是一个缓慢的操作，可能会导致帧速率故障。）</p>
<p>AssetBundle 有自己的引用计数（系统将它们视为可寻址对象，并将它们包含的资产视为依赖项）。当您从包中加载资产时，包的引用计数会增加，而当您释放资产时，包的引用计数会减少。当一个包的引用计数归零时，这意味着它包含的所有资产都没有在使用，并且包和它包含的所有资产都从内存中卸载。</p>
<p>使用<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/EventViewer.html" rel="external nofollow noopener noreferrer" target="_blank">事件查看器</a>来监控您的运行时内存管理。查看器显示加载和卸载资产及其依赖项的时间。</p>
<h3 id="避免资产churn"><a href="#避免资产churn" class="headerlink" title="避免资产churn"></a>避免资产churn</h3><p>如果您释放恰好是 AssetBundle 中最后一项的对象，然后立即重新加载该资产或捆绑包中的其他资产，则可能会出现资产churn问题。</p>
<p>例如，假设你有两种材料，<code>boat</code>并且<code>plane</code>该份额纹理，<code>cammo</code>，已被拉入了自己的AssetBundle。1<code>boat</code>级使用和 2 级使用<code>plane</code>。当您退出第 1 级时，您释放<code>boat</code>并立即加载<code>plane</code>. 当您释放时<code>boat</code>，Addressables 卸载纹理<code>cammo</code>。然后，当您加载 时<code>plane</code>，Addressables 会立即重新加载<code>cammo</code>。</p>
<h3 id="内存使用"><a href="#内存使用" class="headerlink" title="内存使用"></a>内存使用</h3><p>当你加载一个 AssetBundle 时，Unity 会分配内存来存储包的内部数据，这是除了用于它包含的资产的内存之外。加载的 AssetBundle 的主要内部数据类型包括：</p>
<ul>
<li><p><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/MemoryManagement.html#serialized-file-buffers" rel="external nofollow noopener noreferrer" target="_blank">序列化文件缓冲区</a>：用于从包中加载数据</p>
</li>
<li><p><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/MemoryManagement.html#typetrees" rel="external nofollow noopener noreferrer" target="_blank">TypeTrees</a>：定义对象的序列化布局</p>
</li>
<li><p><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/MemoryManagement.html#table-of-contents" rel="external nofollow noopener noreferrer" target="_blank">目录</a>：列出捆绑中的资产</p>
</li>
<li><p><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/MemoryManagement.html#preload-table" rel="external nofollow noopener noreferrer" target="_blank">预加载表</a>：列出每个资产的依赖关系</p>
</li>
</ul>
<p>当你组织你的 Addressable 组和 AssetBundle 时，你通常必须在你创建和加载的 AssetBundle 的大小和数量之间进行权衡。一方面，更少、更大的包可以最大限度地减少 AssetBundles 的总内存使用量。另一方面，使用大量小包可以最大限度地减少峰值内存使用量，因为您可以更轻松地卸载资产和 AssetBundles。</p>
<p>虽然磁盘上 AssetBundle 的大小与其运行时的大小不同，但您可以使用磁盘大小作为构建中 AssetBundle 内存开销的大致指南。您可以从<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/BuildLayoutReport.html" rel="external nofollow noopener noreferrer" target="_blank">Build Layout Report</a>获取包大小和其他可用于帮助分析 AssetBundles 的信息。</p>
<h2 id="加载可寻址资产"><a href="#加载可寻址资产" class="headerlink" title="加载可寻址资产"></a><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/LoadingAddressableAssets.html" rel="external nofollow noopener noreferrer" target="_blank">加载可寻址资产</a></h2><p>该<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.AddressableAssets.Addressables.html" rel="external nofollow noopener noreferrer" target="_blank">Addressables</a>类提供了加载寻址资产的几种方法。您可以一次或批量加载一个资产。要识别要加载的资产，您可以将单个键或键列表传递给加载函数。键可以是以下对象之一：</p>
<ul>
<li><p>地址：包含您分配给资产的地址的字符串</p>
</li>
<li><p>标签：包含分配给一个或多个资产的标签的字符串</p>
</li>
<li><p>AssetReference对象：实例<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.AddressableAssets.AssetReference.html" rel="external nofollow noopener noreferrer" target="_blank">AssetReference</a></p>
</li>
<li><p><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.ResourceManagement.ResourceLocations.IResourceLocation.html" rel="external nofollow noopener noreferrer" target="_blank">IResourceLocation</a>实例：一个中间对象，包含加载资产及其依赖项的信息。</p>
</li>
</ul>
<p>当您调用资产加载功能之一时，Addressables 系统开始执行以下任务的异步操作：</p>
<ol>
<li>查找指定键的资源位置（IResourceLocation 键除外）</li>
<li>收集依赖项列表</li>
<li>下载所需的任何远程 AssetBundle</li>
<li>将 AssetBundles 加载到内存中</li>
<li>将操作的<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationHandle.Result.html#UnityEngine_ResourceManagement_AsyncOperations_AsyncOperationHandle_Result" rel="external nofollow noopener noreferrer" target="_blank">Result</a>对象设置为加载的对象</li>
<li>更新操作的<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationHandle.Status.html#UnityEngine_ResourceManagement_AsyncOperations_AsyncOperationHandle_Status" rel="external nofollow noopener noreferrer" target="_blank">状态</a>并调用任何 <a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationHandle.Completed.html" rel="external nofollow noopener noreferrer" target="_blank">Completed</a>事件侦听器</li>
</ol>
<p>如果加载操作成功，Status 将设置为 Succeeded，并且可以从<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationHandle.Result.html#UnityEngine_ResourceManagement_AsyncOperations_AsyncOperationHandle_Result" rel="external nofollow noopener noreferrer" target="_blank">Result</a>对象访问加载的对象。</p>
<p>如果发生错误，则将异常复制到操作对象的<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.ResourceManagement.AsyncOperations.AsyncOperationHandle.OperationException.html#UnityEngine_ResourceManagement_AsyncOperations_AsyncOperationHandle_OperationException" rel="external nofollow noopener noreferrer" target="_blank">OperationException</a>成员中，并将 Status 设置为 Failed。默认情况下，异常不会作为操作的一部分抛出。但是，您可以为<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.ResourceManagement.ResourceManager.ExceptionHandler.html#UnityEngine_ResourceManagement_ResourceManager_ExceptionHandler" rel="external nofollow noopener noreferrer" target="_blank">ResourceManager.ExceptionHandler</a>属性分配一个处理程序函数来处理任何异常。此外，您可以在 Addressable 系统设置中启用<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/AddressableAssetSettings.html#diagnostics" rel="external nofollow noopener noreferrer" target="_blank">Log Runtime Exceptions</a>选项以将错误记录到 Unity<a href="https://docs.unity3d.com/2019.4/Documentation/Manual/Console.html" rel="external nofollow noopener noreferrer" target="_blank">控制台</a>。</p>
<p>当您调用可以加载多个可寻址资产的加载函数时，您可以指定是否应该在任何单个加载操作失败时中止整个操作，或者该操作是否应该加载任何可以加载的资产。在这两种情况下，操作状态都设置为失败。（<code>releaseDependenciesOnFailure</code>在调用加载函数时将参数设置为 true 以在任何失败时中止整个操作。）</p>
<h1 id="尝试构建全量打包"><a href="#尝试构建全量打包" class="headerlink" title="尝试构建全量打包"></a>尝试构建全量打包</h1><p>要构建您的内容工件：</p>
<ol>
<li>配置您的组设置。</li>
<li>如果您要远程分发内容，请配置您的配置文件和可寻址系统设置以启用远程内容分发。</li>
<li>选择正确的配置文件。</li>
<li>从<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/Groups.html#groups-window" rel="external nofollow noopener noreferrer" target="_blank">Groups 窗口</a>启动构建。</li>
</ol>
<p>由于我们没有创建自定义的Profile，暂时使用默认的Profile进行打包测试</p>
<h2 id="默认配置的路径"><a href="#默认配置的路径" class="headerlink" title="默认配置的路径"></a>默认配置的路径</h2><h3 id="默认本地路径"><a href="#默认本地路径" class="headerlink" title="默认本地路径"></a>默认本地路径</h3><p>本地构建路径默认为<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.AddressableAssets.Addressables.BuildPath.html#UnityEngine_AddressableAssets_Addressables_BuildPath" rel="external nofollow noopener noreferrer" target="_blank">Addressables.BuildPath</a>提供的路径，它位于 Unity 项目的 Library 文件夹中。Addressables 根据您当前的平台构建目标设置将文件夹附加到本地构建路径。当您为多个平台构建时，构建会将每个平台的工件放在不同的子文件夹中。</p>
<p>同样，本地加载路径默认为<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEngine.AddressableAssets.Addressables.RuntimePath.html#UnityEngine_AddressableAssets_Addressables_RuntimePath" rel="external nofollow noopener noreferrer" target="_blank">Addressables.RuntimePath</a>提供的路径，解析为 StreamingAssets 文件夹。再次 Addressables 将平台构建目标添加到路径中。</p>
<p>当您将本地包构建到默认构建路径时，构建代码会在您构建播放器时临时将工件从构建路径复制到 StreamingAssets 文件夹（并在构建后删除它们）。</p>
<p>如果您构建到自定义本地路径或从自定义本地路径加载，则您有责任在进行播放器构建之前将构建工件复制到项目中的正确位置，并确保您的应用程序可以在运行时访问这些工件。</p>
<h3 id="默认远程路径"><a href="#默认远程路径" class="headerlink" title="默认远程路径"></a>默认远程路径</h3><p>Addressables 将默认远程构建路径设置为在您的项目文件夹下创建的任意选择的文件夹名称“ServerData”。构建将当前平台目标作为子文件夹添加到路径中，以分离不同平台的独特工件。</p>
<p>默认远程加载路径是“ <a href="http://localhost/" rel="external nofollow noopener noreferrer" target="_blank">http://localhost/</a> ”，附加了当前配置文件 BuildTarget 变量。您必须将此路径更改为计划加载可寻址资产的基本 URL。</p>
<p>根据您正在进行的开发、测试或发布类型，使用不同的配置文件来设置远程加载路径。例如，您可以有一个配置文件从 localhost 服务器加载资产用于一般开发构建，一个配置文件从临时环境加载资产用于 QA 构建，还有一个配置文件从您的内容交付网络 (CDN) 加载资产用于发布构建</p>
<h2 id="打包结果"><a href="#打包结果" class="headerlink" title="打包结果"></a>打包结果</h2><h3 id="本地打包结果"><a href="#本地打包结果" class="headerlink" title="本地打包结果"></a>本地打包结果</h3><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798251/origin-of-ray/asynccode_gvx9k7.png" alt="img"></p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798285/origin-of-ray/asynccode_qatfim.png" alt="img"></p>
<p>可以看到content是拆分为了两个bundle，原因是本地打包的资源中有scene，这种含有场景的group会多分出一个bundle</p>
<h3 id="远程内容打包结果"><a href="#远程内容打包结果" class="headerlink" title="远程内容打包结果"></a>远程内容打包结果</h3><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798320/origin-of-ray/asynccode_xelzim.png" alt="img"></p>
<h2 id="打包产物分析"><a href="#打包产物分析" class="headerlink" title="打包产物分析"></a>打包产物分析</h2><h3 id="本地打包的产物"><a href="#本地打包的产物" class="headerlink" title="本地打包的产物"></a>本地打包的产物</h3><p>因为我们目前只为OS打包了资源，所以aa文件夹下只有OSX</p>
<p>默认情况下，构建会在您的配置文件设置中为 LocalBuildPath 和 RemoteBuildPath 变量定义的位置创建文件。 Unity 用于您的播放器构建的文件包括 AssetBundles (.bundle)、目录 JSON 和哈希文件以及设置文件。</p>
<p>在大多数情况下，不应该从默认值更改本地构建或加载路径。如果这样做，则必须在进行Player构建之前将本地构建工件从自定义构建位置复制到项目的StreamingAssets文件夹。改变这些路径也会妨碍你将Addressable作为Player Build的一部分</p>
<p>如果我们将选择资源为RemoteBuildPath，那么需要我们自己去手动上传资源到CDN</p>
<p>内容构建还会创建以下文件，这些文件在Player构建中不会直接使用</p>
<ul>
<li><p><code>addressables_content_state.bin</code>: used to make a content update build. If you support dynamic content updates, you must save this file after each content release. Otherwise, you can ignore this file.</p>
</li>
<li><p><code>AddressablesBuildTEP.json</code>: logs build performance data. See <a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.19/manual/BuildProfileLog.html" rel="external nofollow noopener noreferrer" target="_blank">Build Profiling</a>.</p>
</li>
</ul>
<p>See <a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.19/manual/Builds.html" rel="external nofollow noopener noreferrer" target="_blank">Building Addressable content</a> for more information about how to set up and perform a content build.</p>
<h3 id="远程资源打包产物"><a href="#远程资源打包产物" class="headerlink" title="远程资源打包产物"></a>远程资源打包产物</h3><p>远程打包的产物还会多一个hash，用于验证下载资源的正确性。</p>
<p>但是它的bin文件在Asset目录下。</p>
<p>产物的名字还会多一个时间戳，避免由于缓存而导致的更新不及时。</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798359/origin-of-ray/asynccode_bswc6q.png" alt="img"></p>
<p>如果开启以上配置，则产物名中的就不是时间戳而是版本号。</p>
<h1 id="尝试增量式更新"><a href="#尝试增量式更新" class="headerlink" title="尝试增量式更新"></a>尝试增量式更新</h1><p>Local的bundle不需要这种，因为文件内容全部都打包在Application中了。</p>
<p>当您远程分发内容时，您可以对先前发布的构建执行差异更新，以最大限度地减少用户必须下载的数据量（与完整构建相比）。</p>
<p>正确配置远程组并拥有包含远程内容的先前构建后，您可以通过以下方式执行内容更新构建：</p>
<blockquote>
<p>除了开启Build Remote Catalog，对于每个Group的更新配置还有<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/ContentUpdateWorkflow.html#settings" rel="external nofollow noopener noreferrer" target="_blank">Content update builds Setting | Addressables | 1.18.16</a>：</p>
<p>一个是Content Update Restriction是Cannot 还是 Can Change Post Release，Cannot的叫做Static</p>
<p>另一个是Unique Build ID，开启后可以让用户在不重启App的情况下更新资源。</p>
</blockquote>
<ol>
<li>Run the <a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/ContentUpdateWorkflow.html#check-for-content-update-restrictions-tool" rel="external nofollow noopener noreferrer" target="_blank">Check for Content Update Restrictions</a> tool.</li>
</ol>
<blockquote>
<p>这一步有可能显示没有更改，因为它不检测Static的Group，因为只有Static的才需要创建一个Content Update的Group，而Non-Static的直接就覆盖原有的bundle了，具体可以参考这里：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/ContentUpdateWorkflow.html#content-update-examples" rel="external nofollow noopener noreferrer" target="_blank">Content update builds Example | Addressables | 1.18.16</a></p>
</blockquote>
<p><strong>Important</strong>: Before you run the <strong>Check for Content Update Restrictions</strong> tool, you should make a branch with your version control system. The tool rearranges your asset groups in a way suited for updating content. Branching ensures that next time you ship a full player build, you can return to your preferred content arrangement.</p>
<ol>
<li>打开<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/Groups.html#groups-window" rel="external nofollow noopener noreferrer" target="_blank">Groups 窗口</a> （菜单：<strong>Windows &gt; Asset Management &gt; Addressables &gt; Groups</strong>）。</li>
<li>从工具栏上的配置<strong>文件</strong>菜单中选择所需的配置文件。</li>
<li>从<strong>Build</strong>菜单中选择<strong>Update a Previous Build</strong>。 <em>文件选择器对话框打开。</em></li>
</ol>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798402/origin-of-ray/asynccode_tpamc1.png" alt="img"></p>
<ol>
<li>找到<code>addressables_content_state.bin</code>您正在更新的构建生成的文件。（默认位置在您的<code>Assets/AddressableAssetsData/TargetPlatform</code>文件夹中。）</li>
<li>单击<strong>打开</strong>以启动更新构建。</li>
</ol>
<p>这种构建方式需要上一次的全量构建产生的bin文件，也就是说，bin文件只会在全量构建时产生和修改，而Update a Previous Build中的这个Previous Build指的永远是上一次全量构建，即使你中间进行过其他的增量式构建。</p>
<p>全量式构建是在每次更新整个Application时运行的，而如果你只想更新AA资源而不重新发版App，则只需要在全量构建时选择Build Remote Catalog，这样就会单独再为Remote资源构建一个catalog，每次拉取Remote资源时，会自动检测远程是否有新版的资源</p>
<p>You must save the <strong><em>addressables_content_state.bin</em></strong> file produced by the Default Build Script for each build that you intend to update in the future. This file is updated every time you run the build script. Be sure to save the version produced for the content build that you publish.</p>
<h1 id="本地环境搭建"><a href="#本地环境搭建" class="headerlink" title="本地环境搭建"></a>本地环境搭建</h1><h2 id="新建Editor-Host"><a href="#新建Editor-Host" class="headerlink" title="新建Editor Host"></a>新建Editor Host</h2><p>当我们使用Remote资源时，默认的LoadPath其实并没有启动服务，为了在本地模拟这个情况，AA提供了Editor Host</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798505/origin-of-ray/asynccode_t4wq3q.png" alt="img"></p>
<p>创建一个新的host</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798583/origin-of-ray/asynccode_cylsxa.png" alt="img"></p>
<p>选择enable之后，就会启动一个服务器</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798641/origin-of-ray/asynccode_cb3h3c.png" alt="img"></p>
<p>此时的服务启动，我们成功托管了bundle在本地的8888端口，但是现在的问题是我们的Profile中的RemoteBuildPath仍然是 <a href="http://localhost/[BuildTarget]，如果我们使用者变量，我们将无法正确加载，所以我们需要创建一个新的Profile，并修改其RemoteLoadPath为本的的8888端口。" rel="external nofollow noopener noreferrer" target="_blank">http://localhost/[BuildTarget]，如果我们使用者变量，我们将无法正确加载，所以我们需要创建一个新的Profile，并修改其RemoteLoadPath为本的的8888端口。</a></p>
<h2 id="新建Editor-Hosted-Profile"><a href="#新建Editor-Hosted-Profile" class="headerlink" title="新建Editor Hosted Profile"></a>新建Editor Hosted Profile</h2><p>在开发期间使用托管服务时，请考虑创建一个配置文件，将资产组配置为从托管服务加载。有关配置文件的更多信息，请参阅<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/AddressableAssetsProfiles.html" rel="external nofollow noopener noreferrer" target="_blank">可寻址资产配置文件</a>。</p>
<p>进入<strong>Addressables Profiles</strong>窗口后，通过<strong>Create</strong> &gt; <strong>Profile</strong>创建一个新的配置<strong>文件</strong>。在以下示例中，新配置文件称为“Editor Hosted”。</p>
<p>修改远程加载 URL 以从托管服务加载。在<strong>Addressables Hosting</strong>窗口中，您可以使用远程<strong>LoadPath</strong>变量中名为<code>[PrivateIpAddress]</code>和的字段来构建路径 URL（例如，）。<code>http://[PrivateIpAddress]:[HostingServicePort]/[BuildTarget]</code></p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798659/origin-of-ray/asynccode_wbj3xx.png" alt="img"></p>
<p><em>配置服务的配置文件。</em></p>
<p>验证是否正确配置了每个组。确保您将<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEditor.AddressableAssets.Settings.GroupSchemas.BundledAssetGroupSchema.BuildPath.html#UnityEditor_AddressableAssets_Settings_GroupSchemas_BundledAssetGroupSchema_BuildPath" rel="external nofollow noopener noreferrer" target="_blank">BuildPath</a>和<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEditor.AddressableAssets.Settings.GroupSchemas.BundledAssetGroupSchema.LoadPath.html#UnityEditor_AddressableAssets_Settings_GroupSchemas_BundledAssetGroupSchema_LoadPath" rel="external nofollow noopener noreferrer" target="_blank">LoadPath</a>路径设置为您修改后用于托管服务的各自配置文件键。在此示例中，您可以看到应如何扩展<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/api/UnityEditor.AddressableAssets.Settings.GroupSchemas.BundledAssetGroupSchema.LoadPath.html#UnityEditor_AddressableAssets_Settings_GroupSchemas_BundledAssetGroupSchema_LoadPath" rel="external nofollow noopener noreferrer" target="_blank">LoadPath 中</a>的配置文件变量以构建正确的基本 URL，以便从托管服务加载资产。</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798691/origin-of-ray/asynccode_jwfgen.png" alt="img"></p>
<p>然后切换当前激活的Profile为Editor Hosted。</p>
<h2 id="修改Play-Mode-Script"><a href="#修改Play-Mode-Script" class="headerlink" title="修改Play Mode Script"></a>修改Play Mode Script</h2><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798713/origin-of-ray/asynccode_swsy1k.png" alt="img"></p>
<ul>
<li><p><strong>Use the Asset database</strong>: Addressables loads Assets directly from the Asset database. This option typically provides the fastest iteration speed if you are making both code and Asset changes, but also least resembles a production build.</p>
</li>
<li><p><strong>Simulate groups</strong>: Addressables loads Assets while simulating groups. This option is helpful if you are working on organizing and optimizing your Addressables groups themselves. It provides Addressables events without requiring a full content rebuild after every change.</p>
</li>
<li><p><strong>Use existing build</strong>: Addressables loads content from your last content build. This option most resembles a production build and can provide fast iteration turnaround if you aren’t changing Assets.</p>
</li>
</ul>
<h1 id="新建生产环境配置"><a href="#新建生产环境配置" class="headerlink" title="新建生产环境配置"></a>新建生产环境配置</h1><p>对于生产环境，我们还需要创建一个Profile</p>
<p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1634798749/origin-of-ray/asynccode_hpjuhj.png" alt="img"></p>
<p>不要忘记将BuildPath下的内容上传到LoadPath中</p>
<h1 id="CI-CD搭建"><a href="#CI-CD搭建" class="headerlink" title="CI/CD搭建"></a>CI/CD搭建</h1><p>打包所需要的脚本：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.15/manual/BuildPlayerContent.html" rel="external nofollow noopener noreferrer" target="_blank">AddressableAssetSettings.BuildPlayerContent | Addressables | 1.15.1</a></p>
<blockquote>
<p>之所以用1.15版本的的文档，是因为1.18的文档里面没有改API的使用介绍了</p>
</blockquote>
<h1 id="高级教程"><a href="#高级教程" class="headerlink" title="高级教程"></a>高级教程</h1><p>其他配置：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/AddressableAssetSettings.html" rel="external nofollow noopener noreferrer" target="_blank">Addressable Asset Settings | Addressables | 1.18.16</a></p>
<p>资源管理：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/AddressableAssetsDevelopmentCycle.html" rel="external nofollow noopener noreferrer" target="_blank">Managing Addressables in the Editor | Addressables | 1.18.16</a></p>
<p>资源打包：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/Builds.html" rel="external nofollow noopener noreferrer" target="_blank">Building content | Addressables | 1.18.16</a></p>
<p>远程资源分发：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/RemoteContentDistribution.html" rel="external nofollow noopener noreferrer" target="_blank">Remote content distribution | Addressables | 1.18.16</a></p>
<p>分析工具：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/DiagnosticTools.html" rel="external nofollow noopener noreferrer" target="_blank">Diagnostic tools | Addressables | 1.18.16</a></p>
<p>资源预加载：<a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.18/manual/DownloadDependenciesAsync.html" rel="external nofollow noopener noreferrer" target="_blank">Preloading dependencies | Addressables | 1.18.16</a>，[AssetBundle Loading | Addressables | 1.18.16](</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Ray Sun
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://sunra.top/2021/10/21/unity-addressable/" title="Unity Addressable 可寻址插件">https://sunra.top/2021/10/21/unity-addressable/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/10/16/uniyt-asset-workflow/" rel="prev" title="Unity文档阅读笔记（二）Asset Workflow">
      <i class="fa fa-chevron-left"></i> Unity文档阅读笔记（二）Asset Workflow
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/07/uniyt-change-suit/" rel="next" title="Unity 人物换装实现">
      Unity 人物换装实现 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安装与初始化"><span class="nav-number">1.</span> <span class="nav-text">安装与初始化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AddressableAssetData目录"><span class="nav-number">2.</span> <span class="nav-text">AddressableAssetData目录</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基础配置"><span class="nav-number">3.</span> <span class="nav-text">基础配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Profile：配置打包的地址和Target平台变量"><span class="nav-number">3.1.</span> <span class="nav-text">Profile：配置打包的地址和Target平台变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启用Remote资源发布"><span class="nav-number">3.2.</span> <span class="nav-text">启用Remote资源发布</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建新的Group-Template（可选）"><span class="nav-number">3.3.</span> <span class="nav-text">创建新的Group Template（可选）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#新建Template"><span class="nav-number">3.3.1.</span> <span class="nav-text">新建Template</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为Template添加Schema"><span class="nav-number">3.3.2.</span> <span class="nav-text">为Template添加Schema</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建自定义的Schema"><span class="nav-number">3.3.3.</span> <span class="nav-text">创建自定义的Schema</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建新的Group用于打包为远程bundle"><span class="nav-number">3.4.</span> <span class="nav-text">创建新的Group用于打包为远程bundle</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将资源标记为可寻址"><span class="nav-number">3.5.</span> <span class="nav-text">将资源标记为可寻址</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如何管理AA资源"><span class="nav-number">4.</span> <span class="nav-text">如何管理AA资源</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AA资源打包后会占用多少体积"><span class="nav-number">4.1.</span> <span class="nav-text">AA资源打包后会占用多少体积</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AA资源应该拆分多少Group"><span class="nav-number">4.2.</span> <span class="nav-text">AA资源应该拆分多少Group</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如何在运行时使用AA资源"><span class="nav-number">5.</span> <span class="nav-text">如何在运行时使用AA资源</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#内存管理"><span class="nav-number">5.1.</span> <span class="nav-text">内存管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#避免资产churn"><span class="nav-number">5.1.1.</span> <span class="nav-text">避免资产churn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内存使用"><span class="nav-number">5.1.2.</span> <span class="nav-text">内存使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加载可寻址资产"><span class="nav-number">5.2.</span> <span class="nav-text">加载可寻址资产</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#尝试构建全量打包"><span class="nav-number">6.</span> <span class="nav-text">尝试构建全量打包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#默认配置的路径"><span class="nav-number">6.1.</span> <span class="nav-text">默认配置的路径</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#默认本地路径"><span class="nav-number">6.1.1.</span> <span class="nav-text">默认本地路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#默认远程路径"><span class="nav-number">6.1.2.</span> <span class="nav-text">默认远程路径</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打包结果"><span class="nav-number">6.2.</span> <span class="nav-text">打包结果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#本地打包结果"><span class="nav-number">6.2.1.</span> <span class="nav-text">本地打包结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#远程内容打包结果"><span class="nav-number">6.2.2.</span> <span class="nav-text">远程内容打包结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#打包产物分析"><span class="nav-number">6.3.</span> <span class="nav-text">打包产物分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#本地打包的产物"><span class="nav-number">6.3.1.</span> <span class="nav-text">本地打包的产物</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#远程资源打包产物"><span class="nav-number">6.3.2.</span> <span class="nav-text">远程资源打包产物</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#尝试增量式更新"><span class="nav-number">7.</span> <span class="nav-text">尝试增量式更新</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#本地环境搭建"><span class="nav-number">8.</span> <span class="nav-text">本地环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#新建Editor-Host"><span class="nav-number">8.1.</span> <span class="nav-text">新建Editor Host</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新建Editor-Hosted-Profile"><span class="nav-number">8.2.</span> <span class="nav-text">新建Editor Hosted Profile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改Play-Mode-Script"><span class="nav-number">8.3.</span> <span class="nav-text">修改Play Mode Script</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#新建生产环境配置"><span class="nav-number">9.</span> <span class="nav-text">新建生产环境配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CI-CD搭建"><span class="nav-number">10.</span> <span class="nav-text">CI/CD搭建</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#高级教程"><span class="nav-number">11.</span> <span class="nav-text">高级教程</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg">
  <p class="site-author-name" itemprop="name">Ray Sun</p>
  <div class="site-description" itemprop="description">拨开互联网的迷雾</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">259</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Sun668" title="GitHub → https://github.com/Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

      <div class="wechat_channel" style="width: 50%;margin-left: 25%;">
        <br>
        <!-- 这里添加你的二维码图片 -->
        <img src="/images/wechat_channel.png">
        <!-- <span>公众号</span> -->
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ray Sun</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  <script src="/js/local-search.js"></script>












  

  

  

</body>
</html>
