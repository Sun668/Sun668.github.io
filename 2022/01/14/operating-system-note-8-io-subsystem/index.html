<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="概述 由于I&#x2F;O设备种类繁多，功能和传输速率差异极大，因此需要多种方法来进行设备控制，这些方法共同组成了操作系统内核的I&#x2F;O子系统，它将内核的其他方面从繁重的I&#x2F;O设备管理中解放出来。"><meta property="og:type" content="article"><meta property="og:title" content="操作系统学习笔记（八）I&#x2F;O管理子系统"><meta property="og:url" content="https://sunra.top/2022/01/14/operating-system-note-8-io-subsystem/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="概述 由于I&#x2F;O设备种类繁多，功能和传输速率差异极大，因此需要多种方法来进行设备控制，这些方法共同组成了操作系统内核的I&#x2F;O子系统，它将内核的其他方面从繁重的I&#x2F;O设备管理中解放出来。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160906/origin-of-ray/asynccode_fnjgcu.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160936/origin-of-ray/asynccode_tvqeud.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642161250/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220114195347_sle5nu.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160963/origin-of-ray/asynccode_yrffju.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160986/origin-of-ray/asynccode_ep2j2u.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642161118/origin-of-ray/asynccode_z1kip3.png"><meta property="article:published_time" content="2022-01-14T11:46:59.000Z"><meta property="article:modified_time" content="2024-10-18T04:14:05.068Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="技术分享 使用教程 原理 前端 计算机图形学"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160906/origin-of-ray/asynccode_fnjgcu.png"><link rel="canonical" href="https://sunra.top/2022/01/14/operating-system-note-8-io-subsystem/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://sunra.top/2022/01/14/operating-system-note-8-io-subsystem/","path":"2022/01/14/operating-system-note-8-io-subsystem/","title":"操作系统学习笔记（八）I/O管理子系统"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>操作系统学习笔记（八）I/O管理子系统 | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script src="/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">一起探索互联网的秘密</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#io%E8%B0%83%E5%BA%A6"><span class="nav-number">2.</span> <span class="nav-text">I&#x2F;O调度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E4%B8%8E%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="nav-number">3.</span> <span class="nav-text">高速缓存与缓冲区</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A3%81%E7%9B%98%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98disk-cache"><span class="nav-number">3.1.</span> <span class="nav-text">磁盘高速缓存（Disk Cache）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="nav-number">3.2.</span> <span class="nav-text">缓冲区</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E7%BC%93%E5%86%B2"><span class="nav-number">3.2.1.</span> <span class="nav-text">单缓冲</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8C%E7%BC%93%E5%86%B2"><span class="nav-number">3.2.2.</span> <span class="nav-text">双缓冲</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E7%BC%93%E5%86%B2"><span class="nav-number">3.2.3.</span> <span class="nav-text">循环缓冲</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E6%B1%A0"><span class="nav-number">3.2.4.</span> <span class="nav-text">缓冲池</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E5%92%8C%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.</span> <span class="nav-text">高速缓存和缓冲区的对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E7%9A%84%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6"><span class="nav-number">4.</span> <span class="nav-text">设备的分配与回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E6%A6%82%E8%BF%B0"><span class="nav-number">4.1.</span> <span class="nav-text">设备分配概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">4.2.</span> <span class="nav-text">设备分配的数据结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E7%9A%84%E7%AD%96%E7%95%A5"><span class="nav-number">4.3.</span> <span class="nav-text">设备分配的策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-number">4.4.</span> <span class="nav-text">设备分配的安全性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%AE%BE%E5%A4%87%E5%90%8D%E5%88%B0%E7%89%A9%E7%90%86%E8%AE%BE%E5%A4%87%E5%90%8D%E7%9A%84%E6%98%A0%E5%B0%84"><span class="nav-number">4.5.</span> <span class="nav-text">逻辑设备名到物理设备名的映射</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spooling%E6%8A%80%E6%9C%AF%E5%81%87%E8%84%B1%E6%9C%BA%E6%8A%80%E6%9C%AF"><span class="nav-number">5.</span> <span class="nav-text">SPOOLing技术（假脱机技术）</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">一起探索互联网的秘密</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">317</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sunra.top/2022/01/14/operating-system-note-8-io-subsystem/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="一起探索互联网的秘密"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="操作系统学习笔记（八）I/O管理子系统 | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 操作系统学习笔记（八）I/O管理子系统</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-01-14 19:46:59" itemprop="dateCreated datePublished" datetime="2022-01-14T19:46:59+08:00">2022-01-14</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-10-18 12:14:05" itemprop="dateModified" datetime="2024-10-18T12:14:05+08:00">2024-10-18</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline：</span><a title="waline" href="/2022/01/14/operating-system-note-8-io-subsystem/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/2022/01/14/operating-system-note-8-io-subsystem/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="概述"><a class="markdownIt-Anchor" href="#概述"></a> 概述</h2><p>由于I/O设备种类繁多，功能和传输速率差异极大，因此需要多种方法来进行设备控制，这些方法共同组成了操作系统内核的I/O子系统，它将内核的其他方面从繁重的I/O设备管理中解放出来。</p><span id="more"></span><p>I/O核心子系统提供的服务主要有：</p><ul><li>I/O调度</li><li>缓冲与高速缓存</li><li>设备分配与回收</li><li>假脱机</li><li>设备保护</li><li>差错处理</li></ul><h2 id="io调度"><a class="markdownIt-Anchor" href="#io调度"></a> I/O调度</h2><p>应用程序发出的系统调用的顺序不一定是最佳选择，所以需要I/O调度来改善系统整体性能，使进程之间公平地共享设备访问减少I/O所需要的平均等待时间。</p><p>操作系统开发人员通过为每一个设备维护一个请求队列，来实现调度。当一个应用程序执行阻塞I/O系统调用时，请求就加到相应设备的队列上。</p><p>I/O调度会重新安排调度顺序，以改善系统总体效率和应用程序的平均响应时间。</p><p>I/O子系统还可以使用主存或磁盘上的存储空间技术，如缓冲，高速缓存，假脱机等来改善计算机效率</p><p>磁盘调度算法就是I/O调度的一种。</p><h2 id="高速缓存与缓冲区"><a class="markdownIt-Anchor" href="#高速缓存与缓冲区"></a> 高速缓存与缓冲区</h2><h3 id="磁盘高速缓存disk-cache"><a class="markdownIt-Anchor" href="#磁盘高速缓存disk-cache"></a> 磁盘高速缓存（Disk Cache）</h3><p>操作系统中使用磁盘高速缓存技术来提高磁盘的I/O速度，对高速缓存复制的访问要比原始数据访问更快。例如正在运行的进程指令既存储在磁盘上，又存储在物理内存上，也被复制到CPU的二级和一级高速缓存中。</p><p>不过，磁盘高速缓存不同于通常意义下的介于CPU与内存之间的小容量高速存储器，而是指利用内存中的存储空间来暂存从磁盘中读出的一系列盘块中的信息。</p><p>因此，磁盘高速缓存逻辑上属于磁盘，物理上则是驻留在内存中的盘块。</p><p>高速缓存在内存中分为两种形式，</p><p>一种是在内存中开辟单独的一块存储空间来作为磁盘高速缓存，大小固定；</p><p>另一种是把未利用的内存空间作为一个缓冲池，供请求分页系统和磁盘I/O共享。</p><h3 id="缓冲区"><a class="markdownIt-Anchor" href="#缓冲区"></a> 缓冲区</h3><p>在设备管理子系统中，引入缓冲区的主要目的如下：</p><ul><li>缓和CPU和I/O设备间速度不匹配的问题。</li><li>减少CPU的中断频率，放宽对CPU中断响应时间的限制。</li><li>解决基本数据单元大小不匹配问题</li><li>提高CPU和I/O设备之间的并行性</li></ul><p>其实现方法如下：</p><ul><li>采用硬件缓冲器，但是成本太高，只在一些关键部位使用。</li><li>采用缓冲区（在内存中）</li></ul><p>缓冲区有一个特点，即当缓冲区数据非空时，不能像缓冲区冲入数据，只能从缓冲区读取数据。当缓冲区为空时，可以往缓冲区冲入数据，但是必须把缓冲区充满后，才能从中读取数据。</p><p>根据系统设置缓冲器的个数，缓冲技术可以分为如下几种：</p><h4 id="单缓冲"><a class="markdownIt-Anchor" href="#单缓冲"></a> 单缓冲</h4><p>在设备和处理机之间设置一个缓冲区，设备和处理机交换数据时，先把被交换的数据写入缓冲区，然后需要数据的设备或处理机从中取走数据。</p><p>在块设备输入时，假定从磁盘把一块数据输入缓冲区的时间为T，操作系统从中取走数据的时间为M，CPU对这块数据的处理时间为C。</p><p>我们在研究各种缓冲技术处理每块数据的时间时，假定一种初始状态，然后计算下一次到达相同状态的时间，就是处理一块数据的时间（如果没有明确说明，以一般认为缓冲区大小与工作区是相同的）。</p><p>我们假定T &gt; C，初始状态工作区满，缓冲区空。</p><p>当工作区处理完数据后，时间为C，但是缓冲区还没充满。</p><p>等缓冲区充满了，从时间为T，停止冲入数据。</p><p>然后数据从缓冲区传入工作区，用时为M，当工作区满了，缓冲区也空了，到达下一个状态，这个哥过程用时为M+T。</p><p>如果T&lt;C，同理，用时为M+C</p><p>所以单缓冲处理每块数据的时间为max(C,T) + M。</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160906/origin-of-ray/asynccode_fnjgcu.png" alt="img"></p><h4 id="双缓冲"><a class="markdownIt-Anchor" href="#双缓冲"></a> 双缓冲</h4><p>根据单缓冲特点，CPU在传送时间M内处于空闲状态，由此引入双缓冲</p><p>我们假定的初始状态是，工作区空，其中一个缓冲区满，另一个空，可以再次计算。</p><p>我们分为T&lt;M+C和T&gt;M+C两种情况讨论。</p><p>结论为双缓冲处理一块数据的用时为max(C + M, T)。</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160936/origin-of-ray/asynccode_tvqeud.png" alt="img"></p><p>若T&gt;M+C，我们可以使用块设备连续输入；若T&lt;M+C，则可以使CPU不必等待设备输入。</p><p>对于字符设备，若采用行输入，则采用双缓冲可以是用户在输入第一行后，在CPU执行第一行命令时，用户可以向第二缓冲输入下一行数据。</p><p>若两台机器之间只设置了单缓冲，则它们在任意时刻，只能实现单向的数据传输。为了实现双向数据传输，则必须再设置一个缓冲区，一个作为发送缓冲区，一个作为接收缓冲区。</p><h4 id="循环缓冲"><a class="markdownIt-Anchor" href="#循环缓冲"></a> 循环缓冲</h4><p>包含多个大小相同的缓冲区，每个缓冲区有一个链接指针指向下一个缓冲区，最后一个缓冲区指向第一个缓冲区，多个缓冲区构成一个环形。</p><p>循环缓冲用于输入输出时，还需要两个指针in和out。对于输入而言，首先要从设备接收数据到缓冲区，in指针指向可以输入数据的第一个空缓冲区，out指针指向可以提取数据的第一个满缓冲区。输出则相反（？）。</p><h4 id="缓冲池"><a class="markdownIt-Anchor" href="#缓冲池"></a> 缓冲池</h4><p>由多个系统公用的缓冲区组成，缓冲区按照其使用情况可以分为三个队列：</p><ul><li>空缓冲队列</li><li>装满输入数据的缓冲队列（输入队列）</li><li>装满输出数据的缓冲队列（输出队列）</li></ul><p>还应该有四种缓冲区：</p><ul><li>用于收容输入数据的工作缓冲区</li><li>用于提取输入数据的工作缓冲区</li><li>用于收容输出数据的工作缓冲区</li><li>用于提取输出数据的工作缓冲区</li></ul><p>当输入进程需要输入数据时，从空缓冲队列队首摘下一个空缓冲区，作为收容输入的工作缓冲区，然后向其中输入数据，装满后挂到输入队列队尾。</p><p>当计算进程需要输入数据时，从输入队列获得一个缓冲区作为提取输入数据的工作缓冲区，提取完成后放回空缓冲队列队尾。</p><h3 id="高速缓存和缓冲区的对比"><a class="markdownIt-Anchor" href="#高速缓存和缓冲区的对比"></a> 高速缓存和缓冲区的对比</h3><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642161250/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220114195347_sle5nu.png" alt></p><h2 id="设备的分配与回收"><a class="markdownIt-Anchor" href="#设备的分配与回收"></a> 设备的分配与回收</h2><h3 id="设备分配概述"><a class="markdownIt-Anchor" href="#设备分配概述"></a> 设备分配概述</h3><p>设备分配时指根据用户的I/O请求分配所需的设备。分配的总原则是充分发挥设备的使用效率，尽可能让设备忙碌，又要避免由于不合理的分配方法造成的进程死锁。</p><p>从设备特性来看，采用下述三种使用方式的设备分别称为独占设备，共享设备和虚拟设备：</p><ul><li>独占式使用设备</li><li>分时共享设备，如磁盘的I/O，各进程的每次I/O操作请求可以通过分时来交替进行</li><li>以SPOOLing方式使用外部设备。该技术是是在批处理操作系统时代引入的，即假脱机I/O技术，这种技术对设备的操作，其实就是对I/O操作进行批处理，是一种以空间换时间的技术。</li></ul><h3 id="设备分配的数据结构"><a class="markdownIt-Anchor" href="#设备分配的数据结构"></a> 设备分配的数据结构</h3><p>设备分配依据的主要数据结构有设备控制表（DCT），控制器控制表（COCT），通道控制表（CHCT）和系统设备表（SDT）</p><p>设备控制表（DCT）：我们可以认为，一个设备控制表就象征一个设备，而这个控制表的表项就是设备的各个属性。如图</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160963/origin-of-ray/asynccode_yrffju.png" alt="img"></p><p>我们前面学了4种I/O控制方式，通道方式显然要比其他几种方式更加优越，因此现代操作系统的I/O控制采用的都是通道控制。</p><p>设备控制器控制设备与内存交换数据，而设备控制器有需要请求通道为其服务，因此每个COCT必定有一个表项存放指向相应通道控制表（CHCT）的指针，而一个通道可为多个设备控制器服务，因此CHCT中必定有一个指针，指向一个表，这个表上的信息表达的是CHCT提供服务的那几个设备控制器。CHCT与COCT的关系是一对多的关系。</p><p>系统设备表（SDT）：整个系统只有一个SDT，它记录已连接到系统中的所有物理设备的情况，每个物理设备占用一个表目。</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642160986/origin-of-ray/asynccode_ep2j2u.png" alt="img"></p><p>由于在多道程序系统中，进程数多于资源数，会引起资源的竞争，因此要有一套合理的分配原则，主要考虑的因素有：I/O设备的固有属性，I/O设备的分配算法，I/O设备分配的安全性，以及I/O设备的独立性。</p><h3 id="设备分配的策略"><a class="markdownIt-Anchor" href="#设备分配的策略"></a> 设备分配的策略</h3><ol><li>设备分配原则。设备分配应根据设备特性，用户要求和系统配置情况。分配的总原则是：既要充分发挥设备的使用效率，又要避免造成进程死锁。还要将用户程序和具体设备隔离开。</li><li>设备分配方式。分为静态分配和动态分配两种。</li></ol><p>静态分配主要用于对独占设备的分配，它在用户作业开始执行前一次性分配完该作业要求的全部设备，控制器（如通道等），一旦分配，这些设备，控制器（和通道）就一直为该作业拥有，直到该作业被撤销。静态分配不会死锁，但是效率低，不符合总原则。</p><p>动态分配是在进程执行过程中根据需要分配，动态分配需要合适的分配算法。</p><ol start="3"><li>设备分配算法。常见的动态设备分配算法有先请求先分配，优先级高者优先等。</li></ol><p>这里可以联系进程调度中的临界资源分配，如何避免死锁，如银行家算法？</p><h3 id="设备分配的安全性"><a class="markdownIt-Anchor" href="#设备分配的安全性"></a> 设备分配的安全性</h3><p>指的是设备分配过程中应该避免死锁</p><ol><li>安全分配方式。每当进程发出I/O请求后便进入阻塞态，直到其他I/O操作完成时才被唤醒，这样，一旦进程获得某种设备后便阻塞，不能再请求任何资源，而且在它阻塞时也不保持任何资源。优点是设备分配安全，但是CPU和I/O是串行的（对于同一个进程而言）。</li><li>不安全的分配方式。进程在发出I/O请求后继续运行，需要时又发出第二个，第三个I/O请求。仅当进程所请求的设备已经被另一个进程占用时，才进入阻塞态。优点是可以同时操作多个设备，从而快速推进进程，缺点是可能有死锁（因为进入阻塞的时候没有释放资源）。</li></ol><h3 id="逻辑设备名到物理设备名的映射"><a class="markdownIt-Anchor" href="#逻辑设备名到物理设备名的映射"></a> 逻辑设备名到物理设备名的映射</h3><p>为了提高设备分配的灵活性和设备的利用率，方便实现I/O重定向，引入了设备独立性。它指的是应用程序独立于具体使用的物理设备。</p><p>为了实现设备独立性，在应用程序中使用逻辑设备名来请求使用某类设备。</p><p>在系统中设置一张逻辑设备表（Logic Unit Table, LUT），用于将逻辑设备名映射为物理设备名。LUT表项包括逻辑设备名，物理设备名和设备驱动程序入口地址。</p><p>当进程用逻辑设备明请求分配设备时，系统为它分配相应的物理设备，并在LUT中建立一个表项，以后进程再利用逻辑设备名请求I/O操作系统时，系统通过查找LUT找到相应的物理设备和驱动。</p><p>可以有两种方式建立LUT：</p><ul><li>在整个系统中只设置一张LUT。主要适用于单用户系统</li><li>每个用户一个LUT。当用户登录时，系统为该用户建立一个进程，以及一个LUT，并把LUT存放到进程的PCB中。</li></ul><h2 id="spooling技术假脱机技术"><a class="markdownIt-Anchor" href="#spooling技术假脱机技术"></a> SPOOLing技术（假脱机技术）</h2><p>为了缓和CPU的高速性和I/O设备的低速性之间的矛盾，引入了脱机I/O技术。</p><p>该技术利用专门的外围控制机，将低速I/O设备上的数据传送到高速磁盘上，或者相反。</p><p>SPOOLing的意思是外部设备同时联机操作，又称假脱机输入/输出操作，是操作系统中采用的一项独占设备改造成共享设备的技术。</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1642161118/origin-of-ray/asynccode_z1kip3.png" alt="img"></p><ol><li>输入井和输出井</li></ol><p>输入井和输出井指的是在磁盘上开辟的两个存储区域。输入井模拟脱机输入时的磁盘用于收容I/O设备输入的数据。输出井模拟脱机输出时的磁盘，用于收容用户程序的输出数据。</p><ol start="2"><li>输入缓冲区和输出缓冲区</li></ol><p>是在内存中开辟的两个缓冲区。输入缓冲区用于暂存由输入设备送来的数据，以后再送到输入井。输出缓冲区用来暂存从输出井送来的数据，以后再送到输出设备。</p><ol start="3"><li>输入进程和输出进程</li></ol><p>输入进程模拟脱机输入是的外围控制机，将用户要求的数据从输入机通过输入缓冲区再送到输入井。当CPU需要输入数据时，直接将数据从输入井读入内存。</p><p>输出进程模拟脱机输出时的外围控制机，把用户要求输出的数据先从内存送到输出井，待输出设备空闲时，在将输出井中的数据经过输出缓冲区送到输出设备</p><p>为什么要从输入机到输入缓冲区（内存）到输入井（磁盘），然后CPU需要时，再从磁盘读会内存，绕一圈？</p><p>为了CPU当前可能并不需要这个数据，提前输入好？</p><p>共享打印机是使用SPOOLing技术的一个实例，这项技术已经被广泛用于多用户系统和局域网。当用户进程请求打印输出时，SPOOLing系统同意打印，但并不是立即把打印机分配给该用户进程，而是为它做了两件事。</p><ul><li>由输出进程在输出井中为之申请一块空闲磁盘块，并将要打印的数据送入</li><li>输出进程再为用户进程申请一个空白的用户请求打印表，并将用户的打印请求填入其中，再将该表挂到请求打印队列中。</li></ul></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Ray Sun</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://sunra.top/2022/01/14/operating-system-note-8-io-subsystem/" title="操作系统学习笔记（八）I&#x2F;O管理子系统">https://sunra.top/2022/01/14/operating-system-note-8-io-subsystem/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"> <span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/2022/01/07/operating-system-note-7-io-introduction/" rel="prev" title="操作系统学习笔记（七）I/O管理概述"><i class="fa fa-chevron-left"></i> 操作系统学习笔记（七）I/O管理概述</a></div><div class="post-nav-item"> <a href="/2022/01/22/unity-async/" rel="next" title="Unity 中的异步">Unity 中的异步<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2022/01/14/operating-system-note-8-io-subsystem/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>