<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Nginx is a lightweight web server and reverse proxy server. Due to its small memory footprint, extremely fast startup, and strong concurrency capability, it is widely used in Internet projects."><meta property="og:type" content="article"><meta property="og:title" content="nginx understanding and cross-domain solution"><meta property="og:url" content="https://sunra.top/en/2019/08/07/nginx_and_cors/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Nginx is a lightweight web server and reverse proxy server. Due to its small memory footprint, extremely fast startup, and strong concurrency capability, it is widely used in Internet projects."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1565269970/v2-c8ac111c267ae0745f984e326ef0c47f_hd_xln6m2.jpg"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1565269973/v2-4787a512240b238ebf928cd0651e1d99_hd_o9ma5f.jpg"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1565269988/20130515152325076_jd3uk5.png"><meta property="article:published_time" content="2019-08-07T12:41:02.000Z"><meta property="article:modified_time" content="2023-08-12T13:44:04.370Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1565269970/v2-c8ac111c267ae0745f984e326ef0c47f_hd_xln6m2.jpg"><link rel="canonical" href="https://sunra.top/en/2019/08/07/nginx_and_cors/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2019/08/07/nginx_and_cors/","path":"2019/08/07/nginx_and_cors/","title":"nginx understanding and cross-domain solution"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>nginx understanding and cross-domain solution | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Forward-proxy-and-reverse-proxy"><span class="nav-number">1.</span> <span class="nav-text">Forward proxy and reverse proxy</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Forward-proxy"><span class="nav-number">1.1.</span> <span class="nav-text">Forward proxy:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Reverse-proxy"><span class="nav-number">1.2.</span> <span class="nav-text">Reverse proxy:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx-modules-and-working-principles"><span class="nav-number">2.</span> <span class="nav-text">Nginx modules and working principles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx-Process-Model"><span class="nav-number">3.</span> <span class="nav-text">Nginx Process Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thermal-deployment-principle"><span class="nav-number">4.</span> <span class="nav-text">Thermal deployment principle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuration-file"><span class="nav-number">5.</span> <span class="nav-text">Configuration file</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP-module"><span class="nav-number">5.1.</span> <span class="nav-text">HTTP module</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Server-module"><span class="nav-number">5.2.</span> <span class="nav-text">Server module</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Location-module"><span class="nav-number">5.3.</span> <span class="nav-text">Location module</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Upstream-module"><span class="nav-number">5.4.</span> <span class="nav-text">Upstream module</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nginx-solves-cross-domain-problems"><span class="nav-number">6.</span> <span class="nav-text">Nginx solves cross-domain problems</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:10px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>最好用的程序员的一站式工具平台，拥有最好用的GPT及其Prompt列表，最精准的翻译功能和全网搜索功能</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2019/08/07/nginx_and_cors/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="nginx understanding and cross-domain solution | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> nginx understanding and cross-domain solution</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-08-07 20:41:02" itemprop="dateCreated datePublished" datetime="2019-08-07T20:41:02+08:00">2019-08-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-12 21:44:04" itemprop="dateModified" datetime="2023-08-12T21:44:04+08:00">2023-08-12</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2019/08/07/nginx_and_cors/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2019/08/07/nginx_and_cors/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Nginx is a lightweight web server and reverse proxy server. Due to its small memory footprint, extremely fast startup, and strong concurrency capability, it is widely used in Internet projects.</p><span id="more"></span><h3 id="Forward-proxy-and-reverse-proxy"><a href="#Forward-proxy-and-reverse-proxy" class="headerlink" title="Forward proxy and reverse proxy"></a>Forward proxy and reverse proxy</h3><h4 id="Forward-proxy"><a href="#Forward-proxy" class="headerlink" title="Forward proxy:"></a>Forward proxy:</h4><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1565269970/v2-c8ac111c267ae0745f984e326ef0c47f_hd_xln6m2.jpg" alt="正向代理"><br>As shown in the figure above, due to the existence of the firewall, we cannot directly access Google. At this time, we can bypass the firewall through the VPN. In this process, the Client understands the destination that his request needs to reach, but this The request will be proxied by the VPN, so the server actually does not know where the request actually comes from, and the forward proxy is the Client.</p><h4 id="Reverse-proxy"><a href="#Reverse-proxy" class="headerlink" title="Reverse proxy:"></a>Reverse proxy:</h4><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1565269973/v2-4787a512240b238ebf928cd0651e1d99_hd_o9ma5f.jpg" alt="反向代理"><br>The reverse proxy proxy is the server. For the Client, he does not know where his request ends up and which server handles it. He just sends the request to the proxy server, and the reverse proxy server sends the request to the proxy server. Another server in the intranet handles it. The process of reverse proxy is transparent to the Client.</p><h3 id="Nginx-modules-and-working-principles"><a href="#Nginx-modules-and-working-principles" class="headerlink" title="Nginx modules and working principles"></a>Nginx modules and working principles</h3><p>Nginx consists of internal cores and modules. The kernel is very simple, just mapping Client requests to a location block by looking up the configuration file.</p><p>Nginx modules are structurally divided into core modules, basic modules, and third-party modules.<br>Core modules: HTTP module, EVENT module, MAIL module<br>Basic modules: HTTP Access module, HTTP FastCGI module, HTTP Proxy module and HTTP Rewrite module<br>Third-party modules: HTTP Upstream Request Hash module, Notice module, and HTTP Access Key module.</p><p>Nginx modules are functionally divided into the following three categories.<br>Handlers (processor modules). This type of module directly processes requests and performs operations such as outputting content and modifying headers information. There is generally only one Handlers processor module.<br>Filters (filter modules). This type of module mainly modifies the output of other processor modules and is finally output by Nginx.<br>Proxies (proxy module). This type of module is a module such as HTTP Upstream of Nginx. These modules mainly interact with backend services such as FastCGI, and implement functions such as service proxy and Load Balance.<br><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1565269988/20130515152325076_jd3uk5.png" alt="nginx"></p><p>So in fact, nginx itself only maps the request to different locations according to the configuration file, and then returns the processing result.</p><h3 id="Nginx-Process-Model"><a href="#Nginx-Process-Model" class="headerlink" title="Nginx Process Model"></a>Nginx Process Model</h3><p>After nginx is started, there will be a master process and multiple worker processes. The master process is mainly used to manage the worker process, including: receiving signals from the outside world, sending signals to each worker process, monitoring the running status of the worker process, and automatically restarting the new worker process when the worker process exits (in abnormal cases). The basic network events are handled in the worker process. Multiple worker processes are equal, they compete equally for requests from clients, and each process is independent of each other. A request can only be processed in a worker process, and a worker process cannot handle requests from other processes. The number of worker processes can be set. Generally, we will set it to be consistent with the number of machine cpu cores. The reason for this is inseparable from the nginx process model and event handling model.<br>But if there are multiple workers, when a request comes in, all worker processes can listen to the request, how to choose a process to handle the request?<br>In response to this situation, nginx provides mutual exclusion. Only when you get the lock can you accept requests</p><h3 id="Thermal-deployment-principle"><a href="#Thermal-deployment-principle" class="headerlink" title="Thermal deployment principle"></a>Thermal deployment principle</h3><p>After modifying the configuration file nginx.conf, regenerate the new worker process. Of course, the request will be processed with the new configuration, and the new request must be handed over to the new worker process. As for the old worker process, wait for those previous requests. After processing, kill it.</p><h3 id="Configuration-file"><a href="#Configuration-file" class="headerlink" title="Configuration file"></a>Configuration file</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">main</span><br><span class="line">events   &#123;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line">http        &#123;</span><br><span class="line">  ....</span><br><span class="line">  upstream myproject &#123;</span><br><span class="line">    .....</span><br><span class="line">  &#125;</span><br><span class="line">  server  &#123;</span><br><span class="line">    ....</span><br><span class="line">    location &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  server  &#123;</span><br><span class="line">    ....</span><br><span class="line">    location &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The configuration file of nginx is mainly divided into six parts, namely global configuration (main), nginx working mode (events), http settings (http), host settings (server), URL matching (location), Load Balance server settings (upstream)</p><p>We often use http, server, and location.</p><h4 id="HTTP-module"><a href="#HTTP-module" class="headerlink" title="HTTP module"></a>HTTP module</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line">    access_log  /usr/local/var/log/nginx/access.log  main;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    tcp_nopush      on;</span><br><span class="line">    tcp_nodelay     on;</span><br><span class="line">    keepalive_timeout  10;</span><br><span class="line">    #gzip  on;</span><br><span class="line">    upstream myproject &#123;</span><br><span class="line">        .....</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Include: Used to set the mime type of the file. The type is defined in mime.type in the configuration file directory to tell nginx to recognize the type of the file<br>default_type: Set the default type to binary<br>log_format: Set the log format and record which parameters<br>access_log the file address used to record each access log, followed by main is the log format style, corresponding to the log_format main.<br>The sendfile parameter is used to enable efficient file transfer mode. Set the tcp_nopush and tcp_nodelay directives to on to prevent network congestion.<br>keepalive_timeout set a timeout for the Client connection to remain active. After this time, the server closes the connection.</p><h4 id="Server-module"><a href="#Server-module" class="headerlink" title="Server module"></a>Server module</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       8080;</span><br><span class="line">        server_name  localhost 192.168.12.10 www.yangyi.com;</span><br><span class="line">        #  global definition, if it is the same directory, so the definition of the simplest.</span><br><span class="line">        root   /Users/yangyi/www;</span><br><span class="line">        index  index.php index.html index.htm; </span><br><span class="line">        charset utf-8;</span><br><span class="line">        access_log  usr/local/var/log/host.access.log  main;</span><br><span class="line">        aerror_log  usr/local/var/log/host.error.log  error;</span><br><span class="line">        ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The server flag defines the start of the virtual host.<br>Listen is used to specify the server level port of the virtual host.<br>server_name used to specify an IP address or domain name, separated by a space.<br>Root represents the entire root web root directory within the entire server virtual host. Note that it should be distinguished from the one defined under locate {}.<br>Index globally defines the default homepage address for access. Note that it should be distinguished from the one defined under locate {}.<br>Charset is used to set the default encoding format for web pages.<br>access_log used to specify the access log storage path for this virtual host, and the final main is used to specify the output format of the access log.</p><h4 id="Location-module"><a href="#Location-module" class="headerlink" title="Location module"></a>Location module</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">            root   /Users/yangyi/www;</span><br><span class="line">            index  index.php index.html index.htm;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>Location/means matching the access root directory.<br>The root directive is used to specify the web directory of the virtual host when accessing the root directory. This directory can be a relative path (relative path is relative to the installation directory of nginx). It can also be an absolute path.<br>Index is used to set the default home page address that we only access after entering the domain name. There is a sequence: index.php index.html index.htm. If the directory view permission is not enabled and these default home pages cannot be found, a 403 error will be reported.</p><h4 id="Upstream-module"><a href="#Upstream-module" class="headerlink" title="Upstream module"></a>Upstream module</h4><p>Upstream module Load Balance module, through a simple scheduling algorithm to achieve Client IP to the backend server Load Balance.<br></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream iyangyi.com&#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.12.1:80;</span><br><span class="line">    server 192.168.12.2:80 down;</span><br><span class="line">    server 192.168.12.3:8080  max_fails=3  fail_timeout=20s;</span><br><span class="line">    server 192.168.12.4:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Inside is ip_hash This is one of the Load Balance scheduling algorithms, which will be introduced below. Followed by various servers. Identify with the server keyword, followed by ip.<p></p><p>The Load Balance module of Nginx currently supports 4 scheduling algorithms:</p><ol><li>weight polling (default). Each request is assigned to a different backend server one by one in chronological order. If a server in the backend is downtimed, the faulty system will be automatically removed, leaving user access unaffected. Weight. Specify the polling weight value. The higher the weight value, the higher the probability of access assigned. It is mainly used when the performance of each server in the backend is uneven.<br>ip_hash. Each request is assigned according to the hash result of the access IP, so that visitors from the same IP can access a backend server, which effectively solves the problem of session sharing in dynamic web pages.</li><li>fair. More intelligent than the above two Load Balance algorithm. This algorithm can be based on the page size and load time to intelligently Load Balance, that is, according to the response time of the backend server to allocate requests, the response time is short priority allocation. Nginx itself does not support fair, if you need to use this scheduling algorithm, you must download the upstream_fair module of Nginx.<br>url_hash. Allocating requests according to the hash result of the access url, so that each url is directed to the same backend server, which can further improve the efficiency of the backend cache server. Nginx itself does not support url_hash. If you need to use this scheduling algorithm, you must install the Nginx hash package.</li></ol><h3 id="Nginx-solves-cross-domain-problems"><a href="#Nginx-solves-cross-domain-problems" class="headerlink" title="Nginx solves cross-domain problems"></a>Nginx solves cross-domain problems</h3><p>The debugging page is: <a target="_blank" rel="external nofollow noopener noreferrer" href="http://192.168.1.2:8080/">http://192.168.1.2:8080/</a></p><p>The requested interface is: <a target="_blank" rel="external nofollow noopener noreferrer" href="http://sun668.vip/api/get/info">http://sun668.vip/api/get/info</a></p><p>Step 1:</p><p>The requested interface is: <a target="_blank" rel="external nofollow noopener noreferrer" href="http://192.168.1.2/api/get/info">http://192.168.1.2/api/get/info</a></p><p>PS: This solves the cross-domain problem.</p><p>Step 2:</p><p>Modify the nginx.conf file:<br></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">  listen 8088;</span><br><span class="line">  server_name  192.168.1.2;</span><br><span class="line"></span><br><span class="line">  location /&#123;</span><br><span class="line">    proxy_pass http://192.168.1.2:8080;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location /api&#123;</span><br><span class="line">    proxy_pass http://sun668.vip/api;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p></p><p>Reference documents:<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.zybuluo.com/phper/note/89391">https://www.zybuluo.com/phper/note/89391</a><br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/mine_song/article/details/56678736">https://blog.csdn.net/mine_song/article/details/56678736</a><br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/hguisu/article/details/8930668">https://blog.csdn.net/hguisu/article/details/8930668</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2019/08/07/nginx_and_cors/" title="nginx understanding and cross-domain solution">https://sunra.top/en/2019/08/07/nginx_and_cors/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"> <a href="/en/2019/08/10/same_orgin_and_cors/" rel="next" title="Thinking about Same Origin Strategy and Cross-domain Method">Thinking about Same Origin Strategy and Cross-domain Method<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2019/08/07/nginx_and_cors/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>