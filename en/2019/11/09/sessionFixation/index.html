<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Session  Session A storage structure for a class of schemes used to maintain state between a client and a server"><meta property="og:type" content="article"><meta property="og:title" content="Session Fixation Principle and Defense"><meta property="og:url" content="https://sunra.top/en/2019/11/09/sessionFixation/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Session  Session A storage structure for a class of schemes used to maintain state between a client and a server"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2019-11-09T00:08:41.000Z"><meta property="article:modified_time" content="2024-07-02T00:25:58.769Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2019/11/09/sessionFixation/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2019/11/09/sessionFixation/","path":"2019/11/09/sessionFixation/","title":"Session Fixation Principle and Defense"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Session Fixation Principle and Defense | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#session"><span class="nav-number">1.</span> <span class="nav-text">Session</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#session-2"><span class="nav-number">1.1.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#session-3"><span class="nav-number">1.2.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#session-4"><span class="nav-number">1.3.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#why-do-we-need-a-session"><span class="nav-number">1.4.</span> <span class="nav-text">Why do we need a session?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#specific-mechanisms"><span class="nav-number">1.5.</span> <span class="nav-text">Specific mechanisms</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#session-5"><span class="nav-number">2.</span> <span class="nav-text">Session</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#definition"><span class="nav-number">2.1.</span> <span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#attack-flow"><span class="nav-number">2.2.</span> <span class="nav-text">Attack flow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defense-methods"><span class="nav-number">2.3.</span> <span class="nav-text">Defense methods</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#express-session"><span class="nav-number">3.</span> <span class="nav-text">Express-session</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2019/11/09/sessionFixation/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Session Fixation Principle and Defense | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Session Fixation Principle and Defense</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-11-09 08:08:41" itemprop="dateCreated datePublished" datetime="2019-11-09T08:08:41+08:00">2019-11-09</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-07-02 08:25:58" itemprop="dateModified" datetime="2024-07-02T08:25:58+08:00">2024-07-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Security/" itemprop="url" rel="index"><span itemprop="name">Security</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2019/11/09/sessionFixation/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2019/11/09/sessionFixation/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><h3 id="session"><a class="markdownIt-Anchor" href="#session"></a> Session</h3><h4 id="session-2"><a class="markdownIt-Anchor" href="#session-2"></a> Session</h4><p>A storage structure for a class of schemes used to maintain state between a client and a server</p><span id="more"></span><h4 id="session-3"><a class="markdownIt-Anchor" href="#session-3"></a> Session</h4><p>Since the Session is stored in the form of a text file on the server side, it is not afraid that the Client can modify the content. It can be stored directly in memory or in a memory database such as redis. Of course, it is also possible to store it in other databases.</p><p>Sessions have a lifecycle</p><p>The so-called lightweight means that its creation and deletion do not need to consume too many resources</p><p>There is a cache inside the Session object</p><h4 id="session-4"><a class="markdownIt-Anchor" href="#session-4"></a> Session</h4><p>It is used to store the attributes and configuration information of a specific user session, such as the user’s identity information, etc., which will not be lost when the web page jumps.</p><p>Usually used for the following operations:</p><ul><li>Store information that maintains user status throughout the session, such as login information or other information generated by user browsing</li><li>Store objects that only need to maintain state between pages during a new load, or a set of functional pages<br> Maintain user status information on the web server for accessing pages from any device at any time</li></ul><p>Restrictions:</p><ul><li>The more users log in, the more memory the session needs</li><li>The duration of each session object is user access time plus inactivity time</li></ul><h4 id="why-do-we-need-a-session"><a class="markdownIt-Anchor" href="#why-do-we-need-a-session"></a> Why do we need a session?</h4><p>Because the HTTP protocol itself is stateless, there is no way for users to remember the login status within a period of time after logging in. It requires another tool to record the login status and generate an id for this record to return to the Client. After being saved, each subsequent request will take this id to automatically authenticate the login status.</p><p>An example of coffee:</p><ol><li><p>The clerk of the store is very powerful and can remember the consumption amount of each customer. As long as the customer walks into the coffee shop, the clerk will know how to treat it. This approach is the support state of the protocol itself.</p></li><li><p>Give the customer a card, which records the amount of consumption, usually with an expiration date. Every time the customer presents this card, the consumption will be linked to previous or future consumption. This practice is to keep the status in the Client.</p></li><li><p>A membership card is issued to the customer, and no information is recorded except the card number. Every time the customer produces the card, the clerk finds the record corresponding to the card number in the store’s record book and adds some consumption information. This approach is to maintain the state on the server side.</p></li></ol><h4 id="specific-mechanisms"><a class="markdownIt-Anchor" href="#specific-mechanisms"></a> Specific mechanisms</h4><ol><li><p>When the program needs to create a’session ‘for a client’s request (usually after the login information is successfully verified to create a session for these information), the server first checks whether the client’s request already contains a ** session Identifier ** - called’session id’, if it already contains a’session id ‘, it means that a session has been created for this Client before, and the server retrieves the’session’ according to the’session id ’ (if it cannot be retrieved, it may create a new one), if the Client request does not contain the’session id’, then this is Client creates a’session ‘and generates a’session id’ associated with this’session ‘. The value of the’session id’ should be a string ** that will not be repeated and is not easy to find patterns to imitate **, this The’session id 'will be returned to the Client for saving in this response (usually set this sessionid to the cookie through the set-cookie header in the return header, and the next request will automatically send this sessionid to the background through the cookie).</p></li><li><p>Since’cookies’ can be artificially disabled, there must be other mechanisms in place to still be able to pass the’session id ‘back to the server when’cookies’ are disabled. A technique often used is called’URL 'rewriting</p><p>Two forms:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//append path as url</span><br><span class="line">&#x27;http://..../xxx;jsessionid=abcdefjijeoijoifjioe&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//as a query string</span><br><span class="line">&#x27;http://..../xxx?jsessionid=abcdefjijeoijoifjioe&#x27;</span><br><span class="line">Copy the code</span><br></pre></td></tr></table></figure></li><li><p>Older technology, ** form hidden fields **, this method is useful in preventing csrf</p></li></ol><h3 id="session-5"><a class="markdownIt-Anchor" href="#session-5"></a> Session</h3><h4 id="definition"><a class="markdownIt-Anchor" href="#definition"></a> Definition</h4><p>Session fixation attack is to use the session ID fixed mechanism of the application system in the server to obtain authentication and authorization with the help of others with the same session ID, and then use the session ID to hijack other people’s sessions to successfully impersonate others, resulting in session fixation attack</p><h4 id="attack-flow"><a class="markdownIt-Anchor" href="#attack-flow"></a> Attack flow</h4><ol><li><p>Attackers can access the application website normally;</p></li><li><p>The application website server returns a session ID (attackSessionID) to him;</p></li><li><p>The Attacker uses the session ID to construct a link to the website (<a target="_blank" rel="external nofollow noopener noreferrer" href="http://website.kom/login.php">http://website.kom/login.php</a>? sessionid = attackerSessionID) and sends it to the Victim;</p></li><li><p>Click the link, carry the attacker’s session ID and username password to log in to the website normally, and the session is successfully established; at this time, if you use the attackerSessionID to access the server, the server will consider the attacker to be the victim.</p></li><li><p>The Attacker successfully impersonated and hijacked the Victim’s session with the session ID.</p></li></ol><h4 id="defense-methods"><a class="markdownIt-Anchor" href="#defense-methods"></a> Defense methods</h4><p>The root cause of the entire attack process is to directly use the sessionID sent by the link to generate a session and return the sessionID directly.</p><p>The solution is also very simple. Interfaces with sensitive information like login need to regenerate a new sessionID.</p><h3 id="express-session"><a class="markdownIt-Anchor" href="#express-session"></a> Express-session</h3><p>Express-session is a plugin for the node server framework express. For details, please refer to how to use it.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/expressjs/session">express-session文档</a>If you want to understand the principle, you can also look at the source code. In fact, the principle is very simple, but it is encapsulated. It is the generation of cookies and set-cookies in the request header, and the encapsulation of CRUD in the session.</p><p>It is worth noting that its store option, that is, the storage location. If it does not pass a value, it will be stored in memory by default. We can implement a plugin ourselves, as long as the plugin implements the get, set, touch and other interfaces mentioned in the doc above. It doesn’t matter if your interfaces store data to Redis, MongoDB or anywhere else.</p><p>If you just use express-session to manage the session, there is no way to defend against session fixation, and there is no need to regenerate the sessionID for every request. We only need to regenerate the sessionID for some sensitive operations, such as login. Good. Such as:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fixation</span> = (<span class="params">options</span>) =&gt; &#123;</span><br><span class="line">  options = options || &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    req.<span class="property">resetSessionID</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> session = req.<span class="property">session</span>;</span><br><span class="line">        req.<span class="property">session</span>.<span class="title function_">regenerate</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> session) &#123;</span><br><span class="line">              <span class="keyword">if</span> (!req.<span class="property">session</span>[i]) &#123;</span><br><span class="line">                req.<span class="property">session</span>[i] = session[i];</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">resolve</span>(req.<span class="property">session</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">everyRequest</span> &amp;&amp; req.<span class="property">headers</span>[<span class="string">&#x27;X-Requested-With&#x27;</span>] ! <span class="string">&#x27;XMLHttpRequest&#x27;</span> &amp;&amp; !req.<span class="property">xhr</span>) &#123;</span><br><span class="line">      req.<span class="title function_">resetSessionID</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="title function_">next</span>(err);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>The above code regenerates an id through the regenerate method built into express-session, and sets the original session content to the newly generated session.</p><p>We only need to call this method in the request that needs to reset the id.</p><p>Reference article:</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://juejin.im/post/5af828e96fb9a07ab83e1f10">https://juejin.im/post/5af828e96fb9a07ab83e1f10</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2019/11/09/sessionFixation/" title="Session Fixation Principle and Defense">https://sunra.top/en/2019/11/09/sessionFixation/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2019/11/01/InfineScroll/" rel="prev" title="InfineScroll 无限加载bug"><i class="fa fa-chevron-left"></i> InfineScroll 无限加载bug</a></div><div class="post-nav-item"> <a href="/en/2019/11/16/OAuth%20and%20OIDC/" rel="next" title="OAuth and OIDC">OAuth and OIDC<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2019/11/09/sessionFixation/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>