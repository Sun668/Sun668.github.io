<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Introduction to RPCRPC (Remote Procedure Call): Remote procedure call is the idea of requesting services from a remote computer program over a network without knowledge of the underlying network techn"><meta property="og:type" content="article"><meta property="og:title" content="Introduction to RPC Concepts"><meta property="og:url" content="https://sunra.top/en/2020/08/17/rpc/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Introduction to RPCRPC (Remote Procedure Call): Remote procedure call is the idea of requesting services from a remote computer program over a network without knowledge of the underlying network techn"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1597670692/Blog/fd5b5686336b0a1212398d8ea8fe6f66.jpg-wh_651x-s_3461264051_xmwq0x.jpg"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1597670948/Blog/2730356-e239aeb499d61162.png_ejj0qe.webp"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1597672620/Blog/9033085-334724946c50139e.png_i6remn.webp"><meta property="article:published_time" content="2020-08-17T13:15:02.000Z"><meta property="article:modified_time" content="2023-08-13T02:28:52.143Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1597670692/Blog/fd5b5686336b0a1212398d8ea8fe6f66.jpg-wh_651x-s_3461264051_xmwq0x.jpg"><link rel="canonical" href="https://sunra.top/en/2020/08/17/rpc/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2020/08/17/rpc/","path":"2020/08/17/rpc/","title":"Introduction to RPC Concepts"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Introduction to RPC Concepts | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction-to-RPC"><span class="nav-number">1.</span> <span class="nav-text">Introduction to RPC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Example"><span class="nav-number">1.1.</span> <span class="nav-text">Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPC-architecture"><span class="nav-number">2.</span> <span class="nav-text">RPC architecture</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RPC-core-functions-RPC-protocol"><span class="nav-number">2.1.</span> <span class="nav-text">RPC core functions (RPC protocol)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RPC"><span class="nav-number">2.2.</span> <span class="nav-text">RPC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPC-protocol-implementation"><span class="nav-number">3.</span> <span class="nav-text">RPC protocol implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Addressing"><span class="nav-number">3.1.</span> <span class="nav-text">Service Addressing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Serialization-and-deserialization"><span class="nav-number">3.2.</span> <span class="nav-text">Serialization and deserialization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-transmission"><span class="nav-number">3.3.</span> <span class="nav-text">Network transmission</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Based-on"><span class="nav-number">3.3.1.</span> <span class="nav-text">** Based on</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Based-on-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">** Based on</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Comparison-of-two-ways"><span class="nav-number">3.3.3.</span> <span class="nav-text">Comparison of two ways</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RabbitMQ"><span class="nav-number">3.3.4.</span> <span class="nav-text">RabbitMQ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPC-Service-Registration-and-Discovery"><span class="nav-number">4.</span> <span class="nav-text">RPC Service Registration and Discovery</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-registration"><span class="nav-number">4.1.</span> <span class="nav-text">Service registration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Discovery"><span class="nav-number">4.2.</span> <span class="nav-text">Service Discovery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Perception-service-offline"><span class="nav-number">4.3.</span> <span class="nav-text">Perception service offline</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPC%E4%B8%8ERESTful"><span class="nav-number">5.</span> <span class="nav-text">RPC与RESTful</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Different-categories"><span class="nav-number">5.1.</span> <span class="nav-text">Different categories</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Different-ways-of-use"><span class="nav-number">5.2.</span> <span class="nav-text">Different ways of use</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Object-Oriented"><span class="nav-number">5.3.</span> <span class="nav-text">Object Oriented</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Different-serialization-protocols"><span class="nav-number">5.4.</span> <span class="nav-text">Different serialization protocols</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-scenarios"><span class="nav-number">5.5.</span> <span class="nav-text">Application scenarios</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2020/08/17/rpc/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Introduction to RPC Concepts | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Introduction to RPC Concepts</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-08-17 21:15:02" itemprop="dateCreated datePublished" datetime="2020-08-17T21:15:02+08:00">2020-08-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-13 10:28:52" itemprop="dateModified" datetime="2023-08-13T10:28:52+08:00">2023-08-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Sundry/" itemprop="url" rel="index"><span itemprop="name">Sundry</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2020/08/17/rpc/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2020/08/17/rpc/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="Introduction-to-RPC"><a href="#Introduction-to-RPC" class="headerlink" title="Introduction to RPC"></a>Introduction to RPC</h2><p>RPC (Remote Procedure Call): Remote procedure call is the idea of requesting services from a remote computer program over a network without knowledge of the underlying network technology.</p><p>The main functional goal of RPC (Remote Procedure Call) is to make it easier to build distributed computing (applications) without losing the semantic simplicity of local calls when providing powerful remote call capabilities. To achieve this goal, <strong>the RPC framework needs to provide a transparent call mechanism so that users do not have to explicitly distinguish between local and remote calls</strong> .　　<br> RPC adopts the C/S mode. The requester is a client, and the service provider is a server. First, the client calling process sends a call message with process parameters to the service process, and then waits for the reply message. On the server side, the process remains asleep until the call message arrives. When a call message arrives, the server gets the process parameters, calculates the result, sends the reply message, and then waits for the next call message. Finally, the Client calling process receives the reply message, gets the process result, and then calls execution to continue.</p><span id="more"></span><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>The concept above may still be a bit vague when viewed alone</p><p>Let’s take a look at the RPC demo that comes with Python</p><p>Server.py：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> SimpleXMLRPCServer <span class="keyword">import</span> SimpleXMLRPCServer    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun_add</span>(<span class="params">a,b</span>):     </span><br><span class="line">    totle = a + b      </span><br><span class="line">    <span class="keyword">return</span> totle </span><br><span class="line"><span class="keyword">if</span> __name__  <span class="string">&#x27;__main__&#x27;</span>:     </span><br><span class="line">    S = SimpleXMLRPCServer ((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8080</span>)) <span class="comment">#Enable xmlrpcserver     </span></span><br><span class="line">    register_function (fun_add) <span class="comment">#register function fun_add     </span></span><br><span class="line">    Print <span class="string">&quot;server is online...&quot;</span> s. serve_forever () <span class="comment">#open loop wait </span></span><br></pre></td></tr></table></figure><p>Client.py：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Import ServerProxy <span class="keyword">from</span> xmlrpclib <span class="comment">#Import packages from xmlrpclib </span></span><br><span class="line">S = ServerProxy (<span class="string">&quot;http://172.171.5.205:8080&quot;</span>) <span class="comment">#define xmlrpc Client </span></span><br><span class="line"><span class="built_in">print</span> s.fun_add(<span class="number">2</span>,<span class="number">3</span>)    </span><br></pre></td></tr></table></figure><h2 id="RPC-architecture"><a href="#RPC-architecture" class="headerlink" title="RPC architecture"></a>RPC architecture</h2><p>In a typical RPC usage scenario, it includes components such as Service Discovery, load, fault tolerance, network transmission, and serialization. Among them, the “RPC protocol” indicates how the program performs network transmission and serialization.</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1597670692/Blog/fd5b5686336b0a1212398d8ea8fe6f66.jpg-wh_651x-s_3461264051_xmwq0x.jpg" alt></p><h3 id="RPC-core-functions-RPC-protocol"><a href="#RPC-core-functions-RPC-protocol" class="headerlink" title="RPC core functions (RPC protocol)"></a>RPC core functions (RPC protocol)</h3><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1597670948/Blog/2730356-e239aeb499d61162.png_ejj0qe.webp" alt></p><ul><li>Client (Client): The service caller.</li><li>Client Stub (Client Stub): Stores server level address information, packs the request parameter data information of the client into a network message, and then sends it to the server level through network transmission.</li><li>Server level stub (Server Stub): Receive and unpack the request message sent by the Client, and then call the local service for processing.</li><li>server level (Server): the true provider of the service.<br>Network Service: The underlying transport, which can be TCP or HTTP.</li></ul><h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><ul><li>The service consumer (Client Client) invokes the service through local invocation.</li><li>Client stub (Client Stub) is responsible for serializing (assembling) information such as methods and imported parameters into a message body that can be transmitted over the network after receiving the call request.</li><li>Client Stub finds the remote service address and sends the message to the server level over the network.</li><li>The server level stub decodes the message after it is received (deserialization operation).</li><li>server level stub (Server Stub) calls the local service for related processing according to the decoding result</li><li>server level (Server) local service business processing.<br>The results are returned to the server level stub.</li><li>Server level stub serialization results.</li><li>The server level stub sends the results over the network to the consumer.</li><li>The Client Stub receives the message and decodes it (deserializes).</li><li>The service consumer gets the final result.</li></ul><h2 id="RPC-protocol-implementation"><a href="#RPC-protocol-implementation" class="headerlink" title="RPC protocol implementation"></a>RPC protocol implementation</h2><p>The core function of RPC is mainly composed of 5 modules. If you want to implement an RPC yourself, the simplest way is to achieve three technical points, namely:</p><ul><li>Service addressing<br>Serialization and deserialization of data streams</li><li>Network transmission</li></ul><h3 id="Service-Addressing"><a href="#Service-Addressing" class="headerlink" title=" Service Addressing "></a> <strong>Service Addressing</strong></h3><p>Service addressing can use Call ID mapping. In local calls, the function body is specified directly through the function pointer, but in remote calls, the function pointer is not possible because the address spaces of the two processes are completely different.</p><p>So in RPC, all functions must have their own ID. This ID is uniquely determined in all processes.</p><p>Client must attach this ID when making remote procedure calls. Then we also need to maintain a corresponding table of function and Call IDs at the Client and server levels respectively.</p><p>When the client needs to make a remote call, it looks up this table, finds out the corresponding Call ID, and then passes it to the server level. The server level also looks up the table to determine the function that the client needs to call, and then executes the corresponding function. Code.</p><p>Implementation method: Service registration center.</p><p>To invoke a service, you first need a service registry to query which instances of the other service exist.</p><h3 id="Serialization-and-deserialization"><a href="#Serialization-and-deserialization" class="headerlink" title=" Serialization and deserialization "></a> <strong>Serialization and deserialization</strong></h3><p>How does the client pass parameter values to a remote function? In a local call, we just need to push the parameters onto the stack and let the function read them on the stack by itself.</p><p>However, during remote procedure calls, the client and server levels are different processes and cannot pass parameters through memory.</p><p>At this time, the client needs to convert the parameters into a ByteFlow first, pass it to the server level, and then convert the ByteFlow into a format that can be read by itself.</p><p>Only binary data can be transmitted in the network. The definitions of serialization and deserialization are:</p><p>The process of converting an object into a binary stream is called serialization<br>The process of converting a binary stream into an object is called deserialization</p><p>This process is called serialization and deserialization. Similarly, values returned from the server level also need to be serialized and deserialized.</p><h3 id="Network-transmission"><a href="#Network-transmission" class="headerlink" title=" Network transmission "></a> <strong>Network transmission</strong></h3><p>Network transmission: Remote calls are often used on the network, and the client and server levels are connected through the network.</p><p>All data needs to be transmitted over the network, so there needs to be a network transport layer. The network transport layer needs to pass the Call ID and serialized parameter bytes to the server level, and then pass the serialized call result back to the Client.</p><p>As long as it can complete both, it can be used as a transport layer. Therefore, the protocol it uses is actually unlimited, as long as it can complete the transmission.</p><p>Although most RPC frameworks use the TCP protocol, UDP can also be used, while gRPC simply uses HTTP2.</p><p>TCP connections are the most common, a brief analysis of TCP-based connections: usually TCP connections can be on-demand connections (when you need to call to establish a connection, immediately after the call is broken), or long connections (Client and server After establishing a connection to maintain long-term holding, regardless of whether there is a data packet sent at this time, you can cooperate with the heartbeat detection mechanism to regularly detect whether the established connection is alive and valid), multiple remote procedure calls share the same connection.</p><p>There are many optional network transmission methods in RPC, including TCP protocol, UDP protocol, and HTTP protocol.</p><p>Each protocol has a different impact on the overall performance and efficiency. How to choose a correct network transmission protocol? First of all, it is necessary to understand how various transmission protocols work in RPC.</p><h4 id="Based-on"><a href="#Based-on" class="headerlink" title="** Based on"></a>** Based on</h4><p>A socket connection is established between the caller of the service and the provider of the service, and the caller of the service serializes the interface name, method name and parameters to be called through the socket and passes them to the provider of the service, and the provider of the service deserializes them. Then use reflection to call related methods.</p><p>Returns the result to the caller of the service, which is roughly the case for the entire TCP-based RPC call.</p><p>However, in the example application, a series of encapsulation will be carried out. For example, RMI is to pass serializable Java objects on the TCP protocol.</p><h4 id="Based-on-1"><a href="#Based-on-1" class="headerlink" title="** Based on"></a>** Based on</h4><p>This method is more like accessing a web page, but its return result is more simple and simple.</p><p>The approximate process is as follows: the caller of the service sends a request to the provider of the service. The method of this request may be one of GET, POST, PUT, DELETE, etc. The provider of the service may make different requests according to different request methods. Different processing, or a certain method only allows a certain request method.</p><p>The specific method of the call is to call the method according to the URL, and the parameters required by the method may be the result of parsing the XML data or JSON data transmitted to the service caller, and return the JOSN or XML data result.</p><p>Since there are currently many open source web servers, such as Tomcat, it is easier to implement, just like working on a web project.</p><h4 id="Comparison-of-two-ways"><a href="#Comparison-of-two-ways" class="headerlink" title=" Comparison of two ways "></a> <strong>Comparison of two ways</strong></h4><p>The RPC call based on the TCP protocol implementation, because the TCP protocol is in the lower layer of the Protocol Stack, can customize the protocol fields more flexibly, reduce network overhead, improve performance, and achieve greater throughput and concurrency.</p><p>However, more attention needs to be paid to the complex details of the underlying layer, and the cost of implementation is higher. At the same time, for different platforms, such as Android, iOS, etc., different toolkits need to be redeveloped to send requests and parse them accordingly, which is heavy workload and difficult to respond quickly and meet user requests.</p><p>RPC based on the HTTP protocol can use request or response data in JSON and XML formats.</p><p>JSON and XML as a common format standard (using the HTTP protocol also requires serialization and deserialization, but this is not the concern of the content under the protocol, mature Web programs have already done a good job of serializing content), open source parsing tools have been quite mature, on which secondary development will be very convenient and simple.</p><p>However, since the HTTP protocol is an upper layer protocol, the number of bytes occupied by transmitting information containing the same content using the HTTP protocol will be higher than the number of bytes occupied by transmitting using the TCP protocol.</p><p>Therefore, under the same network, transmitting the same content through the HTTP protocol will be less efficient than data based on the TCP protocol, and the time occupied by information transmission will be longer. Of course, compressing data can narrow this gap.</p><h4 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h4><p>Benefits of using RabbitMQ:</p><ul><li>Synchronous mutation step: You can use thread pool to turn synchronization into asynchronous, but the disadvantage is that you have to implement thread pool yourself and strong coupling. Using message queue can easily turn synchronous requests into asynchronous requests.</li><li>Low cohesion and high coupling: Decoupling, reducing strong dependencies.</li><li>Traffic peak clipping: set the request value through the message queue, discard or go to the error interface if it exceeds the threshold.</li><li>Improved network communication performance: The creation and destruction of TCP costs a lot, creating 3 handshakes and destroying 4 breakups. At the peak, thousands of links will cause a huge waste of resources, and the number of TCP processed by the operating system per second is also There are quantitative limitations, which will inevitably cause performance bottlenecks.</li></ul><h2 id="RPC-Service-Registration-and-Discovery"><a href="#RPC-Service-Registration-and-Discovery" class="headerlink" title="RPC Service Registration and Discovery"></a>RPC Service Registration and Discovery</h2><p>In RPC remote procedure call, there are two roles, a service provider and another service consumer. How to let the caller know which services exist to call? That is, how to let others use our service?</p><p>A colleague said it’s very simple, just tell the user the IP and port of the service. Indeed, the key to the problem here is whether it is automatically informed or manually informed.</p><p>The way of manual notification: if you find that one machine of your service is not enough and you want to add another one, this time you have to tell the caller that I now have two IPs, and you need to poll the call to achieve Load Balance; the caller grit his teeth and changed it. As a result, one day a machine crashed, and the caller found that half of the service was unavailable, he could only manually modify the code to delete the IP of the machine that crashed. The real production environment will of course not use manual methods.</p><p>Is there a way to achieve automatic notification, that is, the addition and removal of machines are transparent to the caller, and the caller no longer needs the Hard code service provider address? Of course, now zookeeper is widely used to achieve automatic service registration and discovery functions!</p><p>In mature service governance frameworks, there are not only these two roles, but also a Registry role. A diagram can explain the main responsibilities of the registry.</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1597672620/Blog/9033085-334724946c50139e.png_i6remn.webp" alt></p><ul><li>Registry for server level registration of remote services and Client discovery services</li><li>server level, provide background services to the outside world, and register your service information to the registration center</li><li>Client, get the registration information of the remote service from the registry, and then make a remote procedure call</li></ul><p>At present, the main registration center can be implemented through open source frameworks such as zookeeper, eureka, consul, etcd, etc. Internet companies will also develop their own business characteristics, such as Meituan Dianping’s self-developed MNS and Sina Weibo’s self-developed vintage.</p><h3 id="Service-registration"><a href="#Service-registration" class="headerlink" title="Service registration"></a>Service registration</h3><p>Obviously, in order for others to discover your service, you first need to register the service with the service center.</p><p>Registering a service to the service center is actually a registration in the registry, which stores the IP, port, calling method (protocol, serialization method) of the service. In zookeeper, registering a service is actually creating a znode node in zookeeper, which stores the service information mentioned above. This node bears the most important responsibility. It is created by the service provider (when the service is released) for service consumers to obtain the information in the node, so as to locate the real network topology location of the service provider and know how to call it.</p><h3 id="Service-Discovery"><a href="#Service-Discovery" class="headerlink" title="Service Discovery"></a>Service Discovery</h3><p>When the service consumer calls the service for the first time, it will find the list of IP addresses of the corresponding service through the registry and cache it locally for subsequent use. When the consumer calls the service, it will not request the registry again, but directly call the service from the server of a service provider from the IP list through the Load Balance algorithm.</p><h3 id="Perception-service-offline"><a href="#Perception-service-offline" class="headerlink" title="Perception service offline"></a>Perception service offline</h3><p>When a service is released, it must naturally be registered with the registry, but it must also be removed from the registry when it is offline. Registration is an active behavior, which does not require special attention, but service offline is a problem worth thinking about. Service offline includes offline in abnormal ways such as active offline and system downtime.</p><h2 id="RPC与RESTful"><a href="#RPC与RESTful" class="headerlink" title="RPC与RESTful"></a>RPC与RESTful</h2><h3 id="Different-categories"><a href="#Different-categories" class="headerlink" title="Different categories"></a>Different categories</h3><p>REST, is the abbreviation of Representational State Transfer, which describes representational state transfer in Chinese (it refers to a snapshot of resource data in an instantaneous state, including information such as the content of resource data, representation format (XML, JSON), etc.)</p><p>REST is a software architecture style. The typical application of this style is HTTP. It is widely favored by developers because of its simplicity and strong scalability.</p><p>RPC is the abbreviation of Remote Procedure Call Protocol. The Chinese description is a remote procedure call. It can realize that the Client calls the server’s service (method) like calling a local service (method).</p><p>And RPC can be based on TCP/UDP, can also be transmitted based on the HTTP protocol, it stands to reason that it and REST are not a level of meaning, should not be discussed together, but who makes REST so popular, it is currently the most popular A set of API design standards for Internet applications, in a sense, we say that REST can actually refer to the HTTP protocol.</p><h3 id="Different-ways-of-use"><a href="#Different-ways-of-use" class="headerlink" title="Different ways of use"></a>Different ways of use</h3><p>From the point of view of use, the HTTP interface only focuses on the service provider and does not care how the Client is called. The interface only needs to ensure that when there is a Client call, the corresponding data is returned. RPC requires the Client interface to remain consistent with the server.</p><p>REST is to write the method at the server level, and the Client does not know the specific method. The Client just wants to get the resource, so it initiates an HTTP request, and the server level locates the method after a series of routes according to the URI after receiving the request. RPC is the server level to provide a good method for the Client to call. The Client needs to know the specific class of the server, the specific method, and then call it directly like a local method.</p><h3 id="Object-Oriented"><a href="#Object-Oriented" class="headerlink" title="Object Oriented"></a>Object Oriented</h3><p>From a design point of view, RPC, the so-called remote procedure call, is method-oriented, REST: the so-called Representational state transfer, is resource-oriented, in addition to this, there is a so-called SOA, the so-called service-oriented architecture, It is message-oriented, and this contact is not much to say.</p><h3 id="Different-serialization-protocols"><a href="#Different-serialization-protocols" class="headerlink" title="Different serialization protocols"></a>Different serialization protocols</h3><p>Interface calls usually contain two parts, serialization and communication protocol.</p><p>Communication Protocol, as mentioned above, REST is based on the HTTP protocol, while RPC can be based on TCP/UDP or can be transmitted based on the HTTP protocol.</p><p>Common serialization protocols are: json, xml, hession, protobuf, thrift, text, bytes, etc. REST usually uses JSON or XML, while RPC uses JSON-RPC or XML-RPC.</p><h3 id="Application-scenarios"><a href="#Application-scenarios" class="headerlink" title="Application scenarios"></a>Application scenarios</h3><p>Both REST and RPC are commonly used in microservice structures.</p><ol><li>HTTP is relatively more standardized, more standard, and more general. No matter which language supports the http protocol. If you are an open API to the outside world, such as Open Platform, there are various external programming languages, and you cannot refuse to support each language. Now open source Middleware, the first few protocols supported basically include RESTful.</li></ol><p>Utilization of RPC in Microservices</p><ol><li>As the basic component of the microservice architecture, the RPC framework can greatly reduce the cost of the microservice architecture, improve the R &amp; D efficiency of the caller and service provider, and shield all kinds of complex details of calling functions (services) across processes. Let the caller feel like calling a remote function like calling a local function, and let the service provider feel like implementing a local function to implement a service.</li></ol><p>Reference link:</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.zhihu.com/question/25536695">https://www.zhihu.com/question/25536695</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/027a6ec9c44e">https://www.jianshu.com/p/027a6ec9c44e</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.51cto.com/art/201906/597963.htm">https://developer.51cto.com/art/201906/597963.htm</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/4213069067ae">https://www.jianshu.com/p/4213069067ae</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2020/08/17/rpc/" title="Introduction to RPC Concepts">https://sunra.top/en/2020/08/17/rpc/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2020/08/14/es6-symbol/" rel="prev" title="ES6 Symbol"><i class="fa fa-chevron-left"></i> ES6 Symbol</a></div><div class="post-nav-item"> <a href="/en/2020/08/25/vue-reactive/" rel="next" title="Vue Source Code Learning (1) Responsive Principle">Vue Source Code Learning (1) Responsive Principle<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2020/08/17/rpc/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>