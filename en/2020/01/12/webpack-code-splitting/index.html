<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="In the past few days, when watching the webpack teaching video, I had a little doubt about the code separation, so I went to read the official doc, and now I have sorted out the translation of the ori"><meta property="og:type" content="article"><meta property="og:title" content="Webpack Code Splitting"><meta property="og:url" content="https://sunra.top/en/2020/01/12/webpack-code-splitting/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="In the past few days, when watching the webpack teaching video, I had a little doubt about the code separation, so I went to read the official doc, and now I have sorted out the translation of the ori"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2020-01-11T23:46:48.000Z"><meta property="article:modified_time" content="2024-03-31T02:07:10.515Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2020/01/12/webpack-code-splitting/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2020/01/12/webpack-code-splitting/","path":"2020/01/12/webpack-code-splitting/","title":"Webpack Code Splitting"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Webpack Code Splitting | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-entry-point-entry"><span class="nav-number">1.</span> <span class="nav-text">The entry point (entry)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prevent-duplication"><span class="nav-number">2.</span> <span class="nav-text">Prevent duplication</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dynamic-import"><span class="nav-number">3.</span> <span class="nav-text">Dynamic import</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prefetch-preload-modules-prefetch-preload"><span class="nav-number">4.</span> <span class="nav-text">Prefetch&#x2F;preload modules (prefetch&#x2F;preload</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2020/01/12/webpack-code-splitting/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Webpack Code Splitting | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Webpack Code Splitting</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-01-12 07:46:48" itemprop="dateCreated datePublished" datetime="2020-01-12T07:46:48+08:00">2020-01-12</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-03-31 10:07:10" itemprop="dateModified" datetime="2024-03-31T10:07:10+08:00">2024-03-31</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Packing/" itemprop="url" rel="index"><span itemprop="name">Packing</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2020/01/12/webpack-code-splitting/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2020/01/12/webpack-code-splitting/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>In the past few days, when watching the webpack teaching video, I had a little doubt about the code separation, so I went to read the official doc, and now I have sorted out the translation of the original document and my understanding of some of the content.</p><span id="more"></span><p>Code separation is one of the most noticeable features in webpack. This feature enables code to be separated into different bundles, which can then be loaded on demand or in parallel. Code separation can be used to obtain smaller bundles and control resource loading priority. If used properly, it can greatly affect loading time.</p><p>There are three commonly used code separation methods.</p><ul><li>entry point: use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/configuration/entry-context"><code>entry</code></a> Configure to manually separate code.</li><li>Prevention of duplication: use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a> Deduplicate and separate chunks.<br>Dynamic import: code is separated by internal connection function calls in the module.</li></ul><p>First of all, here is to explain the difference and connection between bundle and chunk:</p><p>The specific explanation can be seen<a target="_blank" rel="external nofollow noopener noreferrer" href="https://stackoverflow.com/questions/42523436/what-are-module-chunk-and-bundle-in-webpack">这里</a>, but in summary it is:</p><ol><li>A module is a module. It can be an ESM module or a commonJS or AMD module</li><li>The module file operated during the packaging process is called a chunk. For example, loading a module asynchronously is a chunk</li><li>bundle is the last packaged file, the final file can be exactly the same as the chunk length, but in most cases it is a collection of multiple chunks</li></ol><h2 id="The-entry-point-entry"><a href="#The-entry-point-entry" class="headerlink" title="The entry point (entry)"></a>The entry point (entry)</h2><p>This is by far the simplest and most intuitive way to separate code. However, this way is more manually configured and has some hidden dangers, which we will solve. Let’s first take a look at how to separate another module from the main bundle:</p><p><strong>project</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">webpack-demo</span><br><span class="line">|- package.json</span><br><span class="line">|- webpack.config.js</span><br><span class="line">|- /dist</span><br><span class="line">|- /src</span><br><span class="line">  |- index.js</span><br><span class="line"><span class="addition">+ |- another-module.js</span></span><br><span class="line">|- /node_modules</span><br></pre></td></tr></table></figure><p><strong>another-module.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  _.<span class="title function_">join</span>([<span class="string">&#x27;Another&#x27;</span>, <span class="string">&#x27;module&#x27;</span>, <span class="string">&#x27;loaded!&#x27;</span>], <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>webpack.config.js</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&#x27;path&#x27;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  mode: &#x27;development&#x27;,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: &#x27;./src/index.js&#x27;,</span><br><span class="line"><span class="addition">+   another: &#x27;./src/another-module.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &#x27;[name].bundle.js&#x27;,</span><br><span class="line">    path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>About the output.filename in the above configuration file [name]，它的作用是可以让打包生成的文件名称是入口[文件名称.bundle.js]，这里还可以配置许多其他的配置，详细的配置可以看<a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/configuration/output/">官方文档</a>。</p><p>This will generate the following build result:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">            Asset     Size   Chunks             Chunk Names</span><br><span class="line">another.bundle.js  550 KiB  another  [emitted]  another</span><br><span class="line">  index.bundle.js  550 KiB    index  [emitted]  index</span><br><span class="line">Entrypoint index = index.bundle.js</span><br><span class="line">Entrypoint another = another.bundle.js</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>As mentioned earlier, there are some pitfalls in this approach:</p><ul><li>If there are duplicate modules between the entry chunks, those duplicate modules will be introduced into each bundle. Because here all files in the dependencies generated by each entry file will be packaged into their respective same file.<br>This method is not flexible enough and cannot dynamically split the code in the core application logic.</li></ul><p>The first of these two points is undoubtedly a serious problem for our example, because we also introduced lodash in ‘./src/index.js’, which results in repeated references in both bundles. We can use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a> Plugin to remove duplicate modules.</p><h2 id="Prevent-duplication"><a href="#Prevent-duplication" class="headerlink" title="Prevent duplication"></a>Prevent duplication</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a> 插件可以将公共的依赖模块提取到已有的 entry chunk 中，或者提取到一个新生成的 chunk。让我们使用这个插件，将前面示例中重复的 <code>lodash</code> 模块去除：</p><blockquote><p><code>CommonsChunkPlugin</code></p></blockquote><p><strong>webpack.config.js</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  const path = require(&#x27;path&#x27;);</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#123;</span><br><span class="line">      index: &#x27;./src/index.js&#x27;,</span><br><span class="line">      another: &#x27;./src/another-module.js&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: &#x27;[name].bundle.js&#x27;,</span><br><span class="line">      path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="addition">+   optimization: &#123;</span></span><br><span class="line"><span class="addition">+     splitChunks: &#123;</span></span><br><span class="line"><span class="addition">+       chunks: &#x27;all&#x27;</span></span><br><span class="line"><span class="addition">+     &#125;</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>Use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/plugins/split-chunks-plugin/#optimization-splitchunks"><code>optimization.splitChunks</code></a> Configuration options, you can now see that duplicate dependencies have been removed from’index.bundle.js’ and’another.bundle.js’. It should be noted that this plugin removes the heavy burden of’lodash ‘from the main bundle and then separates it into a separate chunk. Execute’npm run build’ to see the effect:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">                          Asset      Size                 Chunks             Chunk Names</span><br><span class="line">              another.bundle.js  5.95 KiB                another  [emitted]  another</span><br><span class="line">                index.bundle.js  5.89 KiB                  index  [emitted]  index</span><br><span class="line">vendors~another~index.bundle.js   547 KiB  vendors~another~index  [emitted]  vendors~another~index</span><br><span class="line">Entrypoint index = vendors~another~index.bundle.js index.bundle.js</span><br><span class="line">Entrypoint another = vendors~another~index.bundle.js another.bundle.js</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Here are some plugins and loaders provided by the community that are helpful for code separation:</p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/plugins/mini-css-extract-plugin"><code>mini-css-extract-plugin</code></a>Used to separate CSS from the main application.</li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/loaders/bundle-loader"><code>bundle-loader</code></a>Used to separate code and lazy load the generated bundle.</li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/gaearon/promise-loader"><code>promise-loader</code></a>Similar to bundle-loader, but using the promise API.</li></ul><h2 id="Dynamic-import"><a href="#Dynamic-import" class="headerlink" title="Dynamic import"></a>Dynamic import</h2><p>When it comes to dynamic code splitting, webpack provides two similar techniques. The first, and recommended, way is to use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/tc39/proposal-dynamic-import">ECMAScript 提案</a> Of <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/api/module-methods#import-"><code>import()</code> 语法</a> To achieve dynamic import. The second is the legacy function of webpack, using webpack-specific <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/api/module-methods#require-ensure"><code>require.ensure</code></a>Let’s try using the first one first</p><blockquote><p><code>import()</code></p></blockquote><p>Before we start, let’s remove the redundant from the configuration <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/concepts/entry-points/"><code>entry</code></a> And <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/plugins/split-chunks-plugin"><code>optimization.splitChunks</code></a>, because they are not needed in the following demonstration:</p><p><strong>webpack.config.js</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  const path = require(&#x27;path&#x27;);</span><br><span class="line"></span><br><span class="line">  module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#123;</span><br><span class="line"><span class="addition">+     index: &#x27;./src/index.js&#x27;</span></span><br><span class="line"><span class="deletion">-     index: &#x27;./src/index.js&#x27;,</span></span><br><span class="line"><span class="deletion">-     another: &#x27;./src/another-module.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: &#x27;[name].bundle.js&#x27;,</span><br><span class="line"><span class="addition">+     chunkFilename: &#x27;[name].bundle.js&#x27;,</span></span><br><span class="line">      path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="deletion">-   optimization: &#123;</span></span><br><span class="line"><span class="deletion">-     splitChunks: &#123;</span></span><br><span class="line"><span class="deletion">-       chunks: &#x27;all&#x27;</span></span><br><span class="line"><span class="deletion">-     &#125;</span></span><br><span class="line"><span class="deletion">-   &#125;</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>Note that’chunkFilename ‘is used here, which determines the name of the non-entry chunk. For more information on’chunkFilename’, see <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/configuration/output/#output-chunkfilename">输出</a> Doc. Update our project to remove files that will not be used now:</p><p><strong>project</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">webpack-demo</span><br><span class="line">|- package.json</span><br><span class="line">|- webpack.config.js</span><br><span class="line">|- /dist</span><br><span class="line">|- /src</span><br><span class="line">  |- index.js</span><br><span class="line"><span class="deletion">- |- another-module.js</span></span><br><span class="line">|- /node_modules</span><br></pre></td></tr></table></figure><p>Now, instead of statically importing lodash, we use dynamic import to separate a chunk:</p><p><strong>src/index.js</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- import _ from &#x27;lodash&#x27;;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">- function component() &#123;</span></span><br><span class="line"><span class="addition">+ function getComponent() &#123;</span></span><br><span class="line"><span class="deletion">-   var element = document.createElement(&#x27;div&#x27;);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-   // Lodash, now imported by this script</span></span><br><span class="line"><span class="deletion">-   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);</span></span><br><span class="line"><span class="addition">+   return import(/* webpackChunkName: &quot;lodash&quot; */ &#x27;lodash&#x27;).then((&#123; default: _ &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+     var element = document.createElement(&#x27;div&#x27;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+     element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+     return element;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+   &#125;).catch(error =&gt; &#x27;An error occurred while loading the component&#x27;);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="deletion">- document.body.appendChild(component());</span></span><br><span class="line"><span class="addition">+ getComponent().then(component =&gt; &#123;</span></span><br><span class="line"><span class="addition">+   document.body.appendChild(component);</span></span><br><span class="line"><span class="addition">+ &#125;)</span></span><br></pre></td></tr></table></figure><p>The reason we need to use’default ‘here is that starting from webpack v4, when importing CommonJS modules, instead of parsing the imported module to the value of’module.exports’, an artificial namespace object is created for the CommonJS module. For more information on the reason behind this, please read <a target="_blank" rel="external nofollow noopener noreferrer" href="https://medium.com/webpack/webpack-4-import-and-commonjs-d619d626b655">webpack 4: import() 和 CommonJs</a>。</p><p>Note that in the comment we provided’webpackChunkName ‘. This will name the split bundle lodash.bundle.js instead of’[id].bundle.js<code>。想了解更多关于</code>webpackChunkName<code>和其他可用选项，请查看 [</code>import()`](<a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/api/module-methods/#import-">https://webpack.docschina.org/api/module-methods/#import-</a>) Doc. Let’s execute webpack and see that lodash detached a separate bundle:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">                   Asset      Size          Chunks             Chunk Names</span><br><span class="line">         index.bundle.js  7.88 KiB           index  [emitted]  index</span><br><span class="line">vendors~lodash.bundle.js   547 KiB  vendors~lodash  [emitted]  vendors~lodash</span><br><span class="line">Entrypoint index = index.bundle.js</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Since import () returns a promise, it can be combined with <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"><code>async</code> 函数</a>Used together. However, a preprocessor like Babel and <a target="_blank" rel="external nofollow noopener noreferrer" href="https://babel.docschina.org/docs/en/babel-plugin-syntax-dynamic-import/#installation">Syntax Dynamic Import Babel Plugin</a>Here’s how to simplify the code with an async function:</p><p><strong>src/index.js</strong></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- function getComponent() &#123;</span></span><br><span class="line"><span class="addition">+ async function getComponent() &#123;</span></span><br><span class="line"><span class="deletion">-   return import(/* webpackChunkName: &quot;lodash&quot; */ &#x27;lodash&#x27;).then(&#123; default: _ &#125; =&gt; &#123;</span></span><br><span class="line"><span class="deletion">-     var element = document.createElement(&#x27;div&#x27;);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-     element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-     return element;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">-   &#125;).catch(error =&gt; &#x27;An error occurred while loading the component&#x27;);</span></span><br><span class="line"><span class="addition">+   var element = document.createElement(&#x27;div&#x27;);</span></span><br><span class="line"><span class="addition">+   const &#123; default: _ &#125; = await import(/* webpackChunkName: &quot;lodash&quot; */ &#x27;lodash&#x27;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+   element.innerHTML = _.join([&#x27;Hello&#x27;, &#x27;webpack&#x27;], &#x27; &#x27;);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+   return element;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getComponent().then(component =&gt; &#123;</span><br><span class="line">    document.body.appendChild(component);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="Prefetch-preload-modules-prefetch-preload"><a href="#Prefetch-preload-modules-prefetch-preload" class="headerlink" title="Prefetch/preload modules (prefetch/preload"></a>Prefetch/preload modules (prefetch/preload</h2><p>Webpack v4.6.0 + added support for prefetching and preloading.</p><p>When declaring import, you can use the following built-in directives to make webpack output “resource hint” to inform the browser:</p><ul><li>prefetch: resources that may be needed under certain navigation in the future</li><li>preload (preload): resources may be required under the current navigation</li></ul><p>In the following simple example of prefetch, there is a HomePage component that internally renders a LoginButton component, and then loads the LoginModal component on demand after clicking.</p><p><strong>LoginButton.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPrefetch: true */</span> <span class="string">&#x27;LoginModal&#x27;</span>);</span><br></pre></td></tr></table></figure><p>This generates and appends to the page header, instructing the browser to prefetch the login-modal-chunk.js file at idle time.</p><blockquote><p>As long as the father</p></blockquote><p>Compared with the prefetch instruction, the preload instruction has many differences.</p><ul><li>The preload chunk will start loading in parallel when the parent chunk is loaded. The prefetch chunk will start loading after the parent chunk is loaded.</li><li>preload chunk has medium priority and downloads immediately. Prefetch chunk downloads when the browser is idle.</li><li>The preload chunk will be requested immediately in the parent chunk for the present moment. The prefetch chunk will be used at some future moment.<br>Different levels of browser support.</li></ul><p>In the simple preload example below, there is a Component that depends on a larger library, so it should be separated into a separate chunk.</p><p>Let’s imagine that the ChartComponent component here relies on the huge ChartingLibrary library. It will display a LoadingIndicator (Load Progress Bar) component during rendering, and then immediately import the ChartingLibrary on demand:</p><p><strong>ChartComponent.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPreload: true */</span> <span class="string">&#x27;ChartingLibrary&#x27;</span>);</span><br></pre></td></tr></table></figure><p>When using’ChartComponent ‘in a page, at the same time as requesting ChartComponent.js, charting-library-chunk will also be requested through “. Assuming that the page-chunk is small and loads quickly, the page will display’LoadingIndicator (Load Progress Bar) ‘ at this time, and wait until the’charting-library-chunk ‘request completes, and the LoadingIndicator component disappears. Startup requires very little loading time because only one round trip is made instead of two. Especially in high latency environments.</p><blockquote><p>Incorrect use</p></blockquote><p>For other packaging methods supported by webpack, you can see<a href="[https://webpack.docschina.org/api/module-methods/#es6-%E6%8E%A8%E8%8D%90-](https://webpack.docschina.org/api/module-methods/#es6-推荐-">这篇文档</a>)</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2020/01/12/webpack-code-splitting/" title="Webpack Code Splitting">https://sunra.top/en/2020/01/12/webpack-code-splitting/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2020/01/03/vue-test-utils/" rel="prev" title="Vue-test-utils"><i class="fa fa-chevron-left"></i> Vue-test-utils</a></div><div class="post-nav-item"> <a href="/en/2020/01/17/js-modules2/" rel="next" title="JavaScript Modularization Syntax">JavaScript Modularization Syntax<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2020/01/12/webpack-code-splitting/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>