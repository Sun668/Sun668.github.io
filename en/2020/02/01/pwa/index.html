<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="In the past few days, I have come into contact with the new concept of PWA when learning webpack, so here is a brief summary of the basic concepts, uses and how to use PWA in combination with webpack"><meta property="og:type" content="article"><meta property="og:title" content="PWA"><meta property="og:url" content="https://sunra.top/en/2020/02/01/pwa/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="In the past few days, I have come into contact with the new concept of PWA when learning webpack, so here is a brief summary of the basic concepts, uses and how to use PWA in combination with webpack"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://gss0.bdstatic.com/9rkZbzqaKgQUohGko9WTAnF6hhy/assets/pwa/projects/1515672231576/sw-chrome-inspect.png"><meta property="og:image" content="https://gss0.bdstatic.com/9rkZbzqaKgQUohGko9WTAnF6hhy/assets/pwa/projects/1515671916268/sw-lifecycle.png"><meta property="article:published_time" content="2020-02-01T01:46:25.000Z"><meta property="article:modified_time" content="2024-03-31T02:07:10.507Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://gss0.bdstatic.com/9rkZbzqaKgQUohGko9WTAnF6hhy/assets/pwa/projects/1515672231576/sw-chrome-inspect.png"><link rel="canonical" href="https://sunra.top/en/2020/02/01/pwa/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2020/02/01/pwa/","path":"2020/02/01/pwa/","title":"PWA"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>PWA | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-PWA"><span class="nav-number">1.</span> <span class="nav-text">What is PWA?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Service"><span class="nav-number">2.</span> <span class="nav-text">Service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-is-Service"><span class="nav-number">2.1.</span> <span class="nav-text">What is Service</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-Use-Services"><span class="nav-number">3.</span> <span class="nav-text">How to Use Services</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Prerequisite"><span class="nav-number">3.1.</span> <span class="nav-text">Prerequisite</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Process"><span class="nav-number">3.2.</span> <span class="nav-text">Process</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Register"><span class="nav-number">3.2.1.</span> <span class="nav-text">Register</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Check-if-the-registration-is-successful"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">Check if the registration is successful</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Reasons-for-registration-failure"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">Reasons for registration failure</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Installation"><span class="nav-number">3.2.2.</span> <span class="nav-text">Installation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Custom-request-response"><span class="nav-number">3.2.3.</span> <span class="nav-text">Custom request response</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-1"><span class="nav-number">3.2.4.</span> <span class="nav-text">Service</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Automatically-update-all-pages"><span class="nav-number">3.2.4.1.</span> <span class="nav-text">Automatically update all pages</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Manual-update"><span class="nav-number">3.2.4.2.</span> <span class="nav-text">Manual update</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#debug"><span class="nav-number">3.2.4.3.</span> <span class="nav-text">debug</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Service-2"><span class="nav-number">4.</span> <span class="nav-text">Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-in-Vue"><span class="nav-number">5.</span> <span class="nav-text">Use in Vue</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2020/02/01/pwa/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="PWA | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> PWA</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-02-01 09:46:25" itemprop="dateCreated datePublished" datetime="2020-02-01T09:46:25+08:00">2020-02-01</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-03-31 10:07:10" itemprop="dateModified" datetime="2024-03-31T10:07:10+08:00">2024-03-31</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2020/02/01/pwa/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2020/02/01/pwa/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>In the past few days, I have come into contact with the new concept of PWA when learning webpack, so here is a brief summary of the basic concepts, uses and how to use PWA in combination with webpack and vue.</p><span id="more"></span><h2 id="What-is-PWA"><a href="#What-is-PWA" class="headerlink" title="What is PWA?"></a>What is PWA?</h2><p>Progressive Web Apps, or PWAs for short, are a new way to enhance the experience of web apps, giving users the experience of native apps.</p><p>PWA can achieve the experience of native applications is not based on a specific technology, but through the application of some new technologies to improve, in the security, performance and experience of three aspects have been greatly improved, PWA is essentially Web App, with some The new technology also has some of the characteristics of Native App, both Web App and Native App advantages.</p><p>The main features of PWA include the following three points:</p><ul><li>Reliable - Even in unstable network environments, it can load and display instantly</li><li>Experience - Responds quickly and has smooth animations that respond to user actions<br>Sticky Like native apps on the device, with an immersive User Experience that users can add to the desktop</li></ul><p>PWA itself emphasizes progressive and does not require all requirements for security, performance, and experience to be met at once. Developers can <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.google.cn/web/progressive-web-apps/checklist">PWA Checklist</a> Look at the existing features.</p><p>Specific details can be referred to.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://lavas.baidu.com/pwa/README">PWA文档</a></p><h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><h3 id="What-is-Service"><a href="#What-is-Service" class="headerlink" title="What is Service"></a>What is Service</h3><p>The W3C organization proposed an HTML5 API such as Service Worker as early as May 2014, mainly for persistent offline caching.</p><p>Of course, this API is not out of thin air, as for the origin of which we can simply sort out:</p><p>JavaScript in browsers runs on a single main thread and can only do one thing at a time. With the continuous complexity of Web business, we gradually add a lot of resource-consuming and time-consuming complex computing processes in js, and the performance problems caused by these processes are more prominent in the complexity of WebApp.</p><p>W3C organization early insight into the impact of these problems may be caused, this time there is a called Web Worker API was created, the only purpose of this API is to liberate the main thread, Web Worker is separated from the main thread, some complex time-consuming work to it, after completion through the postMessage method to tell the main thread, and the main thread through the onMessage method to get Web Worker feedback results.</p><p>All problems seem to be solved, but the Web Worker is temporary, and the results of each task cannot be persisted. If there is the same complex operation next time, it will take time to do it all over again. Can we have a Worker that persists all the time and is ready to accept commands from the main thread? Based on this requirement, the initial version of Service Worker was launched. Service Worker added persistent offline caching capabilities to the Web Worker. Of course, before the Service Worker, there was also an API for offline caching on HTML5 called AppCache, but there are many AppCache <a target="_blank" rel="external nofollow noopener noreferrer" href="https://alistapart.com/article/application-cache-is-a-douchebag">不能忍受的缺点</a>。</p><p>The W3C decided that AppCache should remain in the HTML 5.0 Recommendation and be removed in subsequent versions of HTML.</p><p>Service Workers have the following functions and features:</p><ul><li>An independent worker thread, independent of the current webpage process, with its own independent worker context.<br>Once installed, it exists forever unless manually unregistered</li><li>It can wake up directly when used, and automatically sleep when not in use</li><li>Programmable intercept proxy requests and returns, cache files, cached files can be retrieved by web page processes (including network offline status)</li><li>Controllable for offline content developers</li><li>Ability to push messages to Clients</li><li>DOM cannot be manipulated directly</li><li>Must work in HTTPS environment</li><li>Asynchronous implementation, internally mostly implemented through Promises</li></ul><p>So we basically know the great mission of the Service Worker, which is to make the cache elegant and extreme, to make the shortcomings of the Web App more weak compared to the Native App, and to provide developers with unlimited reverie on performance and experience.</p><h2 id="How-to-Use-Services"><a href="#How-to-Use-Services" class="headerlink" title="How to Use Services"></a>How to Use Services</h2><h3 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h3><p>Service Workers have certain prerequisites when using them for security and implementation principles.</p><ul><li>Due to the HTTPS environment required by the Service Worker, we can usually resort to <a target="_blank" rel="external nofollow noopener noreferrer" href="https://pages.github.com/">github page</a> Learning debugging. Of course, the general browser allows debugging Service Worker when the host is localhost or 127.0.0.1 is also ok.</li><li>Service Worker caching mechanism is dependent <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Cache">Cache API</a> Achieved</li><li>Depends <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">HTML5 fetch API</a></li><li>Depends <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/javaScript/Reference/Global_Objects/Promise">Promise</a> Achieve</li></ul><h3 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h3><h4 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h4><p>To install the Service Worker, we need to start the installation by registering the Service Worker in the js main thread (js in the regular page), this process will notify the browser where the javaScript files of our Service Worker thread are located.</p><p>Let’s first feel a piece of code:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">123456789101112131415<span class="keyword">if</span> (<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&#x27;/sw.js&#x27;</span>, &#123;<span class="attr">scope</span>: <span class="string">&#x27;/&#x27;</span>&#125;)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">registration</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Registration successful</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ServiceWorker registration successful with scope: &#x27;</span>, registration.<span class="property">scope</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Registration failed: (</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ServiceWorker registration failed: &#x27;</span>, err);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>This code is first to determine the availability of the Service Worker API. If it is supported, we will continue to talk about implementation, otherwise we will not talk about it.</p></li><li><p>If supported, register a Service Worker at/sw.js when the page is onloaded.</p></li><li><p>Each time the page loads successfully, the’register () ‘method will be called, and the browser will determine whether the Service Worker thread has been registered and act accordingly.</p></li><li><p>The scope parameter of the register method is optional and specifies the subdirectory of the content you want the service worker to control. The service worker file in this demo is located in the root domain, which means the scope of the service worker will be the entire source.</p><p>Regarding the scope parameter of the’register ‘method, it needs to be explained: The Service Worker thread will receive a fetch event for all items on the scope specified domain directory. If our Service Worker’s javaScript file is in’/a/b/sw.js’, without passing the scope value, the scope value is’/a/b ‘.</p><p>The meaning of the value of scope is that if the value of scope is’/a/b ‘, then the Service Worker thread can only capture (‘/a/b/page1 ‘,’/a/b/page2 ‘,…) page fetch events. Through the meaning of scope, we can also see that the Service Worker does not serve a single page, so global variables need to be used with caution in the js logic of the Service Worker.</p></li><li><p>‘Then () ‘ function chain calls our promise, and when the promise resolves, the code inside will be executed.</p></li><li><p>At the end we chain a’catch () ‘function, which will only be executed when the promise is rejected.</p></li></ul><p>After the code execution is completed, we have registered a service worker, which works in the worker context, so there is no access to the DOM. Run the service worker code outside the normal page to control their loading.</p><h5 id="Check-if-the-registration-is-successful"><a href="#Check-if-the-registration-is-successful" class="headerlink" title="Check if the registration is successful"></a>Check if the registration is successful</h5><p>If you are confused, did my Service Worker register successfully? What does it look like to register successfully?</p><p>You can open our good partner chrome browser on your PC and enter’chrome://inspect/#service-workers’</p><p><img src="https://gss0.bdstatic.com/9rkZbzqaKgQUohGko9WTAnF6hhy/assets/pwa/projects/1515672231576/sw-chrome-inspect.png" alt="chorme inspect-Service Worker"></p><p>We can also view service worker details through’chrome://serviceworker-internals’. This is still useful if you just want to understand the lifecycle of service workers, but it is likely to be completely replaced by’chrome://inspect/#service-workers’ in the future.</p><p>Of course, it can also be used for testing<a target="_blank" rel="external nofollow noopener noreferrer" href="https://support.google.com/chrome/answer/95464?hl=zh-Hans">隐身窗口</a>You can close the Service Worker thread and reopen it, as the previous Service Worker thread will not affect the new window. Any registrations and caches created from the incognito window will be cleared after the window is closed.</p><h5 id="Reasons-for-registration-failure"><a href="#Reasons-for-registration-failure" class="headerlink" title="Reasons for registration failure"></a>Reasons for registration failure</h5><p>Why does it cause Service Worker registration to fail? The reasons are basically the following situations:</p><p>Not an HTTPS environment, not localhost or 127.0.0.1.</p><ul><li>The address of the Service Worker file is not written correctly and needs to be relative to the origin.</li><li>Service Worker files with a different origin than your App are not allowed.</li></ul><h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><p>After your Service Worker registration is successful, our browser already has a worker context that belongs to your own web App. At this time, the browser will non-stop trying to install and activate the pages on your site. It, and the cache of static resources can be done here.</p><p>The install event will be bound to the Service Worker file. After the Service Worker is installed successfully, the install event will be triggered.</p><p>The install event is typically used to populate your browser’s offline cache capabilities. To achieve this, we use Service Worker’s new iconic storage cache API - a global object on Service Worker that allows us to store resources sent by network responses and generate keys based on their requests. This API works very similar to standard browser caching, but only for your site’s domain. It persists until you tell it it is no longer stored and you have full control.</p><p> <strong>The usage of localStorage is very similar to the usage of Service Worker cache, but since localStorage is synchronous usage, it is not allowed to be used in Service Workers. **</strong> IndexedDB can also be used for data storage within Service Workers. **</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1234567891011121314151617</span><span class="comment">//listen to the install event of the service worker</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;install&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">//If the service worker has been installed successfully, the event.waitUntil callback function will be called</span></span><br><span class="line">    event.<span class="title function_">waitUntil</span>(</span><br><span class="line">        <span class="comment">//After the installation is successful, operate the CacheStorage cache. Before using it, you need to open the corresponding cache space through caches.open ().</span></span><br><span class="line">        caches.<span class="title function_">open</span>(<span class="string">&#x27;my-test-cache-v1&#x27;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">cache</span>) &#123;</span><br><span class="line">            <span class="comment">//Add the precache cache via the addAll method of the cache cache object</span></span><br><span class="line">            <span class="keyword">return</span> cache.<span class="title function_">addAll</span>([</span><br><span class="line">                <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/index.html&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/main.css&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/main.js&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/image.jpg&#x27;</span></span><br><span class="line">            ]);</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>Here, we add an install event listener, followed by an’ExtendableEvent.waitUntil () ‘method on the event - this will ensure that the Service Worker does not install before the code in waitUntil () has finished executing.</li><li>In waitUntil (), we used the caches.open () method to create a new cache called v1, which will be the first version of our site resource cache. It returns a promise to create a cache. When it is resolved, we will then call a method’addAll () ‘on the created cache instance (Cache API). The parameter of this method is a set of URLs relative to origin. These URLs are the list of resources you want to cache.</li><li>If the promise is rejected, the installation will fail and the worker will not do anything. This is also possible because you can fix your code and try again the next time the registration occurs.</li><li>When the installation completes successfully, the Service Worker will be activated. The first time your Service Worker is registered/activated, it will be no different. But when the Service Worker is updated, it will be different.</li></ul><h4 id="Custom-request-response"><a href="#Custom-request-response" class="headerlink" title="Custom request response"></a>Custom request response</h4><p>At this point, in fact, now that you can cache your site resources, you need to tell the service worker to do something with these cached contents. With the fetch event, this is very easy to do.</p><p>Every time any resource controlled by the Service Worker is requested, the fetch event will be triggered. These resources include the html doc within the specified scope, and any other resources referenced within these html docs (such as’index.html ‘initiates a cross-domain request to embed an image, which will also pass through the Service Worker), and the image of the Service Worker proxy server begins to slowly emerge, and the hook of the proxy server can use the two powerful tools of scope and fetch events. Site request management Well organized.</p><p>You can add a fetch event listener to the service worker, then call the respondWith () method on the event to hijack our HTTP responses, and then you can update them with your own magic.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1234567891011121314151617181920212223242526272829303132<span class="variable language_">this</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    event.<span class="title function_">respondWith</span>(</span><br><span class="line">        caches.<span class="title function_">match</span>(event.<span class="property">request</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">            <span class="comment">//Come on, the proxy can handle some proxy things</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//If the service worker has its own return, return directly and reduce the http request once</span></span><br><span class="line">            <span class="keyword">if</span> (response) &#123;</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="title class_">If</span> the service worker does not <span class="keyword">return</span>, it must directly request the real remote service</span><br><span class="line">            <span class="title class_">Var</span> request = event.<span class="property">request</span>.<span class="property">clone</span> (); <span class="comment">// copy the original request</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">fetch</span>(request).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">httpRes</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="title class_">The</span> <span class="keyword">return</span> <span class="keyword">of</span> the http request has been caught and can be disposed <span class="keyword">of</span>.</span><br><span class="line"></span><br><span class="line">                <span class="comment">//The request failed, just return the failed result directly...</span></span><br><span class="line">                <span class="keyword">if</span> (!httpRes || httpRes.<span class="property">status</span> ! <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> httpRes;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="title class_">If</span> the request is successful, cache the request.</span><br><span class="line">                <span class="keyword">var</span> responseClone = httpRes.<span class="title function_">clone</span>();</span><br><span class="line">                caches.<span class="title function_">open</span>(<span class="string">&#x27;my-test-cache-v1&#x27;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">cache</span>) &#123;</span><br><span class="line">                    cache.<span class="title function_">put</span>(event.<span class="property">request</span>, responseClone);</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> httpRes;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>We can perform static resource caching when’install ‘, or proxy page requests through’fetch’ event handling callbacks to achieve dynamic resource caching.</p><p>The two ways can be compared:</p><ul><li>The advantage of on install is that it can be offline on the second visit, but the disadvantage is that the URL that needs to be cached needs to be inserted into the script during compile, increasing the amount of code and reducing maintainability;</li><li>The advantage of on fetch is that there is no need to change the compile process and no additional traffic is generated. The disadvantage is that it requires one more access to be available offline.</li></ul><p>In addition to static pages and files, true offline availability can be achieved if Ajax data is properly cached. Achieving this step may require some refactoring of existing web apps to separate data and templates.</p><h4 id="Service-1"><a href="#Service-1" class="headerlink" title="Service"></a>Service</h4><p>‘/sw.js’ controls the caching of page resources and requests, so what if the caching policy needs to be updated? That is, what if ‘/sw.js’ is updated? ‘/sw.js’ itself how to update?</p><p>If the content of ‘/sw.js’ is updated, the browser retrieves a new file when visiting a website page, and a byte-by-byte comparison of the ‘/sw.js’ file is found to be different, it will think that an update is launched <a target="_blank" rel="external nofollow noopener noreferrer" href="https://w3c.github.io/ServiceWorker/#update-algorithm">更新算法</a>, so the new file will be installed and the install event will be triggered. However, the old Service Worker, which is already active at this time, is still running, and the new Service Worker will enter the waiting state after the installation is completed. The new Service Worker will not take effect in the next reopened page until all opened pages are closed and the old Service Worker is automatically stopped.</p><h5 id="Automatically-update-all-pages"><a href="#Automatically-update-all-pages" class="headerlink" title="Automatically update all pages"></a>Automatically update all pages</h5><p>What if you want all pages to be automatically updated in time when a new version is available? You can execute the’self.skipWaiting () ‘method in the install event to skip the waiting state and go directly to the activate phase. Then when the’activate’ event occurs, update the Service Workers on all Clients by executing the’self.clients.claim () ‘method.</p><p>Take a look at specific examples:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12345678910111213141516171819202122232425</span><span class="comment">//Skip the wait during installation and go directly to active</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;install&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    event.<span class="title function_">waitUntil</span>(self.<span class="title function_">skipWaiting</span>());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    event.<span class="title function_">waitUntil</span>(</span><br><span class="line">        <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Update Client</span></span><br><span class="line">            self.<span class="property">clients</span>.<span class="title function_">claim</span>(),</span><br><span class="line"></span><br><span class="line">            <span class="comment">//clean up old version</span></span><br><span class="line">            caches.<span class="title function_">keys</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">cacheList</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">                    cacheList.<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">cacheName</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (cacheName ! <span class="string">&#x27;my-test-cache-v1&#x27;</span>) &#123;</span><br><span class="line">                            <span class="keyword">return</span> caches.<span class="title function_">delete</span>(cacheName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                );</span><br><span class="line">            &#125;)</span><br><span class="line">        ])</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Another thing to note is that the ‘/sw.js’ file may be due to browser caching issues. When the file changes, it is still an old file in the browser. This will cause the update to not respond. If you encounter this problem, you can try to do this: add a filter rule for the file on the Web Server without caching or setting a shorter valid period.</p><h5 id="Manual-update"><a href="#Manual-update" class="headerlink" title="Manual update"></a>Manual update</h5><p>In fact, you can also manually update the page with the help of’Registration.update () ‘.</p><p>Refer to the following example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">123456789<span class="keyword">var</span> version = <span class="string">&#x27;1.0.1&#x27;</span>;</span><br><span class="line"></span><br><span class="line">navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&#x27;/sw.js&#x27;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">reg</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;sw_version&#x27;</span>) ! version) &#123;</span><br><span class="line">        reg.<span class="title function_">update</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;sw_version&#x27;</span>, version)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h5><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://lavas.baidu.com/pwa/offline-and-cache-loading/service-worker/service-worker-debug">Service Worker debug 技巧</a> 中也会提到, Service Worker 被载入后立即激活可以保证每次 <code>/sw.js</code> 为最新的。</p><p>The code is as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">123self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;install&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    self.<span class="title function_">skipWaiting</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Service-2"><a href="#Service-2" class="headerlink" title="Service"></a>Service</h2><p>We already know that the working principle of Service Worker is based on the registration, installation, activation and other steps in the browser js main thread to share the cache task independently, so how do we do some of the things we want workers to do in a series of operations in these APIs themselves?</p><p>Here we need to understand the concept of Service Worker lifecycle, which helps us learn to carry out purposeful callbacks at each stage of the lifecycle, so that our custom work can be carried out correctly and effectively in the Service Worker. MDN gives a detailed Service Worker lifecycle diagram:</p><p><img src="https://gss0.bdstatic.com/9rkZbzqaKgQUohGko9WTAnF6hhy/assets/pwa/projects/1515671916268/sw-lifecycle.png" alt="Service Worker 生命周期"></p><p>We can see that the lifecycle is divided into several states: ‘Installing’, ‘After Installation’, ‘Activating’, ‘After Activation’, ‘Obsolete’.</p><p>Installing: This state occurs after the service worker is registered, indicating that the installation has started, triggering the install event callback to specify some static resources for offline caching.</p><p>There are two methods in the’install ‘event callback:</p><ul><li>‘event.waitUntil () ‘: Pass a Promise as an argument and wait until the Promise is resolved.</li><li>‘Self.skipWaiting () ‘: ‘self’ is a global variable for the current context. Executing this method means forcing the service worker currently in the waiting state to enter the activate state.<br>Installed: The service worker has completed installation and is waiting for other service worker threads to be closed.</li><li> <strong>Activating</strong> : Clients in this state that are not controlled by other service workers, allow the current worker to complete the installation, and clear the old cache resources of other workers and associated caches, waiting for the new service worker thread to be activated.</li></ul><p>There are two methods in the’activate ‘callback:</p><ul><li>‘event.waitUntil () ‘: Pass a Promise as an argument and wait until the Promise is resolved.</li><li>‘Self.clients.claim () ‘: Executing this method in the activate event callback means taking control of the page, so that the updated version cache is used when the page is opened later. The old Service Worker script no longer controls the page and will be stopped later.</li><li> <strong>Activated</strong> : In this state, the’activate ‘event callback is processed (providing an opportunity to update the cache policy). Functional events’fetch (request) ‘, ‘sync (background synchronization) ‘, ‘push (push) ‘ can be handled.<br>Redundant: This state indicates the end of a service worker’s life cycle.</li></ul><p>Here, in particular, the reasons for entering the redundant state may be these:</p><ul><li>installation failed</li><li>Activating failed</li><li>A new version of Service Worker replaced it and became active</li></ul><h2 id="Use-in-Vue"><a href="#Use-in-Vue" class="headerlink" title="Use in Vue"></a>Use in Vue</h2><ul><li>npm install workbox-webpack-plugin</li><li>After introducing the plugin in webpack.config.js, introduce the plugin in the plugins</li><li>Run webpack packaging, will generate service-worker.js and manifest in the dist directory</li><li>Register and install the service-worker.js we packaged and generated in index.js through the code in the example in the previous section</li></ul><p>For specific details, please refer to<a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.google.com/web/tools/workbox/modules/workbox-webpack-plugin">workbox-webpack-plugin文档</a></p><p>The plug-in is actually based on the vue project and packaging results to generate a service-worker related files, and ultimately we need to add our own service-worker in the project to register the relevant installation code.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2020/02/01/pwa/" title="PWA">https://sunra.top/en/2020/02/01/pwa/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2020/01/25/http-headers-part-params/" rel="prev" title="Parameter analysis and application of http protocol header"><i class="fa fa-chevron-left"></i> Parameter analysis and application of http protocol header</a></div><div class="post-nav-item"> <a href="/en/2020/02/08/webpack-performace-optimization/" rel="next" title="Webpack Performance optimization">Webpack Performance optimization<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2020/02/01/pwa/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>