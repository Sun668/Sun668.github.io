<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="File Upload Vulnerabilities and Their HarmFile upload vulnerability refers to a network attacker uploading an executable file to the server and executing it. The uploaded file here can be a Trojan hor"><meta property="og:type" content="article"><meta property="og:title" content="File Upload Vulnerability"><meta property="og:url" content="https://sunra.top/en/2021/01/27/file-upload-vulnerablity/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="File Upload Vulnerabilities and Their HarmFile upload vulnerability refers to a network attacker uploading an executable file to the server and executing it. The uploaded file here can be a Trojan hor"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-01-27T11:59:47.000Z"><meta property="article:modified_time" content="2023-08-20T01:26:34.276Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2021/01/27/file-upload-vulnerablity/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2021/01/27/file-upload-vulnerablity/","path":"2021/01/27/file-upload-vulnerablity/","title":"File Upload Vulnerability"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>File Upload Vulnerability | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#File-Upload-Vulnerabilities-and-Their-Harm"><span class="nav-number">1.</span> <span class="nav-text">File Upload Vulnerabilities and Their Harm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-upload-vulnerability-preliminary-suffix-domain-name-bypass"><span class="nav-number">2.</span> <span class="nav-text">File upload vulnerability preliminary: suffix domain name bypass</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Suffix-name-detection"><span class="nav-number">2.1.</span> <span class="nav-text">Suffix name detection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-bypass-detection"><span class="nav-number">2.2.</span> <span class="nav-text">How to bypass detection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-upload-vulnerability-intermediate"><span class="nav-number">3.</span> <span class="nav-text">File upload vulnerability intermediate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Server-Affinity-Vulnerability"><span class="nav-number">3.1.</span> <span class="nav-text">Server Affinity Vulnerability</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IIS5-x"><span class="nav-number">3.1.1.</span> <span class="nav-text">IIS5.x</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Nginx-parsing-vulnerability"><span class="nav-number">3.1.2.</span> <span class="nav-text">Nginx parsing vulnerability</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Apache-parsing-vulnerability"><span class="nav-number">3.1.3.</span> <span class="nav-text">Apache parsing vulnerability</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Front-end-authentication-bypass"><span class="nav-number">3.2.</span> <span class="nav-text">Front-end authentication bypass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Htaccess-bypass"><span class="nav-number">3.3.</span> <span class="nav-text">.Htaccess bypass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Case-bypass"><span class="nav-number">3.4.</span> <span class="nav-text">Case bypass</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-Upload-Vulnerability-Advanced"><span class="nav-number">4.</span> <span class="nav-text">File Upload Vulnerability Advanced</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows-File-Stream-Feature-Bypass"><span class="nav-number">4.1.</span> <span class="nav-text">Windows File Stream Feature Bypass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-header-check-bypass"><span class="nav-number">4.2.</span> <span class="nav-text">File header check bypass</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2021/01/27/file-upload-vulnerablity/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="File Upload Vulnerability | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> File Upload Vulnerability</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-01-27 19:59:47" itemprop="dateCreated datePublished" datetime="2021-01-27T19:59:47+08:00">2021-01-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-20 09:26:34" itemprop="dateModified" datetime="2023-08-20T09:26:34+08:00">2023-08-20</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Security/" itemprop="url" rel="index"><span itemprop="name">Security</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2021/01/27/file-upload-vulnerablity/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2021/01/27/file-upload-vulnerablity/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="File-Upload-Vulnerabilities-and-Their-Harm"><a href="#File-Upload-Vulnerabilities-and-Their-Harm" class="headerlink" title="File Upload Vulnerabilities and Their Harm"></a>File Upload Vulnerabilities and Their Harm</h2><p>File upload vulnerability refers to a network attacker uploading an executable file to the server and executing it. The uploaded file here can be a Trojan horse, virus, malicious script or WebShell, etc.</p><p>Due to insufficient programmer control over the user file upload portion or processing defects, resulting in the user can cross its own authority to upload executable dynamic script files to the server.</p><span id="more"></span><p>For example, if you use a windows server and use asp as a dynamic website environment on the server side, then in the upload function of your website, you must not allow users to upload asp type files, otherwise he uploads a webshell, and your server The files on it can be arbitrarily changed by him. Therefore, the harm caused by file upload vulnerabilities is often devastating. Apache, Tomcat, Nginx, etc. have all exposed file upload vulnerabilities.</p><p>For example, we transfer a php file to the background, the content of the file is very simple, just a line of code, through the eval function to execute the value of the hacker field in the request parameter.</p><p>If we upload this file to the server and assume that it is stored in <a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost/images/shell.php">http://localhost/images/shell.php</a></p><p>So at this time, let’s use the command line to execute</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d &quot;hacker=echo get_current_user();&quot; http://localhost/images/shell.php</span><br></pre></td></tr></table></figure><p>At this time, it will echo the current user of the server.</p><p>Of course, we can also use other PHP built-in system functions to infer the information of the entire backend server.</p><h2 id="File-upload-vulnerability-preliminary-suffix-domain-name-bypass"><a href="#File-upload-vulnerability-preliminary-suffix-domain-name-bypass" class="headerlink" title="File upload vulnerability preliminary: suffix domain name bypass"></a>File upload vulnerability preliminary: suffix domain name bypass</h2><h3 id="Suffix-name-detection"><a href="#Suffix-name-detection" class="headerlink" title="Suffix name detection"></a>Suffix name detection</h3><p>An important part of the reason why the example we mentioned at the beginning can be executed successfully is that the file’s suffix name is php, so the server will use the php parser to execute the executable code when parsing the entire file.</p><p>If this file is just an ordinary txt file, even if there is malicious code in it, our server will just treat it as an ordinary string.</p><p>Therefore, based on this premise, if we can perform a detection on the suffix name of the uploaded file, we can avoid such vulnerabilities by intercepting file suffixes like php.</p><h3 id="How-to-bypass-detection"><a href="#How-to-bypass-detection" class="headerlink" title="How to bypass detection"></a>How to bypass detection</h3><p>Taking php as an example, if our suffix detection only detects’ * .php ‘, then if I upload a php3 type file, I can actually upload it successfully, but a proxy like Apache2 will use php, php3, All files with php4 and php5 suffixes are parsed as php files.</p><h2 id="File-upload-vulnerability-intermediate"><a href="#File-upload-vulnerability-intermediate" class="headerlink" title="File upload vulnerability intermediate"></a>File upload vulnerability intermediate</h2><h3 id="Server-Affinity-Vulnerability"><a href="#Server-Affinity-Vulnerability" class="headerlink" title="Server Affinity Vulnerability"></a>Server Affinity Vulnerability</h3><h4 id="IIS5-x"><a href="#IIS5-x" class="headerlink" title="IIS5.x"></a>IIS5.x</h4><ul><li>When creating a file directory ending in .asp, any files in this directory will be parsed into asp files.</li><li>The server does not parse content after “;” by default</li></ul><p>Based on two points, we can have two forms of utilization</p><ul><li>www.xxx.com/xx.asp/xx.jpg will be parsed into an asp file</li><li>www.xxx.com/xx.asp; .jpg will be parsed into an asp file</li></ul><h4 id="Nginx-parsing-vulnerability"><a href="#Nginx-parsing-vulnerability" class="headerlink" title="Nginx parsing vulnerability"></a>Nginx parsing vulnerability</h4><p>A file parsing vulnerability caused by PHP-CGI exists in older versions of Nginx.</p><p>A key option in the PHP configuration file, cgi.fix_pathinfo, is located locally in the php.in configuration file and is enabled by default.</p><p>When there are non-existent files in the URL, PHP will forward parse by default.</p><p>Based on this, we can:</p><ul><li>Access: www.xx.com/phpinfo.jpg/1.php (actually this 1.php does not exist)</li><li>The phpinfo.jpg file will be parsed, but it will be parsed using the php parser.</li></ul><h4 id="Apache-parsing-vulnerability"><a href="#Apache-parsing-vulnerability" class="headerlink" title="Apache parsing vulnerability"></a>Apache parsing vulnerability</h4><p>A parsing vulnerability exists in Apache versions 1.x and 2.x</p><p>Apache will judge the suffix from right to left, and will skip the unrecognized suffix until the first recognizable suffix is found, and then parse according to the modified suffix.</p><p>Based on this, we can:</p><ul><li>Upload shell.php.test</li><li>Visit shell.php.test, the server will parse the shell.php.test file, but parse it according to the php file format.</li></ul><h3 id="Front-end-authentication-bypass"><a href="#Front-end-authentication-bypass" class="headerlink" title="Front-end authentication bypass"></a>Front-end authentication bypass</h3><p>Many websites only use JavaScript for verification on the front end.</p><p>Take advantage of this vulnerability:</p><ul><li>Modify the content by means of packet capture.</li><li>Disable or remove JavaScript code by Chrome</li></ul><h3 id="Htaccess-bypass"><a href="#Htaccess-bypass" class="headerlink" title=".Htaccess bypass"></a>.Htaccess bypass</h3><p>The .htaccess file (distributed configuration file) provides a way for configuration files to vary from folder to folder, and the folders and subfolders they are placed in are affected, with the same syntax as the main Apache configuration file.</p><p>If the server has htaccess enabled, we can upload the htaccess file to modify the server configuration of this folder</p><ul><li>Upload a .htaccess file with the file content set to ‘[AddType application/x-http-php.test]’</li><li>Upload a one-sentence Trojan horse file with the file name set to shell.test.</li><li>Accessing shell.test will actually be executed as a php file.</li></ul><h3 id="Case-bypass"><a href="#Case-bypass" class="headerlink" title="Case bypass"></a>Case bypass</h3><p>For the detection of the blacklist, we can change the case of the suffix name to bypass it.</p><p>For example, if we want to upload a PHP file, we can upload a pHp.</p><p>But the question is, why does this work:</p><p>Is PHP really the same as pHp?</p><ul><li>If different, then why pHp can be performed.</li></ul><p>For Windows systems, it is actually case-insensitive to suffix names.</p><p>But for the Linux system, he is case-sensitive, but because of this, it may lead to inconvenience for users, so some developers will manually modify the configuration of their app to make it case-insensitive.</p><h2 id="File-Upload-Vulnerability-Advanced"><a href="#File-Upload-Vulnerability-Advanced" class="headerlink" title="File Upload Vulnerability Advanced"></a>File Upload Vulnerability Advanced</h2><h3 id="Windows-File-Stream-Feature-Bypass"><a href="#Windows-File-Stream-Feature-Bypass" class="headerlink" title="Windows File Stream Feature Bypass"></a>Windows File Stream Feature Bypass</h3><p>The file stream system of Windows is NTFS, which implements multi-file stream characteristics.</p><p>NTFS environment, a file is used by default unnamed file stream, but at the same time we can also create other named file stream, Windows Explorer does not display the file named file stream by default, these named file stream function and grinding named file stream is the same.</p><p>We can try the following three commands on the Windows platform:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Echo 111 &gt; test.txt: 1.txt//write data 111 to the named file stream 1.txt of test.txt.</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Echo 222 &gt; test.txt//write data 222 to test.txt.</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Echo test &gt; test.txt :: $data//writes data to the default file stream of test.txt.</span><br></pre></td></tr></table></figure><p>With the first command, we will create a test.txt file, but when we open the file, we will find nothing. At this time, we open the file stream with’notepad test.txt: 1.txt ‘and we can see’ 111 ‘.</p><p>The second and third commands have the same effect and will write content in the file.</p><p>Based on the above characteristics, we can understand that NTFS file stream allows us to make a file with multiple file streams. Usually, our graphical interface uses the default unnamed file stream, but other file streams once created through the command line., in fact, it exists and is attached to the file, and this attachment can ignore the suffix, which means that you can attach a php to the txt file, such as</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Echo Malware &gt; test.txt: shell.php</span><br></pre></td></tr></table></figure><p>This code can attach malicious code to a common txt file, thus helping us bypass type detection.</p><h3 id="File-header-check-bypass"><a href="#File-header-check-bypass" class="headerlink" title="File header check bypass"></a>File header check bypass</h3><p>Different types of files actually have their own signature file headers.</p><p>Some servers may verify these file headers.</p><p>To bypass this vulnerability, we can try splicing the code directly behind the allowed file types and then use a parser to execute it, such as:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat shell.php &gt; test.jpg</span><br></pre></td></tr></table></figure><p>In this way, we will splice a piece of PHP code after test.jpg.</p><p>At this time, we use the PHP parser to execute, and we can successfully execute the final code.</p><blockquote><p>One thing to note here is that there may be some character encodings in the image that the parser cannot perform, so we can delete these unparsed contents directly, because all we need is the header of the jpg file.</p></blockquote></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2021/01/27/file-upload-vulnerablity/" title="File Upload Vulnerability">https://sunra.top/en/2021/01/27/file-upload-vulnerablity/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2021/01/26/vue3-feature-3/" rel="prev" title="Vue3 Preliminary Exploration (3) Global API"><i class="fa fa-chevron-left"></i> Vue3 Preliminary Exploration (3) Global API</a></div><div class="post-nav-item"> <a href="/en/2021/01/29/leetcode-1631/" rel="next" title="leetcode-1631">leetcode-1631<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2021/01/27/file-upload-vulnerablity/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>