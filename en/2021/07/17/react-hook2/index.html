<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="I have been using React for two months, and I will summarize some of the gains about React Hook in the actual combat and the courses I bought in the past two months."><meta property="og:type" content="article"><meta property="og:title" content="React Hook Practical Summary - How to Write Less Complex Projects with React Hook"><meta property="og:url" content="https://sunra.top/en/2021/07/17/react-hook2/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="I have been using React for two months, and I will summarize some of the gains about React Hook in the actual combat and the courses I bought in the past two months."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1639981252/origin-of-ray/image_nj5wy0.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1639981399/origin-of-ray/image_1_dxtvnt.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1639981335/origin-of-ray/c12927e3-3360-4da4-9a10-dce256deb229_lpc9uh.png"><meta property="article:published_time" content="2021-07-16T23:59:23.000Z"><meta property="article:modified_time" content="2024-06-23T03:23:58.979Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1639981252/origin-of-ray/image_nj5wy0.png"><link rel="canonical" href="https://sunra.top/en/2021/07/17/react-hook2/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2021/07/17/react-hook2/","path":"2021/07/17/react-hook2/","title":"React Hook Practical Summary - How to Write Less Complex Projects with React Hook"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>React Hook Practical Summary - How to Write Less Complex Projects with React Hook | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#why-react-invented-hooks"><span class="nav-number">1.</span> <span class="nav-text">Why React Invented Hooks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-number">1.1.</span><span class="nav-text"></span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#the-birth-of-the-hook-find-a-way-to-hook-any-data-source-into-any-function-component"><span class="nav-number">1.2.</span> <span class="nav-text">The birth of the hook: find a way to hook any data source into any function component</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#benefits-of-hooks"><span class="nav-number">1.3.</span> <span class="nav-text">Benefits of Hooks</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#logical-separation"><span class="nav-number">1.3.1.</span> <span class="nav-text">Logical separation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#separation-of-concerns"><span class="nav-number">1.3.2.</span> <span class="nav-text">Separation of concerns</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reflection"><span class="nav-number">1.3.3.</span> <span class="nav-text">Reflection</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#the-role-of-several-built-in-hooks-and-their-use"><span class="nav-number">2.</span> <span class="nav-text">The role of several built-in hooks and their use</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#usestate-give-function-components-the-ability-to-maintain-state"><span class="nav-number">2.1.</span> <span class="nav-text">useState: Give function components the ability to maintain state</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useeffect-execution-side-effect"><span class="nav-number">2.2.</span> <span class="nav-text">useEffect: Execution side effect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#usecallback-cache-callback-function"><span class="nav-number">2.3.</span> <span class="nav-text">useCallback: Cache callback function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#usememo-cache-the-result-of-the-calculation"><span class="nav-number">2.4.</span> <span class="nav-text">useMemo: Cache the result of the calculation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useref-share-data-between-multiple-renders"><span class="nav-number">2.5.</span> <span class="nav-text">useRef: Share data between multiple renders</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#usecontext-define-global-state"><span class="nav-number">2.6.</span> <span class="nav-text">useContext: Define global state</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#comparison-of-hooks-and-life-cycles"><span class="nav-number">3.</span> <span class="nav-text">Comparison of Hooks and Life Cycles</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-structure-a-react-project"><span class="nav-number">4.</span> <span class="nav-text">How to structure a React project</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2021/07/17/react-hook2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="React Hook Practical Summary - How to Write Less Complex Projects with React Hook | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> React Hook Practical Summary - How to Write Less Complex Projects with React Hook</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-07-17 07:59:23" itemprop="dateCreated datePublished" datetime="2021-07-17T07:59:23+08:00">2021-07-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-06-23 11:23:58" itemprop="dateModified" datetime="2024-06-23T11:23:58+08:00">2024-06-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2021/07/17/react-hook2/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2021/07/17/react-hook2/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>I have been using React for two months, and I will summarize some of the gains about React Hook in the actual combat and the courses I bought in the past two months.</p><span id="more"></span><h2 id="why-react-invented-hooks"><a class="markdownIt-Anchor" href="#why-react-invented-hooks"></a> Why React Invented Hooks</h2><h3 id><a class="markdownIt-Anchor" href="#"></a></h3><p>The model of the React component is actually very intuitive, that is, the mapping from Model to View, where the Model corresponds to the state and props in React. As shown in the figure below:</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1639981252/origin-of-ray/image_nj5wy0.png" alt="img"></p><p>In the past, we needed to deal with the details of how DOM nodes should change when the Model changes. Now, we only need to use JSX to describe the final presentation of the UI in a declarative way based on the data of the Model, because React will help you handle all the details of DOM changes. Moreover, when the state in the Model changes, the UI will automatically change, which is called data binding.</p><p>So, we can think of the presentation of the UI as the execution process of a function. Among them, the Model is the input parameter, and the execution result of the function is the DOM tree, which is the View. What React wants to ensure is that whenever the Model changes, the function will be re-executed and a new DOM tree will be generated, and then React will update the new DOM tree to the browser in the best way.</p><p>In this case, is it really appropriate to use Class as a component? When Class is used as the carrier of React components, does it use all its functions? If you think carefully, you will find that using Class is actually a bit far-fetched, mainly for two reasons.</p><p>On the one hand, React components do not inherit from each other. For example, you do not create a Button component and then create a DropdownButton to inherit Button. So, React does not actually take advantage of the inheritance feature of Classes.</p><p>On the other hand, because all UI is state-driven, methods of a class instance (i.e. component) are rarely called externally. Be aware that all methods of a component are called internally or automatically as lifecycle methods.</p><p>This is also why React provided the mechanism for function components very early. However, there was a limitation at that time that function components could not have internal state, must be pure functions, and could not provide a complete lifecycle mechanism. This greatly limited the large-scale use of function components.</p><h3 id="the-birth-of-the-hook-find-a-way-to-hook-any-data-source-into-any-function-component"><a class="markdownIt-Anchor" href="#the-birth-of-the-hook-find-a-way-to-hook-any-data-source-into-any-function-component"></a> The birth of the hook: find a way to hook any data source into any function component</h3><p>In fact, if we continue to think along the lines of function components, we will find that if we want to make function components more useful, the goal is to add state to function components. This may not seem difficult.</p><p>Think about it briefly, function and object are different, and there is no instance of the object can save the state between multiple executions, it is bound to need a space outside the function to save the state, and to be able to detect its changes, which can trigger the function component re-rendering.</p><p>Thinking further, do we need such a mechanism to bind an external data to the execution of the function. When the data changes, the function can automatically re-execute. In this way, any external data that affects the UI presentation can be bound to the function component of React through this mechanism. In React, this mechanism is called Hooks.</p><p>So we can now understand why this mechanism is called Hooks. As the name suggests, Hook means “hook”. In React, Hooks hook a target result to a data source or event source that may change, so when the hooked data or event changes, the code that produces the target result will be re-executed to produce the updated result.</p><p>For the function component, this result is the final DOM tree; so the structure of Hooks can be shown in the following figure: The role of Hooks is to treat all data as a data source, hook into any function component, and trigger updates to the function component</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1639981399/origin-of-ray/image_1_dxtvnt.png" alt="img"></p><h3 id="benefits-of-hooks"><a class="markdownIt-Anchor" href="#benefits-of-hooks"></a> Benefits of Hooks</h3><ul><li><blockquote><p>Logical separation</p></blockquote></li><li><blockquote><p>Separation of concerns</p></blockquote></li></ul><h4 id="logical-separation"><a class="markdownIt-Anchor" href="#logical-separation"></a> Logical separation</h4><p>Take the scenario of binding window size we mentioned just now as an example. If there are multiple components that need to readjust the layout when the user adjusts the browser window size, then we need to extract such logic into a common module for multiple components to use. With React thinking, in JSX we will render different components according to Size, for example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (size = <span class="string">&quot;small&quot;</span>) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SmallComponent</span> /&gt;</span></span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">LargeComponent</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the Class component scenario, we first need to define a Higher Order Component, which is responsible for listening for window size changes and passing the changed value as props to the next component.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withWindowSize</span> = <span class="title class_">Component</span> =&gt; &#123;</span><br><span class="line">  <span class="comment">//Generate a Higher Order Component WrappedComponent that only contains the logic to monitor the window size</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">WrappedComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>(props);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="variable language_">this</span>.<span class="title function_">getSize</span>()</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;resize&quot;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">innerWidth</span> &gt; <span class="number">1000</span> ? <span class="string">&quot;large&quot;</span> ：<span class="string">&quot;small&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    handleResize = <span class="function">()=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> currentSize = <span class="variable language_">this</span>.<span class="title function_">getSize</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="variable language_">this</span>.<span class="title function_">getSize</span>()</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title class_">Pass</span> the <span class="variable language_">window</span> size to the real business logic component</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">size</span>=<span class="string">&#123;this.state.size&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">WrappedComponent</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; size &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">if</span> (size = <span class="string">&quot;small&quot;</span>) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SmallComponent</span> /&gt;</span></span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">LargeComponent</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Use withWindowSize to generate Higher Order Component, which is used to generate the size attribute and pass it to the real business component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withWindowSize</span>(<span class="title class_">MyComponent</span>); </span><br></pre></td></tr></table></figure><p>How to implement the same logic if using Hooks and function components. First we need to implement a Hooks:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getSize</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">innerWidth</span> &gt; <span class="number">1000</span> ? <span class="string">&quot;large&quot;</span> : <span class="string">&quot;small&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useWindowSize</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [size, setSize] = <span class="title function_">useState</span>(<span class="title function_">getSize</span>());</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">setSize</span>(<span class="title function_">getSize</span>())</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handler);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handler);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Demo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> size = <span class="title function_">useWindowSize</span>();</span><br><span class="line">  <span class="keyword">if</span> (size = <span class="string">&quot;small&quot;</span>) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SmallComponent</span> /&gt;</span></span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">LargeComponent</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="separation-of-concerns"><a class="markdownIt-Anchor" href="#separation-of-concerns"></a> Separation of concerns</h4><p>Another major benefit of Hooks: helping to separate concerns In addition to logic reuse, another major benefit that Hooks can bring is to help separate concerns, meaning that Hooks can make code for the same business logic as much as possible Aggregate together.</p><p>This is difficult to do in the past in the Class component. Because in the Class component, you have to scatter the code of the same business logic in different lifecycle methods of the class component. Therefore, by using Hooks to clearly isolate the business logic, the code can be easier to understand and maintain.</p><h4 id="reflection"><a class="markdownIt-Anchor" href="#reflection"></a> Reflection</h4><p>Logic separation allows logic to be separated from the function component, reducing the length of the function component.</p><p>Separation of concerns allows related logic to be grouped together, such as in the same custom hook, rather than scattered throughout the function component.</p><p>Suddenly found that before like all kinds of useState, useEffect are stuffed into the function component is not very good, which led to the function component will be very long, and let all the logic in a function mixed, completely did not use the logic separation and the benefits of separation of concerns.</p><h2 id="the-role-of-several-built-in-hooks-and-their-use"><a class="markdownIt-Anchor" href="#the-role-of-several-built-in-hooks-and-their-use"></a> The role of several built-in hooks and their use</h2><h3 id="usestate-give-function-components-the-ability-to-maintain-state"><a class="markdownIt-Anchor" href="#usestate-give-function-components-the-ability-to-maintain-state"></a> useState: Give function components the ability to maintain state</h3><p>The useState Hook is used to manage the state, which allows the function component to have the ability to maintain state. That is, the state is shared between multiple renders of a function component. The following example shows the use of useState:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Create</span> a state that stores count and give it an initial value <span class="keyword">of</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        +</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The useState Hook is summed up like this:</p><p>1.The parameter initialState of useState (initialState) is the initial value of the created state, which can be of any type, such as numbers, objects, arrays, etc. (if you want to cache a function, you should use useCallback. If the initialState of useState is a function, it will cache the return result of the function).<br> 2.The return value of useState () is an array with two elements. The first array element is used to read the value of state, and the second is used to set the value of this state. It should be noted here that the variable of state (count in the example) is read-only, so we must set its value through the second array element setCount.<br> 3. If we want to create multiple states, then we need to call useState multiple times.</p><blockquote><p>Generally speaking, one principle we have to follow is: state</p></blockquote><ul><li><blockquote><p>Value passed from props. Sometimes the value passed from props cannot be used directly, but must be displayed on the UI after a certain calculation, such as sorting. So what we need to do is to reorder every time we use it, or use some cache mechanism instead of putting the result directly into state.</p></blockquote></li><li><blockquote><p>The value read from the URL. For example, sometimes it is necessary to read the parameters in the URL as part of the state of the component. Then we can read it from the URL every time we need it, instead of reading it out and putting it directly into state.</p></blockquote></li><li><blockquote><p>The value read from cookie, localStorage. Generally speaking, it is also read directly every time it is used, rather than read it and put it in state.</p></blockquote></li></ul><h3 id="useeffect-execution-side-effect"><a class="markdownIt-Anchor" href="#useeffect-execution-side-effect"></a> useEffect: Execution side effect</h3><p>A useEffect, as its name suggests, is used to perform a side effect. What are side effects?</p><p>Generally speaking, a side effect refers to a piece of code that has nothing to do with the current execution result. For example, to modify a variable outside of a function, to initiate a request, etc.</p><p>That is to say, during the execution of the function component, the execution of the code in the useEffect does not affect the rendered UI.</p><p>Corresponding to the Class component, the useEffect covers the three lifecycle methods of ComponentDidMount, participentDidUpdate and participentWillUnmount. However, if you are used to using Class components, do not follow the method of mapping the useEffect to one or several lifecycles. You just need to remember that the useEffect is determined and executed after each component is rendered.</p><p>There are also two special uses of useEffect: no dependencies, and dependencies as empty arrays. Let’s analyze it in detail.</p><ul><li>If there are no dependencies, it will be re-executed after each render.</li><li>An empty array as a dependency is only triggered on the first execution.</li></ul><p>In addition to these mechanisms, useEffect also allows you to return a function to do some cleaning operations when the component is destroyed. For example, removing event listeners.</p><p>So when defining dependencies, we need to pay attention to the following three points:</p><p>The variables defined in the dependency must be used in the callback function, otherwise declaring the dependency is actually meaningless.</p><ul><li>Dependencies are usually an array of constants, not variables. Because generally when creating callbacks, you know very well which dependencies are used.</li><li>React will use shallow comparisons to compare whether dependencies have changed, so pay special attention to arrays or object types. If you create a new object every time, even if it is equivalent to the previous value, it will be considered that the dependency has changed. This is a place that can easily lead to bugs when starting to use Hooks</li></ul><h3 id="usecallback-cache-callback-function"><a class="markdownIt-Anchor" href="#usecallback-cache-callback-function"></a> useCallback: Cache callback function</h3><p>In React function components, every UI change is done by re-executing the entire function, which is very different from traditional Class components: there is no direct way in function components to maintain a state between multiple renderings.</p><p>For example, in the following code, we define an event handling function on the plus button to increment the counter by 1. However, because the definition is inside the function component, it is impossible to reuse the handleIncrement function between multiple renders, and a new one needs to be created each time:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleIncrement</span> = (<span class="params"></span>) =&gt; <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncrement&#125;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Each time the state of the component changes, the function component will actually be executed again. Each time it is executed, a new event handler function handleIncrement is actually created. This event handler function contains a closure of the count variable to ensure the correct result every time.</p><p>This also means that even if the count does not change, when the function component is re-rendered due to other state changes, this writing will create a new function each time. Creating a new event handler function, although it does not affect the correctness of the result, is actually unnecessary. Because doing so not only increases the overhead of the system, but more importantly: the way a new function is created each time will make the component that receives the event handler function need to be re-rendered.</p><h3 id="usememo-cache-the-result-of-the-calculation"><a class="markdownIt-Anchor" href="#usememo-cache-the-result-of-the-calculation"></a> useMemo: Cache the result of the calculation</h3><p>The API signature of useMemo is as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useMemo</span>(fn, deps);</span><br></pre></td></tr></table></figure><p>Here, fn is a calculation function that generates the required data. Generally speaking, fn will use some variables declared in deps to generate a result, which is used to render the final UI. This scenario should be easy to understand: if some data is calculated from other data, then only when the data used, that is, the dependent data, changes should be recalculated.</p><p>For example, for a list that displays user information, now the user name needs to be searched, and the UI needs to display the filtered user according to the search keyword, then such a function needs to have two states:</p><ul><li>User Tabular Data itself: from a request.<br> Search keywords: data entered by the user in the search box.</li></ul><p>In this example, no matter why the component needs to be re-rendered, it actually needs to perform a filtering operation. But in fact, you only need to recalculate the data to be displayed when one of the two states of users or searchKey changes. So, at this time, we can use the useMemo Hook to implement this logic and cache the results of the calculation:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="title class_">Cache</span> the calculated result using userMemo</span><br><span class="line"><span class="keyword">const</span> usersToShow = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!users) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> users.<span class="property">data</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> user.<span class="property">first_name</span>.<span class="title function_">includes</span>(searchKey));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [users, searchKey]);</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>At this time, if we combine the two Hooks of useMemo and useCallback, we will find an interesting feature, that is, the function of useCallback can actually be achieved with useMemo. For example, the following code uses useMemo to achieve the function of useCallback:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myEventHandler = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">//return a function as cached result</span></span><br><span class="line">   <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">     <span class="comment">//Do event handling here</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;, [dep1, dep2]);</span><br></pre></td></tr></table></figure><h3 id="useref-share-data-between-multiple-renders"><a class="markdownIt-Anchor" href="#useref-share-data-between-multiple-renders"></a> useRef: Share data between multiple renders</h3><p>In a class component, we can define class member variables so that we can store some data on the object through member properties. But in the function component, there is no such space to store data. Therefore, React uses a Hook like useRef to provide such functionality. The API signature of useRef is as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myRefContainer = <span class="title function_">useRef</span>(initialValue);</span><br></pre></td></tr></table></figure><p>Suppose you want to make a timer component, which has both start and pause functions. Obviously, you need to use window.setInterval to provide timing functions; and in order to be able to pause, you need to save the reference to the counter returned by window.setInterval somewhere, making sure that when you click the pause button, you can also use window.clearInterval to stop the timer. Then, the most suitable place to save the counter reference is useRef, because it can store data across renderings. The code is as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useCallback, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//Define the time state to save the accumulated time of the timer</span></span><br><span class="line">  <span class="keyword">const</span> [time, setTime] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Define a container like timer to hold a variable between cross-component renders</span></span><br><span class="line">  <span class="keyword">const</span> timer = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//event handling function that starts timing</span></span><br><span class="line">  <span class="keyword">const</span> handleStart = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//use the current property to set the value of ref</span></span><br><span class="line">    timer.<span class="property">current</span> = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setTime</span>(<span class="function">(<span class="params">time</span>) =&gt;</span> time + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//pause the event handling function</span></span><br><span class="line">  <span class="keyword">const</span> handlePause = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//Use clearInterval to stop timing</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="built_in">clearInterval</span>(timer.<span class="property">current</span>);</span><br><span class="line">    timer.<span class="property">current</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;time / 10&#125; seconds.</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleStart&#125;</span>&gt;</span>Start<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handlePause&#125;</span>&gt;</span>Pause<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The data saved using useRef is generally independent of the rendering of the UI, so when the value of ref changes, it will not trigger the re-rendering of the component, which is where useRef differs from useState.</p><p>In addition to storing data across rendering, useRef has an important function of saving references to a DOM node. We know that in React, there is almost no need to care about how the real DOM node is rendered and modified. But in some scenarios, we have to get references to real DOM nodes, so combine React’s ref properties</p><h3 id="usecontext-define-global-state"><a class="markdownIt-Anchor" href="#usecontext-define-global-state"></a> useContext: Define global state</h3><p>React provides a Context mechanism that allows all components to create a Context in the component tree at the beginning of a component. In this way, all components in the component tree can access and modify the Context. Then in the function component, we can use a Hook like useContext to manage the Context.</p><p>The API signature of useContext is as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title function_">useContext</span>(<span class="title class_">MyContext</span>);</span><br></pre></td></tr></table></figure><p>As mentioned earlier, a Context is available from a component tree where a component is the root component, so we need an API to be able to create a Context, which is the React.createContext API, as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(initialValue);</span><br></pre></td></tr></table></figure><p>The MyContext here has a Provider property, which is generally used as the root component of the component tree. Here I still use the example of the official React doc to explain, namely: a theme switching mechanism. The code is as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#000000&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#eeeeee&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#ffffff&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#222222&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Create a Theme Context</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(themes.<span class="property">light</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">The</span> entire application uses <span class="title class_">ThemeContext</span>. <span class="title class_">Provider</span> <span class="keyword">as</span> the root component</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">//Use themes.dark as the current Context </span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;themes.dark&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Use a Theme Button in the Toolbar component</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ThemedButton</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Use useContext in the Theme Button to get the current theme</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ThemedButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">background:</span> <span class="attr">theme.background</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">color:</span> <span class="attr">theme.foreground</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      I am styled by theme context!</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>See here you may be a little curious, Context looks like a global data, why design such a complex mechanism, instead of directly using a global variable to save data?</p><p>The answer is actually very simple, that is, to be able to bind data. When the data of this Context changes, the components that use this data can be automatically refreshed. But if there is no Context, but a simple global variable, it is difficult to achieve.</p><p>But what we just saw is actually a static example of using Context, directly using thems.dark as the value of Context. So how to make it dynamic? For example, the common switch dark or light mode button is used to switch the theme of the entire page. In fact, dynamic Context does not require us to learn any new APIs, but uses the mechanism of React itself, which can be achieved with this line of code:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">ThemeContext</span>.<span class="property">Provider</span> value=&#123;themes.<span class="property">dark</span>&#125;&gt;</span><br></pre></td></tr></table></figure><p>As you can see, themes.dark is passed as a property value to the Provider component. If you want to make it dynamic, you just need to save it with a state. By modifying the state, you can dynamically switch the value of the Context. And in doing so, all places that use this Context will be automatically refreshed. For example, this code</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//Use state to save the theme so it can be dynamically modified</span></span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useState</span>(<span class="string">&quot;light&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Switch theme callback function</span></span><br><span class="line">  <span class="keyword">const</span> toggleTheme = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setTheme</span>(<span class="function">(<span class="params">theme</span>) =&gt;</span> (theme = <span class="string">&quot;light&quot;</span> ? <span class="string">&quot;dark&quot;</span> : <span class="string">&quot;light&quot;</span>));</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="title class_">Use</span> the theme state <span class="keyword">as</span> the current <span class="title class_">Context</span></span><br><span class="line">    &lt;<span class="title class_">ThemeContext</span>.<span class="property">Provider</span> value=&#123;themes[theme]&#125;&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;toggleTheme&#125;</span>&gt;</span>Toggle Theme<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line">    &lt;/<span class="title class_">ThemeContext</span>.<span class="property">Provider</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="comparison-of-hooks-and-life-cycles"><a class="markdownIt-Anchor" href="#comparison-of-hooks-and-life-cycles"></a> Comparison of Hooks and Life Cycles</h2><p>The lifecycle approach is to think of component creation and updates as a pipeline of what you can do on this pipeline. The Hooks approach is what to do when the state changes.</p><h2 id="how-to-structure-a-react-project"><a class="markdownIt-Anchor" href="#how-to-structure-a-react-project"></a> How to structure a React project</h2><p>The Root of Software Complexity: Complex Dependencies</p><p>We often say that a project looks very complex. So how should we define this “complex”? If you think carefully, you will find that when a function requires layers of nested module dependencies, even if you feel that the idea is very smooth during development, but when you look back, or if you want others to understand a function implementation, you have to go through a very deep call chain. This is the direct reason why you feel complex. So we can say that the root of software complexity comes entirely from complex dependencies.</p><p>Under the components, actions, Hooks and other folders, they are classified according to functions. And this classification is often further divided according to technical functions, such as table, modals, pages, etc. This approach actually increases the complexity of the project structure and is inconvenient to develop, mainly in two aspects.</p><p>On the one hand, for a function, we cannot intuitively know which folders its related code is scattered in. For example, the classification function in CMS may have lists, drop-down boxes, dialog boxes, asynchronous request logic, etc., which are all in different folders.</p><p>On the other hand, when developing a function, switching source code can be very inconvenient. For example, when you write a category list function, you need to frequently switch back and forth between components, style files, actions, reducers, etc. Moreover, if the project is large, then you need to expand a very long tree structure to find the corresponding files, or use file search to navigate. However, the premise of file search navigation is that you also need to have a good understanding of the logic of the entire function and know which files are available.</p><p>The essence of this development difficulty is that the source code is not organized according to business functions, but split from a technical point of view. Therefore, for the organization of folders, we must organize the source code by domain. A domain-related folder is similar to the first scenario just mentioned, and it contains all the technical modules it needs, so it will be very convenient to understand the code implementation or switch navigation during development.</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1639981335/origin-of-ray/c12927e3-3360-4da4-9a10-dce256deb229_lpc9uh.png" alt="img"></p><p>As you can see, the entire application contains at least modules such as article management, comments, classification, and users. First of all, we know that a React application must be composed of some technical components, such as components, routing, actions, store, etc. In the figure, I distinguish these components with different colors. However, if we scatter these technical components into different domain folders, each domain folder has its own compoents, routing, actions, store, etc. In this way, each folder is equivalent to a small project, containing all the source code related to itself, which is easy to understand and develop.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2021/07/17/react-hook2/" title="React Hook Practical Summary - How to Write Less Complex Projects with React Hook">https://sunra.top/en/2021/07/17/react-hook2/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2021/07/03/babel-tokenizer/" rel="prev" title="In-depth Babel Principles Series (3) Tokenizer"><i class="fa fa-chevron-left"></i> In-depth Babel Principles Series (3) Tokenizer</a></div><div class="post-nav-item"> <a href="/en/2021/07/24/javascript-v8-run-flow/" rel="next" title="JavaScript Execution Mechanism (6) How V8 executes JavaScript code">JavaScript Execution Mechanism (6) How V8 executes JavaScript code<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2021/07/17/react-hook2/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>