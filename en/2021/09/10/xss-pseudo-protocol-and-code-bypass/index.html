<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="This blog can be linked to my last post aboutXSS 的分类与利用方式The pseudo-protocol and encoding bypass mentioned this time is also a code injection attack method. The pseudo-protocol provides another code i"><meta property="og:type" content="article"><meta property="og:title" content="Pseudo-Protocol and Encoding Bypass"><meta property="og:url" content="https://sunra.top/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="This blog can be linked to my last post aboutXSS 的分类与利用方式The pseudo-protocol and encoding bypass mentioned this time is also a code injection attack method. The pseudo-protocol provides another code i"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-09-10T09:31:41.000Z"><meta property="article:modified_time" content="2024-06-10T03:16:08.962Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/","path":"2021/09/10/xss-pseudo-protocol-and-code-bypass/","title":"Pseudo-Protocol and Encoding Bypass"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Pseudo-Protocol and Encoding Bypass | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-a-fake-agreement"><span class="nav-number">1.</span> <span class="nav-text">What is a fake agreement</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Encoding-bypass"><span class="nav-number">2.</span> <span class="nav-text">Encoding bypass</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Unicode-encoding"><span class="nav-number">2.1.</span> <span class="nav-text">Unicode encoding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Browser-decoding"><span class="nav-number">2.2.</span> <span class="nav-text">Browser decoding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-layers-of-confusion"><span class="nav-number">2.3.</span> <span class="nav-text">Multiple layers of confusion</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Summary"><span class="nav-number">3.</span> <span class="nav-text">Summary</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Pseudo-Protocol and Encoding Bypass | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Pseudo-Protocol and Encoding Bypass</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-09-10 17:31:41" itemprop="dateCreated datePublished" datetime="2021-09-10T17:31:41+08:00">2021-09-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-06-10 11:16:08" itemprop="dateModified" datetime="2024-06-10T11:16:08+08:00">2024-06-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Security/" itemprop="url" rel="index"><span itemprop="name">Security</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>This blog can be linked to my last post about<a href="https://sunra.top/posts/5052/">XSS 的分类与利用方式</a>The pseudo-protocol and encoding bypass mentioned this time is also a code injection attack method. The pseudo-protocol provides another code injection point, and encoding bypass is the corresponding injection method.</p><span id="more"></span><h2 id="What-is-a-fake-agreement"><a href="#What-is-a-fake-agreement" class="headerlink" title="What is a fake agreement"></a>What is a fake agreement</h2><p>The concept of pseudo-protocol is relatively simple, but there are many types of situations.</p><p>Pseudo-protocols are different from protocols widely used on the Internet such as http, https, ftp, etc. They are used in URLs to perform specific functions.<br>For example, Data pseudo-protocol: ‘data: text/html; base64, PHanflajfAFLGLKSJ =’,<br>JavaScript pseudo-protocol: ‘javascript: alert (1); **’;</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt; p &gt; &lt; a href = &quot;javascript: alert (5) &quot; &gt; javascript pseudo-protocol<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTs8L3NjcmlwdD4=&quot;</span>&gt;</span>data 伪协议 base64<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgiMSIpOzwvc2NyaXB0Pg&quot;</span>&gt;</span>含双引号data 伪协议 base64<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Encoding-bypass"><a href="#Encoding-bypass" class="headerlink" title="Encoding bypass"></a>Encoding bypass</h2><p>In fact, the pseudo-protocol objectively provides an additional code injection point, and the encoding bypass is the way we use this injection point for injection.</p><p>This injection method is mainly to bypass the filtering of ‘&lt; script &gt;’ tags, parentheses, quotation marks, etc</p><h3 id="Unicode-encoding"><a href="#Unicode-encoding" class="headerlink" title="Unicode encoding"></a>Unicode encoding</h3><p>Before talking about coding bypass, let’s first mention this well-known coding method.</p><p>ISO (International Organization for Standardization) developed a code that includes all cultures, all letters and symbols on Earth, using two bytes to represent one character.</p><p>Unicode is just a set of symbols. It only specifies the binary code of the symbol, but it does not specify how this binary code should be stored.</p><p>The specific storage is implemented by: UTF-8, UTF-16, etc</p><ul><li>JavaScript encoding: ‘&amp; #x’, ‘\ u’ can be used to indicate that the current string is a unicode encoding, such as string test, which can be expressed as’test ‘, or’ &amp; #x0074 &amp; #x0065 &amp; #x0073 &amp; #x0074 ‘, or’ &amp; #x74 &amp; #x65 &amp; #x73 &amp; #x74 ‘</li><li>HTML Entity Encoding: ‘&amp; #’ indicates the current HTML entity encoding, or take test as an example, ‘&amp; #116 &amp; #101 &amp; #115 &amp; #116’.</li><li>URL encoding: This is more common, that is, the beginning of the percent sign, such as’% 74% 65% 73% 74 ‘</li></ul><h3 id="Browser-decoding"><a href="#Browser-decoding" class="headerlink" title="Browser decoding"></a>Browser decoding</h3><p> <strong>There are three main processes involved in parsing an HTML doc: HTML parsing, URL parsing, and JavaScript parsing. Each parser is responsible for decoding and parsing its corresponding part of the HTML doc, and the order varies</strong></p><p>First, let’s take a look at the effect of each parser separately.</p><ol><li>HTML encoding</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt; p &gt; For a tag, href attribute javascript: alert (1) encoding comparison &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 1 &lt; a href = &quot;javascript: alert (1) &quot; &gt; unencoded<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 2 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode r in href<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 3 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode r in javascript<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 4 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode r in alert (1)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br></pre></td></tr></table></figure><p>Among these encoding methods, only 2 cannot be parsed correctly, because 2 destroys the doc structure of HTML.<br>Because the HTML parser does not decode the HTML keywords, there is no recognition of 2 as a normal HTML tag, and the latter will not be, so we can see that the latter two, no matter what encoding method is changed, cannot be decoded correctly.</p><ol><li>URL encoding</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt; p &gt; For a tag, href attribute javascript: alert (1) encoding comparison &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 1 &lt; a href = &quot;javascript: alert (1) &quot; &gt; unencoded<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 2 &lt; a h% 72ef = &quot;javascript: alert (1) &quot; &gt; encode r in href<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 3 &lt; a href = &quot;javasc% 72ipt: alert (1) &quot; &gt; encode r in javascript<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 4 &lt; a href = &quot;javascript: ale% 72t (1) &quot; &gt; encode r in alert (1)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br></pre></td></tr></table></figure><p>In this case, 1,4 can be bypassed, and 2 cannot be bypassed for the same reason as above. This thing will not be parsed as normal html, and 3, although it will be parsed into a tag, but It is the url encoding of the javascript protocol type, and the protocol is also part of the url. The url parser is to identify according to this keyword. It cannot be identified now, so it cannot be bypassed.</p><ol><li>JavaScript coding</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt; p &gt; For a tag, href attribute javascript: alert (1) encoding comparison &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 1 &lt; a href = &quot;javascript: alert (1) &quot; &gt; unencoded<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 2 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode r in href<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 3 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode r in javascript<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 4 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode r in alert (1)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 5 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode (in alert (1)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br></pre></td></tr></table></figure><p>This is also 1, 4 can be bypassed, 2 is to destroy the DOM structure, 3 is to destroy the protocol, the label can be parsed normally, but the protocol is wrong, 5 this destroys the parsing of js, and cannot be performed correctly.</p><p>In summary, in the corresponding parsing stage, if the keyword of this stage is encoded and the structure is destroyed, it cannot be parsed correctly.</p><p>If the HTML parsing stage encodes the href attribute, it cannot be parsed correctly. HTML parsing does not consider that the a tag has an attribute called’href ‘, but that there is an attribute called’href’.</p><p>When the url parser goes to javasc% 72ipt: alert (1), it will not consider this a JavaScript pseudo-protocol at all, so it will not decode it.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt; p &gt; 4 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode r in alert (1)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 5 &lt; a href = &quot;javascript: alert (1) &quot; &gt; encode (in alert (1)<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br></pre></td></tr></table></figure><p>Both of these can correctly go to the last step of the JavaScript parsing stage, and then extract the js code for parsing. At this time, it depends on how the js parser parses it.</p><p>If the encoding of the url keyword, such as’javascript ‘, is not parsed correctly during the HTML decoding phase, then the url parsing phase will not parse it.</p><h3 id="Multiple-layers-of-confusion"><a href="#Multiple-layers-of-confusion" class="headerlink" title="Multiple layers of confusion"></a>Multiple layers of confusion</h3><p>The above is a separate parser, in fact, we also mentioned that the browser parses the doc in order, respectively, the HTML parser parses the dom tree, the URL parser decodes the url attribute in the dom tree, and finally the JavaScript parser decodes the part of the dom tree that is considered to be js code</p><p>As long as we reverse this order, we can perform two or even three layers of obfuscated encoding on a piece of HTML code.</p><p>Such as second-level confusion</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt; p &gt; 1 &lt; a href = &quot;javascript: ale% 5c% 75% 30% 30% 37% 32t (1) &quot; &gt; r in alert (1) encodes js, then url<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 2 &lt; a href = &quot;javascript: ale\ u0072t (1) &quot; &gt; r in alert (1) is encoded in js, then html<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br><span class="line">&lt; p &gt; 3 &lt; a href = &quot;javascript: ale% 72t (1) &quot; &gt; r in alert (1) is url encoded, then html encoded<span class="tag">&lt;/<span class="name">a</span>&gt;</span> &lt;/p &gt;</span><br></pre></td></tr></table></figure><p>Three layers of confusion</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt; p &gt; For a tag, the href attribute javascript: alert (1) is triggered by a three-layer encoding vulnerability &lt;/p &gt;</span><br><span class="line">&lt; p &gt; Three-layer decoding &lt; a href = &quot;javascript: ale% 5c% 75% 30% 30% 37% 32t (1) &quot; &gt; The r in alert (1) is js encoded, then url encoded, and then html encoded &lt;/p &gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>To sum up, in our last blog about xss, developers can filter by detecting keywords, scripts, etc.</p><p>However, the browser provides a pseudo-protocol method, so we have added a code injection method.</p><p>The advantage of this method is that it allows us to encode these keywords, thereby bypassing the above detection.</p><p>And this requires understanding two points, the first point, the encoding and decoding method of the browser, and the second, the order of decoding.</p><p>The first is html decoding. If the key to html is encoded at this stage, it cannot be parsed correctly. For example, if the href attribute of a tag is html encoded, the browser will think that you just want to give a tag an attribute called’href ‘, but at this stage, other parts can be decoded in html, such as’javascript: alert (1) ‘. The r in this code is encoded in html encoding and can be decoded at this stage (that is, html decoding stage, only those non-html keywords will be decoded and encoded in html encoding).</p><p>The second is URL decoding. At this stage, if it is’javasc% 72ipt: alert (1) ‘, the url encoding thinks you have a protocol called’javasc% 72ipt’, and of course it will not be parsed correctly.</p><p>Finally, JavaScript decoding can go to this stage, indicating that the above two steps have been correctly parsed, and that you have a piece of js code here, then parse it according to the js parser.</p><p>Understand it from a different perspective.</p><p>The html decoding stage is to see what tags you have and what attributes the tags have. If you encode these things, it is actually written in a different way. Of course, the parser directly parses it into a dom tree as you said. As for whether the follow-up is recognizable by the browser kernel, the parser does not care. The information that is not used in this step can be decoded by html decoding.</p><p>After HTML decoding, for parsing the url part, then perform url decoding. One purpose of this step is to see what protocol you are. If you encode the name of the protocol, the parser also thinks that you are the protocol. As for whether there is really this protocol, it is not the parser that is responsible.</p><p>Finally, after being parsed by the url parser, it is considered to be the part of the js code, and then the js is decoded.</p><p>In the end, these three steps are parsed first, what you say is what you say, you say there is an attribute called’href ‘, then there is, the rest of the part is decoded according to the decoding method corresponding to the current stage and handed over to the next stage, the next stage is to first pick out the part you are responsible for parsing (not decoding), and then decode the rest according to the decoding method corresponding to the current stage. As for whether it can run in the end, that’s not what they care about. **</p><p>For example, this thing: ‘&lt; p &gt; 3 &lt; a href = “javasc% 72ipt: alert (1) “ &gt; r in javascript is encoded&lt;/a&gt; &lt;/p &gt;’, in the html decoding stage a tag and href attributes can be parsed normally, in theory ‘javasc% 72ipt’ this thing will also be decoded by html, but this section is not html encoded, so it is not decoded correctly. At the next stage, the url parser thinks that the protocol of this thing is’ javasc% 72ipt ‘, so the next stage will not think that it is a piece of js, even if it can be parsed correctly by the js parser.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/" title="Pseudo-Protocol and Encoding Bypass">https://sunra.top/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2021/09/05/xss-inrtroduction/" rel="prev" title="Classification and Utilization of XSS"><i class="fa fa-chevron-left"></i> Classification and Utilization of XSS</a></div><div class="post-nav-item"> <a href="/en/2021/09/19/xss-worm/" rel="next" title="XSS Worm Definition and Practical Analysis">XSS Worm Definition and Practical Analysis<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2021/09/10/xss-pseudo-protocol-and-code-bypass/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>