<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Recently, when looking at some security knowledge, I found a new vulnerability called SSRF. The principle of this vulnerability is not complicated, but because it is the first time I have encountered"><meta property="og:type" content="article"><meta property="og:title" content="Principle and Defense Scheme of SSRF Vulnerability"><meta property="og:url" content="https://sunra.top/en/2021/05/06/ssrf/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Recently, when looking at some security knowledge, I found a new vulnerability called SSRF. The principle of this vulnerability is not complicated, but because it is the first time I have encountered"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-05-06T13:48:51.000Z"><meta property="article:modified_time" content="2025-02-19T13:05:40.602Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2021/05/06/ssrf/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2021/05/06/ssrf/","path":"2021/05/06/ssrf/","title":"Principle and Defense Scheme of SSRF Vulnerability"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Principle and Defense Scheme of SSRF Vulnerability | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#what-is-ssrf"><span class="nav-number">1.</span> <span class="nav-text">What is SSRF?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#principle"><span class="nav-number">1.1.</span> <span class="nav-text">Principle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#example"><span class="nav-number">1.2.</span> <span class="nav-text">Example</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssrf-hazard"><span class="nav-number">2.</span> <span class="nav-text">SSRF Hazard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#detect-any-port-of-the-internal-host"><span class="nav-number">2.1.</span> <span class="nav-text">** Detect any port of the internal host **</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-ssrf-to-obtain-sensitive-intranet-file-information"><span class="nav-number">2.2.</span> <span class="nav-text">** Use SSRF to obtain sensitive intranet file information **</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#defense-methods"><span class="nav-number">3.</span> <span class="nav-text">Defense methods</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2021/05/06/ssrf/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Principle and Defense Scheme of SSRF Vulnerability | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Principle and Defense Scheme of SSRF Vulnerability</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-05-06 21:48:51" itemprop="dateCreated datePublished" datetime="2021-05-06T21:48:51+08:00">2021-05-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2025-02-19 21:05:40" itemprop="dateModified" datetime="2025-02-19T21:05:40+08:00">2025-02-19</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Security/" itemprop="url" rel="index"><span itemprop="name">Security</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2021/05/06/ssrf/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2021/05/06/ssrf/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Recently, when looking at some security knowledge, I found a new vulnerability called SSRF. The principle of this vulnerability is not complicated, but because it is the first time I have encountered it, I still simply record it.</p><span id="more"></span><h2 id="what-is-ssrf"><a class="markdownIt-Anchor" href="#what-is-ssrf"></a> What is SSRF?</h2><p>Server level request forgery (Server-Side Request Forgery), refers to the attacker who fails to obtain the ownership limit of the server, using the server vulnerability to send a constructed request to the intranet where the server is located. SSRF attacks usually target internal systems that cannot be directly accessed by external networks.</p><h3 id="principle"><a class="markdownIt-Anchor" href="#principle"></a> Principle</h3><p>The main reason for the formation of SSRF vulnerabilities is that the interface provided by the server contains the URL parameters of the requested content, and the URL parameters transmitted by the Client are not filtered. **</p><p>Assuming that a company’s website is deployed on the A server, in order to allow users to access it, the A server has its own I public network P address (or through the NAT Gateway configuration, it has its own public network IP + PORT), and the company also has A B server stores some important data. This B server is deployed on the intranet and has no public network IP, so under normal circumstances, the extranet cannot be accessed.</p><p>At this time, some services on the website on the A server need to use the data on B, so they will send a request to B. Since A knows where B is, A can access it.</p><p>At this time, A is equivalent to a reverse proxy of B, but this proxy can only issue a few requests specified on the A website.</p><p>If at this time, the request A can make is not strictly limited, and the parameters can be pieced together casually, then A is equivalent to opening a door for hackers to go straight to the B server.</p><h3 id="example"><a class="markdownIt-Anchor" href="#example"></a> Example</h3><p>Many web applications provide the function of obtaining data from other servers. Using specified URLs, web applications can retrieve images, download files, read file contents, etc. The essence of SSRF is to use defective web applications as proxies to attack remote and local servers. In general, the target of SSRF attacks is internal systems that are inaccessible to the extranet. Hackers can exploit SSRF vulnerabilities to obtain some information about internal systems (precisely because it is initiated at the server level, it can request internal systems that are connected to it and isolated from the extranet). Most of the reasons for the formation of SSRF are because the server level provides the function of obtaining data from other server applications without filtering and restricting the target address.</p><h2 id="ssrf-hazard"><a class="markdownIt-Anchor" href="#ssrf-hazard"></a> SSRF Hazard</h2><h3 id="detect-any-port-of-the-internal-host"><a class="markdownIt-Anchor" href="#detect-any-port-of-the-internal-host"></a> ** Detect any port of the internal host **</h3><p>This situation is more extreme and basically does not occur. That is to say, A will go to B through the ip and Port Number in the request parameters. That is to say, the specific information of B is obtained by A parsing the IP and Port in the request</p><p>However, once this situation occurs, the attacker can forge various IPs and PORTS to access, and get the network results in the intranet and the port development of each server according to the different returned results.</p><h3 id="use-ssrf-to-obtain-sensitive-intranet-file-information"><a class="markdownIt-Anchor" href="#use-ssrf-to-obtain-sensitive-intranet-file-information"></a> ** Use SSRF to obtain sensitive intranet file information **</h3><p>There is a ssrf.php page on the server. The function of this page is to obtain URL parameters and then display the content of the URL on the web page.</p><p>We go to the link: <a target="_blank" rel="external nofollow noopener noreferrer" href="http://127.0.0.1/ssrf.php?url=http:">http://127.0.0.1/ssrf.php?url=http:</a> <a target="_blank" rel="noopener" href="//127.0.0.1/test.php">//127.0.0.1/test.php</a> and it will show the test.php page</p><p>We can change the URL parameter to the address of the intranet, which will disclose the information of the server’s intranet. Change the URL to the form of file://to read the local file.</p><h2 id="defense-methods"><a class="markdownIt-Anchor" href="#defense-methods"></a> Defense methods</h2><ol><li><p>Filter the returned information. If the web application is to obtain a certain type of file, verify whether the returned information meets the standard before displaying the returned result to the user.</p></li><li><p>Unify the error message to avoid users from judging the port status of the remote server based on the error message.</p></li></ol><p>Limit the requested port, such as 80, 443, 8080, 8090.</p><ol start="4"><li><p>Prohibit uncommonly used protocols, only allow http and https requests. It can prevent problems caused by files:///, gopher://, ftp://, etc.</p></li><li><p>Use DNS cache or Host Whitelist.</p></li></ol><p>Reference link:</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://zhuanlan.zhihu.com/p/91819069">https://zhuanlan.zhihu.com/p/91819069</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/612c010e588e">https://www.jianshu.com/p/612c010e588e</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2021/05/06/ssrf/" title="Principle and Defense Scheme of SSRF Vulnerability">https://sunra.top/en/2021/05/06/ssrf/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2021/04/28/micro-frontend/" rel="prev" title="micro frontend concept and scheme comparison"><i class="fa fa-chevron-left"></i> micro frontend concept and scheme comparison</a></div><div class="post-nav-item"> <a href="/en/2021/05/11/redux/" rel="next" title="Redux Introduction Notes">Redux Introduction Notes<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2021/05/06/ssrf/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>