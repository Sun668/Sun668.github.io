<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="The last blog about React left a pit about Es6 class, about the relationship between class and function, we will discuss this blog. We come to this blog with two questions:  how classes are implemente"><meta property="og:type" content="article"><meta property="og:title" content="ES6 Class Source Code Analysis"><meta property="og:url" content="https://sunra.top/en/2021/03/28/es6-class-source-code/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="The last blog about React left a pit about Es6 class, about the relationship between class and function, we will discuss this blog. We come to this blog with two questions:  how classes are implemente"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-03-28T08:44:50.000Z"><meta property="article:modified_time" content="2023-08-20T01:31:47.844Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2021/03/28/es6-class-source-code/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2021/03/28/es6-class-source-code/","path":"2021/03/28/es6-class-source-code/","title":"ES6 Class Source Code Analysis"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>ES6 Class Source Code Analysis | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-implement-class-with-function"><span class="nav-number">1.</span> <span class="nav-text">How to implement class with function</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Prototype-chain"><span class="nav-number">1.1.</span> <span class="nav-text">Prototype chain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-babel-to-convert-classes-into-es5-code"><span class="nav-number">1.2.</span> <span class="nav-text">Using babel to convert classes into es5 code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Auxiliary-function"><span class="nav-number">1.3.</span> <span class="nav-text">Auxiliary function</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#inherits"><span class="nav-number">1.3.1.</span> <span class="nav-text">_inherits</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setPrototypeOf"><span class="nav-number">1.3.2.</span> <span class="nav-text">_setPrototypeOf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isNativeReflectConstruct"><span class="nav-number">1.3.3.</span> <span class="nav-text">_isNativeReflectConstruct</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getPrototypeOf"><span class="nav-number">1.3.4.</span> <span class="nav-text">_getPrototypeOf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#typeof"><span class="nav-number">1.3.5.</span> <span class="nav-text">_typeof</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#possibleConstructorReturn"><span class="nav-number">1.3.6.</span> <span class="nav-text">_possibleConstructorReturn</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createSuper"><span class="nav-number">1.3.7.</span> <span class="nav-text">_createSuper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#classCallCheck"><span class="nav-number">1.3.8.</span> <span class="nav-text">_classCallCheck</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineProperties"><span class="nav-number">1.3.9.</span> <span class="nav-text">_defineProperties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createClass"><span class="nav-number">1.3.10.</span> <span class="nav-text">_createClass</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamically-generated-code"><span class="nav-number">1.4.</span> <span class="nav-text">Dynamically generated code</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#new"><span class="nav-number">2.</span> <span class="nav-text">new</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2021/03/28/es6-class-source-code/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="ES6 Class Source Code Analysis | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> ES6 Class Source Code Analysis</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-03-28 16:44:50" itemprop="dateCreated datePublished" datetime="2021-03-28T16:44:50+08:00">2021-03-28</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-20 09:31:47" itemprop="dateModified" datetime="2023-08-20T09:31:47+08:00">2023-08-20</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2021/03/28/es6-class-source-code/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2021/03/28/es6-class-source-code/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>The last blog about React left a pit about Es6 class, about the relationship between class and function, we will discuss this blog.</p><p>We come to this blog with two questions:</p><ul><li>how classes are implemented with functions<br>What is the difference between new class and new function?</li></ul><span id="more"></span><h2 id="How-to-implement-class-with-function"><a href="#How-to-implement-class-with-function" class="headerlink" title="How to implement class with function"></a>How to implement class with function</h2><h3 id="Prototype-chain"><a href="#Prototype-chain" class="headerlink" title="Prototype chain"></a>Prototype chain</h3><p>As we all know, class is actually a syntactic sugar of function, which is based on the prototype chain, so if you want to understand this blog, I suggest you to take a look at my previous blog about prototype chain:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://kingworker.cn/javascript%e6%89%a7%e8%a1%8c%e6%9c%ba%e5%88%b6%ef%bc%88%e4%ba%94%ef%bc%89%e7%94%a8%e5%85%ac%e5%bc%8f%e8%ae%b2%e6%b8%85%e6%a5%9a%e5%8e%9f%e5%9e%8b%e9%93%be/">用公式讲清楚原型链</a></p><h3 id="Using-babel-to-convert-classes-into-es5-code"><a href="#Using-babel-to-convert-classes-into-es5-code" class="headerlink" title="Using babel to convert classes into es5 code"></a>Using babel to convert classes into es5 code</h3><p>We can write a piece of class code and then use<a target="_blank" rel="external nofollow noopener noreferrer" href="https://babeljs.io/repl/#?browsers=&amp;build=&amp;builtIns=false&amp;spec=false&amp;loose=false&amp;code_lz=MYGwhgzhAEAKCmAnCB7AdgbwFDV8dEALogK7CEqIAUaYAtvADTRgDm8AlNrj4QBYBLCADpaDaAF5oY-Dh7R-Q4W3iSW7ObgC-WTdCJhCA4AoCeAB1VSA5ACN4AtK2u7cEMKYBy9VVS57EeEISRDQFQREZPR05AyMTR2IUP24efDRUEHhhEBRWKgAiAo5orBjQSBgAWXgw-AAPQlqAExgEZHRUvAJiMgpqGWYVf3l5CBJLahLR8KV2NGakNWs6MCyXeR0tIA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=env%2Creact%2Cstage-2&amp;prettier=true&amp;targets=&amp;version=7.13.13&amp;externalPlugins=">babel在线工具</a>Convert it into es5 code, and then analyze it step by step.</p><p>First, let’s write a piece of class code</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">   <span class="title function_">constructor</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> type = <span class="string">&#x27;being&#x27;</span></span><br><span class="line"></span><br><span class="line">  sayName ()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">intro</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Men</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(name, age)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gender</span> = <span class="string">&#x27;male&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The function after conversion is too long, I will not completely paste here, want to see the full version can go to the above link to see for yourself, we now begin to analyze the transformation of the function step by step.</p><h3 id="Auxiliary-function"><a href="#Auxiliary-function" class="headerlink" title="Auxiliary function"></a>Auxiliary function</h3><h4 id="inherits"><a href="#inherits" class="headerlink" title="_inherits"></a>_inherits</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_inherits</span>(<span class="params">subClass, superClass</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> superClass ! <span class="string">&quot;function&quot;</span> &amp;&amp; superClass ! <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Super expression must either be null or a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  subClass.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(superClass &amp;&amp; superClass.<span class="property"><span class="keyword">prototype</span></span>, &#123;</span><br><span class="line">    <span class="attr">constructor</span>: &#123; <span class="attr">value</span>: subClass, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">configurable</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (superClass) <span class="title function_">_setPrototypeOf</span>(subClass, superClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The name of this function is used for inheritance, that is, the function will be called when extends.</p><p>This function first comes up to determine whether the parent class meets the conditions, if not, directly throw an exception.</p><p>This is followed by a call to the Object.create method, which does this:</p><p>The Object.create () method creates a new object, using the existing object to provide the <strong>proto</strong> of the newly created object.</p><p>That is to say:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subClass.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(superClass &amp;&amp; superClass.<span class="property"><span class="keyword">prototype</span></span>, &#123;</span><br><span class="line">    <span class="attr">constructor</span>: &#123; <span class="attr">value</span>: subClass, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">configurable</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>This code completes inheritance based on the prototype chain. The result of this code is that a new object is created through superClass.prototype, the <strong>proto</strong> of the new object points to superClass.prototype, and then the object is assigned to subClass.prototype.</p><p>That is, subClass.prototype. ‘<strong>proto</strong>‘ = superClass.prototype</p><p>In this way, the subclass prototype chain has superclass prototypes.</p><p>Then there is the last step of _setPrototypeOf, we continue to see what this function does</p><h4 id="setPrototypeOf"><a href="#setPrototypeOf" class="headerlink" title="_setPrototypeOf"></a>_setPrototypeOf</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_setPrototypeOf</span>(<span class="params">o, p</span>) &#123;</span><br><span class="line">  _setPrototypeOf =</span><br><span class="line">    <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ||</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">_setPrototypeOf</span>(<span class="params">o, p</span>) &#123;</span><br><span class="line">      o. _ _ proto _ _ = p;</span><br><span class="line">      <span class="keyword">return</span> o;</span><br><span class="line">    &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_setPrototypeOf</span>(o, p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The role of this function is also to construct a prototype chain, and its core purpose is this sentence</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o. _ _ proto _ _ = p</span><br></pre></td></tr></table></figure><p>Combined with the previous auxiliary function</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_setPrototypeOf</span>(subClass, superClass)</span><br></pre></td></tr></table></figure><p>The result is subClass. ‘<strong>proto</strong>‘ = superClass</p><h4 id="isNativeReflectConstruct"><a href="#isNativeReflectConstruct" class="headerlink" title="_isNativeReflectConstruct"></a>_isNativeReflectConstruct</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_isNativeReflectConstruct</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Reflect</span> = <span class="string">&quot;undefined&quot;</span> || !<span class="title class_">Reflect</span>.<span class="property">construct</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Reflect</span>.<span class="property">construct</span>.<span class="property">sham</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Proxy</span> = <span class="string">&quot;function&quot;</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title class_">Boolean</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>.<span class="title function_">call</span>(</span><br><span class="line">      <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(<span class="title class_">Boolean</span>, [], <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To understand this code, it is necessary to understand what Reflect is and what Reflect.construct is</p><p>First of all, Reflect is actually a new syntax of ES6. You can see what you can do<a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">MDN</a>, is not our current focus, we will only focus on one of them for the time being:</p><blockquote><p>[`Reflect.construct(target,</p><p>Construct the function</p></blockquote><p>Then the role of this function is more obvious, that is, to see if the current execution environment can use Reflect.construct to create new objects.</p><h4 id="getPrototypeOf"><a href="#getPrototypeOf" class="headerlink" title="_getPrototypeOf"></a>_getPrototypeOf</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_getPrototypeOf</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  _getPrototypeOf = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span></span><br><span class="line">    ? <span class="title class_">Object</span>.<span class="property">getPrototypeOf</span></span><br><span class="line">    : <span class="keyword">function</span> <span class="title function_">_getPrototypeOf</span>(<span class="params">o</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> o.<span class="property">__proto__</span> || <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(o);</span><br><span class="line">      &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_getPrototypeOf</span>(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This function is the next prototype in the prototype chain that gets passed parameters, which can also be understood as the object it directly inherits.</p><h4 id="typeof"><a href="#typeof" class="headerlink" title="_typeof"></a>_typeof</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_typeof</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="string">&quot;@babel/helpers - typeof&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Symbol</span> = <span class="string">&quot;function&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Symbol</span>.<span class="property">iterator</span> = <span class="string">&quot;symbol&quot;</span>) &#123;</span><br><span class="line">    _typeof = <span class="keyword">function</span> <span class="title function_">_typeof</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> obj;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    _typeof = <span class="keyword">function</span> <span class="title function_">_typeof</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> obj &amp;&amp;</span><br><span class="line">        <span class="keyword">typeof</span> <span class="title class_">Symbol</span> = <span class="string">&quot;function&quot;</span> &amp;&amp;</span><br><span class="line">        obj.<span class="property">constructor</span> = <span class="title class_">Symbol</span> &amp;&amp;</span><br><span class="line">        obj ! <span class="title class_">Symbol</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line">        ? <span class="string">&quot;symbol&quot;</span></span><br><span class="line">        : <span class="keyword">typeof</span> obj;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_typeof</span>(obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>This code first creates the function variable _typeof through if-else. Since it is es5 code, there is no const and let. This direct variable assignment method is actually the same as var, so it will exist<a target="_blank" rel="external nofollow noopener noreferrer" href="https://kingworker.cn/javascript%e6%89%a7%e8%a1%8c%e6%9c%ba%e5%88%b6%ef%bc%88%e4%b8%80%ef%bc%89%e5%8f%98%e9%87%8f%e6%8f%90%e5%8d%87/">变量提升</a></p><p>The result is that a function is declared in the function scope, assigned to _typeof, and then called to return the result.</p><p>Putting why there is this judgment, I should leave a pit here again, we temporarily ignore it, just as it is for browser compatibility.</p><h4 id="possibleConstructorReturn"><a href="#possibleConstructorReturn" class="headerlink" title="_possibleConstructorReturn"></a>_possibleConstructorReturn</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_possibleConstructorReturn</span>(<span class="params">self, call</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (call &amp;&amp; (<span class="title function_">_typeof</span>(call) = <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> call = <span class="string">&quot;function&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> call;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_assertThisInitialized</span>(self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_assertThisInitialized</span>(<span class="params">self</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (self = <span class="keyword">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ReferenceError</span>(</span><br><span class="line">      <span class="string">&quot;this hasn&#x27;t been initialised - super() hasn&#x27;t been called&quot;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>First of all, we need to know’void 0 ‘ = undefined` 是 true.</p><p>Looking back at this code again, that is, if the call is an object or function, return the call directly.</p><p>If not, then see if self is undefined. If so, throw an exception. If not, return self.</p><h4 id="createSuper"><a href="#createSuper" class="headerlink" title="_createSuper"></a>_createSuper</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_createSuper</span>(<span class="params">Derived</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hasNativeReflectConstruct = <span class="title function_">_isNativeReflectConstruct</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">_createSuperInternal</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Super</span> = <span class="title function_">_getPrototypeOf</span>(<span class="title class_">Derived</span>),</span><br><span class="line">      result;</span><br><span class="line">    <span class="keyword">if</span> (hasNativeReflectConstruct) &#123;</span><br><span class="line">      <span class="keyword">var</span> <span class="title class_">NewTarget</span> = <span class="title function_">_getPrototypeOf</span>(<span class="variable language_">this</span>).<span class="property">constructor</span>;</span><br><span class="line">      result = <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(<span class="title class_">Super</span>, <span class="variable language_">arguments</span>, <span class="title class_">NewTarget</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = <span class="title class_">Super</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_possibleConstructorReturn</span>(<span class="variable language_">this</span>, result);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Well, after seeing so many auxiliary functions above, they are finally used here.</p><p>Let’s take a good look at what this function does:</p><ul><li>First determine whether the current execution environment can call Reflect.construct, if you can hasNativeReflectConstruct is true.<br>Then the result of this function execution actually returns the _createSuperInternal of another function, which uses the outer parameters, so this is a closure.<br>Let’s see what happens in this closure:<ul><li>Get Derived Prototype as Super</li><li>if the current environment can call Reflect.construct (hasNativeReflectConstruct is true)</li><li>var NewTarget = _getPrototypeOf (this).constructor; Gets the constructor up the prototype chain of the current function executor and assigns it to NewTarget.</li><li>result = Reflect.construct (Super, arguments, NewTarget); call new Super with arguments, the constructor of the created object is NewTarget</li><li>If hasNativeReflectConstruct is false, call apply directly on this, this inheritance method is actually <strong>borrowing constructor function inheritance</strong> this inheritance method, there are many other inheritance methods, interested can go to my other blog: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://kingworker.cn/javascript-%e7%bb%a7%e6%89%bf/">https://kingworker.cn/javascript-%e7%bb%a7%e6%89%bf/</a></li><li>Finally call _possibleConstructorReturn (this, result), the result is, if result is an object or function, then return result, otherwise if this is not undefined, then return this, do not meet the throw error.</li></ul></li></ul><h4 id="classCallCheck"><a href="#classCallCheck" class="headerlink" title="_classCallCheck"></a>_classCallCheck</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_classCallCheck</span>(<span class="params">instance, Constructor</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot call a class as a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This function is very simple, it is used to detect that the class cannot be called like a normal function, such as class Persion. You cannot directly Persion ()</p><h4 id="defineProperties"><a href="#defineProperties" class="headerlink" title="_defineProperties"></a>_defineProperties</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_defineProperties</span>(<span class="params">target, props</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; props.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> descriptor = props[i];</span><br><span class="line">    descriptor.<span class="property">enumerable</span> = descriptor.<span class="property">enumerable</span> || <span class="literal">false</span>;</span><br><span class="line">    descriptor.<span class="property">configurable</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;value&quot;</span> <span class="keyword">in</span> descriptor) descriptor.<span class="property">writable</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, descriptor.<span class="property">key</span>, descriptor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_defineProperty</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">      <span class="attr">value</span>: value,</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    obj[key] = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The function of these two functions together is to continuously define new properties on the target</p><h4 id="createClass"><a href="#createClass" class="headerlink" title="_createClass"></a>_createClass</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_createClass</span>(<span class="params">Constructor, protoProps, staticProps</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (protoProps) <span class="title function_">_defineProperties</span>(<span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>, protoProps);</span><br><span class="line">  <span class="keyword">if</span> (staticProps) <span class="title function_">_defineProperties</span>(<span class="title class_">Constructor</span>, staticProps);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Constructor</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Combined with the above _defineProperties function, this function has three parameters, the first parameter is the constructor function, the second parameter is an array of all common properties, and the third is an array of all static properties, so the function is actually:</p><p>Define the ordinary properties of the class on the prototype of the constructor function, so that when we create a new instance, we can find these ordinary properties on the prototype chain of the instance</p><blockquote><p>Those who have read my previous blog about prototype chains should be impressed with my formula:</p><p>a = new A() =&gt; a.<code>__proto__</code> = A.prototype</p></blockquote><ul><li>Defines static properties in the class on the constructor function, so that we can directly point out static methods on the constructor function.</li></ul><h3 id="Dynamically-generated-code"><a href="#Dynamically-generated-code" class="headerlink" title="Dynamically generated code"></a>Dynamically generated code</h3><p>Okay, with these auxiliary functions above, I can see how the class we defined at the beginning uses these auxiliary functions to achieve</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Person</span> = <span class="comment">/*#__PURE__*/</span> (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Person</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">_createClass</span>(</span><br><span class="line">    <span class="title class_">Person</span>,</span><br><span class="line">    [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;sayName&quot;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="keyword">function</span> <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;intro&quot;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="keyword">function</span> <span class="title function_">intro</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Person</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="title function_">_defineProperty</span>(<span class="title class_">Person</span>, <span class="string">&quot;type&quot;</span>, <span class="string">&quot;being&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Men</span> = <span class="comment">/*#__PURE__*/</span> (<span class="keyword">function</span> (<span class="params">_Person</span>) &#123;</span><br><span class="line">  <span class="title function_">_inherits</span>(<span class="title class_">Men</span>, _Person);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> _super = <span class="title function_">_createSuper</span>(<span class="title class_">Men</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Men</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _this;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Men</span>);</span><br><span class="line"></span><br><span class="line">    _this = _super.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, age);</span><br><span class="line">    _this.<span class="property">gender</span> = <span class="string">&quot;male&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> _this;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Men</span>;</span><br><span class="line">&#125;)(<span class="title class_">Person</span>);</span><br></pre></td></tr></table></figure><ul><li>First of all, Persion is defined as the return result of an immediately executed function, which is still a function, so we can know that in the end Persion is actually a function, and we still call this function Constructor Persion.</li></ul><p>What does the Constructor Persion function do?</p><ul><li>First, call _classCallCheck (this, Person);, this is the auxiliary function we just analyzed, to ensure that our Constructor Persion function is not called directly, but placed after new as a constructor function.</li><li>then add two properties on the instance, name and age</li></ul><ul><li><p>Call _createClass, we just analyzed, the three parameters of this function are constructor function, array of normal properties, array of static properties, so after this step, Persion.prototype has a new property called sayName, Persion There is a new static property called intro.</p></li><li><p>Finally back to Constructor Persion</p></li><li><p>Because type is a static property of Class Persion, define type on Constructor Persion so that it can be found directly on the constructor function.</p></li><li><p>Men is also defined as the result of an immediately executed function, which is also a function. We call this function Constructor Men.</p></li><li><p>First call _inherits (Men, _Person), through the “_inherits” function we just analyzed, its function is</p><blockquote><p>subClass.prototype.<code>__proto__</code> = superClass.prototype</p><p>subClass.<code>__proto__</code> = superClass</p><p>put it here, that is to say</p><p>Men.prototype.<code>__proto__</code> = _Person.prototype</p><p>Men.<code>__proto__</code> = _Person</p></blockquote><p>This completes the inheritance of the prototype chain</p><p>One thing to note here is that <strong>this Men is the function Men of the following declaration, not the outer Men, because the function declaration promotes</strong></p></li><li><p><code>var _super = _createSuper(Men)</code></p><p>We just analyzed this <em>createSuper function, it will return another function, the role of this function is to get’Men.<strong>proto</strong> ‘as Super, and then call Super with the function caller as the context, and the above _inherits (Men, _Person) ‘ has made Men. ‘</em> <em>pro to __` =</em> Person.</p><p>So the result of this step is a function that will call the Persion function in the context of the caller</p></li><li><p>Second, define Constructor Men (although the code order is not like this, but the function declaration will raise the variable), so what does this Constructor Men do?</p><ul><li>Also check if the Men are called directly.<br>Invoking _super, that is, calling Persion on an instance of Men, is typical of borrowing constructor function inheritance.</li><li>Mount the gender attribute on the Men instance.</li></ul></li><li><p>返回Constructor Men</p></li></ul><p>We finally analyzed the results:</p><ul><li>First we get two functions Persion and Men, both of which can only be called by new, otherwise an exception will be thrown.<br>Secondly, both constructor functions themselves define the declared static properties, and the constructor function prototype defines the normal properties.</li><li>Men.prototype.<code>__proto__</code> = _Person.prototype</li><li>Men.<code>__proto__</code> = _Person</li><li>The constructor function of Men inherits by calling the method of the Persion constructor function on the Men instance.</li></ul><h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><p>See here and understand the small partners should understand, there is no difference, just more built-in checks to help you do the inheritance of the prototype chain.</p><p>The class essence returns a function.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2021/03/28/es6-class-source-code/" title="ES6 Class Source Code Analysis">https://sunra.top/en/2021/03/28/es6-class-source-code/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2021/03/25/react-ref/" rel="prev" title="React Introductory Series (2) Ref"><i class="fa fa-chevron-left"></i> React Introductory Series (2) Ref</a></div><div class="post-nav-item"> <a href="/en/2021/03/29/react-context/" rel="next" title="React Introduction Series (3) Context">React Introduction Series (3) Context<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2021/03/28/es6-class-source-code/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>