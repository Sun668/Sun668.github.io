<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="React Ref"><meta property="og:type" content="article"><meta property="og:title" content="React Introductory Series (2) Ref"><meta property="og:url" content="https://sunra.top/en/2021/03/25/react-ref/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="React Ref"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-03-25T11:47:03.000Z"><meta property="article:modified_time" content="2024-04-24T06:06:37.485Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2021/03/25/react-ref/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2021/03/25/react-ref/","path":"2021/03/25/react-ref/","title":"React Introductory Series (2) Ref"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>React Introductory Series (2) Ref | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Role-of-Ref"><span class="nav-number">1.</span> <span class="nav-text">The Role of Ref</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#When-to-use"><span class="nav-number">2.</span> <span class="nav-text">When to use</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-is-declarative"><span class="nav-number">2.1.</span> <span class="nav-text">What is declarative</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Do-not-overuse"><span class="nav-number">3.</span> <span class="nav-text">Do not overuse</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-Use-Ref"><span class="nav-number">4.</span> <span class="nav-text">How to Use Ref</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Create"><span class="nav-number">4.1.</span> <span class="nav-text">Create</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access"><span class="nav-number">4.2.</span> <span class="nav-text">Access</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#For"><span class="nav-number">4.2.1.</span> <span class="nav-text">For</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#For-1"><span class="nav-number">4.2.2.</span> <span class="nav-text">For</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Refs"><span class="nav-number">4.2.3.</span> <span class="nav-text">Refs</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Will"><span class="nav-number">4.3.</span> <span class="nav-text">Will</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Callback"><span class="nav-number">4.4.</span> <span class="nav-text">Callback</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#About-callbacks"><span class="nav-number">4.4.1.</span> <span class="nav-text">About callbacks</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ref-forwarding"><span class="nav-number">5.</span> <span class="nav-text">Ref forwarding</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Forward"><span class="nav-number">5.1.</span> <span class="nav-text">Forward</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2021/03/25/react-ref/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="React Introductory Series (2) Ref | Origin of Ray"><meta itemprop="description" content="React Ref"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> React Introductory Series (2) Ref</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-03-25 19:47:03" itemprop="dateCreated datePublished" datetime="2021-03-25T19:47:03+08:00">2021-03-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-04-24 14:06:37" itemprop="dateModified" datetime="2024-04-24T14:06:37+08:00">2024-04-24</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2021/03/25/react-ref/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2021/03/25/react-ref/" itemprop="commentCount"></span></a></span></div><div class="post-description">React Ref</div></div></header><div class="post-body" itemprop="articleBody"><p>In the last blog, I roughly recorded some of the content and ideas about the core concepts in the official React doc, many of which are my guesses based on my understanding of Vue.</p><p>Continue to read the advanced guide from this blog, the topic of this blog is Ref in React.</p><span id="more"></span><h2 id="The-Role-of-Ref"><a href="#The-Role-of-Ref" class="headerlink" title="The Role of Ref"></a>The Role of Ref</h2><p>Refs provides a way for us to access DOM nodes or React elements created in render methods.</p><p>In a typical React data stream,<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/components-and-props.html">props</a> Is the only way for a parent component to interact with a child component. To modify a child component, you need to re-render it using new props. However, in some cases, you need to force modification of a child component outside of the typical data flow. The modified child component may be an instance of a React component or a DOM element. For both cases, React provides a solution.</p><p>The above paragraph is taken from the official doc. In simple terms, under normal circumstances, we can only trigger the re-rendering of components by modifying the state or prop. However, Ref provides a new way for you to directly modify custom components or DOM.</p><h2 id="When-to-use"><a href="#When-to-use" class="headerlink" title="When to use"></a>When to use</h2><p>Here are a few situations where refs are suitable for use:</p><ul><li>Manage focus, text selection or media playback.</li><li>Trigger forced animation.</li><li>Integrate third-party DOM libraries.</li></ul><p>Avoid using refs to do anything that can be done with a declarative implementation.</p><p>For example, to avoid exposing the open () and close () methods in the Dialog component, it is better to pass the isOpen property.</p><h3 id="What-is-declarative"><a href="#What-is-declarative" class="headerlink" title="What is declarative"></a>What is declarative</h3><p>The above paragraph mentioned the declarative form, so what is the declarative form?</p><p>Simply put, it is a programming paradigm, which is equivalent to imperative programming, function programming, and Object Oriented programming.</p><p>The so-called declarative expression indicates the purpose, but does not specify how to do it.</p><p>Just like this example in the doc, ‘open () ‘ is a declarative programming paradigm that only specifies the purpose without specifying how to do it. If it is’isOpen = true ‘, it is imperative, which tells how to do it. The method is to set isOpen to true.</p><p>For details, you can take a look: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://segmentfault.com/a/1190000015924762">https://segmentfault.com/a/1190000015924762</a></p><h2 id="Do-not-overuse"><a href="#Do-not-overuse" class="headerlink" title="Do not overuse"></a>Do not overuse</h2><p>You may first think of using refs to “make things happen” in your app. If this is the case, please take a moment to carefully reconsider which component layer the state attribute should be placed in. Usually you will wonder if it is more appropriate to have this state at a higher component level. View <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/lifting-state-up.html">状态提升</a> To get more examples.</p><h2 id="How-to-Use-Ref"><a href="#How-to-Use-Ref" class="headerlink" title="How to Use Ref"></a>How to Use Ref</h2><h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><p>Refs are created using’React.createRef () ‘and attached to React elements via the’ref’ attribute. When constructing a component, it is common to assign Refs to instance attributes so that they can be referenced throughout the component.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class MyComponent extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.myRef = React.createRef();  </span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;div ref=&#123;this.myRef&#125; /&gt;;  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h3><p>When ref is passed to an element in render, a reference to that node can be accessed in the ref’s current property.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> node = <span class="variable language_">this</span>.<span class="property">myRef</span>.<span class="property">current</span>;</span><br></pre></td></tr></table></figure><p>The value of ref varies depending on the type of node:</p><ul><li>When the ref attribute is used on HTML elements, the ref created in the constructor function using React.createRef () receives the underlying DOM element as its current attribute.</li><li>When the ref attribute is used for custom class components, the ref object receives the mounted instance of the component as its current attribute.<br>You can’t use the ref property on function components because they don’t have instances.</li></ul><h4 id="For"><a href="#For" class="headerlink" title="For"></a>For</h4><p>The following code uses’ref ‘to store references to DOM nodes:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class CustomTextInput extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    //Create a ref to store the DOM element of textInput</span><br><span class="line">    this.textInput = React.createRef();    </span><br><span class="line">    this.focusTextInput = this.focusTextInput.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  focusTextInput() &#123;</span><br><span class="line">    //Use the native API directly to make the text text box focus</span><br><span class="line">    //NOTE: We access the DOM node via &quot;current&quot;</span><br><span class="line">    this.textInput.current.focus();  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    //Tell React we want to associate &lt; input &gt; ref to</span><br><span class="line">    //on the&#x27;textInput &#x27;created in the constructor</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          ref=&#123;this.textInput&#125; /&gt;        &lt;input</span><br><span class="line">          type=&quot;button&quot;</span><br><span class="line">          value=&quot;Focus the text input&quot;</span><br><span class="line">          onClick=&#123;this.focusTextInput&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React will pass a DOM element to the’current ‘property when the component is mounted and a’null’ value when the component is unmounted. The’ref ‘will be updated before the’assemblentDidMount’ or’assemblentDidUpdate ‘lifecycle hook is triggered.</p><blockquote><p>From this sentence, we can roughly guess:</p><p>-<br>-</p></blockquote><h4 id="For-1"><a href="#For-1" class="headerlink" title="For"></a>For</h4><p>If we want to wrap the CustomTextInput above to simulate it being clicked immediately after mounting, we can use ref to get the custom input component and manually call its focusTextInput method:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class AutoFocusTextInput extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.textInput = React.createRef();  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.textInput.current.focusTextInput();  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;CustomTextInput ref=&#123;this.textInput&#125; /&gt;    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note that this is only valid if’CustomTextInput ‘is declared as a class:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class CustomTextInput extends React.Component &#123;  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Through this example, we can go back and understand what we just said: when</p><p>That is to say, in this’AutoFocusTextInput ‘component, we have created a new ref, although it is also called’textInput’, but this time the’textInput.current ‘points to the real instance of’CustomTextInput’, that is, new</p></blockquote><h4 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h4><p>By default, you cannot use the ref property on function components because they have no instance:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function MyFunctionComponent() &#123;  return &lt;input /&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Parent extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.textInput = React.createRef();  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    // This will *not* work!</span><br><span class="line">    return (</span><br><span class="line">      &lt;MyFunctionComponent ref=&#123;this.textInput&#125; /&gt;    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>From this point of view, the above-mentioned custom component actually calls new statement may be problematic.</p><p>I think that if it is a direct call to new, there are only two explanations:</p><p>-<br>-</p></blockquote><p>If you want to use’ref ‘in the function component, you can use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/forwarding-refs.html"><code>forwardRef</code></a>(Available with <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/hooks-reference.html#useimperativehandle"><code>useImperativeHandle</code></a> Used in combination), or the component can be converted into a class component.</p><p>Anyway, you can use the ref attribute inside a function component as long as it points to a DOM element or class component:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function CustomTextInput(props) &#123;</span><br><span class="line">  //textInput must be declared here so that ref can reference it const textInput = useRef (null);</span><br><span class="line">  function handleClick() &#123;</span><br><span class="line">    textInput.current.focus();  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        ref=&#123;textInput&#125; /&gt;      &lt;input</span><br><span class="line">        type=&quot;button&quot;</span><br><span class="line">        value=&quot;Focus the text input&quot;</span><br><span class="line">        onClick=&#123;handleClick&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>The forwardRef here will be talked about when the Ref is forwarded.</p></blockquote><h3 id="Will"><a href="#Will" class="headerlink" title="Will"></a>Will</h3><p>In rare cases, you may want to reference the DOM node of a sub-node in the parent component. This is generally not recommended because it breaks the encapsulation of the component, but it can occasionally be used to trigger focus or measure the size or position of child DOM nodes.</p><p>Although you can<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html#adding-a-ref-to-a-class-component">向子组件添加 ref</a>, but this is not an ideal solution because you can only get component instances instead of DOM nodes. Also, it is invalid on the function component.</p><p>If you are using React 16.3 or later, we recommend using it in this case <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/forwarding-refs.html">ref 转发</a>. <strong>Ref forwarding enables a component to expose the ref of a subcomponent as if it were its own ref</strong> About how to expose the DOM node of a subcomponent to a parent component, in <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/forwarding-refs.html#forwarding-refs-to-dom-components">ref 转发文档</a>There is a detailed example in.</p><p>If you’re using React 16.2 or earlier, or if you need more flexibility than ref forwarding, you can use<a target="_blank" rel="external nofollow noopener noreferrer" href="https://gist.github.com/gaearon/1a018a023347fe1c2476073330cc5509">这个替代方案</a>Pass ref directly as a prop with a special name.</p><p>If possible, we do not recommend exposing DOM nodes, but sometimes it can be a lifesaver. Note that this scenario requires you to add some code to the subcomponent. If you have no control over the implementation of the subcomponent, your remaining option is to use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/react-dom.html#finddomnode"><code>findDOMNode()</code></a>, but in<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage"><code>严格模式</code></a> It has been abandoned and is not recommended for use.</p><h3 id="Callback"><a href="#Callback" class="headerlink" title="Callback"></a>Callback</h3><p>React also supports another way to set refs, called “callback refs”. It can help you more finely control when refs are set and unset.</p><p>Instead of passing the ref attribute created by createRef (), you pass a function that takes a React component instance or HTML DOM element as a parameter so that it can be stored and accessed elsewhere.</p><p>The following example describes a generic paradigm that uses the ref callback function to store a reference to a DOM node in an instance’s properties.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">class CustomTextInput extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line"></span><br><span class="line">    this.textInput = null;</span><br><span class="line">    this.setTextInputRef = element =&gt; &#123;      this.textInput = element;    &#125;;</span><br><span class="line">    This.focusTextInput = () =&gt; &#123; // focus a text text box using the native DOM API      </span><br><span class="line">    	if (this.textInput) this.textInput.focus();    </span><br><span class="line">    &#125;;  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    //After the component is mounted, let the text box automatically get focus</span><br><span class="line">    this.focusTextInput();  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    //use the callback function of&#x27;ref &#x27;to store the reference of the text text box DOM node to React</span><br><span class="line">    //on an instance (such as this.textInput)</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          ref=&#123;this.setTextInputRef&#125;        /&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=&quot;button&quot;</span><br><span class="line">          value=&quot;Focus the text input&quot;</span><br><span class="line">          onClick=&#123;this.focusTextInput&#125;        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React will call the’ref ‘callback function and pass in the DOM element when the component is mounted, and call it and pass in’null’ when it is unmounted. React will ensure that the refs are up-to-date until’assemblentDidMount ‘or’assemblentDidUpdate’ is triggered.</p><blockquote><p>There are small partners here who may drill into the horns. Why pass in a function and it will be called.</p><p>The answer is simple, React source code for the ref attribute is certainly a special treatment, if its value is a function, go back to call it.</p><p>If you guess so, then you actually pass in any function, he will execute, do not have to set ref in the function, set a ref in the function passed in the ref property, it should be just a convention.</p></blockquote><p>You can pass refs as callbacks between components, just like you can pass object refs created with React.createRef ().</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function CustomTextInput(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input ref=&#123;props.inputRef&#125; /&gt;    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Parent extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;CustomTextInput</span><br><span class="line">        inputRef=&#123;el =&gt; this.inputElement = el&#125;      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above example, ‘Parent’ passes its refs callback function as’inputRef ‘props to’CustomTextInput’, and’CustomTextInput ‘passes the same function as a special’ref’ property to ‘&lt; input &gt;’. As a result, ‘this.inputElement’ in’Parent ‘is set to the DOM node corresponding to the’input’ element in’CustomTextInput ‘.</p><h4 id="About-callbacks"><a href="#About-callbacks" class="headerlink" title="About callbacks"></a>About callbacks</h4><p>If the’ref ‘callback function is defined as an inline function, it will be executed twice during the update process, the first time with the parameter’null’, and then the second time with the parameter DOM element. This is because a new function instance is created on each render, so React empties the old ref and sets the new one. The above problem can be avoided by defining the callback function of the ref as a bound function of the class, but in most cases it is irrelevant.</p><h2 id="Ref-forwarding"><a href="#Ref-forwarding" class="headerlink" title="Ref forwarding"></a>Ref forwarding</h2><p>Ref forwarding is a project that will <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">ref</a> The technique of automatically passing through a component to one of its subcomponents. This is usually not necessary for components in most applications. But it is useful for some components, especially reusable component libraries. The most common cases are described below.</p><h3 id="Forward"><a href="#Forward" class="headerlink" title="Forward"></a>Forward</h3><p>Consider this’FancyButton ‘component that renders the native DOM element’button’:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function FancyButton(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;button className=&quot;FancyButton&quot;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React components hide their implementation details, including their rendering results. Other components that use’FancyButton ‘ <strong>usually do not need</strong> to get the internal DOM element of’button’ <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">ref</a>This is good because it prevents components from becoming overly dependent on the DOM structure of other components.</p><p>While this encapsulation is ideal for application-level components like FeedStory or Comment, it can be inconvenient for highly reusable “leaf” components like FancyButton or MyTextInput. These components tend to be used throughout the application in a way similar to regular DOM buttons and inputs, and accessing their DOM nodes is unavoidable for managing focus, selection, or animation.</p><p> <strong>Ref forwarding is an optional feature that allows some components to receive a’ref ‘and pass it down (in other words, “forward” it) to subcomponents.</strong></p><p>In the following example, ‘FancyButton’ uses’React.forwardRef ‘to get the’ref’ passed to it, and then forwards to the DOM’button ‘it renders:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const FancyButton = React.forwardRef((props, ref) =&gt; (  </span><br><span class="line">  &lt;button ref=&#123;ref&#125; className=&quot;FancyButton&quot;&gt;    </span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">//You can directly get the ref of the DOM button:</span><br><span class="line">const ref = React.createRef();</span><br><span class="line">&lt;FancyButton ref=&#123;ref&#125;&gt;Click me!&lt;/FancyButton&gt;;</span><br></pre></td></tr></table></figure><p>In this way, a component using FancyButton can get the ref of the underlying DOM node button and access it if necessary, just as if it were using the DOM button directly.</p><p>Here is a step-by-step explanation of what happens in the above example:</p><ol><li>We created one by calling React.createRef <a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">React ref</a> And assign it to the’ref ‘variable.</li><li>We pass’ref ‘down to &lt; FancyButton ref = {ref} &gt; by specifying it as a JSX property.</li><li>React passes’ref ‘to function’ (props, ref) = &gt;… ‘in’forwardRef’ as its second argument.</li><li>We forward the ref parameter down to &lt; button ref = {ref} &gt;, specifying it as a JSX attribute.</li><li>When the ref mount is complete, ‘ref.current’ will point to the ‘&lt; button &gt;’ DOM node.</li></ol><blockquote><p>Attention</p><p>Second parameter</p><p>Ref</p></blockquote></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2021/03/25/react-ref/" title="React Introductory Series (2) Ref">https://sunra.top/en/2021/03/25/react-ref/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2021/03/18/react-grammar/" rel="prev" title="React Introductory Series (1) A First Reading of Syntax and Concepts"><i class="fa fa-chevron-left"></i> React Introductory Series (1) A First Reading of Syntax and Concepts</a></div><div class="post-nav-item"> <a href="/en/2021/03/28/es6-class-source-code/" rel="next" title="ES6 Class Source Code Analysis">ES6 Class Source Code Analysis<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2021/03/25/react-ref/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>