<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Today’s question of the day by leetcode is a difficult question, but I summarize it not because of its difficulty, but because it is a combination of a variant of the prefix and and a binary search tr"><meta property="og:type" content="article"><meta property="og:title" content="The sum of the maximum value of a rectangular area not exceeding K"><meta property="og:url" content="https://sunra.top/en/2021/04/22/leetcode-363/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Today’s question of the day by leetcode is a difficult question, but I summarize it not because of its difficulty, but because it is a combination of a variant of the prefix and and a binary search tr"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1619079599/origin-of-ray/1614650837-SAIiWg-1_djwemy.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1619079626/origin-of-ray/1618906986-JMALHO-image_xkmnqr.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1619079646/origin-of-ray/1618907001-HvoRxP-image_oxr9sq.png"><meta property="article:published_time" content="2021-04-22T00:20:18.000Z"><meta property="article:modified_time" content="2025-06-10T14:30:04.054Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1619079599/origin-of-ray/1614650837-SAIiWg-1_djwemy.png"><link rel="canonical" href="https://sunra.top/en/2021/04/22/leetcode-363/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2021/04/22/leetcode-363/","path":"2021/04/22/leetcode-363/","title":"The sum of the maximum value of a rectangular area not exceeding K"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>The sum of the maximum value of a rectangular area not exceeding K | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#violence-enumeration"><span class="nav-number">1.</span> <span class="nav-text">Violence enumeration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#naive-two-dimensional-prefix-sum"><span class="nav-number">2.</span> <span class="nav-text">Naive two-dimensional prefix sum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#main-problem-solving-ideas-two-dimensional-prefix-and-abstraction-are-one-dimensional"><span class="nav-number">3.</span> <span class="nav-text">Main problem-solving ideas (two-dimensional prefix and abstraction are one-dimensional)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#space-optimization"><span class="nav-number">4.</span> <span class="nav-text">Space optimization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ordered-set-treeset"><span class="nav-number">5.</span> <span class="nav-text">Ordered set TreeSet</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2021/04/22/leetcode-363/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="The sum of the maximum value of a rectangular area not exceeding K | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> The sum of the maximum value of a rectangular area not exceeding K</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-04-22 08:20:18" itemprop="dateCreated datePublished" datetime="2021-04-22T08:20:18+08:00">2021-04-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2025-06-10 22:30:04" itemprop="dateModified" datetime="2025-06-10T22:30:04+08:00">2025-06-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2021/04/22/leetcode-363/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2021/04/22/leetcode-363/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Today’s question of the day by leetcode is a difficult question, but I summarize it not because of its difficulty, but because it is a combination of a variant of the prefix and and a binary search tree, which can help me review.</p><span id="more"></span><p>The first is the title link: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://leetcode-cn.com/problems/max-sum-of-rectangle-no-larger-than-k/">https://leetcode-cn.com/problems/max-sum-of-rectangle-no-larger-than-k/</a></p><h2 id="violence-enumeration"><a class="markdownIt-Anchor" href="#violence-enumeration"></a> Violence enumeration</h2><p>First of all, it is easy to think of brute force enumeration of all submatrices, then the complexity at this time is O (m ^ 2 * n ^ 2), which is easy to timeout. But this is the basic idea, let’s optimize step by step</p><h2 id="naive-two-dimensional-prefix-sum"><a class="markdownIt-Anchor" href="#naive-two-dimensional-prefix-sum"></a> Naive two-dimensional prefix sum</h2><p>In the process of brute force enumeration, we have actually done many calculations.</p><p>We can define sum [i] [j] as the sum of all cell values from (0,0) to (i, j)</p><p>那么，<code>sum[i][j] = sum[i - 1][j] + sum[i][j - 1] - sum[i - 1][j - 1] + matrix[i][j]</code></p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1619079599/origin-of-ray/1614650837-SAIiWg-1_djwemy.png" alt></p><p>Therefore, when we require (x1, y1) as the sum of the regions in the upper left corner and (x2, y2) as the sum of the regions in the lower right corner, we can directly use the prefix and array to quickly solve:</p><p><code>sum[x2][y2] - sum[x1 - 1][y2] - sum[x2][y1 - 1] + sum[x1 - 1][y1 - 1]</code></p><p>In this way, we can first initialize the prefix and array through O (m * n), and then calculate the sum of all submatrices through O (m * n), thus reducing the time complexity to O (m * n);</p><h2 id="main-problem-solving-ideas-two-dimensional-prefix-and-abstraction-are-one-dimensional"><a class="markdownIt-Anchor" href="#main-problem-solving-ideas-two-dimensional-prefix-and-abstraction-are-one-dimensional"></a> Main problem-solving ideas (two-dimensional prefix and abstraction are one-dimensional)</h2><p>Let’s consider how the solution of “naive two-dimensional prefix sum” searches for the answer (submatrix): uniquely determine a matrix by enumerating “upper left corner” &amp; “lower right corner”.</p><p>In other words, the four edges of the sub-matrix are uniquely determined by enumerating (i, j) (i, j) and (p, q) (p, q), and each coordinate point can be regarded as a certain edge of the sub-matrix.</p><p>Since there are four sides to determine, how can we reduce the complexity?</p><p>We can enumerate three of the edges and then use the data structure to speed up finding the fourth edge.</p><p>Once we have identified the three edges (red), the resulting submatrix simply depends on the position of the fourth edge (yellow):</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1619079626/origin-of-ray/1618906986-JMALHO-image_xkmnqr.png" alt></p><p>So the problem becomes &quot;how to quickly find the position of the fourth edge (yellow) &quot;.</p><p>We can further narrow down the problem by considering the case where the matrix has only one row (one dimension):</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1619079646/origin-of-ray/1618907001-HvoRxP-image_oxr9sq.png" alt></p><p>At this time, the problem is further transformed into “In a one-dimensional array, solve for the sum of the largest contiguous subarrays that do not exceed K.”</p><blockquote><p>How to do this step?</p><p>The current value in the original one-dimensional array (not the prefix and array) is the sum of all cells in the column between the upper and lower boundaries</p></blockquote><p>For this one-dimensional problem, we can first preprocess the “prefix sum”, then enumerate the left endpoint of the subarray, and then solve the position of its right endpoint by “binary”.</p><p>Assuming we have obtained the prefix and sum of a one-dimensional array, we can obtain the sum of the subscript range [i, j] [i, j]:<br> areaSum(i,j)=sum[j]−sum[i−1]⩽k</p><p>After the transformation:<br> sum[j]⩽k+sum[i−1]</p><p>We have two ways to maximize areaSum (i, j):</p><ul><li>Determine (enumerate) the left endpoint position i, and find the largest right endpoint sum [j] that matches the condition.</li><li>Determine (enumerate) the position j of the right endpoint, and find the smallest left endpoint that matches the condition sum [i]</li></ul><p>For a one-dimensional array without negative weights, we can enumerate the left endpoint i, and at the same time use the “monotonically increasing” feature of the prefix sum to find the largest sum that meets the condition of sum [j] k + sum [i − 1] through “binary”. Value sum [j] to solve the answer.</p><p>However, if it has negative weights, the prefix sum will lose its “monotonically increasing” characteristic, and we cannot use the enumeration i combined with the “binary” to find j.</p><p>At this time, the process needs to be reversed: we enumerate j from left to right, and use the “ordered set” structure to maintain the traversed position, find the sum [i] sum [j] − k sum [i] condition The smallest value sum [i] solves the answer.</p><p>Based on the above analysis, the complexity of solving such a one-dimensional array problem is O (nlogn).</p><p>At the same time, applying one-dimensional thinking to this problem (two-dimensional), the complexity is either O (m ^ 2 * nlogn) or O (n ^ 2 * mlogm);</p><p>** The key point is how to relate to the “one-dimensional” problem: obviously “the sum of the target submatrix” is equal to “the sum of the submatrix formed by the right column of the submatrix and the left column of the original matrix” - “the left column of the submatrix and the left column of the original matrix, forming the sum of the submatrix” **</p><p>We can use area [r] to represent “the right column of the submatrix and the left column of the original matrix, forming the sum of the submatrix”, and use area [l - 1] to represent “the left column of the submatrix and the left column of the original matrix, forming the sum of the submatrix”, then:<br> target=area[r]−area[l−1]⩽k</p><p>This is exactly the same as our “one-dimensional problem”. At the same time, the size of area [r] can be directly determined from the “up and down row” &amp; “right column”, and the “ordered set” stores all the areas [r] in the process of r. In order to achieve “binary” search for the smallest area [l - 1] that meets the area [r] − karea [l − 1] condition.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxSumSubmatrix = <span class="keyword">function</span>(<span class="params">matrix, k</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="title class_">Number</span>.<span class="property">MIN_SAFE_INTEGER</span>;</span><br><span class="line">  <span class="keyword">const</span> m = matrix.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">const</span> n = matrix[<span class="number">0</span>].<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">const</span> sum = <span class="keyword">new</span> <span class="title class_">Array</span>(m + <span class="number">1</span>).<span class="title function_">fill</span>(<span class="number">0</span>).<span class="title function_">map</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Array</span>(n + <span class="number">1</span>).<span class="title function_">fill</span>(<span class="number">0</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//Initialize the prefix and array, sum [i] [j] represents the sum of all cells from (0,0) to (i - 1, j - 1)</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">      sum[i][j] = sum[i - <span class="number">1</span>][j] + sum[i][j - <span class="number">1</span>] - sum[i - <span class="number">1</span>][j - <span class="number">1</span>] + matrix[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//traverse the upper boundary of the submatrix</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> top = <span class="number">1</span>; top &lt;= m; top++) &#123;</span><br><span class="line">    <span class="comment">//traverse the lower boundary of the submatrix</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> bot = top; bot &lt;= m; bot++) &#123;</span><br><span class="line">      <span class="comment">//At this point, we can start transforming the two-dimensional matrix problem into a one-dimensional matrix problem</span></span><br><span class="line">      <span class="comment">//Because the problem of upper and lower boundaries has already been solved in the double-layer loop</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//Use ordered collections to maintain all traversed right boundaries</span></span><br><span class="line">      <span class="comment">//That is, the sum between the upper and lower boundaries, from column 0 to the right boundary</span></span><br><span class="line">      <span class="keyword">const</span> sumSet = <span class="keyword">new</span> <span class="title class_">TreeSet</span>();</span><br><span class="line">      sumSet.<span class="title function_">add</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">1</span>; r &lt;= n; r++) &#123;</span><br><span class="line">        <span class="comment">//The sum of all cells from column 0 to column r, from row top to row bot.</span></span><br><span class="line">        <span class="keyword">const</span> right = sum[bot][r] - sum[top - <span class="number">1</span>][r];</span><br><span class="line">        <span class="comment">//Find a minimum value greater than or equal to right - k by dichotomy</span></span><br><span class="line">        <span class="keyword">const</span> left = sumSet.<span class="title function_">ceiling</span>(right - k);</span><br><span class="line">        <span class="keyword">if</span> (left ! <span class="literal">null</span>) &#123;</span><br><span class="line">          ans = <span class="title class_">Math</span>.<span class="title function_">max</span>(ans, right - left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Add the traversed right to the ordered set for the next loop</span></span><br><span class="line">        <span class="comment">//here is a point, the right must be increasing because there is no negative value in the cell</span></span><br><span class="line">        sumSet.<span class="title function_">add</span>(right);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="space-optimization"><a class="markdownIt-Anchor" href="#space-optimization"></a> Space optimization</h2><p>It is not difficult to find that the process of searching the target submatrix in the original matrix is strictly “top to bottom” &amp; “left to right”.</p><p>Therefore, we can delegate the logic of calculating the sum of prefixes to the loop of searching for submatrices, thereby reducing the space complexity of O (m ∗ n) to O (n).</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxSumSubmatrix = <span class="keyword">function</span>(<span class="params">matrix, k</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="title class_">Number</span>.<span class="property">MIN_SAFE_INTEGER</span>;</span><br><span class="line">  <span class="keyword">const</span> m = matrix.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">const</span> n = matrix[<span class="number">0</span>].<span class="property">length</span>;</span><br><span class="line">  <span class="title class_">For</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; m; i ++) &#123; <span class="comment">// i is the starting point of the row number</span></span><br><span class="line">    <span class="keyword">const</span> sum = <span class="keyword">new</span> <span class="title class_">Array</span>(n).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title class_">For</span> (<span class="keyword">let</span> j = i; j &lt; m; j ++) &#123; <span class="comment">// j is the end of the line number</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; n; c++) &#123;</span><br><span class="line">        <span class="title class_">Sum</span> [c] += matrix [j] [c];<span class="comment">//sum [c] refers to the sum of all the data in column c between row i and row j</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> sumSet = <span class="keyword">new</span> <span class="title class_">TreeSet</span>();</span><br><span class="line">      sumSet.<span class="title function_">add</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">let</span> s = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">const</span> v <span class="keyword">of</span> sum) &#123;</span><br><span class="line">        s += v;</span><br><span class="line">        <span class="keyword">const</span> ceil = sumSet.<span class="title function_">ceiling</span>(s - k); </span><br><span class="line">        <span class="keyword">if</span> (ceil != <span class="literal">null</span>) &#123;</span><br><span class="line">          ans = <span class="title class_">Math</span>.<span class="title function_">max</span>(ans, s - ceil);</span><br><span class="line">        &#125;</span><br><span class="line">        sumSet.<span class="title function_">add</span>(v);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ordered-set-treeset"><a class="markdownIt-Anchor" href="#ordered-set-treeset"></a> Ordered set TreeSet</h2><p>In fact, due to the special reasons of this question, each add is incremental and does not require additional sorting, so add can be pushed directly in the array.</p><p>And binary search can see my other blog: <a href="https://sunra.top/posts/e421a043/">https://sunra.top/posts/e421a043/</a></p><p>Reference link:</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://leetcode-cn.com/problems/max-sum-of-rectangle-no-larger-than-k/solution/gong-shui-san-xie-you-hua-mei-ju-de-ji-b-dh8s/">https://leetcode-cn.com/problems/max-sum-of-rectangle-no-larger-than-k/solution/gong-shui-san-xie-you-hua-mei-ju-de-ji-b-dh8s/</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://leetcode-cn.com/u/ac_oier/">https://leetcode-cn.com/u/ac_oier/</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2021/04/22/leetcode-363/" title="The sum of the maximum value of a rectangular area not exceeding K">https://sunra.top/en/2021/04/22/leetcode-363/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2021/04/21/css-layout-vertical-center/" rel="prev" title="Summary and Comparison of CSS Mainstream Layouts (2) Vertical Center Alignment"><i class="fa fa-chevron-left"></i> Summary and Comparison of CSS Mainstream Layouts (2) Vertical Center Alignment</a></div><div class="post-nav-item"> <a href="/en/2021/04/25/css-layout-two-column/" rel="next" title="Summary and Comparison of CSS Mainstream Layouts (3) Two-column Layout">Summary and Comparison of CSS Mainstream Layouts (3) Two-column Layout<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2021/04/22/leetcode-363/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>