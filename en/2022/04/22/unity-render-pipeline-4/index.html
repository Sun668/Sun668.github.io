<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="The basic content of the rendering pipeline has been introduced in front, and then the parts that we can program are introduced. Before we start, we need to introduce some basic concepts and briefly e"><meta property="og:type" content="article"><meta property="og:title" content="Unity Rendering Principle (4) Unity Shader Basic Concepts"><meta property="og:url" content="https://sunra.top/en/2022/04/22/unity-render-pipeline-4/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="The basic content of the rendering pipeline has been introduced in front, and then the parts that we can program are introduced. Before we start, we need to introduce some basic concepts and briefly e"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2022-04-21T23:42:09.000Z"><meta property="article:modified_time" content="2023-08-02T02:52:15.327Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2022/04/22/unity-render-pipeline-4/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2022/04/22/unity-render-pipeline-4/","path":"2022/04/22/unity-render-pipeline-4/","title":"Unity Rendering Principle (4) Unity Shader Basic Concepts"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Unity Rendering Principle (4) Unity Shader Basic Concepts | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Shader"><span class="nav-number">1.</span> <span class="nav-text">Shader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Shader-Type"><span class="nav-number">1.1.</span> <span class="nav-text">Shader Type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Glossary"><span class="nav-number">1.2.</span> <span class="nav-text">Glossary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shader-1"><span class="nav-number">2.</span> <span class="nav-text">Shader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Shader-2"><span class="nav-number">2.1.</span> <span class="nav-text">Shader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shader-3"><span class="nav-number">2.2.</span> <span class="nav-text">Shader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SubShader"><span class="nav-number">2.2.1.</span> <span class="nav-text">SubShader</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pass"><span class="nav-number">2.2.2.</span> <span class="nav-text">Pass</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Shader-4"><span class="nav-number">2.2.3.</span> <span class="nav-text">Shader</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-call-flow-of-Shader-during-rendering"><span class="nav-number">2.3.</span> <span class="nav-text">The call flow of Shader during rendering</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shader-compiling"><span class="nav-number">3.</span> <span class="nav-text">Shader compiling</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stripping-at-build-time"><span class="nav-number">3.1.</span> <span class="nav-text">Stripping at build time</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shader-compile-asynchronously"><span class="nav-number">3.2.</span> <span class="nav-text">Shader compile asynchronously</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Branches-Variants-and-Keywords-in-Shader"><span class="nav-number">4.</span> <span class="nav-text">Branches, Variants and Keywords in Shader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Conditionals"><span class="nav-number">4.1.</span> <span class="nav-text">Conditionals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shader-5"><span class="nav-number">4.2.</span> <span class="nav-text">Shader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Number-of-variants-generated"><span class="nav-number">4.2.1.</span> <span class="nav-text">Number of variants generated</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deduplication-of-shader-variants"><span class="nav-number">4.2.2.</span> <span class="nav-text">Deduplication of shader variants</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#How-to-optimize-pack-volume-from-a-Shader-variant-perspective"><span class="nav-number">4.2.3.</span> <span class="nav-text">How to optimize pack volume from a Shader variant perspective</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shader-6"><span class="nav-number">4.3.</span> <span class="nav-text">Shader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#type%EF%BC%9Amulti"><span class="nav-number">4.3.1.</span> <span class="nav-text">type：multi</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#scope%EF%BC%9Alocal"><span class="nav-number">4.3.2.</span> <span class="nav-text">scope：local</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#stage"><span class="nav-number">4.3.3.</span> <span class="nav-text">stage</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shader"><span class="nav-number">4.3.4.</span> <span class="nav-text">shader</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2022/04/22/unity-render-pipeline-4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Unity Rendering Principle (4) Unity Shader Basic Concepts | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Unity Rendering Principle (4) Unity Shader Basic Concepts</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-04-22 07:42:09" itemprop="dateCreated datePublished" datetime="2022-04-22T07:42:09+08:00">2022-04-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-02 10:52:15" itemprop="dateModified" datetime="2023-08-02T10:52:15+08:00">2023-08-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2022/04/22/unity-render-pipeline-4/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2022/04/22/unity-render-pipeline-4/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>The basic content of the rendering pipeline has been introduced in front, and then the parts that we can program are introduced. Before we start, we need to introduce some basic concepts and briefly explain some of the properties.</p><span id="more"></span><h2 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h2><h3 id="Shader-Type"><a href="#Shader-Type" class="headerlink" title="Shader Type"></a>Shader Type</h3><p>Shaders in Unity are divided into three large types, each used for different purposes:</p><ul><li>Shader: It is part of the rendering pipeline and the most commonly used type of Shader, which is used to calculate the pixel value of each point on the screen. This shader is divided into various types<ul><li>Vertex shader</li><li>Element shader</li><li>Surface shaders (Unity specific, vertex shaders and slice shaders are compiled)</li></ul></li><li>Compute Shader: The calculation is performed in the GPU, but the process is not in the graphics pipeline.</li><li>Ray Tracing Shader: Performs calculations related to ray tracing.</li></ul><h3 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h3><ul><li>Shader/Shader Program: A program that runs on the GPU, unless otherwise specified, refers to the ordinary Shader that is part of the rendering pipeline.</li><li>Shader Object: An instance of a Shader Class that encapsulates the Shader Program and other information.</li><li>Shader Lab: a dedicated Shader language packaged by Unity</li><li>Shader Graph: A tool for visually creating Shaders</li><li>Shader asset: A file in the Unity project with the extension “.shader” that defines a Shader Object</li><li>Shader Graph asset: a file in the Unity project that defines a Shader Object</li></ul><h2 id="Shader-1"><a href="#Shader-1" class="headerlink" title="Shader"></a>Shader</h2><p>In Unity, when we use a Shader as part of a pipeline, we are using an instance of a Shader Class, the Shader Object.<br>Shader Object is a way of working with Shader Programs for Unity. It encapsulates Shader Programs and other related information. It can define multiple Shader Programs in the same file and tell Unity how to use them.</p><h3 id="Shader-2"><a href="#Shader-2" class="headerlink" title="Shader"></a>Shader</h3><p>A Shader Object contains the Shader Program, instructions to modify GPU settings (i.e. render state), and information about how Unity uses them.</p><p>There are two ways to create a new Shader Object:</p><ul><li>Create a Shader asset by writing code (a text file with the extension “.shader”)</li><li>Create a Shader Graph asset using Shader Graph<br>Either way, the result is the same.</li></ul><h3 id="Shader-3"><a href="#Shader-3" class="headerlink" title="Shader"></a>Shader</h3><p> <strong>A Shader Object has a nested structure that organizes the Shader Program into Shader Variants and the internal information into structures called SubShader and Pass.</strong></p><p>A Shader Object contains:<br>Information about itself, such as its name</p><ul><li>Optional fallback Shader Object for Unity to call when it is not available</li><li>One or more SubShaders</li></ul><p>We can also define some additional information, such as shared Shader code, etc</p><h4 id="SubShader"><a href="#SubShader" class="headerlink" title="SubShader"></a>SubShader</h4><p>SubShader allows us to split the Shader Object into multiple parts to accommodate different hardware, pipeline, and runtime settings</p><p>A SubShader contains:</p><ul><li>SubShader applicable hardware, pipeline and runtime settings</li><li>SubShader Tag, a set of Attributes that provide information about SubShader - Value Pair<br>One or more passes.</li></ul><p>We can also define some additional information, such as the render state that applies to all affiliated passes.</p><h4 id="Pass"><a href="#Pass" class="headerlink" title="Pass"></a>Pass</h4><p>A pass includes:</p><ul><li>Pass Tag, Attribute that provides Pass-related information - Value Pair</li><li>Command to update the render state before running the Shader program to which Pass belongs</li><li>Shader Program, which is then organized into Shader variants<br>We can also define some additional information, such as the name of the Pass</li></ul><h4 id="Shader-4"><a href="#Shader-4" class="headerlink" title="Shader"></a>Shader</h4><p>Shader Programs in Pass are organized into Shader Variants, which share common code but have different capabilities when enabling or disabling a given keyword.</p><p>The number of shader variants in Pass depends on the keywords and target platform defined in the shader code. Each Pass contains at least one variant</p><h3 id="The-call-flow-of-Shader-during-rendering"><a href="#The-call-flow-of-Shader-during-rendering" class="headerlink" title="The call flow of Shader during rendering"></a>The call flow of Shader during rendering</h3><p>Before using a Shader Object, Unity will create a list of SubShaders in the Shader Object, including self-defined and fallback</p><p>When Unity renders geometry for the first time or the LOD value of the Shader changes or the rendering pipeline settings change, you need to decide which SubShader to take from the Shader Object:</p><ul><li>Unity will first traverse all SubShaders in the list to find the SubShader that is suitable for the current device, less than or equal to the current LOD value, and matches the pipeline settings</li><li>If there are multiple SubShaders that meet the above requirements, then choose the first one that meets the criteria</li><li>If there is no eligible SubShader, then<ul><li>If it meets the requirements of the device but does not meet the requirements of LOD or pipeline settings, then select one of these SubShaders</li><li>If any requirements are not met, then an error will be reported<br>Unity will recognize geometries using the same Shader variant and then package them into batches for rendering</li></ul></li><li>Unity determines which pass in the current SubShader it should render, and at which point in the frame. This behavior varies depending on the render pipeline</li><li>Each pass it will render:<ul><li>If the current render state is different from the render state in Pass, change it to the render state in Pass</li><li>GPU renders with associated Shader Variants</li></ul></li></ul><h2 id="Shader-compiling"><a href="#Shader-compiling" class="headerlink" title="Shader compiling"></a>Shader compiling</h2><p>Every time you build a project, the Unity editor compiles all the shaders needed to build: for each desired graphics API, compile each desired shader variant.<br>When you work in the Unity editor, the editor does not compile everything in advance. This is because it can take a long time to compile each variant for each graphics API.<br>Instead, the Unity editor does this:</p><ul><li>When importing a shader resource, some minimal processing is performed (such as surface shader generation).</li><li>It checks the Library/ShaderCache folder when shader variants need to be displayed.</li><li>If a previously compiled shader variant using the same source code is found, that shader variant will be used.</li><li>If no match is found, compile the desired shader variant and save the result to the cache.<br>Note: If you enable asynchronous shader compile, it does this in the background and displays the placeholder shader at the same time.<br>Shader compile uses a process called UnityShaderCompiler. Multiple UnityShaderCompiler compile processes can be started (usually one for each CPU core in the machine), so that shader compile can be completed in parallel when the player is built. When the editor does not compile the shader, the compiler process does not perform any operations and does not consume computer resources.<br>If there are many shaders that change frequently, the Shader Cache folder can become very large. Deleting this folder is safe; it will only cause Unity to recompile the shader variants.<br>When the player builds, all shader variants that are “not yet compiled” will be compiled, so they will exist in the game data even if the editor will not use them.</li></ul><h3 id="Stripping-at-build-time"><a href="#Stripping-at-build-time" class="headerlink" title="Stripping at build time"></a>Stripping at build time</h3><p>When building a game, Unity may detect that the game does not use certain internal shader variants and exclude (“strip”) them from the build data. Stripping at build time will be used for the following:</p><ul><li>For shaders shader_feature with #pragma, Unity automatically checks if a variant is used. If none of the materials in the build use a variant, the variant will not be included in the build. See the internal shader variant doc. Standard shaders use this feature.</li><li>Shader variants that handle fog and lightmap modes that are not used by any scene will not be included in the game data. If you want to override this behavior, see the Graphics window.<br>You can also manually identify variants and use the OnProcessShader API to tell Unity to exclude them from the build.<br>The combination of the above usually greatly reduces the shader data size. For example, a fully compiled standard shader will occupy several hundred megabytes, but in a typical project, it usually ends up occupying only a few megabytes (and is usually further compressed by the application packaging process).</li></ul><h3 id="Shader-compile-asynchronously"><a href="#Shader-compile-asynchronously" class="headerlink" title="Shader compile asynchronously"></a>Shader compile asynchronously</h3><p>A Shader object can compile hundreds of Shader Variants. If Unity had to compile all of them every time it loaded a Shader object, the editor might get stuck. And actually, Unity compiles the Variants on demand, using a Placeholder Shader object.</p><p>The working principle of asynchronous shader compile is:</p><ol><li>When the editor first encounters an uncompiled shader variant, it adds the shader variant to the compile queue on the job thread. The Progress Bar in the lower right corner of the editor displays the status of the compile queue.</li><li>When loading the shader variant, the editor renders the geometry using a placeholder shader, which appears as pure cyan.</li><li>When the editor has finished compiling the shader variants, it will use the shader variants to render the geometry.</li></ol><p>There are also some specific methods to switch this asynchronous compile through settings and code, which will not be repeated. You can take a look.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.unity3d.com/cn/current/Manual/AsynchronousShaderCompilation.html">异步着色器编译的官方文档</a></p><h2 id="Branches-Variants-and-Keywords-in-Shader"><a href="#Branches-Variants-and-Keywords-in-Shader" class="headerlink" title="Branches, Variants and Keywords in Shader"></a>Branches, Variants and Keywords in Shader</h2><p>Sometimes, we want the same shader to behave differently in different situations. When this happens, you use conditions to define different behaviors for different hardware.</p><p>This section of the manual contains information about the color fixer variants and keywords that work and when and how to use them.</p><div class="table-container"><table><thead><tr><th>Page</th><th>Description</th></tr></thead><tbody><tr><td>Conditionals in shaders</td><td>An introduction to conditionals in shaders, including information on the different types of conditional, and when to use which one.</td></tr><tr><td>Shader branching</td><td>An introduction to static and dynamic branching in shaders.</td></tr><tr><td>Shader variants</td><td>An introduction to shader variants, and information on how to understand and control how many shader variants Unity compiles.</td></tr><tr><td>Shader keywords</td><td>An introduction to shader keywords, and information on how to use them.</td></tr><tr><td>Using shader keywords with C# scripts</td><td>Working with shader keywords in C# scripts.</td></tr><tr><td>Using shader keywords with the material Inspector</td><td>Working with shader keywords in the Unity Editor, using the material Inspector.</td></tr><tr><td>着色器变体集合</td><td>An introduction to shader variant collections, and information on how to use them.</td></tr></tbody></table></div><h3 id="Conditionals"><a href="#Conditionals" class="headerlink" title="Conditionals"></a>Conditionals</h3><p>Sometimes, we want to make the same Shader behave differently in different situations, for example, configuring different settings for different materials, defining different functions for different hardware, or dynamically modifying the Shader’s functions at runtime. Or in some cases avoid running complex calculations, such as texture reading.</p><p>We have three different ways to make GPUs behave differently in different situations.</p><ul><li>Static branching: generate different shaders according to different conditions during the compile stage of the shader</li><li>Dynamic branching: GPU selects different branches based on conditions at runtime</li><li>Shader variants: Unity uses static branches to compile the source code of Shader into multiple shader codes. Unity selects different shader codes according to different conditions at runtime</li></ul><p>These three can actually be divided into two types, static conditions and dynamic conditions, because the Shader variant actually uses static conditions, but the static branch eliminates the unused code according to the static conditions in the compile stage, and the variant compiles a variant of each different condition in the compile stage</p><p>How to choose between these three methods, you can take a look<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.unity3d.com/Manual/shader-branching.html">官方文档</a></p><p>Simply put, if you know the conditions that need to be met in advance, use static branching. If you don’t know, choose one of the dynamic branching or shaer variants. Dynamic branching is selected during GPU runtime, so it will affect GPU performance. Shader variants It will increase the package size.</p><h3 id="Shader-5"><a href="#Shader-5" class="headerlink" title="Shader"></a>Shader</h3><p>Shader variants, sometimes called shader permutations, are a way to introduce conditional behavior into shader code. Unity compiles shader source files into shader programs. Each compiled shader program has one or more variants: different shader program versions apply to different conditions. At runtime, Unity uses variants that match the current requirements. You can use shader keywords to configure variables.</p><p>Shaders with a large number of variants are called mega shaders or uber shaders. Unity’s standard shader is an example of such a shader.</p><h4 id="Number-of-variants-generated"><a href="#Number-of-variants-generated" class="headerlink" title="Number of variants generated"></a>Number of variants generated</h4><p>At build time, Unity compiles a set of shader variants for each graph API of the current build target. The number of variants per graph API and build target combination depends on your shader source files and your use of shader keywords.</p><ol><li><p>Unity compiles a set of shader variants for each graph API in the current build target list. Shaders are different for each combination of build target and graph API; for example, Unity compiles different shaders for Metal on iOS and macOS. Some shaders or keywords may only target a given graph API or a given build target, so the total number of variants for each combination of graph API and build target may differ; however, the process of compiling these variants is the same.</p></li><li><p>Unity must decide how many Shader Programs to compile for the current build target and graphics API combination. For each shader source file included in your build, Unity determines how many unique Shader Programs it defines:</p></li></ol><ul><li>A Computational Shader Asset defines a separate Shader Program.</li><li>In a hand-coded shader, the number of Shader Programs depends on your code. The total includes:<ul><li>all shader stages in all channels in the source file itself. For example, each vertex stage defines a Shader Program;</li><li>Define a Shader Program for each fragment phase; this includes all fallback shaders, as well as all channels included using the UsePass command</li></ul></li><li>In Shader Graph Shader, the number of Shader programs depends on the code Unity generates from your graph. To view the shader code generated by Unity, click on the shader Graph asset and select see generated code. You can then determine the total number of shader programs, just like manually coding shaders.</li></ul><ol><li>keywords affect the number of variants<br> <strong>When Unity determines how many shader programs it must compile for the current build target and graphics API, it determines how many shader variants it must compile for each shader program.</strong></li></ol><p>For each shader program, Unity decides on the combination of shader keywords that produce different variants. This includes:</p><ul><li>A collection of shader variable keywords, declared in the source file for the shader. For more information, see<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.unity3d.com/Manual/shader-keywords.html#declaring-keywords">声明着色关键字</a>。</li><li>Unity automatically adds shader keyword sets. For more information, see<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.unity3d.com/Manual/shader-keywords.html#predefined-shader-keywords">Unity预定义的shader关键字</a>。</li></ul><p>For example, this set contains three shader variant keywords:</p><p>COLOR_RED<br>COLOR_GREEN<br>COLOR_BLUE<br>This set contains four shader variant keywords:</p><p>QUALITY_LOW<br>QUALITY_MEDIUM<br>QUALITY_HIGH<br>QUALITY_ULTRA<br>A shader program affected by those shader variant keywords will result in the following twelve variants:</p><p>COLOR_RED and QUALITY_LOW<br>COLOR_RED and QUALITY_MEDIUM<br>COLOR_RED and QUALITY_HIGH<br>COLOR_RED and QUALITY_ULTRA<br>COLOR_GREEN and QUALITY_LOW<br>COLOR_GREEN and QUALITY_MEDIUM<br>COLOR_GREEN and QUALITY_HIGH<br>COLOR_GREEN and QUALITY_ULTRA<br>COLOR_BLUE and QUALITY_LOW<br>COLOR_BLUE and QUALITY_MEDIUM<br>COLOR_BLUE and QUALITY_HIGH<br>COLOR_BLUE and QUALITY_ULTRA</p><p>When you add more shader variable keyword sets, the number of variables in Unity compile can grow rapidly. The term for this rapid growth is combinatorial explosion. For example, consider a fairly typical use case where a shader has many shader variant keyword sets, each containing two keywords (&lt; feature name &gt; ON and &lt; feature name &gt; OFF). If the shader has two such keyword sets, this will result in four variables. If the shader has 10 sets of such keywords, this will result in 1024 variants</p><h4 id="Deduplication-of-shader-variants"><a href="#Deduplication-of-shader-variants" class="headerlink" title="Deduplication of shader variants"></a>Deduplication of shader variants</h4><p>After compiling, Unity automatically recognizes the same variables in the same Pass and ensures that these same variables point to the same bytecode. This is called deduplication. Deduplication prevents the same variables in the same Pass from increasing the file size; however, the same variant can still cause wasteful work during compile and increase memory usage and shader load time at runtime. With this in mind, it is best to remove unwanted variables.</p><h4 id="How-to-optimize-pack-volume-from-a-Shader-variant-perspective"><a href="#How-to-optimize-pack-volume-from-a-Shader-variant-perspective" class="headerlink" title="How to optimize pack volume from a Shader variant perspective"></a>How to optimize pack volume from a Shader variant perspective</h4><p>There is an article well written, record it: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.unity.com/technology/stripping-scriptable-shader-variants">https://blog.unity.com/technology/stripping-scriptable-shader-variants</a></p><h3 id="Shader-6"><a href="#Shader-6" class="headerlink" title="Shader"></a>Shader</h3><p>The Shader keyword allows us to use conditional behavior code in shader code. We can create some common code, but the behavior and function of these codes will vary depending on the keyword.</p><p>We can define keywords in a collection, a collection contains keywords that contain mutual exclusion, for example:</p><ul><li>COLOR_RED</li><li>COLOR_GREEN</li><li>COLOR_BLUE</li></ul><p>The way we define the shader keyword affects a few things:</p><ul><li>type: affects how unity creates shader variants for keywords</li><li>scope: will affect whether the keyword is local or global, which determines whether we can modify this keyword at runtime</li><li>stage: the stage that affects the influence of the shader keyword (vertex shading stage, slice element shading stage, etc.)</li></ul><h4 id="type：multi"><a href="#type：multi" class="headerlink" title="type：multi"></a>type：multi</h4><p>Type is divided into two types, one is multi compile and the other is shader feature. Unity uses these to create a collection of keywords to work with shader variants. These keywords are used within Unity to create ‘#define’ preprocessors</p><ul><li>multi compile: defines a collection of keywords to use with shader variants, unity compiles variants for each keyword in the collection</li><li>shader feature: defines a set of keywords to be used with shader variants, and also instructs the compiler to compile variants when no keyword is enabled (unity will detect the state of each keyword at packaging time, And compile variants only for the keyword used. Whether a keyword is used depends on whether the material using it has enabled the keyword)</li></ul><p>The choice of “multi compile” or “shader feature” depends on how the keyword is used. If you use the keyword to configure material in your project and do not change its value from a C #script at runtime, you should use “shader feature” to reduce the number of shader keywords and variants in your project. If you use a C #script to enable and disable keywords at runtime, you should use “Multi Compile” to prevent variants from being stripped.</p><blockquote><p>Note: If you put a shader in “Always</p></blockquote><h4 id="scope：local"><a href="#scope：local" class="headerlink" title="scope：local"></a>scope：local</h4><p>When you declare a set of keywords, you choose whether the keywords in the collection have local or global scope. This determines whether you can use the global shader keyword to override the state of this keyword at runtime.</p><p>By default, you can declare a keyword using global scope. This means that you can override the state of this keyword at runtime using global shader keywords. If you declare a keyword with local scope, this means that you cannot override the state of this keyword at runtime using global shader keywords</p><p>If a keyword with the same name exists in the shader source file and its dependencies, the scope of the keyword in the source file overrides the scope in the dependencies</p><h4 id="stage"><a href="#stage" class="headerlink" title="stage"></a>stage</h4><p>By default, Unity generates keyword variants for each stage of the shader. For example, if your shader contains a vertex stage and a fragment stage, Unity generates variants for each keyword combination for both the vertex and fragment shader program. If only one set of keywords is used in one stage, it will result in the same variant for the other stage.<br>Unity automatically recognizes and repeats denaturation to avoid increasing build size, but still results in wasted compile time, increased shader load time, and increased runtime memory usage.</p><p>To avoid this problem, when you declare a set of keywords in a hand-coded shader, you can instruct Unity to compile only at a given shader stage. You are then responsible for ensuring that keywords are only used in the specified shader stage.</p><p>The graphics API does not fully support stage-specific keywords. In OpenGL and Vulkan, Unity automatically converts all stage-specific keyword directives into regular keyword directives when compiling. In Metal, any keyword targeting the vertex stage will also affect the tessellation stage and vice versa.</p><h4 id="shader"><a href="#shader" class="headerlink" title="shader"></a>shader</h4><p>We can set the keyword enable or disable through code or material inspector. For details, please refer to the official doc:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.unity3d.com/Manual/shader-keywords-scripts.html">Using shader keywords with C# scripts</a>, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.unity3d.com/Manual/shader-keywords-material-inspector.html">Using shader keywords with the Material Inspector</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2022/04/22/unity-render-pipeline-4/" title="Unity Rendering Principle (4) Unity Shader Basic Concepts">https://sunra.top/en/2022/04/22/unity-render-pipeline-4/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2022/04/14/storage-management-1/" rel="prev" title="Computer storage management comprehensive arrangement (a) the basic principles and requirements of memory management"><i class="fa fa-angle-left"></i> Computer storage management comprehensive arrangement (a) the basic principles and requirements of memory management</a></div><div class="post-nav-item"> <a href="/en/2022/05/01/unity-render-pipeline-5/" rel="next" title="Unity Rendering Principle (5) Shader Lab">Unity Rendering Principle (5) Shader Lab<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2022/04/22/unity-render-pipeline-4/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>