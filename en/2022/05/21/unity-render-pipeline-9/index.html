<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="We are officially starting to learn some Shaders that can be applied, this time we will start with the lighting model. The code and concepts in this article are interpreted from “Getting Started with"><meta property="og:type" content="article"><meta property="og:title" content="Principles of Unity Rendering (9) Unity Lighting Model"><meta property="og:url" content="https://sunra.top/en/2022/05/21/unity-render-pipeline-9/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="We are officially starting to learn some Shaders that can be applied, this time we will start with the lighting model. The code and concepts in this article are interpreted from “Getting Started with"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1653385372/origin-of-ray/WX20220524-174049_2x_qqp0xr.png"><meta property="article:published_time" content="2022-05-21T03:03:44.000Z"><meta property="article:modified_time" content="2023-08-13T02:19:43.236Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1653385372/origin-of-ray/WX20220524-174049_2x_qqp0xr.png"><link rel="canonical" href="https://sunra.top/en/2022/05/21/unity-render-pipeline-9/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2022/05/21/unity-render-pipeline-9/","path":"2022/05/21/unity-render-pipeline-9/","title":"Principles of Unity Rendering (9) Unity Lighting Model"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Principles of Unity Rendering (9) Unity Lighting Model | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Illumination-of-the-Real-World-How-We-See-the-World"><span class="nav-number">1.</span> <span class="nav-text">Illumination of the Real World - How We See the World</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Light-source"><span class="nav-number">1.1.</span> <span class="nav-text">Light source</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Absorption-and-scattering"><span class="nav-number">1.2.</span> <span class="nav-text">Absorption and scattering</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Coloring"><span class="nav-number">1.3.</span> <span class="nav-text">Coloring</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BRDF-model"><span class="nav-number">1.4.</span> <span class="nav-text">BRDF model</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Standard-illumination-model"><span class="nav-number">2.</span> <span class="nav-text">Standard illumination model</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ambient-light"><span class="nav-number">2.1.</span> <span class="nav-text">Ambient light</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Self-luminous"><span class="nav-number">2.2.</span> <span class="nav-text">Self-luminous</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Diffuse-reflection"><span class="nav-number">2.3.</span> <span class="nav-text">Diffuse reflection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Highlight-reflection"><span class="nav-number">2.4.</span> <span class="nav-text">Highlight reflection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pixel-by-pixel-or-vertex-by-vertex"><span class="nav-number">2.5.</span> <span class="nav-text">Pixel by pixel or vertex by vertex</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ambient-Light-and-Self-Illumination-in-Unity"><span class="nav-number">3.</span> <span class="nav-text">Ambient Light and Self-Illumination in Unity</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-Implement-a-Diffuse-Lighting-Model"><span class="nav-number">3.1.</span> <span class="nav-text">How to Implement a Diffuse Lighting Model</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Vertex-by-vertex-illumination"><span class="nav-number">3.1.1.</span> <span class="nav-text">Vertex-by-vertex illumination</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pixel-by-pixel-illumination"><span class="nav-number">3.1.2.</span> <span class="nav-text">Pixel-by-pixel illumination</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-Implement-a-Highlight-Reflection-Lighting-Model"><span class="nav-number">3.2.</span> <span class="nav-text">How to Implement a Highlight Reflection Lighting Model</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Vertex-by-vertex"><span class="nav-number">3.2.1.</span> <span class="nav-text">Vertex by vertex</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pixel-by-pixel"><span class="nav-number">3.2.2.</span> <span class="nav-text">Pixel by pixel</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2022/05/21/unity-render-pipeline-9/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Principles of Unity Rendering (9) Unity Lighting Model | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Principles of Unity Rendering (9) Unity Lighting Model</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-05-21 11:03:44" itemprop="dateCreated datePublished" datetime="2022-05-21T11:03:44+08:00">2022-05-21</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-13 10:19:43" itemprop="dateModified" datetime="2023-08-13T10:19:43+08:00">2023-08-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2022/05/21/unity-render-pipeline-9/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2022/05/21/unity-render-pipeline-9/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>We are officially starting to learn some Shaders that can be applied, this time we will start with the lighting model. The code and concepts in this article are interpreted from “Getting Started with Unity Shader Essentials”.</p><p>This article mainly explains the principles and code analysis of several lighting models in the book.</p><span id="more"></span><h2 id="Illumination-of-the-Real-World-How-We-See-the-World"><a href="#Illumination-of-the-Real-World-How-We-See-the-World" class="headerlink" title="Illumination of the Real World - How We See the World"></a>Illumination of the Real World - How We See the World</h2><p>The purpose of the game world we build is to imitate a real world, so we need to mathematically model the principles of object imaging in the real world, and then use the program to realize this mathematical model.</p><p>So our first step before learning the Unity lighting model is to have a basic understanding of real-world lighting.</p><p>When we say “this object is red,” it’s actually because this object reflects more red light and absorbs all other colors of light waves, and an object is black, it actually absorbs all colors of light waves.</p><p>Generally speaking, to simulate real lighting to generate an image, we need to consider three physical phenomena:</p><ul><li>First, the light is emitted from the light source</li><li>Then, the light and some objects in the scene meet, some light is absorbed by the object, and some light is scattered by the object in other directions.<br>Finally, the camera absorbs some light and produces an image</li></ul><h3 id="Light-source"><a href="#Light-source" class="headerlink" title="Light source"></a>Light source</h3><p>Light is emitted by a light source. In real-time rendering, we usually treat the light source as a point with no volume and use <strong>l</strong> to represent its direction. So how do we measure how much light a light source emits? That is, how do we quantify a light? In optics, this is called irradiance. For parallel light, its irradiance can be obtained by calculating the energy passing through a unit area perpendicular to l. The surface of an object is generally not perpendicular to l. When calculating the irradiance of an object surface, we can calculate the cosine of the angle between the surface normal of the illumination direction l.<br><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1653385372/origin-of-ray/WX20220524-174049_2x_qqp0xr.png" alt><br>Since the irradiance is inversely proportional to the distance d/cosθ between the rays when they hit the surface of the object, the irradiance is proportional to cosθ. Cosθ can be obtained from the dot product of the light source direction l and the surface normal n.</p><h3 id="Absorption-and-scattering"><a href="#Absorption-and-scattering" class="headerlink" title="Absorption and scattering"></a>Absorption and scattering</h3><p>After the light is emitted by the light source, it intersects with the object. There are usually two results of intersection: scattering and absorption.</p><p>Scattering only changes the direction of the light without changing the density and color of the light. Absorption only changes the density and color of the light, but does not change the direction of the light.</p><p>After light is scattered on the surface of an object, there are two directions, one will scatter into the interior of the object, which is called refraction or transmission; the other will scatter to the outside, which is called reflection.</p><p>For opaque objects, the light rays refracted into the interior of the object may also continue to intersect the particles inside, with some of the light rays finally re-emitted from the surface of the object, and others absorbed by the object. Those rays re-emitted from the surface of the object will have a different directional distribution and color than the incident ray line.</p><p>In order to distinguish between these two different kinds of scattering, we use different parts of the lighting model to calculate them: specular, which indicates how light is reflected by an object, and diffuse, which indicates how much light will be refracted, absorbed, and scattered out of the surface.</p><p>Based on the number and direction of incident rays, we can calculate the number and direction of outgoing rays, which we usually use to describe it.</p><blockquote><p>To sum up, there are two kinds of results of the intersection of light and objects: scattering and absorption, scattering is divided into refraction and reflection, reflection we use high light reflection to calculate, refraction with diffuse reflection to calculate.</p></blockquote><h3 id="Coloring"><a href="#Coloring" class="headerlink" title="Coloring"></a>Coloring</h3><p>Shading refers to the process of using an equation to calculate the emissivity along a certain viewing direction according to material properties (such as diffuse emission properties, etc.) and light source information (such as light source direction, irradiance, etc.). <strong>We call this equation the lighting model (Lighting Mode)</strong> , different lighting models have different purposes, some terms describe rough surfaces, and some are used to describe metal surfaces.</p><h3 id="BRDF-model"><a href="#BRDF-model" class="headerlink" title="BRDF model"></a>BRDF model</h3><p>When light hits a surface from a certain direction, how much light is reflected and in what direction?</p><p>BRDF (Bidirectional Reflection Distribution Function) is the answer to this question. When given a point on the surface of the model, BRDF contains a complete description of the appearance of that point. In graphics, BRDF is mostly represented by a mathematical formula and provides a parameter to adjust the material properties.</p><h2 id="Standard-illumination-model"><a href="#Standard-illumination-model" class="headerlink" title="Standard illumination model"></a>Standard illumination model</h2><p>There are many different lighting models, but in the early game engines, there was often only one lighting model used, which was called the standard lighting model. In fact, the standard lighting model was widely used before BRDF was proposed.</p><p>The standard lighting model only cares about direct light, that is, those rays that are emitted directly from the light source and illuminated on the surface of the object, and then directly enter the camera through a reflection from the surface of the object.</p><p>Its basic method is to divide the light entering the camera into four parts, each part using a method to calculate its contribution, these four parts are:</p><ul><li>The emissive section. This section is used to describe how much radiation a surface emits in a given direction. Note that if global illumination is not used, these self-luminous surfaces do not actually illuminate surrounding objects, but only appear brighter themselves. For specific details, please refer to the official doc:<a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.unity3d.com/2019.4/Documentation/Manual/lighting-emissive-materials.html">发光材质 - Unity</a></li><li>Specular section. This section describes how much radiation the surface will scatter in the direction of full specular reflection when light from the light source hits the model surface.</li><li>Diffuse section. This section describes how much radiation the surface will scatter in all directions as light from the light source hits the model surface.</li><li>The ambient part. All other indirect lighting (as opposed to direct lighting).</li></ul><h3 id="Ambient-light"><a href="#Ambient-light" class="headerlink" title="Ambient light"></a>Ambient light</h3><p>While standard lighting models focus on describing direct illumination, in the real world, objects can also be illuminated by indirect illumination.</p><p>Indirect illumination is when light is reflected between multiple objects and finally enters the camera. For example, if you put a light gray sofa near the red carpet, the bottom of the sofa will also have red because the carpet reflects some of the light and bounces back onto the sofa.</p><p>In the standard lighting model, we use a part called ambient light to approximate indirect lighting. The calculation of ambient light is very simple, usually by setting a global variable, that is, all objects in the scene use this ambient light.</p><script type="math/tex;mode=display">
c_{ambient} = g_{ambient}</script><h3 id="Self-luminous"><a href="#Self-luminous" class="headerlink" title="Self-luminous"></a>Self-luminous</h3><p>Light can also be emitted directly from the light source into the camera without being reflected by any object. The standard lighting model uses self-luminescence to calculate this contribution. Its calculation formula is also very simple, that is, the self-luminous color of the material is used.</p><script type="math/tex;mode=display">
c_{emissive} = m_{emissive}</script><p>Usually in real-time rendering, self-luminous surfaces often do not illuminate surrounding objects, that is, the object will not be used as a light source.</p><h3 id="Diffuse-reflection"><a href="#Diffuse-reflection" class="headerlink" title="Diffuse reflection"></a>Diffuse reflection</h3><p>Diffuse emission illumination is suitable for modeling the radiance of those objects whose surfaces scatter randomly in all directions. In diffuse emission, the position of the viewing angle is not important because the reflection is completely random, so the distribution can be considered the same in any reflection direction, but the angle of the incident ray is important.</p><p>Diffuse reflection is in accordance with Lambert’s Law: the intensity of the reflected light is proportional to the cosine of the angle between the surface discovery and the light source. Therefore, the calculation formula for the diffuse reflection part is:</p><script type="math/tex;mode=display">c_{diffuse} = (c_{light} \cdot m_{diffuse})max(0, n \cdot I)</script><p>Where n is the surface normal, I is the unit vector of the light source, $m <em>{diffuse} $is the diffuse color of the material, and $c</em> {light} $is the color of the light source.<br>It should be noted that in order to prevent the normal and light source direction point multiplication result from being negative, we use the function of taking the maximum value to intercept it to 0, which can prevent the object from being illuminated by the light source from behind.</p><blockquote><p>Here’s a question, why is it a dot product of two colors instead of adding them, and what is the result of multiplying two color values?<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/70f5e349cd49">https://www.jianshu.com/p/70f5e349cd49</a></p></blockquote><h3 id="Highlight-reflection"><a href="#Highlight-reflection" class="headerlink" title="Highlight reflection"></a>Highlight reflection</h3><p>The specular reflection here is an empirical model, that is, it does not fully match the specular reflection phenomenon in the real world. It can be used to calculate the light that is reflected in the direction of full specular reflection, which can make objects look shiny, such as metal materials.</p><p>Calculate high light reflection need to know more information, such as surface normal, viewing angle direction, light source direction, reflection direction and so on.</p><p>We assume that these vectors are all unit vectors, and we can know three of these four vectors, and we can calculate the fourth - the reflection direction (the principle can refer to: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/a1191835397/article/details/102779766">https://blog.csdn.net/a1191835397/article/details/102779766</a>)</p><script type="math/tex;mode=display">
r = 2(n \cdot I)n - I</script><p>In this way, we can use the Phong model to calculate the highlight reflection part:</p><script type="math/tex;mode=display">
c_{specular} = (c_{light} \cdot m_{specular})max(0, v \cdot r)^{m_{gloss}}</script><p>Where $m <em>{gloss} $is the gloss of the material, also known as shininess. It is used to control how wide the highlights are in the highlight area, the larger the $m</em> {gloss} $, the smaller the highlights. $m <em>{specular} $is the highlight reflection color of the material, which is used to control the color and intensity of the highlight reflection of the material, and $c</em> {light} $is the color and intensity of the light source. At the same time, it is necessary to prevent the value of $v\ cdot r $from being negative.</p><p>Compared with the Phong model, Blinn proposes a simple modification method to obtain similar results. The idea is that in order to avoid calculating the reflection direction r, Blinn introduces a new vector h for this purpose, which is obtained by taking v and I. After averaging, it is normalized, i.e.:</p><script type="math/tex;mode=display">
h = \frac{v + I}{|v + I|}</script><p>Then the formula of the Blinn model is as follows:</p><script type="math/tex;mode=display">
c_{speular} = (c_{light} \cdot m_{specluar})max(0, n \cdot h)^{m_{gloss}}</script><p>In the hardware implementation, if the distance between the camera and the light source is far enough, the Blinn model will be faster than the Phong model. This is because at this time, it can be considered that v and I are both fixed values, so h will be a constant, but when v or When I is not fixed, the Phong model may be faster.</p><p>Note that the Phong model and the Blinn model are both empirical models, and one should not be considered more correct than the other.</p><h3 id="Pixel-by-pixel-or-vertex-by-vertex"><a href="#Pixel-by-pixel-or-vertex-by-vertex" class="headerlink" title="Pixel by pixel or vertex by vertex"></a>Pixel by pixel or vertex by vertex</h3><p>The math used for the basic lighting mode is given above, so where should we do these calculations? Generally speaking, we have two options, calculate in the slice shader, also known as pixel-by-pixel lighting, and calculate in the vertex shader, also known as vertex-by-vertex lighting.</p><p>In pixel-by-pixel lighting, we will get its normal on a per-pixel basis (it can be the difference between the normal values of the vertices, or it can be sampled from the normal texture), and then calculate the lighting model. This technique of interpolating vertex normals between patches is called Phong shading, also known as Phong interpolation or normal interpolation technique, which is different from the Phong lighting model we talked about before.</p><p>Corresponding to this is vertex-by-vertex illumination, also known as Gouraud shading, in vertex-by-vertex illumination, we calculate the illumination at each fixed point, then perform linear interpolation inside the render graph element, and finally output it as pixel color.</p><p>Since the number of vertices is often smaller than that of pixel trees, vertex-by-vertex illumination is often less computational than pixel-by-pixel illumination. However, since vertex-by-vertex illumination relies on linear interpolation to obtain pixel illumination, vertex-by-vertex illumination can be problematic when there are nonlinear calculations in the illumination model (such as when specular reflections).</p><h2 id="Ambient-Light-and-Self-Illumination-in-Unity"><a href="#Ambient-Light-and-Self-Illumination-in-Unity" class="headerlink" title="Ambient Light and Self-Illumination in Unity"></a>Ambient Light and Self-Illumination in Unity</h2><p>Most objects do not have self-luminous properties. It is also very simple to add self-luminous properties, just add the luminous color before the final color output of the chip shader.</p><h3 id="How-to-Implement-a-Diffuse-Lighting-Model"><a href="#How-to-Implement-a-Diffuse-Lighting-Model" class="headerlink" title="How to Implement a Diffuse Lighting Model"></a>How to Implement a Diffuse Lighting Model</h3><p>Now we officially try to write a diffuse reflection Shader, the specific principle directly see the code comments</p><h4 id="Vertex-by-vertex-illumination"><a href="#Vertex-by-vertex-illumination" class="headerlink" title="Vertex-by-vertex illumination"></a>Vertex-by-vertex illumination</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/DiffuseVertexLevel&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//Declare a property for external incoming, type is Color, default value is white</span></span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        The render type <span class="keyword">is</span> opaque <span class="built_in">object</span></span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> &#125;</span><br><span class="line">        <span class="comment">// LOD（Leevl of Drtail）值时100</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                <span class="comment">//Define the role of the Pass in Unity&#x27;s pipeline (only by defining it can you get some of Unity&#x27;s built-in lighting variables such as _LightColor0  </span></span><br><span class="line">                <span class="comment">//In the default pipeline, the lighting mode is ForwardBase etc</span></span><br><span class="line">				<span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;UniversalForward&quot;</span>    </span><br><span class="line">			&#125;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex: POSITION;</span><br><span class="line">                float3 normal: NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos: SV_POSITION;</span><br><span class="line">                fixed3 color: COLOR; </span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="function">v2f <span class="title">vert</span> (<span class="params">a2v v</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//Vertex shader must convert vertex coordinates from model space to clipping space</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                <span class="comment">//get the value of ambient light</span></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//The vertex normal is right multiplied by the world space to the model space matrix transformation matrix, and then normalized to obtain the vector of the vertex normal in the world coordinates</span></span><br><span class="line">                fixed3 worldNormal = normalize(mul(v.normal, (float3x3)unity_WorldToObject));</span><br><span class="line"></span><br><span class="line">                <span class="comment">//When there is only one light source in the scene, the _ WorldSpaceLightPos0.xyz is the light source</span></span><br><span class="line">                fixed3 worldLight = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//dot: dot multiplication</span></span><br><span class="line">                <span class="comment">//saturate: If the imported parameter is less than 0, return 0. If it is greater than 1, return 1. Otherwise, return the original value.</span></span><br><span class="line">                <span class="comment">//The result of multiplying the pixel values is a color blend</span></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, worldLight));</span><br><span class="line"></span><br><span class="line">                The result of adding pixel values <span class="keyword">is</span> a color overlay</span><br><span class="line">                o.color = ambient + diffuse;</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span>(<span class="params">v2f i</span>) : SV_Target</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> fixed4(i.color, <span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback <span class="string">&quot;Diffuse&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Pixel-by-pixel-illumination"><a href="#Pixel-by-pixel-illumination" class="headerlink" title="Pixel-by-pixel illumination"></a>Pixel-by-pixel illumination</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/DiffusePixelLevel&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> &#125;</span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                <span class="comment">//Define the role of the Pass in Unity&#x27;s pipeline (only by defining it can you get some of Unity&#x27;s built-in lighting variables such as _LightColor0  </span></span><br><span class="line">                <span class="comment">//In the default pipeline, the lighting mode is ForwardBase etc</span></span><br><span class="line">				<span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;UniversalForward&quot;</span>    </span><br><span class="line">			&#125;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex: POSITION;</span><br><span class="line">                float3 normal: NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos: SV_POSITION;</span><br><span class="line">                float3 worldNorma: TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="function">v2f <span class="title">vert</span> (<span class="params">a2v v</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNorma = mul(v.normal, (float3x3)unity_WorldToObject);</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span>(<span class="params">v2f i</span>) : SV_Target</span> &#123;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNorma);</span><br><span class="line">                fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 color = ambient + diffuse;</span><br><span class="line">                <span class="keyword">return</span> fixed4(color, <span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback <span class="string">&quot;Diffuse&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="How-to-Implement-a-Highlight-Reflection-Lighting-Model"><a href="#How-to-Implement-a-Highlight-Reflection-Lighting-Model" class="headerlink" title="How to Implement a Highlight Reflection Lighting Model"></a>How to Implement a Highlight Reflection Lighting Model</h3><h4 id="Vertex-by-vertex"><a href="#Vertex-by-vertex" class="headerlink" title="Vertex by vertex"></a>Vertex by vertex</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/SpecularVertexLevel&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Specular(<span class="string">&quot;Specular&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>, Range(<span class="number">8.0</span>, <span class="number">256</span>)) = <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> &#125;</span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;<span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;UniversalForward&quot;</span>&#125;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="built_in">float</span> _Gloss;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex: POSITION;</span><br><span class="line">                float3 normal: NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos: SV_POSITION;</span><br><span class="line">                float3 color: COLOR;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="function">v2f <span class="title">vert</span>(<span class="params">a2v v</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed3 worldNormal = normalize(mul(v.normal, (fixed3x3)unity_WorldToObject));</span><br><span class="line"></span><br><span class="line">                fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 reflectDir = normalize(reflect(-worldLightDir, worldNormal));</span><br><span class="line"></span><br><span class="line">                fixed3 viewDir = normalize(_WorldSpaceCameraPos.xyz - mul(unity_ObjectToWorld, v.vertex).xyz);</span><br><span class="line"></span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(reflectDir, viewDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">                o.color = ambient + diffuse + specular;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span>(<span class="params">v2f i</span>) : SV_Target</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> fixed4(i.color, <span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback <span class="string">&quot;Specular&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Pixel-by-pixel"><a href="#Pixel-by-pixel" class="headerlink" title="Pixel by pixel"></a>Pixel by pixel</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/SpecularPixelLevel&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Specular(<span class="string">&quot;Specular&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>, Range(<span class="number">8.0</span>, <span class="number">256</span>)) = <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> &#125;</span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;<span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;UniversalForward&quot;</span>&#125;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="built_in">float</span> _Gloss;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex: POSITION;</span><br><span class="line">                float3 normal: NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos: SV_POSITION;</span><br><span class="line">                float3 worldNormal: TEXCOORD0;</span><br><span class="line">                float3 worldPos: TEXCORRD1;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="function">v2f <span class="title">vert</span>(<span class="params">a2v v</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">                o.worldNormal = mul(v.vertex, (float3x3)unity_WorldToObject);</span><br><span class="line"></span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span>(<span class="params">v2f i</span>) : SV_Target</span> &#123;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line"></span><br><span class="line">                fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 reflectDir = normalize(reflect(-worldLightDir, worldNormal));</span><br><span class="line"></span><br><span class="line">                fixed3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.worldPos.xyz);</span><br><span class="line"></span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(reflectDir, viewDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> fixed4(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback <span class="string">&quot;Specular&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2022/05/21/unity-render-pipeline-9/" title="Principles of Unity Rendering (9) Unity Lighting Model">https://sunra.top/en/2022/05/21/unity-render-pipeline-9/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2022/05/21/unity-render-pipeline-8/" rel="prev" title="Unity Rendering Principle (8) Unity Rendering Order and Rendering Path"><i class="fa fa-chevron-left"></i> Unity Rendering Principle (8) Unity Rendering Order and Rendering Path</a></div><div class="post-nav-item"> <a href="/en/2022/06/03/unity-trilib-import-fbx/" rel="next" title="Use and source code analysis of TriLib remote loading FBX under Unity">Use and source code analysis of TriLib remote loading FBX under Unity<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2022/05/21/unity-render-pipeline-9/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>