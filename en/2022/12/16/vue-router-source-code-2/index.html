<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="之前的博客我们讲了我们创建VueRouter实例并通过Vue.use应用之后，VueRouter内部如何生成一整套自己的数据结构来存储路由配置的，这次博客我们继续解读Vue Router的源码，大致内容是Vue Router的路由守卫的执行逻辑。"><meta property="og:type" content="article"><meta property="og:title" content="Vue Router Source Code Parsing (2) Jump of Internal Router"><meta property="og:url" content="https://sunra.top/en/2022/12/16/vue-router-source-code-2/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="之前的博客我们讲了我们创建VueRouter实例并通过Vue.use应用之后，VueRouter内部如何生成一整套自己的数据结构来存储路由配置的，这次博客我们继续解读Vue Router的源码，大致内容是Vue Router的路由守卫的执行逻辑。"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2022-12-16T08:28:29.000Z"><meta property="article:modified_time" content="2023-06-27T13:13:42.928Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2022/12/16/vue-router-source-code-2/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2022/12/16/vue-router-source-code-2/","path":"2022/12/16/vue-router-source-code-2/","title":"Vue Router Source Code Parsing (2) Jump of Internal Router"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Vue Router Source Code Parsing (2) Jump of Internal Router | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Route-guard"><span class="nav-number">1.</span> <span class="nav-text">Route guard</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-case"><span class="nav-number">2.</span> <span class="nav-text">Use case</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Source-code-analysis"><span class="nav-number">3.</span> <span class="nav-text">Source code analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#push"><span class="nav-number">3.1.</span> <span class="nav-text">push</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#transitionTo"><span class="nav-number">3.2.</span> <span class="nav-text">transitionTo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#runQueue"><span class="nav-number">3.2.1.</span> <span class="nav-text">runQueue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extractGuards"><span class="nav-number">3.2.2.</span> <span class="nav-text">extractGuards</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConfirmTransition-Steps-1-8"><span class="nav-number">3.2.3.</span> <span class="nav-text">ConfirmTransition (Steps 1-8)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ComfirmTransition-success-callback-steps-9-12"><span class="nav-number">3.2.4.</span> <span class="nav-text">ComfirmTransition success callback (steps 9-12)</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2022/12/16/vue-router-source-code-2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Vue Router Source Code Parsing (2) Jump of Internal Router | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Vue Router Source Code Parsing (2) Jump of Internal Router</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-12-16 16:28:29" itemprop="dateCreated datePublished" datetime="2022-12-16T16:28:29+08:00">2022-12-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-06-27 21:13:42" itemprop="dateModified" datetime="2023-06-27T21:13:42+08:00">2023-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2022/12/16/vue-router-source-code-2/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2022/12/16/vue-router-source-code-2/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p><a href="https://sunra.top/posts/20273/">之前的博客</a>我们讲了我们创建VueRouter实例并通过Vue.use应用之后，VueRouter内部如何生成一整套自己的数据结构来存储路由配置的，这次博客我们继续解读Vue Router的源码，大致内容是Vue Router的路由守卫的执行逻辑。</p><span id="more"></span><h1 id="Route-guard"><a href="#Route-guard" class="headerlink" title="Route guard"></a>Route guard</h1><p>This is the official address of VueRouter’s route guard: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html">https://router.vuejs.org/zh/guide/advanced/navigation-guards.html</a></p><p>The order of execution of route guards during the entire route change process is as follows:</p><ol><li>Navigation is triggered.</li><li>Call the’beforeRouteLeave ‘guard in the inactivated component.</li><li>Call the global beforeEach guard.</li><li>Call the beforeRouteUpdate guard (2.2 +) in the reused component.</li><li>Call’beforeEnter ‘in the route configuration.</li><li>Parse asynchronous routing components.</li><li>Call’beforeRouteEnter ‘in the activated component.</li><li>Call the global beforeResolve guard (2.5 +).</li><li>Navigation is confirmed.</li><li>Invoke the global afterEach hook.</li><li>Trigger DOM update.</li><li>Call the callback function passed to next in the’beforeRouteEnter ‘guard, and the created component instance will be passed in as the parameter of the callback function.</li></ol><h1 id="Use-case"><a href="#Use-case" class="headerlink" title="Use case"></a>Use case</h1><p>Let’s first talk about the code on which our blog is based</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Foo</span> = &#123; </span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;foo&lt;/div&gt;&#x27;</span>,</span><br><span class="line">  <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span></span>) &#123;</span><br><span class="line">    <span class="comment">//called before the corresponding route for rendering this component is verified</span></span><br><span class="line">    <span class="comment">//Cannot get component instance&#x27;this&#x27;!</span></span><br><span class="line">    <span class="comment">//Because when the guard executes, the component instance has not yet been created!</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span></span>) &#123;</span><br><span class="line">    <span class="title class_">Called</span> when the current route changes but the component is to be reused</span><br><span class="line">    <span class="comment">//For example, for a path &#x27;/users/: id&#x27; with dynamic parameters, when jumping between &#x27;/users/1&#x27; and &#x27;/users/2&#x27;,</span></span><br><span class="line">    <span class="comment">//Since the same&#x27;UserDetails&#x27; component will be rendered, the component instance will be to reuse. And the hook will be called in this case.</span></span><br><span class="line">    <span class="comment">//Because the component is already mounted when this happens, the navigation guard can access the component instance&#x27;this&#x27;.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteLeave</span>(<span class="params">to, <span class="keyword">from</span></span>) &#123;</span><br><span class="line">    <span class="comment">//Called when navigating away from the corresponding route that renders the component</span></span><br><span class="line">    <span class="comment">//Like&#x27;beforeRouteUpdate &#x27;, it can access the component instance&#x27;this&#x27;</span></span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Bar</span> = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;bar&lt;/div&gt;&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Baz</span> = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;baz&lt;/div&gt;&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  <span class="attr">base</span>: __dirname,</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="comment">// a single route can define multiple named components</span></span><br><span class="line">      <span class="comment">// which will be rendered into &lt;router-view&gt;s with corresponding names.</span></span><br><span class="line">      <span class="attr">components</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="title class_">Foo</span>,</span><br><span class="line">        <span class="attr">a</span>: <span class="title class_">Bar</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="title class_">Baz</span></span><br><span class="line">        <span class="attr">beforeEnter</span>: <span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(bar);</span><br><span class="line">          <span class="comment">// reject the navigation</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/other&#x27;</span>,</span><br><span class="line">      <span class="attr">components</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="title class_">Baz</span>,</span><br><span class="line">        <span class="attr">a</span>: <span class="title class_">Bar</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="title class_">Foo</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="keyword">async</span> (to, <span class="keyword">from</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">//canUserAccess () returns&#x27;true &#x27;or&#x27;false&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> canAccess = <span class="keyword">await</span> <span class="title function_">canUserAccess</span>(to)</span><br><span class="line">  <span class="keyword">if</span> (!canAccess) <span class="keyword">return</span> <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//router.beforeEach supports the third parameter next</span></span><br><span class="line"><span class="comment">// router.beforeEach((to, from, next) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   if (to.name ! &#x27;Login&#x27; &amp;&amp; !isAuthenticated) next(&#123; name: &#x27;Login&#x27; &#125;)</span></span><br><span class="line"><span class="comment">//   else next()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeResolve</span>(<span class="keyword">async</span> to =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">requiresCamera</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">askForCameraPermission</span>()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="title class_">NotAllowedError</span>) &#123;</span><br><span class="line">        <span class="comment">//... handle error, then cancel navigation</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">Unexpected</span> error, cancel navigation and pass the error to the <span class="variable language_">global</span> processor</span><br><span class="line">        <span class="keyword">throw</span> error</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// afterEach不支持next</span></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">sendToAnalytics</span>(to.<span class="property">fullPath</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div id=&quot;app&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;Named Views&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;ul&gt;</span></span><br><span class="line"><span class="string">        &lt;li&gt;&lt;router-link to=&quot;/&quot;&gt;/&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li&gt;&lt;router-link to=&quot;/other&quot;&gt;/other&lt;/router-link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;/ul&gt;</span></span><br><span class="line"><span class="string">      &lt;router-view class=&quot;view one&quot;&gt;&lt;/router-view&gt;</span></span><br><span class="line"><span class="string">      &lt;router-view class=&quot;view two&quot; name=&quot;a&quot;&gt;&lt;/router-view&gt;</span></span><br><span class="line"><span class="string">      &lt;router-view class=&quot;view three&quot; name=&quot;b&quot;&gt;&lt;/router-view&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="Source-code-analysis"><a href="#Source-code-analysis" class="headerlink" title="Source code analysis"></a>Source code analysis</h1><h2 id="push"><a href="#push" class="headerlink" title="push"></a>push</h2><p>We start with VueRouter.prototype.push to analyze what happens after the call route switch</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">push (<span class="attr">location</span>: <span class="title class_">RawLocation</span>, onComplete?: <span class="title class_">Function</span>, onAbort?: <span class="title class_">Function</span>) &#123;</span><br><span class="line">    <span class="comment">// $flow-disable-line</span></span><br><span class="line">  <span class="keyword">if</span> (!onComplete &amp;&amp; !onAbort &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Promise</span> ! <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">push</span>(location, resolve, reject)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">push</span>(location, onComplete, onAbort)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The three parameters are RawLocation, the callback function when successful and the callback function when failed. RawLocation is actually the parameter type passed by the push function when we use it formally. The specific definitions are as follows:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">Location</span> = &#123;</span><br><span class="line">  _normalized?: <span class="built_in">boolean</span>;</span><br><span class="line">  name?: <span class="built_in">string</span>;</span><br><span class="line">  path?: <span class="built_in">string</span>;</span><br><span class="line">  hash?: <span class="built_in">string</span>;</span><br><span class="line">  query?: <span class="title class_">Dictionary</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  params?: <span class="title class_">Dictionary</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">  append?: <span class="built_in">boolean</span>;</span><br><span class="line">  replace?: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">RawLocation</span> = <span class="built_in">string</span> | <span class="title class_">Location</span></span><br></pre></td></tr></table></figure><p><a href="https://sunra.top/posts/20273/">之前的博客</a>我们this.history会根据mode不同实例化为不同的对象，我们以HTML5History来分析</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">push (<span class="attr">location</span>: <span class="title class_">RawLocation</span>, onComplete?: <span class="title class_">Function</span>, onAbort?: <span class="title class_">Function</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">current</span>: fromRoute &#125; = <span class="variable language_">this</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">transitionTo</span>(location, <span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">pushState</span>(<span class="title function_">cleanPath</span>(<span class="variable language_">this</span>.<span class="property">base</span> + route.<span class="property">fullPath</span>))</span><br><span class="line">      <span class="title function_">handleScroll</span>(<span class="variable language_">this</span>.<span class="property">router</span>, route, fromRoute, <span class="literal">false</span>)</span><br><span class="line">      onComplete &amp;&amp; <span class="title function_">onComplete</span>(route)</span><br><span class="line">    &#125;, onAbort)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>The first is to get the current route: current, its type is Route</p><p>Then call the’transitionTo ‘function, pass in two parameters, the first is the location, the second is the callback function, let’s see what this’transitionTo’ does</p><h2 id="transitionTo"><a href="#transitionTo" class="headerlink" title="transitionTo"></a>transitionTo</h2><p>Before we look at the transtitionTo function, let’s look at a few utility functions.</p><h3 id="runQueue"><a href="#runQueue" class="headerlink" title="runQueue"></a>runQueue</h3><p>The first is’runQueue ‘:</p><p>This function has three parameters, which are:</p><ul><li>queue: an array of parameters</li><li>fn: The actual execution of the function, which also has two parameters, the first is each item in the queue, and the second is the callback function after fn is executed.</li><li>cb: the final callback function after executing fn for each item in the queue</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">runQueue</span> (<span class="attr">queue</span>: <span class="title class_">Array</span>&lt;?<span class="title class_">NavigationGuard</span>&gt;, <span class="attr">fn</span>: <span class="title class_">Function</span>, <span class="attr">cb</span>: <span class="title class_">Function</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">step</span> = index =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= queue.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="title function_">cb</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (queue[index]) &#123;</span><br><span class="line">        <span class="title function_">fn</span>(queue[index], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">step</span>(index + <span class="number">1</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">step</span>(index + <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">step</span>(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="extractGuards"><a href="#extractGuards" class="headerlink" title="extractGuards"></a>extractGuards</h3><p>Simply put, the role of this function is to extract the routing guards inside the component from a series of incoming RouteRecord, and then specify the context of these routing guards, that is, the this pointer through the apply function as itself. If the last parameter is true, it reverses the order of these routing guards.</p><p>The function directly exposed to the outside world is, such as extractLeaveGuards, which actually calls’extractGuards (deactivated, ‘beforeRouteLeave’, bindGuard, true) ‘, that is, from a series of deactivated components, get the’beforeRouteLeave’ function, assemble it and then reverse it.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">extractGuards</span> (</span><br><span class="line">  <span class="attr">records</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;,</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">bind</span>: <span class="title class_">Function</span>,</span><br><span class="line">  reverse?: <span class="built_in">boolean</span></span><br><span class="line">): <span class="title class_">Array</span>&lt;?<span class="title class_">Function</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> guards = <span class="title function_">flatMapComponents</span>(records, <span class="function">(<span class="params">def, instance, match, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> guard = <span class="title function_">extractGuard</span>(def, name)</span><br><span class="line">    <span class="keyword">if</span> (guard) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(guard)</span><br><span class="line">        ? guard.<span class="title function_">map</span>(<span class="function"><span class="params">guard</span> =&gt;</span> <span class="title function_">bind</span>(guard, instance, match, key))</span><br><span class="line">        : <span class="title function_">bind</span>(guard, instance, match, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">flatten</span>(reverse ? guards.<span class="title function_">reverse</span>() : guards)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">extractGuard</span> (</span><br><span class="line">  <span class="attr">def</span>: <span class="title class_">Object</span> | <span class="title class_">Function</span>,</span><br><span class="line">  <span class="attr">key</span>: <span class="built_in">string</span></span><br><span class="line">): <span class="title class_">NavigationGuard</span> | <span class="title class_">Array</span>&lt;<span class="title class_">NavigationGuard</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> def ! <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// extend now so that global mixins are applied.</span></span><br><span class="line">    def = _Vue.<span class="title function_">extend</span>(def)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> def.<span class="property">options</span>[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">extractLeaveGuards</span> (<span class="attr">deactivated</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;): <span class="title class_">Array</span>&lt;?<span class="title class_">Function</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">extractGuards</span>(deactivated, <span class="string">&#x27;beforeRouteLeave&#x27;</span>, bindGuard, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">extractUpdateHooks</span> (<span class="attr">updated</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;): <span class="title class_">Array</span>&lt;?<span class="title class_">Function</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">extractGuards</span>(updated, <span class="string">&#x27;beforeRouteUpdate&#x27;</span>, bindGuard)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bindGuard</span> (<span class="attr">guard</span>: <span class="title class_">NavigationGuard</span>, <span class="attr">instance</span>: ?_Vue): ?<span class="title class_">NavigationGuard</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">boundRouteGuard</span> () &#123;</span><br><span class="line">      <span class="keyword">return</span> guard.<span class="title function_">apply</span>(instance, <span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ConfirmTransition-Steps-1-8"><a href="#ConfirmTransition-Steps-1-8" class="headerlink" title="ConfirmTransition (Steps 1-8)"></a>ConfirmTransition (Steps 1-8)</h3><p>Then, ‘confirmTransition’:</p><p>This function is roughly divided into three parts:</p><ul><li>Determine whether to abort, if necessary, exit<br>Generate an array of route guards to execute</li><li>Sequentially execute an array of route guards</li></ul><p>The first is to determine whether the incoming route and the current route are the same. If so, call abort directly and exit</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> current = <span class="variable language_">this</span>.<span class="property">current</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">pending</span> = route</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">abort</span> = err =&gt; &#123;</span><br><span class="line">  <span class="comment">// changed after adding errors with</span></span><br><span class="line">  <span class="comment">// https://github.com/vuejs/vue-router/pull/3047 before that change,</span></span><br><span class="line">  <span class="comment">// redirect and aborted navigation would produce an err  null</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isNavigationFailure</span>(err) &amp;&amp; <span class="title function_">isError</span>(err)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">errorCbs</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">errorCbs</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">cb</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(<span class="literal">false</span>, <span class="string">&#x27;uncaught error during route navigation:&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  onAbort &amp;&amp; <span class="title function_">onAbort</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> lastRouteIndex = route.<span class="property">matched</span>.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> lastCurrentIndex = current.<span class="property">matched</span>.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  <span class="title function_">isSameRoute</span>(route, current) &amp;&amp;</span><br><span class="line">  <span class="comment">// in the case the route map has been dynamically appended to</span></span><br><span class="line">  lastRouteIndex = lastCurrentIndex &amp;&amp;</span><br><span class="line">  route.<span class="property">matched</span>[lastRouteIndex] = current.<span class="property">matched</span>[lastCurrentIndex]</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">ensureURL</span>()</span><br><span class="line">  <span class="keyword">if</span> (route.<span class="property">hash</span>) &#123;</span><br><span class="line">    <span class="title function_">handleScroll</span>(<span class="variable language_">this</span>.<span class="property">router</span>, current, route, <span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">abort</span>(<span class="title function_">createNavigationDuplicatedError</span>(current, route))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then there is a piece of function logic that generates the execution order of route guards.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; updated, deactivated, activated &#125; = <span class="title function_">resolveQueue</span>(</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">current</span>.<span class="property">matched</span>,</span><br><span class="line">  route.<span class="property">matched</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">queue</span>: <span class="title class_">Array</span>&lt;?<span class="title class_">NavigationGuard</span>&gt; = [].<span class="title function_">concat</span>(</span><br><span class="line">  <span class="comment">// in-component leave guards</span></span><br><span class="line">  <span class="title function_">extractLeaveGuards</span>(deactivated),</span><br><span class="line">  <span class="comment">// global before hooks</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">beforeHooks</span>,</span><br><span class="line">  <span class="comment">// in-component update hooks</span></span><br><span class="line">  <span class="title function_">extractUpdateHooks</span>(updated),</span><br><span class="line">  <span class="comment">// in-config enter guards</span></span><br><span class="line">  activated.<span class="title function_">map</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">beforeEnter</span>),</span><br><span class="line">  <span class="comment">// async components</span></span><br><span class="line">  <span class="title function_">resolveAsyncComponents</span>(activated)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>The role of the first line of’resolveQueue ‘is to compare the current route and the route to jump between the changes, its two parameters are the type of’Array &lt; RouteRecord &gt;’, its logic is relatively simple, is to compare the difference between the two arrays:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">resolveQueue</span> (</span><br><span class="line">  <span class="attr">current</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;,</span><br><span class="line">  <span class="attr">next</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;</span><br><span class="line">): &#123;</span><br><span class="line">  <span class="attr">updated</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;,</span><br><span class="line">  <span class="attr">activated</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;,</span><br><span class="line">  <span class="attr">deactivated</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;</span><br><span class="line">&#125; &#123;</span><br><span class="line">  <span class="keyword">let</span> i</span><br><span class="line">  <span class="keyword">const</span> max = <span class="title class_">Math</span>.<span class="title function_">max</span>(current.<span class="property">length</span>, next.<span class="property">length</span>)</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (current[i] ! next[i]) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">updated</span>: next.<span class="title function_">slice</span>(<span class="number">0</span>, i),</span><br><span class="line">    <span class="attr">activated</span>: next.<span class="title function_">slice</span>(i),</span><br><span class="line">    <span class="attr">deactivated</span>: current.<span class="title function_">slice</span>(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The routing guards in the queue numbers are in order:</p><ul><li>beforeRouteLeave function in all deactivated components and then reverse the order</li><li>global beforeHooks function</li><li>beforeRouteUpdate function in all updated components</li><li>beforeEnter function in the routing configuration corresponding to all activated components</li><li>Load all functions of asynchronous components in activated</li></ul><p>These five steps also correspond to steps 2-6 in the execution sequence of the route guard we mentioned at the beginning</p><p>After getting the correct array of route guards execution order, it is officially executed. Here, we use the tool function: runQueue we just mentioned. The code is as follows:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">iterator</span> = (<span class="params">hook: NavigationGuard, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">pending</span> ! route) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">abort</span>(<span class="title function_">createNavigationCancelledError</span>(current, route))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">hook</span>(route, current, <span class="function">(<span class="params">to: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (to = <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// next(false) -&gt; abort navigation, ensure current URL</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">ensureURL</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="title function_">abort</span>(<span class="title function_">createNavigationAbortedError</span>(current, route))</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isError</span>(to)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">ensureURL</span>(<span class="literal">true</span>)</span><br><span class="line">        <span class="title function_">abort</span>(to)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">        <span class="keyword">typeof</span> to = <span class="string">&#x27;string&#x27;</span> ||</span><br><span class="line">        (<span class="keyword">typeof</span> to = <span class="string">&#x27;object&#x27;</span> &amp;&amp;</span><br><span class="line">          (<span class="keyword">typeof</span> to.<span class="property">path</span> = <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> to.<span class="property">name</span> = <span class="string">&#x27;string&#x27;</span>))</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// next(&#x27;/&#x27;) or next(&#123; path: &#x27;/&#x27; &#125;) -&gt; redirect</span></span><br><span class="line">        <span class="title function_">abort</span>(<span class="title function_">createNavigationRedirectedError</span>(current, route))</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> to = <span class="string">&#x27;object&#x27;</span> &amp;&amp; to.<span class="property">replace</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">replace</span>(to)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">push</span>(to)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// confirm transition and pass on the value</span></span><br><span class="line">        <span class="title function_">next</span>(to)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">abort</span>(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">runQueue</span>(queue, iterator, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// wait until async components are resolved before</span></span><br><span class="line">  <span class="comment">// extracting in-component enter guards</span></span><br><span class="line">  <span class="keyword">const</span> enterGuards = <span class="title function_">extractEnterGuards</span>(activated)</span><br><span class="line">  <span class="keyword">const</span> queue = enterGuards.<span class="title function_">concat</span>(<span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">resolveHooks</span>)</span><br><span class="line">  <span class="title function_">runQueue</span>(queue, iterator, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">pending</span> ! route) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">abort</span>(<span class="title function_">createNavigationCancelledError</span>(current, route))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pending</span> = <span class="literal">null</span></span><br><span class="line">    <span class="title function_">onComplete</span>(route)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">app</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">app</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">handleRouteEntered</span>(route)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>First, the iterator function has two arguments</p><ul><li>Route guard to perform</li><li>Callback function after successful execution</li></ul><p>Then our runQueue has two nested layers:</p><ul><li>The first layer is first passed in the queue we generated just now, that is, the route guard function of 2-6 steps, fn is our iterator function, combined with the runQueue source code we read at the beginning, the first layer does in total The thing is to execute our route guard of 2-6 steps in turn, and each execution is completed by calling the next step in the runQueue to execute the next hook</li><li>In the callback function after all queues are executed in the first layer, we generate a layer of runQueue function. The difference is that this time, the queue we pass in is different. This time our queue generation method is: ‘const enterGuards = extractEnterGuards (activated); const queue = enterGuards.concat (this.router.resolveHooks) ‘, composed of two parts, the first part is the beforeRouteEnter function of all activated components, and then this.router.resolveHooks, that is, the global beforeResolve, here is the route guard order Step 7 and 8</li><li>In the callback function of runQueue on the second layer, we can call the onComplete function of confirmTransition</li></ul><p>Then we want to understand what this onComplete does, we need to see what function transitionTo passes when calling confirmTransition:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">confirmTransition</span>(</span><br><span class="line">  route,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updateRoute</span>(route)</span><br><span class="line">    onComplete &amp;&amp; <span class="title function_">onComplete</span>(route)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">ensureURL</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">afterHooks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">hook</span> =&gt;</span> &#123;</span><br><span class="line">      hook &amp;&amp; <span class="title function_">hook</span>(route, prev)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fire ready cbs once</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">ready</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">ready</span> = <span class="literal">true</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">readyCbs</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">cb</span>(route)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (onAbort) &#123;</span><br><span class="line">      <span class="title function_">onAbort</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (err &amp;&amp; !<span class="variable language_">this</span>.<span class="property">ready</span>) &#123;</span><br><span class="line">      <span class="comment">// Initial redirection should not mark the history as ready yet</span></span><br><span class="line">      <span class="comment">// because it&#x27;s triggered by the redirection instead</span></span><br><span class="line">      <span class="comment">// https://github.com/vuejs/vue-router/issues/3225</span></span><br><span class="line">      <span class="comment">// https://github.com/vuejs/vue-router/issues/3331</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">isNavigationFailure</span>(err, <span class="title class_">NavigationFailureType</span>.<span class="property">redirected</span>) || prev ! <span class="variable constant_">START</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ready</span> = <span class="literal">true</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">readyErrorCbs</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">cb</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ComfirmTransition-success-callback-steps-9-12"><a href="#ComfirmTransition-success-callback-steps-9-12" class="headerlink" title="ComfirmTransition success callback (steps 9-12)"></a>ComfirmTransition success callback (steps 9-12)</h3><p>As you can see, our onComplete is actually this paragraph:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">updateRoute</span>(route)</span><br><span class="line">onComplete &amp;&amp; <span class="title function_">onComplete</span>(route)</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">ensureURL</span>()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">router</span>.<span class="property">afterHooks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">hook</span> =&gt;</span> &#123;</span><br><span class="line">  hook &amp;&amp; <span class="title function_">hook</span>(route, prev)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// fire ready cbs once</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">ready</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ready</span> = <span class="literal">true</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">readyCbs</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">cb</span>(route)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>The first step is to call the updateRoute function. The inside of this function is actually the callback function passed in by history.listen function. This is more important. This callback function will modify the value of $route, and this value is responsive. It will be used in the route-view component, that is to say, changing this value will cause route-view to re-call the render function, which will start the update of the view</li><li>Step 2 If transitionTo has an onComplete function then call</li><li>call the afterHooks function in turn, which is actually an array of globally registered afterEach, so far, step 11 is also completed</li></ul><p>So the last step is to re-execute beforeRouterEnter and return an instance through next. This is actually related to the callback method of beforeRouterEnter generated in the seventh step. This’extractEnterGuards’ and its other two’extractLeaveGuards’ are different from’extractUpdateHooks’. Its bind function is not simply apply, but executes the next callback function after the call is successful, as follows:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">extractEnterGuards</span> (</span><br><span class="line">  <span class="attr">activated</span>: <span class="title class_">Array</span>&lt;<span class="title class_">RouteRecord</span>&gt;</span><br><span class="line">): <span class="title class_">Array</span>&lt;?<span class="title class_">Function</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">extractGuards</span>(</span><br><span class="line">    activated,</span><br><span class="line">    <span class="string">&#x27;beforeRouteEnter&#x27;</span>,</span><br><span class="line">    <span class="function">(<span class="params">guard, _, match, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">bindEnterGuard</span>(guard, match, key)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bindEnterGuard</span> (</span><br><span class="line">  <span class="attr">guard</span>: <span class="title class_">NavigationGuard</span>,</span><br><span class="line">  <span class="attr">match</span>: <span class="title class_">RouteRecord</span>,</span><br><span class="line">  <span class="attr">key</span>: <span class="built_in">string</span></span><br><span class="line">): <span class="title class_">NavigationGuard</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">routeEnterGuard</span> (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">guard</span>(to, <span class="keyword">from</span>, <span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> cb = <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!match.<span class="property">enteredCbs</span>[key]) &#123;</span><br><span class="line">          match.<span class="property">enteredCbs</span>[key] = []</span><br><span class="line">        &#125;</span><br><span class="line">        match.<span class="property">enteredCbs</span>[key].<span class="title function_">push</span>(cb)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">next</span>(cb)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>At this point, the function execution 1-12 after modifying the route has been completed, and the router-view change has been successfully triggered by the reactive method.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2022/12/16/vue-router-source-code-2/" title="Vue Router Source Code Parsing (2) Jump of Internal Router">https://sunra.top/en/2022/12/16/vue-router-source-code-2/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2022/12/10/vue-router-source-code-1/" rel="prev" title="Vue Router Source Code Analysis (1) Generation of Internal Routing Configuration"><i class="fa fa-chevron-left"></i> Vue Router Source Code Analysis (1) Generation of Internal Routing Configuration</a></div><div class="post-nav-item"> <a href="/en/2022/12/24/javascript-design-pattern-3/" rel="next" title="JavaScript Design pattern learning and practice (3)">JavaScript Design pattern learning and practice (3)<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2022/12/16/vue-router-source-code-2/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>