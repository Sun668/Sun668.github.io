<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="In this article, we summarize the command patterns, combination patterns, and template methods in JavaScript. These patterns are relatively similar."><meta property="og:type" content="article"><meta property="og:title" content="JavaScript Design pattern learning and practice (4)"><meta property="og:url" content="https://sunra.top/en/2022/12/30/javascript-design-pattern-4/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="In this article, we summarize the command patterns, combination patterns, and template methods in JavaScript. These patterns are relatively similar."><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2022-12-30T06:39:02.000Z"><meta property="article:modified_time" content="2023-11-02T08:05:26.895Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/2022/12/30/javascript-design-pattern-4/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/2022/12/30/javascript-design-pattern-4/","path":"2022/12/30/javascript-design-pattern-4/","title":"JavaScript Design pattern learning and practice (4)"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>JavaScript Design pattern learning and practice (4) | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Command-mode"><span class="nav-number">1.</span> <span class="nav-text">Command mode</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-of-Command-Mode-Menu-Program"><span class="nav-number">1.1.</span> <span class="nav-text">Example of Command Mode - Menu Program</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Command-Patterns-in-JavaScript"><span class="nav-number">1.2.</span> <span class="nav-text">Command Patterns in JavaScript</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Revoke-the-order"><span class="nav-number">1.3.</span> <span class="nav-text">Revoke the order</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Undo-and-redo"><span class="nav-number">1.4.</span> <span class="nav-text">Undo and redo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Macro-command"><span class="nav-number">1.5.</span> <span class="nav-text">Macro command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Smart-Command-and-Fool-Command"><span class="nav-number">1.6.</span> <span class="nav-text">Smart Command and Fool Command</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Combination-mode"><span class="nav-number">2.</span> <span class="nav-text">Combination mode</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Uses-of-the-combined-model"><span class="nav-number">2.1.</span> <span class="nav-text">Uses of the combined model</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More-powerful-macros"><span class="nav-number">2.2.</span> <span class="nav-text">More powerful macros</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-role-of-abstract-classes-in-composition-patterns"><span class="nav-number">2.3.</span> <span class="nav-text">The role of abstract classes in composition patterns</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-Issues-with-Transparency"><span class="nav-number">2.4.</span> <span class="nav-text">Security Issues with Transparency</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Some-noteworthy-places"><span class="nav-number">2.5.</span> <span class="nav-text">Some noteworthy places</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#When-to-use-combination-mode"><span class="nav-number">2.6.</span> <span class="nav-text">When to use combination mode</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Template-method-pattern"><span class="nav-number">3.</span> <span class="nav-text">Template method pattern</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Definition-and-composition-of-template-method-patterns"><span class="nav-number">3.1.</span> <span class="nav-text">Definition and composition of template method patterns</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#An-example-Coffee"><span class="nav-number">3.2.</span> <span class="nav-text">An example - Coffee</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Disadvantages-and-solutions-of-not-having-abstract-classes-in-JavaScript"><span class="nav-number">3.3.</span> <span class="nav-text">Disadvantages and solutions of not having abstract classes in JavaScript</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Usage-scenarios-of-template-methods"><span class="nav-number">3.4.</span> <span class="nav-text">Usage scenarios of template methods</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-method"><span class="nav-number">3.5.</span> <span class="nav-text">Hook method</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Do-we-really-need-to-inherit"><span class="nav-number">3.6.</span> <span class="nav-text">Do we really need to inherit?</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/2022/12/30/javascript-design-pattern-4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="JavaScript Design pattern learning and practice (4) | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> JavaScript Design pattern learning and practice (4)</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-12-30 14:39:02" itemprop="dateCreated datePublished" datetime="2022-12-30T14:39:02+08:00">2022-12-30</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-11-02 16:05:26" itemprop="dateModified" datetime="2023-11-02T16:05:26+08:00">2023-11-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/2022/12/30/javascript-design-pattern-4/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/2022/12/30/javascript-design-pattern-4/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>In this article, we summarize the command patterns, combination patterns, and template methods in JavaScript. These patterns are relatively similar.</p><span id="more"></span><h1 id="Command-mode"><a href="#Command-mode" class="headerlink" title="Command mode"></a>Command mode</h1><p>Suppose there is a fast food restaurant, and I am the order waiter of the restaurant, then my day’s work should be like this. When a certain guest orders, he needs to write down his needs on the list and hand it to the kitchen. Guests don’t need to care about which chefs help them cook. The restaurant can also meet the regular service that guests need. For example, guests may be on their way home and ask for an hour before they start cooking. As long as the order is still there, the chef will not forget. Guests can easily cancel their orders, and when there are too many guests, they can also line up in order of order.</p><p>The most common application scenarios of the command pattern are: <strong>Sometimes you need to send a request to some object, but you don’t know who the recipient of the request is or what the requested operation is. At this time, it is hoped to design the program in a loosely coupled way, so that the sender and receiver of the request can eliminate the coupling relationship between each other</strong> .</p><blockquote><p>In terms of eliminating the coupling relationship, in fact, the command mode and the publish-subscribe mode have similar purposes. The command mode is more concerned with executing different command operations according to different command objects, while the publish-subscribe mode is more concerned with changing the messaging mechanism between programs.</p></blockquote><p>Take food ordering as an example, the guest needs to send a request to the chef, but he doesn’t know the name and contact information of these chefs at all, nor the way and steps of the chef to cook. The command pattern encapsulates the guest’s request to order food into a command object, which is the order object in the order object. This object can be passed around in the program, just like an order can be passed from the waiter to the chef. In this way, the customer does not need to know the chef’s name, thus uncoupling the coupling between the caller and receiver of the request.</p><h2 id="Example-of-Command-Mode-Menu-Program"><a href="#Example-of-Command-Mode-Menu-Program" class="headerlink" title="Example of Command Mode - Menu Program"></a>Example of Command Mode - Menu Program</h2><p>The theme of Design patterns is always to separate things that are constant from things that change, and Command Patterns are no exception. Some things that happen after pressing a button are constant, while what happens is variable. With the help of the command object, we can easily change this association, so we can also change the language of the button again in the future.</p><p>Let’s draw a few buttons first.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &lt; button id = &quot;button1&quot; &gt; click button 1 &lt;/button &gt;</span><br><span class="line">    &lt; button id = &quot;button2&quot; &gt; click button 2 &lt;/button &gt;</span><br><span class="line">    &lt; button id = &quot;button3&quot; &gt; click button 3 &lt;/button &gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> button1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;button1&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> button2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;button2&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> button3 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;button3&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Next, define the setCommand function, which is responsible for installing commands on the button. To be sure, clicking the button will execute a command command, and the action of executing the command will be agreed to call the execute method of command. Although it is not known what operations these commands represent, the programmer responsible for drawing the button does not care about these things. He only needs to reserve the interface for installing the command, and the command object knows how to communicate with the object correctly.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> setCommand = <span class="keyword">function</span>(<span class="params">button, command</span>) &#123;</span><br><span class="line">    button.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        command.<span class="title function_">execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Finally, the programmers responsible for writing the specific operation of clicking the button submitted their results.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">MenuBar</span> = &#123;</span><br><span class="line">    <span class="attr">refresh</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Refresh menu directory&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">SubMenu</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Add submenu&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">del</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Delete submenu&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">RefreshMenuBarCommand</span> = <span class="keyword">function</span>(<span class="params">receiver</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span> = receiver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">RefreshMenuBarCommand</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">execute</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">refresh</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">AddSubMenuCommand</span> = <span class="keyword">function</span>(<span class="params">receiver</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span> = receiver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">AddSubMenuCommand</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">execute</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">add</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">DelSubMenuCommand</span> = <span class="keyword">function</span>(<span class="params">receiver</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span> = receiver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">DelSubMenuCommand</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">execute</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">del</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> refreshMenuBarCommand = <span class="keyword">new</span> <span class="title class_">RefreshMenuBarCommand</span>(<span class="title class_">MenuBar</span>);</span><br><span class="line"><span class="keyword">var</span> addSubMenuCommand = <span class="keyword">new</span> <span class="title class_">AddSubMenuCommand</span>(<span class="title class_">SubMenu</span>);</span><br><span class="line"><span class="keyword">var</span> delSubMenuCommand = <span class="keyword">new</span> <span class="title class_">DelSubMenuCommand</span>(<span class="title class_">SubMenu</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">setCommand</span>(button1, refreshMenuBarCommand);</span><br><span class="line"><span class="title function_">setCommand</span>(button2, addSubMenuCommand);</span><br><span class="line"><span class="title function_">setCommand</span>(button3, delSubMenuCommand);</span><br></pre></td></tr></table></figure><h2 id="Command-Patterns-in-JavaScript"><a href="#Command-Patterns-in-JavaScript" class="headerlink" title="Command Patterns in JavaScript"></a>Command Patterns in JavaScript</h2><p>Perhaps we will be confused, the so-called command mode, it seems to be a method of the object to take the name of execute, the introduction of command object and receiver of these two out of nothing role is nothing more than to complicate the simple things, the following code can also achieve the same function.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bindClick = <span class="keyword">function</span>(<span class="params">button, func</span>) &#123;</span><br><span class="line">    button.<span class="property">onclick</span> = func;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MenuBar</span> = &#123;</span><br><span class="line">    <span class="attr">refresh</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Refresh menu directory&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">SubMenu</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Add submenu&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">del</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Delete submenu&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">bindClick</span>(button1, <span class="title class_">MenuBar</span>.<span class="property">refresh</span>);</span><br><span class="line"><span class="title function_">bindClick</span>(button2, <span class="title class_">SubMenu</span>.<span class="property">add</span>);</span><br><span class="line"><span class="title function_">bindClick</span>(button3, <span class="title class_">SubMenu</span>.<span class="property">del</span>);</span><br></pre></td></tr></table></figure><p>This statement is correct. The above code simulates the implementation of the command mode of the traditional Object Oriented language. The command mode encapsulates the procedural request call in the execute method of the command object. By encapsulating the call of the method, the operation block can be wrapped and the command object can be passed around, so when calling the command, the client does not need to care about how things go.</p><p>The origin of the command mode is actually an Object Oriented replacement for the callback function.</p><p>JavaScript is a language where function is a first-class object. Like the strategy pattern, the command pattern has long been integrated into the JavaScript language. The operation block does not have to be encapsulated in command.execute, it can be encapsulated in a normal function. As a first-class object, function can already be passed around.</p><p>In Object Oriented design, the receiver of the command pattern is saved as a property of the command object, and it is agreed that the operation to execute the command calls the command.execute method. In the command pattern using closure, the receiver is enclosed in the environment generated by the closure, and the operation of executing the command can be simpler, just execute the callback function.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> setCommand = <span class="keyword">function</span>(<span class="params">button, func</span>) &#123;</span><br><span class="line">    button.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">func</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MenuBar</span> = &#123;</span><br><span class="line">    <span class="attr">refresh</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Refresh menu directory&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">RefreshMenuBarCommand</span> = <span class="keyword">function</span>(<span class="params">receiver</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        reciever.<span class="title function_">refresh</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> refreshMenuBarCommand = <span class="keyword">new</span> <span class="title class_">RefreshMenuBarCommand</span>(<span class="title class_">MenuBar</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">setCommand</span>(button1, refreshMenuBarCommand);</span><br></pre></td></tr></table></figure><p>Of course, if you want to more clearly express that you are currently using the command mode, or in addition to executing the command, you may need to provide an operation to undo the command in the future, it is best to set the execution function to execute the execute method</p><h2 id="Revoke-the-order"><a href="#Revoke-the-order" class="headerlink" title="Revoke the order"></a>Revoke the order</h2><p>The function of the command mode is not only to encapsulate the operation block, but also to easily add undo operations to the command object, just like the customer can cancel the order by phone when ordering food.</p><p>The goal of this section is to use the Animate class to write an animation that makes the ball move to a certain horizontal position on the page. Now there is an input text box and a button button in the page. Enter some numbers in the text box to represent the horizontal position of the ball after it moves, and the ball starts to move immediately after the user clicks the button.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;ball&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    Enter the position of the ball after moving: &lt; input id = &quot;pos&quot;/&gt;</span><br><span class="line">    &lt; button id = &quot;moveBtn&quot; &gt; start moving &lt;/button &gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ball = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;ball&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> pos = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;pos&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> moveBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;moveBtn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    moveBtn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> animate = <span class="keyword">new</span> <span class="title class_">Animate</span>(ball);</span></span><br><span class="line"><span class="language-javascript">        aninate.<span class="title function_">start</span>(<span class="string">&#x27;left&#x27;</span>, pos.<span class="property">value</span>, <span class="number">1000</span>, <span class="string">&#x27;strongEaseOut&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>If you enter 200 in the text box and click the moveBtn button, you can see that the ball moves smoothly to the position of 200 in the horizontal direction. Now we need a way to restore the ball to the position before moving. Of course, you can also enter -200 in the text box and click the button.</p><p>This is a method, but more clumsy, it is best to have a Undo button on the page, click the Undo button Zhizhou, the ball will be able to return to the last position</p><p>Before adding the undo button, let’s change the code to command mode first.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ball = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;ball&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pos = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;pos&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> moveBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;moveBtn&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MoveCommand</span> = <span class="keyword">function</span>(<span class="params">reveiver, pos</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span> = receiver;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pos</span> = pos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">MoveCommand</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">execute</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">start</span>(<span class="string">&#x27;left&#x27;</span>, <span class="variable language_">this</span>.<span class="property">pos</span>, <span class="number">1000</span>, <span class="string">&#x27;strongEaseOut&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> moveCommand;</span><br><span class="line"></span><br><span class="line">moveBtn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> animate = <span class="keyword">new</span> <span class="title class_">Animate</span>(ball);</span><br><span class="line">    moveCommand = <span class="keyword">new</span> <span class="title class_">MoveCommand</span>(animate, pose.<span class="property">value</span>);</span><br><span class="line">    moveCommand.<span class="title function_">execute</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The implementation of the undo operation is generally to add a method called unexexute or undo to the command object, in which the reverse operation of execute is performed. Before the execute method makes the ball really start to move, we need to record the current position of the ball first. When the unexecute or undo operation, let the ball return to the position just recorded.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ball = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;ball&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pos = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;pos&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> moveBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;moveBtn&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> cancelBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;cancelBtn&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MoveCommand</span> = <span class="keyword">function</span>(<span class="params">reveiver, pos</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span> = receiver;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pos</span> = pos;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldPos</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">MoveCommand</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">execute</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">start</span>(<span class="string">&#x27;left&#x27;</span>, <span class="variable language_">this</span>.<span class="property">pos</span>, <span class="number">1000</span>, <span class="string">&#x27;strongEaseOut&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldPos</span> = <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="property">dom</span>.<span class="title function_">getBoundingClientRect</span>()[<span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="property">propertyName</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">MoveCommand</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">undo</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">start</span>(<span class="string">&#x27;left&#x27;</span>, <span class="variable language_">this</span>.<span class="property">oldPos</span>, <span class="number">1000</span>, <span class="string">&#x27;strongEaseOut&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> moveCommand;</span><br><span class="line"></span><br><span class="line">moveBtn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> animate = <span class="keyword">new</span> <span class="title class_">Animate</span>(ball);</span><br><span class="line">    moveCommand = <span class="keyword">new</span> <span class="title class_">MoveCommand</span>(animate, pose.<span class="property">value</span>);</span><br><span class="line">    moveCommand.<span class="title function_">execute</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cancaleBtn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    moveCommand.<span class="title function_">undo</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Undo-and-redo"><a href="#Undo-and-redo" class="headerlink" title="Undo and redo"></a>Undo and redo</h2><p>Just now we discussed how to undo a command. Many times, we need to undo a series of commands. For example, in a Go program, we have already played 10 moves, and we need to repent to the fifth step at once. Before this, we can store all the executed steps in a history list, and then reverse the loop to execute the undo of these commands one by one until the 5th command.</p><p>However, in some cases, the undo operation cannot be successfully used to return the object to the state before execution. For example, in the canvas painting program, there are some points on the canvas, and we draw N curves between these points to connect these points to each other. But it is difficult for me to define an undo operation to erase a certain curve for the command mode here, because in canvas, erasing a line is relatively difficult.</p><p> <strong>The best way at this time is to clear the canvas first, and then execute all the commands that have just been executed. This can also be executed using a stack of history lists. Keeping a log of commands and then executing them repeatedly is a good way to reverse irreversible commands.</strong></p><p>For example, some of our games have a playback function. If we store videos, it may be relatively large, but we can store all commands and play back the game by playing back commands.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Ryu</span> = &#123;</span><br><span class="line">    <span class="attr">attack</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;attack&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">defense</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;defense&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">jump</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Jump&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">crouch</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;squat&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> makdCommand = <span class="keyword">function</span>(<span class="params">receiver, state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        recevier[state]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> commands = &#123;</span><br><span class="line">    <span class="string">&#x27;119&#x27;</span>: <span class="string">&#x27;jump&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;115&#x27;</span>: <span class="string">&#x27;crouch&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;97&#x27;</span>: <span class="string">&#x27;defense&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;100&#x27;</span>: <span class="string">&#x27;attack&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> commandStack = [];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onkeypress</span> = <span class="keyword">function</span>(<span class="params">ev</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> keyCode = ev.<span class="property">keyCode</span>;</span><br><span class="line">    <span class="keyword">var</span> command = <span class="title function_">makeCommand</span>(<span class="title class_">Ryu</span>, commands[keyCode]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (command) &#123;</span><br><span class="line">        <span class="title function_">command</span>()l</span><br><span class="line">        commandStack.<span class="title function_">push</span>(command);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;replay&#x27;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> command;</span><br><span class="line">    <span class="keyword">while</span>(command = commandStack.<span class="title function_">shift</span>()) &#123;</span><br><span class="line">        <span class="title function_">command</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Macro-command"><a href="#Macro-command" class="headerlink" title="Macro command"></a>Macro command</h2><p>A macro command is a collection of commands. By executing macro commands, a batch of commands can be executed at once.</p><p>Imagine a universal remote control, every day home press a special button, you can help us close the door, open the computer and log in QQ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> closeDoorCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Close the door&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Turn on the computer&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openQQCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Login QQ&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MarcoCommand</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">commandList</span>: [],</span><br><span class="line">        <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params">command</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">commandList</span>.<span class="title function_">push</span>(command);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">const</span> command <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">commandList</span>) &#123;</span><br><span class="line">                command.<span class="title function_">execute</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> marcoCommand = <span class="title class_">MarcoCommand</span>();</span><br><span class="line">marcoCommand.<span class="title function_">add</span>(closeDoorCommand);</span><br><span class="line">marcoCommand.<span class="title function_">add</span>(openCommand);</span><br><span class="line">marcoCommand.<span class="title function_">add</span>(openQQCommand);</span><br><span class="line"></span><br><span class="line">marcoCommand.<span class="title function_">execute</span>();</span><br></pre></td></tr></table></figure><p>Macro commands are actually the product of the combination of command mode and combination mode. **</p><h2 id="Smart-Command-and-Fool-Command"><a href="#Smart-Command-and-Fool-Command" class="headerlink" title="Smart Command and Fool Command"></a>Smart Command and Fool Command</h2><p>The command we just created looks like this:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> closeDoorCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Close the door&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There is no recevier information in the closeDoorCommand function here, which itself covers the behavior of executing the request, which contradicts the command object we saw before that contains a receiver.</p><p>Generally speaking, the command pattern saves a receiver in the command object to be responsible for actually executing the client’s request. This kind of command is “fool-like”, it is only responsible for forwarding the client’s request to the receiver for execution. The advantage of this pattern is the decoupling of the request originator and receiver.</p><p>But we can also define some smarter commands that can directly implement requests. This kind of smart object is called “smart command”.</p><p>Commands without receivers degenerate to be very similar to the strategy pattern, and it is no longer possible to distinguish them from the code structure, only their purposes can be distinguished. The problem domain pointed to by the strategy pattern is smaller, and the goal of all policy objects is always the same. They are just different means to achieve this goal, and their internal implementation is for algorithms. The intelligent command pattern points to a wider problem domain, and the goals solved by the command object are more divergent. At the same time, the command pattern can undo, redo, and even execute the command object in turn in combination with queue buffering.</p><h1 id="Combination-mode"><a href="#Combination-mode" class="headerlink" title="Combination mode"></a>Combination mode</h1><p>In programming, we encounter this requirement that “things are made of similar child objects.” The composition pattern is to use small child objects to build larger objects, and these small child objects may themselves be made of smaller grandchildren.</p><p>For example, in the example of the macro command we just mentioned, marcoCommand is a composite object, and closeDoorCommand, openCommand, and openQQCommand are all leaf objects. In the execute method of marcoCommand, it does not actually perform the operation, but traverses all the leaf objects it contains and delegates the real execute request to these leaf objects.</p><p> <strong>marcoCommand behaves like a command, but it is really just a “proxy” for a set of real commands. Not a real proxy, although structurally similar, its purpose is not to control access to leaf objects.</strong></p><h2 id="Uses-of-the-combined-model"><a href="#Uses-of-the-combined-model" class="headerlink" title="Uses of the combined model"></a>Uses of the combined model</h2><p>The composition pattern combines objects into a tree structure to represent a “whole-part” hierarchy. In addition to representing the tree structure, another advantage of the composition pattern is that it can be represented by the polymorphism of objects, making the user’s use of single objects and combined objects consistent.</p><ul><li>Represents a tree structure. Through the example of macros, we can find an advantage of the combination pattern, providing a solution to traverse the tree structure. By calling the execute method of the combination object, the program will recursion call the execute method of the leaf object below the combination object. So our universal remote control only needs one operation to complete the door, open the computer, and open QQ in turn. The combination mode can very conveniently describe the hierarchy of the object part-whole.</li><li>Utilize the polymorphism of objects to treat combined objects and single objects uniformly. Using the polymorphic performance of objects, the Client can ignore the difference between combined objects and single objects. In the composition mode, the client will use all objects in the composition structure uniformly, regardless of whether it is a combined object or a single object.</li></ul><p>This will bring great convenience to customers in actual development. When we add a command to the universal remote control, we don’t care if the command is a macro command or a normal word command, we just need to know that it needs to have an execute method.</p><h2 id="More-powerful-macros"><a href="#More-powerful-macros" class="headerlink" title="More powerful macros"></a>More powerful macros</h2><p>Now we enhance our universal remote control, the function is as follows:</p><ul><li>Turn on the air conditioner</li><li>Turn on the TV and stereo</li><li>Close the door, turn on the computer, log in to QQ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">MarcoCommand</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">commandList</span>: [],</span><br><span class="line">        <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params">command</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">commandList</span>.<span class="title function_">push</span>(command);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">const</span> command <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">commandList</span>) &#123;</span><br><span class="line">                command.<span class="title function_">execute</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openAcCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Turn on the air conditioner&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openTvCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Turn on TV&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openSoundCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Turn on sound&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> marcoCommand1 = <span class="title class_">MarcoCommand</span>();</span><br><span class="line">marcoCommand1.<span class="title function_">add</span>(openTvCommand);</span><br><span class="line">marcoCommand1.<span class="title function_">add</span>(openSoundCommand);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> closeDoorCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Close the door&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Turn on the computer&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> openQQCommand = &#123;</span><br><span class="line">    <span class="attr">execute</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Login QQ&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> marcoCommand2 = <span class="title class_">MarcoCommand</span>();</span><br><span class="line">marcoCommand2.<span class="title function_">add</span>(closeDoorCommand);</span><br><span class="line">marcoCommand2.<span class="title function_">add</span>(openCommand);</span><br><span class="line">marcoCommand2.<span class="title function_">add</span>(openQQCommand);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> marcoCommand = <span class="title class_">MarcoCommand</span>();</span><br><span class="line">marcoCommand.<span class="title function_">add</span>(openAcCommand);</span><br><span class="line">marcoCommand.<span class="title function_">add</span>(marcoCommand1);</span><br><span class="line">marcoCommand.<span class="title function_">add</span>(marcoCommand2);</span><br><span class="line"></span><br><span class="line">marcoCommand.<span class="title function_">execute</span>();</span><br></pre></td></tr></table></figure><p>As can be seen from this example, basic objects can be combined into more complex composite objects, which can be combined by recursion.</p><h2 id="The-role-of-abstract-classes-in-composition-patterns"><a href="#The-role-of-abstract-classes-in-composition-patterns" class="headerlink" title="The role of abstract classes in composition patterns"></a>The role of abstract classes in composition patterns</h2><p>The biggest advantage of the combination mode is that it can treat the combination object and the base object consistently. The client does not need to know whether the macro command or the ordinary command is being processed. As long as it is a command and there is an execute method, the command can be added to the tree.</p><p>The convenience brought by this transparency is particularly obvious in statically typed languages. For example, in Java, the key to implementing the composition pattern is that both the Composite class and the Leaf class must inherit from a Component abstract class, which represents both composite objects and leaf objects, and it can also ensure that composite objects and leaf objects have methods with the same name.</p><p>However, in JavaScript, a dynamically typed language, the polymorphism of objects is innate, and there is no compiler to check the type of variables, so we usually do not simulate a weird abstract class. The point of implementing the composition pattern in JavaScript is to ensure that the composition object and the leaf object have the same method, which usually requires the idea of duck type for interface checking.</p><h2 id="Security-Issues-with-Transparency"><a href="#Security-Issues-with-Transparency" class="headerlink" title="Security Issues with Transparency"></a>Security Issues with Transparency</h2><p>The transparency of the composition pattern allows the requesting client to ignore the difference between the composition object and the leaf object in the tree, but they are actually different.</p><p>Composite objects can have sub-nodes, but leaf objects have no sub-nodes, so we may have some misoperations to add sub-nodes to the leaf object. The solution is usually to add an add method to the leaf object, but this method directly reports an error.</p><h2 id="Some-noteworthy-places"><a href="#Some-noteworthy-places" class="headerlink" title="Some noteworthy places"></a>Some noteworthy places</h2><p> <strong>1. Combination mode is not a parent-child relationship</strong></p><p>The tree structure of the combination pattern is easy to make people mistakenly think that the combination object and the leaf object are parent-child relationships, which is incorrect.</p><p>Composite pattern is a HAS-A relationship, not IS-A. Composite objects contain a set of leaf objects, but Leaf is not a subclass of Composite. Composite objects delegate requests to all the leaf objects they contain, and the key to their cooperation is having the same interface.</p><p> <strong>2. Operations on leaf objects are consistent</strong></p><p>In addition to requiring composite objects and leaf objects to have the same interface, there is a necessary condition that operations on a set of objects must be consistent.</p><p>For example, if a company wants to give all employees 1,000 yuan for the New Year’s Day holiday fee, the combination mode can be used in this scenario, but if the company sends a birthday wish to the employee who has a birthday today, the combination mode is useless, unless the birthday is first picked out. The combination mode can only be used if each leaf object in the list is treated in a consistent manner.</p><p> <strong>3. Bidirectional mapping relationship</strong></p><p>The notification steps for issuing savings fees are from the company to each department, to each group, and then to each employee’s mailbox. This in itself is a good example of a combination model, but some employees may belong to multiple organizational structures, and the objects are not strictly hierarchical, and it is not suitable for a combination model.</p><p>In this case, we must establish a two-way mapping relationship between parent and child nodes. A simple way is to add collections to both groups and employees to hold each other’s references. But this way of mutual reference is quite complicated, and there is too much coupling between objects, making it difficult to modify and delete an object. <strong>At this time, we can introduce the mediator pattern, which is a bit similar to the abstraction of immutable information into knowledge layers in the analysis pattern.</strong></p><p> <strong>4. Use Chain of Responsibility mode to improve portfolio mode performance</strong></p><p>In combination mode, if the structure of the tree is more complex and the number of nodes is large, the performance may not be ideal in the process of traversing the tree. Sometimes we can indeed use some tricks to avoid traversing the entire tree in practice.</p><p>One solution is to use the responsibility chain pattern. The responsibility chain pattern generally requires us to manually set up the chain, but in the composite mode, the relationship between parent and child objects naturally forms a chain. Let the request pass along the chain from the parent object to the child object, or vice versa. Until an object that can handle the request is encountered.</p><h2 id="When-to-use-combination-mode"><a href="#When-to-use-combination-mode" class="headerlink" title="When to use combination mode"></a>When to use combination mode</h2><ul><li><p>Represents the part-overall structure of an object. Composition mode can easily construct a tree to represent the part-overall structure of an object. Especially when we are not sure how many layers the tree has during development. After the construction of the tree is finally completed, we only need to request the topmost object of the tree to perform unified operations on the entire tree. Adding and deleting nodes in Composition mode is very convenient, which also complies with the Open Closed Principle.</p></li><li><p>The client wants to treat all objects in the tree uniformly. The composition mode allows the client to ignore the difference between the composition object and the leaf object. When the client faces the tree, he does not need to care whether the object currently being processed is a combination object or a leaf object, nor does he need to write a bunch of if-else to handle them. The combination object and the leaf object will each do the right thing.</p></li></ul><h1 id="Template-method-pattern"><a href="#Template-method-pattern" class="headerlink" title="Template method pattern"></a>Template method pattern</h1><p>There are not many scenarios where inheritance is used in JavaScript development, and many times we like to use mixins.</p><p>JavaScript doesn’t have classes, but it can inherit through prototypes. The template approach is an inheritance-based Design pattern.</p><h2 id="Definition-and-composition-of-template-method-patterns"><a href="#Definition-and-composition-of-template-method-patterns" class="headerlink" title="Definition and composition of template method patterns"></a>Definition and composition of template method patterns</h2><p>The template method is a very simple pattern that can be implemented simply by using inheritance.</p><p>The template method pattern consists of two parts, the first part is the abstract parent class, and the second part is the concrete implementation subclass. Usually, the algorithm framework of the subclass is encapsulated in the abstract parent class, including implementing some common methods and encapsulating the execution order of all methods in the subclass. Subclasses inherit the entire algorithm structure by inheriting this abstract parent class.</p><p>If we have some parallel subclasses, each subclass has some identical behavior and also some different behavior. If the same different behaviors are mixed in each subclass, it means that these same behaviors will be repeated in each subclass. But in fact, the same behavior can be put into a single place. Template methods solve this problem, the same parts of the subclass are moved to the parent class, and the different parts are left to the subclass to implement.</p><h2 id="An-example-Coffee"><a href="#An-example-Coffee" class="headerlink" title="An example - Coffee"></a>An example - Coffee</h2><p>Suppose we now want to make a cup of coffee and a cup of tea, the brewing process of the two is compared as follows:</p><div class="table-container"><table><thead><tr><th>make coffee</th><th>make tea</th></tr></thead><tbody><tr><td>Boil the water</td><td>Boil the water</td></tr><tr><td>Brew coffee with boiling water</td><td>Brew tea with boiling water</td></tr><tr><td>Pour coffee into a cup</td><td>Pour tea into a cup</td></tr><tr><td>With sugar and milk</td><td>With lemon</td></tr></tbody></table></div><p>Let’s write an abstract parent class first</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Beverage</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">boilWater</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Boil the water&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">brew</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pourInCup</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addCondiments</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">init</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">boilWater</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">brew</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">pourInCup</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">addCondiments</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then we make tea and coffee separately</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Coffee</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Coffee</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Beverage</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Coffee</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">brew</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;brew coffee with boiling water&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Coffee</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pourInCup</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;pour the coffee into the cup&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Coffee</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addCondiments</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Add sugar and milk&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> coffee = <span class="keyword">new</span> <span class="title class_">Coffee</span>();</span><br><span class="line">coffee.<span class="title function_">init</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Tea</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Tea</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Beverage</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Tea</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">brew</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Make tea with boiling water&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Tea</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pourInCup</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;pour the tea into the cup&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Tea</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addCondiments</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;add lemon&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tea = <span class="keyword">new</span> <span class="title class_">Tea</span>();</span><br><span class="line">tea.<span class="title function_">init</span>();</span><br></pre></td></tr></table></figure><p>Beverage.prototype.init is called a template method because it encapsulates the algorithm framework of the subclass, which serves as a template for an algorithm to guide the subclass to execute which methods in which order.</p><h2 id="Disadvantages-and-solutions-of-not-having-abstract-classes-in-JavaScript"><a href="#Disadvantages-and-solutions-of-not-having-abstract-classes-in-JavaScript" class="headerlink" title="Disadvantages and solutions of not having abstract classes in JavaScript"></a>Disadvantages and solutions of not having abstract classes in JavaScript</h2><p>JavaScript does not provide syntactic support for abstract classes. The first role of an abstract class is to hide the concrete type of an object. Since JavaScript is a “type obfuscation” language, the type of hidden object is not important in JavaScript Red.</p><p>On the other hand, when we use prototype inheritance in JavaScript to simulate traditional class-based inheritance, there is no compiler to help us with any form of checking, and there is no way to guarantee that subclasses will override abstract methods in their parent classes.</p><p>We offer two alternative solutions:</p><ul><li><p>Simulate interface checking with duck types to ensure that the methods of the parent class are indeed overridden in the subclass, but simulating interface checking will bring unnecessary complexity</p></li><li><p>Let methods such as Beverage.prototype.brew throw an exception directly. If we forget to write the’Coffee .prototype.init ‘method due to carelessness, we will at least get an error.</p></li></ul><h2 id="Usage-scenarios-of-template-methods"><a href="#Usage-scenarios-of-template-methods" class="headerlink" title="Usage scenarios of template methods"></a>Usage scenarios of template methods</h2><p>In general, this pattern is often used by architects to build the framework of a project. After the architect sets the skeleton of the framework, the programmer inherits the structure of the framework and is responsible for filling in the blanks.</p><h2 id="Hook-method"><a href="#Hook-method" class="headerlink" title="Hook method"></a>Hook method</h2><p>With the template method, we encapsulate the algorithm framework of the subclass in the parent class. This framework works fine under normal circumstances. But what if we meet someone who doesn’t like sugar and milk when drinking coffee.</p><p>At this time, we need to use the hook method. Placing a hook to isolate changes is a common method, such as:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Beverage</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">boilWater</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Boil the water&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">customerWantsCondiments</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">brew</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Throw</span> <span class="keyword">new</span> <span class="title class_">Error</span> (<span class="string">&#x27;Subclass must override brew method&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pourInCup</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Throw</span> <span class="keyword">new</span> <span class="title class_">Error</span> (<span class="string">&#x27;Subclass must override pourInCup method&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addCondiments</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Throw</span> <span class="keyword">new</span> <span class="title class_">Error</span> (<span class="string">&#x27;Subclass must override addCondiments method&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Beverage</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">init</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">boilWater</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">brew</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">pourInCup</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">customerWantsCondiments</span>()) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addCondiments</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Do-we-really-need-to-inherit"><a href="#Do-we-really-need-to-inherit" class="headerlink" title="Do we really need to inherit?"></a>Do we really need to inherit?</h2><p>The template method pattern is one of the few inheritance-based Design patterns, but JavaScript does not actually have a real class inheritance. Inheritance is achieved through the delegation between objects. That is to say, although we learn from the form of inheritance. The language of class inheritance, but such template methods are not authentic, and do we need to use inheritance to implement template methods?</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Beverage</span> = <span class="keyword">function</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> boilWater = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Boil the water&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> brew = params.<span class="property">brew</span> || <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Throw</span> <span class="keyword">new</span> <span class="title class_">Error</span> (<span class="string">&#x27;Subclass must override brew method&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pourInCup = params.<span class="property">pourInCup</span> || <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Throw</span> <span class="keyword">new</span> <span class="title class_">Error</span> (<span class="string">&#x27;Subclass must override pourInCup method&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> addCondiments = params.<span class="property">addCondiments</span> || <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Throw</span> <span class="keyword">new</span> <span class="title class_">Error</span> (<span class="string">&#x27;Subclass must override addCondiments method&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> F = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">init</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">boilWater</span>();</span><br><span class="line">        <span class="title function_">brew</span>();</span><br><span class="line">        <span class="title function_">pourInCup</span>();</span><br><span class="line">        <span class="title function_">addCondiments</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Coffee</span> = <span class="title class_">Beverage</span>(&#123;</span><br><span class="line">    <span class="attr">brew</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Make coffee with boiling water&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">pourInCup</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;pour the coffee into the cup&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">addCondiments</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Console</span>.<span class="property">log</span> (<span class="string">&#x27;Add sugar and milk&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>In JavaScritp, many times higher-order functions are more efficient than template methods.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/2022/12/30/javascript-design-pattern-4/" title="JavaScript Design pattern learning and practice (4)">https://sunra.top/en/2022/12/30/javascript-design-pattern-4/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/2022/12/24/javascript-design-pattern-3/" rel="prev" title="JavaScript Design pattern learning and practice (3)"><i class="fa fa-chevron-left"></i> JavaScript Design pattern learning and practice (3)</a></div><div class="post-nav-item"> <a href="/en/2023/01/04/leetcode-1802/" rel="next" title="Dichotomy Method for Solving the Optimum Problem of Bounded Interval">Dichotomy Method for Solving the Optimum Problem of Bounded Interval<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/2022/12/30/javascript-design-pattern-4/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>