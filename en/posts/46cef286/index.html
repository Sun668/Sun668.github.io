<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="OAuth 2.0 OAuth is an open web standard for authorization that is widely used around the world and is currently available in version 2.0"><meta property="og:type" content="article"><meta property="og:title" content="OAuth and OIDC"><meta property="og:url" content="https://sunra.top/en/posts/46cef286/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="OAuth 2.0 OAuth is an open web standard for authorization that is widely used around the world and is currently available in version 2.0"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2019-11-16T00:08:41.000Z"><meta property="article:modified_time" content="2024-07-02T00:25:58.749Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/posts/46cef286/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/46cef286/","path":"posts/46cef286/","title":"OAuth and OIDC"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>OAuth and OIDC | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#oauth-20"><span class="nav-number">1.</span> <span class="nav-text">OAuth 2.0</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#explanation-of-terms"><span class="nav-number">1.1.</span> <span class="nav-text">Explanation of terms</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#authorization-process"><span class="nav-number">1.2.</span> <span class="nav-text">Authorization Process</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#four-ways-to-get-authorization"><span class="nav-number">1.3.</span> <span class="nav-text">Four ways to get authorization</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#authorization-code-mode"><span class="nav-number">1.3.1.</span> <span class="nav-text">Authorization code mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#simplify-mode"><span class="nav-number">1.3.2.</span> <span class="nav-text">Simplify mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#password-mode"><span class="nav-number">1.3.3.</span> <span class="nav-text">password mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#client-mode"><span class="nav-number">1.3.4.</span> <span class="nav-text">Client Mode</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#update-token"><span class="nav-number">1.4.</span> <span class="nav-text">Update token</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#oidc"><span class="nav-number">2.</span> <span class="nav-text">OIDC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#difference"><span class="nav-number">2.1.</span> <span class="nav-text">Difference</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-introduction"><span class="nav-number">2.2.</span> <span class="nav-text">Process Introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#terminology"><span class="nav-number">2.3.</span> <span class="nav-text">Terminology</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#specific-process"><span class="nav-number">2.4.</span> <span class="nav-text">Specific process</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#authorization-code-process"><span class="nav-number">2.4.1.</span> <span class="nav-text">Authorization Code Process</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#authentication-request"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">authentication request</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#id-token"><span class="nav-number">2.4.1.1.1.</span> <span class="nav-text">ID token</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#default-process"><span class="nav-number">2.4.2.</span> <span class="nav-text">Default Process</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#userinfo-endpoint"><span class="nav-number">2.5.</span> <span class="nav-text">UserInfo Endpoint</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#a-little-thinking-about-oauth"><span class="nav-number">3.</span> <span class="nav-text">A little thinking about OAuth</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/46cef286/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="OAuth and OIDC | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> OAuth and OIDC</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-11-16 08:08:41" itemprop="dateCreated datePublished" datetime="2019-11-16T08:08:41+08:00">2019-11-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-07-02 08:25:58" itemprop="dateModified" datetime="2024-07-02T08:25:58+08:00">2024-07-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Security/" itemprop="url" rel="index"><span itemprop="name">Security</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/46cef286/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/46cef286/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="oauth-20"><a class="markdownIt-Anchor" href="#oauth-20"></a> OAuth 2.0</h2><p>OAuth is an open web standard for authorization that is widely used around the world and is currently available in version 2.0</p><span id="more"></span><h3 id="explanation-of-terms"><a class="markdownIt-Anchor" href="#explanation-of-terms"></a> Explanation of terms</h3><ul><li><p><strong>Third-party application</strong>: Third-party application, also known as “client” in this document.</p></li><li><p><strong>HTTP Service</strong>: HTTP Service Provider, referred to as “Service Provider” in this document.</p></li><li><p><strong>Resource Owner</strong>: The person who owns the resource, also known as the “user” in this document.</p></li><li><p><strong>User Agent</strong>: User agent, in this article, means browser.</p></li><li><p><strong>Authorization server</strong>: Authentication server, i.e., the server dedicated by the service provider to handle authentication.</p></li><li><p><strong>Resource server</strong>: Resource server, i.e., the server where the service provider stores user-generated resources. It can be the same server as the authentication server, or a different server.</p></li></ul><p>OAuth sets up an authorization layer between the “client” and the “service provider”. The “client” cannot log in directly to the “service provider”, but only to the authorization layer, thus distinguishing the user from the client. The token used by the “client” to log in to the authorization layer is different from the user’s password. The user can specify the scope of authority and validity of the authorization token at the time of login.</p><p>After the “client” logs in to the authorization layer, the “service provider” opens the user’s stored data to the “client” according to the scope and validity of the token.</p><h3 id="authorization-process"><a class="markdownIt-Anchor" href="#authorization-process"></a> Authorization Process</h3><ol><li><p>After the user opens the client, the client asks the user to give authorization.</p></li><li><p>The user agrees to give the client authorization.</p></li><li><p>The client uses the authorization obtained in the previous step to request a token from the authentication server.</p></li><li><p>After the authentication server authenticates the client, it confirms that there is no error and agrees to issue the token.</p></li><li><p>The client uses the token to request access to resources from the resource server.</p></li><li><p>The resource server confirms that the token is correct and agrees to open the resource to the client.</p></li></ol><p>The key in these steps is how the client obtains authorization, OAuth 2.0 defines four different ways to obtain authorization.</p><h3 id="four-ways-to-get-authorization"><a class="markdownIt-Anchor" href="#four-ways-to-get-authorization"></a> Four ways to get authorization</h3><p>OAuth 2.0 defines four types of authorization.</p><ul><li>Authorization code mode (authorization code)</li><li>Simplification mode (implicit)</li><li>密码模式（resource owner password credentials）</li><li>Client mode (client credentials)</li></ul><h4 id="authorization-code-mode"><a class="markdownIt-Anchor" href="#authorization-code-mode"></a> Authorization code mode</h4><p>(A) The user accesses the client, which directs the former to the authentication server.</p><p>(B) The user chooses whether to grant authorization to the client.</p><p>© Assuming that the user gives authorization, the authentication server directs the user to the redirection URI specified by the client in advance, along with an authorization code.</p><p>(D) The client receives the authorization code, attaches the earlier “redirect URI” and requests a token from the authentication server. This step is done on the server in the backend of the client and is not visible to the user.</p><p>(E) The authentication server verifies the authorization code and redirect URI, and then sends an access token and a refresh token to the client after confirming that there are no errors.</p><p>The URI of the client requesting authentication in step A, contains the following parameters:</p><ul><li>response_type: indicates the authorization type, mandatory, the value here is fixed to “code”</li><li>client_id: the ID of the client, required</li><li>redirect_uri: means redirect URI, optional</li><li>scope: indicates the scope of the requested permission, optional</li><li>state: indicates the current state of the client, you can specify any value, the authentication server will return this value unchanged.</li></ul><p>In step C, the server responds to the client’s URI with the following parameters:</p><ul><li>code: indicates the authorization code, mandatory. The validity of this code should be very short, usually set to 10 minutes, the client can only use this code once, otherwise it will be rejected by the authorization server. The code is in one-to-one correspondence with the client ID and the redirect URI.</li><li>state: If the client’s request contains this parameter, the authentication server’s response must also contain this parameter in exactly the same way.</li></ul><p>In step D, the HTTP request for a token from the client to the authentication server contains the following parameters:</p><ul><li>grant_type: indicates the authorization mode used, mandatory, the value here is fixed to “authorization_code”.</li><li>code: indicates the authorization code obtained in the previous step, mandatory.</li><li>redirect_uri: indicates the redirect URI, mandatory, and must be consistent with the value of this parameter in step A.</li><li>client_id: the client ID, mandatory.</li></ul><p>The HTTP reply sent by the authentication server in step E, contains the following parameters:</p><ul><li>access_token: indicates the access token, mandatory.</li><li>token_type: indicates the token type, the value is case-insensitive, mandatory, can be bearer type or mac type.</li><li>expires_in: indicates the expiration time in seconds. If this parameter is omitted, the expiration time must be set in some other way.</li><li>refresh_token: indicates the refresh token, which is used to get the next access token, optional.</li><li>scope: indicates the scope of the permission, if the scope is the same as the client application, this item can be omitted.</li></ul><h4 id="simplify-mode"><a class="markdownIt-Anchor" href="#simplify-mode"></a> Simplify mode</h4><p>The simplicit grant type requests a token directly from the authentication server in the browser without going through the server of the third-party application, skipping the “authorization code” step, hence the name. All steps are done in the browser, the token is visible to the visitor, and the client does not need to authenticate.</p><p>(A) The client directs the user to the authentication server.</p><p>(B) The user decides whether to give authorization to the client.</p><p>© Assuming the user gives authorization, the authentication server directs the user to the “redirect URI” specified by the client and includes the access token in the hash portion of the URI.</p><p>(D) The browser sends a request to the resource server, which does not include the Hash value received in the previous step.</p><p>(E) The resource server returns a web page that contains code to get the token in the Hash value.</p><p>(F) The browser executes the script obtained in the previous step and extracts the token.</p><p>(G) The browser sends the token to the client.</p><h4 id="password-mode"><a class="markdownIt-Anchor" href="#password-mode"></a> password mode</h4><p>In password mode (Resource Owner Password Credentials Grant), the user provides the client with his or her username and password. The client uses this information to request authorization from the “service provider”.</p><p>In this model, the user must give his password to the client, but the client must not store it. This is usually used in cases where the user has a high level of trust in the client, such as when the client is part of the operating system or produced by a reputable company. The authentication server should only consider using this mode if other authorization modes cannot be implemented.</p><p>(A) The user provides the user name and password to the client.</p><p>(B) The client sends the user name and password to the authentication server and requests a token from the latter.</p><p>© After the authentication server confirms that there is no error, it provides the access token to the client.</p><p>In step B, the client sends an HTTP request with the following parameters:</p><ul><li>grant_type: the authorization type, the value here is fixed to “password”, mandatory.</li><li>username: user name, required.</li><li>password: the password of the user, mandatory.</li><li>scope: the scope of the permission, optional.</li></ul><h4 id="client-mode"><a class="markdownIt-Anchor" href="#client-mode"></a> Client Mode</h4><p>Client mode (Client Credentials Grant) means that the client authenticates to the “service provider” in its own name, rather than in the name of the user. Strictly speaking, the client mode is not part of the OAuth framework to solve the problem. In this model, the user registers directly with the client, and the client asks the “service provider” to provide services in its own name, so there is no authorization problem.</p><h3 id="update-token"><a class="markdownIt-Anchor" href="#update-token"></a> Update token</h3><p>If the client’s “access token” has expired when the user accesses, you need to use the “update token” to request a new access token.</p><p>The client sends an HTTP request to update the token, containing the following parameters:</p><ul><li>grant<em>type: indicates the authorization mode used, the value here is fixed to &quot;refresh</em>token&quot;, mandatory.</li><li>refresh_token: indicates the update token received earlier, mandatory.</li><li>scope：Indicates the authorization scope of the application, which cannot exceed the scope of the previous application. If this parameter is omitted, it means the same as the previous one.</li></ul><h2 id="oidc"><a class="markdownIt-Anchor" href="#oidc"></a> OIDC</h2><p>OpenID Connect is an interoperable authentication protocol based on the OAuth 2.0 family of specifications. It is implemented using simple REST / JSON message flows and can be easily integrated by developers compared to any previous authentication protocol.</p><p>OpenID Connect allows developers to authenticate users across websites and applications without the need to own and manage password files. openID Connect allows all types of clients, including browser-based<a target="_blank" rel="external nofollow noopener noreferrer" href="https://link.jianshu.com?t=http://lib.csdn.net/base/javascript">JavaScript</a>and native mobile applications, start the login flow and receive verifiable assertions about the identity of the logged-in user.</p><p>Briefly, <em>OIDC</em> is a security mechanism for applications to connect to an Identity Service to obtain user information and return that information to the application in a secure and reliable way.</p><h3 id="difference"><a class="markdownIt-Anchor" href="#difference"></a> Difference</h3><p><strong>OpenID</strong> is <em>Authentication</em>, which authenticates the user’s identity and determines whether it is valid, i.e., lets the site know that “you are the user you claim to be”;</p><p><strong>OAuth</strong> is <em>Authorization</em>, which is the authorization of a user to allow certain actions when the user’s identity is known to be legitimate, i.e., to let the site know “you are allowed to do those things”.<br> It is clear from this that authorization is done after authentication, and only if the user’s identity is determined can authorization be granted.</p><p><em>OpenID Connect</em> is a combination of “authentication” and “authorization”, and because it is based on the <em>OAuth</em> protocol, the <em>OpenID-Connect</em> protocol also contains the <strong>client_id</strong>, <strong>client_secret</strong> and <strong>redirect_uri</strong> fields. The <em>OpenID-Connect</em> protocol also contains fields such as <strong>client_id</strong>, <strong>client_secret</strong> and <strong>redirect_uri</strong>. This information is stored in the “authentication server” to ensure that specific clients receive information only from legitimate application platforms. This is done in order to prevent <em>client_id</em> leaks from causing malicious websites to initiate <em>OIDC</em> processes.</p><h3 id="process-introduction"><a class="markdownIt-Anchor" href="#process-introduction"></a> Process Introduction</h3><p><em>OAuth2</em> provides <em>Access Token</em> to solve the problem of authorizing third-party clients to access protected resources; similarly, <em>OIDC</em> provides <em>ID Token</em> on top of this to solve the problem of identifying user authentication by third-party clients. The core of <em>OIDC</em> is to provide the user’s authentication information (<em>ID-Token</em>) to the third-party client along with the authorization process of <em>OAuth2</em>, <em>ID-Token</em> is wrapped using <strong>JWT</strong> format, thanks to<a href="https://sunra.top/posts/1bb08f7a/">JWT</a>The self-contained, compact, and tamper-proof mechanism of <em>ID-Token</em> allows it to be securely passed to third-party client applications and easily verified. There should be a server that uses the <em>Access-Token</em> interface to <em>UserInfo</em> to exchange more information about the user after verifying that the <em>ID-Token</em> is correct.</p><p>It is clear from the above that <em>OIDC</em> follows the <em>OAuth</em> protocol flow and returns an <em>ID-Token</em> to authenticate the user’s identity while applying for an <em>Access-Token</em>.</p><h3 id="terminology"><a class="markdownIt-Anchor" href="#terminology"></a> Terminology</h3><p><strong>EU</strong>: End User, user.</p><p><strong>RP</strong>: Relying Party , used to refer to a trusted client in <em>OAuth2</em>, the consumer of authentication and authorization information;</p><p><strong>OP</strong>: OpenID Provider, a service provider with the ability to provide EU authentication (such as the authorization service in <em>OAuth2</em>), used to provide the RP with EU authentication information;</p><p><strong>ID-Token</strong>: data in JWT format, containing information about EU identity authentication.</p><p><strong>UserInfo Endpoint</strong>: user information interface (protected by <em>OAuth2</em>) that returns information about an authorized user when the RP is accessed using <em>Access-Token</em>, this interface must use <em>HTTPS</em>.</p><h3 id="specific-process"><a class="markdownIt-Anchor" href="#specific-process"></a> Specific process</h3><p>If it is a JS application where all its code is exposed by being loaded into the browser and no backend can secure <em>client_secret</em>, then it needs to be using <strong>Default Mode Flow</strong> (Implicit Flow).</p><p>If it is a traditional client-side application, the back-end code and the user are isolated and can ensure that <em>client_secret</em> is not leaked, you can use <strong>Authorization Code Pattern Flow</strong> (Authentication Flow).</p><p>There is also <strong>Hybrid Flow</strong>, which in short is a fusion of the above two.</p><h4 id="authorization-code-process"><a class="markdownIt-Anchor" href="#authorization-code-process"></a> Authorization Code Process</h4><p>RP sends an <strong>authentication request</strong> to the OP with a <em>client_id</em> attached;</p><p>The OP authenticates the EU;</p><p>The OP returns a response, sending the authorization code to the RP;</p><p>The RP uses the authorization code to request the ID-Token and Access-Token from the OP, which is verified by the RP and returned to the RP;</p><p>RP sends a request to <em>UserInfo EndPoint</em> using the Access-Token; UserInfo EndPoint returns the EU’s Claims.</p><h5 id="authentication-request"><a class="markdownIt-Anchor" href="#authentication-request"></a> authentication request</h5><p>RP uses OAuth2’s Authorization-Code approach to complete user authentication, and all Tokens are passed through the OP’s Token EndPoint (<a target="_blank" rel="external nofollow noopener noreferrer" href="https://link.jianshu.com?t=https://tools.ietf.org/html/rfc6749#section-3.2">OAuth2中定义</a>) to be issued. To construct an Authentication Request for OIDC, the following parameters are required:</p><ul><li>scope: Mandatory. oidc requests must contain the parameter “openid” for the scope.</li><li>response_type: mandatory. Same as OAuth2.</li><li>client_id: mandatory. Same as OAuth2.</li><li>redirect_uri: Required. Same as OAuth2.</li><li>state: Recommended. Same as OAuth2. prevents CSRF, XSRF.</li></ul><p>After the OP receives the authentication request, it needs to do strict validation of the request parameters, and the specific rules are described in<a target="_blank" rel="external nofollow noopener noreferrer" href="https://link.jianshu.com?t=http://openid.net/specs/openid-connect-core-1_0.html#AuthRequestValidation">http://openid.net/specs/openid-connect-core-1_0.html#AuthRequestValidation</a>After the authentication has passed, the EU is directed to authenticate and agree to the authorization. After this is done, it redirects to the callback address specified by the RP (<em>redirect_uri</em>) and passes the <strong>code</strong> and <strong>state</strong> parameters.</p><p>RP uses the <em>code</em> obtained in the previous step to request Token EndPoint, a step that buckets <em>OAuth2</em> and will not be expanded in detail. The Token EndPoint then returns the response Token, which has an additional <em>id_token</em> field in addition to some of the data specified by <em>OAuth2</em>. The <em>id_token</em> field is the <em>ID Token</em> mentioned above.</p><h6 id="id-token"><a class="markdownIt-Anchor" href="#id-token"></a> ID token</h6><p>As mentioned above <em>OIDC</em>’s most significant extension to <em>OAuth2</em> is the provision of <em>ID-Token</em>. Let’s take a look at the main components of <em>ID-Token</em>:</p><ul><li><strong>iss = Issuer Identifier</strong>: Required. Unique identifier of the person providing the authentication information. Usually the host+path part of the Url;</li><li><strong>sub = Subject Identifier</strong>: must. unique identifier of the EU provided by iss; maximum of 255 ASCII characters;</li><li><strong>aud = Audience(s)</strong>: required. Identifies the audience of the <em>ID-Token</em>. Must contain the client_id of <em>OAuth2</em>;</li><li><strong>exp = Expiration time</strong>: required. Expiration time of <em>ID-Token</em>;</li><li><strong>iat = Issued At Time</strong>: must. time of the JWT build.</li><li><strong>auth_time = AuthenticationTime</strong>: the time when the EU completes authentication. This Claim is required if the RP carries the <em>max_age</em> parameter when sending the authentication request.</li><li><strong>nonce</strong>: random string provided by the RP when sending the request, used to mitigate replay attacks and also to associate the <em>ID-Token</em> with the RP’s own Session information.</li><li><strong>acr = Authentication Context Class Reference</strong>: optional. Indicates an authentication context reference value that can be used to identify an authentication context class.</li><li><strong>amr = Authentication Methods References</strong>: optional. Indicates a set of authentication methods.</li><li><strong>azp = Authorized party</strong>: optional. Used in combination with aud. This value is only used if the authenticated party and the audience (aud) do not agree, and is rarely used in general.</li></ul><h4 id="default-process"><a class="markdownIt-Anchor" href="#default-process"></a> Default Process</h4><p>The default process is similar to the one in <em>OAuth</em>, except that it also adds <em>ID-Token</em> related content.</p><p>It is important to note here that the <em>OIDC</em> documentation makes it very clear that all user-related information is to be encoded using the <strong>JWT</strong> form. In <em>JWT</em>, no sensitive data should be included in the load. If the transfer is the User ID of the user, this value is not actually sensitive and is generally safe to be known.</p><h3 id="userinfo-endpoint"><a class="markdownIt-Anchor" href="#userinfo-endpoint"></a> UserInfo Endpoint</h3><p>Some readers may have noticed that <em>ID-Token</em> only sub is related to EU, which is not enough in general, other information such as EU username, avatar, etc. must also be needed, <em>OIDC</em> provides a set of public cliams to provide more information about the user, which is - UserIndo EndPoin.</p><p>After RP gets the Access Token, it can request this resource and then get a set of EU-related Claims, which can be said to be an extension of <em>ID-Token</em>, <em>ID-Token</em> only needs to contain the unique identification sub of EU (to avoid the ID Token being too large and exposing the user’s sensitive information), and then after getting the complete EU’s information through this interface. This resource <strong>must be deployed on top of TLS</strong></p><h2 id="a-little-thinking-about-oauth"><a class="markdownIt-Anchor" href="#a-little-thinking-about-oauth"></a> A little thinking about OAuth</h2><p>User: User</p><p>User Agent: User agent, such as a browser</p><p>Consumer: Information consumer, such as Leetcode</p><p>Service Provider: There are two service providers, the Identity Provider (IDP), such as QQ, and the Resource Provider, but they are generally the same.</p><p>OAuth is not designed to solve security or performance problems.</p><p>OAuth also does not save the login state in the Consumer for us.</p><p>The purpose of OAuth appeared is to help us associate multiple application accounts with a third-party account, it is the user who gives the permission to the consumer in SP, not the permission to the user in the consumer. We have not lost one account, but established a one-to-many relationship, similar to if we want to get a driver’s license, we need to use our ID card, and authorize the driving school to use our ID card information to go to the Public Security Bureau to confirm our existence and retrieve some other information. But that’s where it ends, and what happens next has nothing to do with OAuth.</p><p>The IDP cannot and has no responsibility to save any information of the user in the consumer, it just tells the consumer some information in the case of user authorization.</p><p>The first time is for the IDP to set the location in the return 302, you can not verify whether it is set by the consumer, the second time is to verify whether the redirect_uri is set by you in the IDP, and whether it is the same as the first time over, this step must be verified, because this step is the most critical, this step will return the token.</p><p>In the end, I still can’t trust my comrade browser, so I let him be a tool to help my own backend to apply for an authorization code to a third party, and then give this authorization code to my own backend, and then my own backend use this code to apply for a token to a third party, and then I don’t tell my browser afterwards. This token is what, they left, that is to say, the browser comrades from beginning to end have not seen the token.</p><p>What is the use of Secret? The reason is that IDPs don’t believe in anyone, they believe in the secret they give out. because redirect_uri is the domain name, and ultimately where it goes still depends on the IP address, if the domain name is right, but the domain name is pointed to their IP by the attacker, the attacker will receive the token. how to modify this DNS pointing involves DNS pollution, because DNS will cache layers, but then there is time. But then there is time, if you keep broadcasting to tell the router or host I am leetcode, I am leetcode, over time you are considered as leetcode in this piece of LAN. But if you have a secret, even if you come over to IDP with code, without the secret I gave you, IDP will not give token. so client_id shows who you are, only if you give client_secret, IDP will believe what you say and give you token, so this secret is very important, our The backend will not believe the browser comrades, so our browser comrades from the beginning to the end also did not touch the secret.</p><p>And what is the use of State? Similar to the defense of CSRF, to ensure the consistency of the request device, but not like CSRF is to forge the victim’s request, but let the victim login to their own account, if the victim in it to save a bitcoin account would not be beautiful? The specific implementation is the attacker logged in, the normal application, but to the IDP returned 302 after the request to stop, do not allow the browser to send requests to their own background, and then the request link with code to the victim, the victim clicked in to get access_token to successfully log in, if you do not pay attention to this account is not their own upload sensitive information, it is very happy. If there is a state, different devices my background are generated a random string to the front end, the attacker even if the request to the victim, he does not know the state of the victim’s device, the background take a look at your state and just said that the state is not the same, it will directly throw away the request, of course, to say that the attacker to your state from the huge Internet of A certain request to steal to, that is also the absolute, this belongs to the fixed-point blast, is to mess with you, then this person has mostly mixed in your side.</p><p>Why will finally return two token because one represents who you are and one represents what you can do, what you can do can be changed by the administrator at any time, but who you are is fixed, and the general access_token expiration time is relatively short, if I use it expired, can not let the user re-login it, that is not back to the beginning?</p><p>After all, these designs are stuck above the transport layer, so what if I mess with your network layer? I then spread an ARP virus? Engage the link layer is a bit exaggerated.</p><p>Reference article:</p><p><a href="https://sunra.top/posts/46cef286/">https://sunra.top/2019/11/16/OAuth%20and%20OIDC/</a> ：OAuth，OIDC简介</p><p><a href="https://sunra.top/posts/74ee5df7/">https://sunra.top/posts/74ee5df7/</a> : Routing Protocol</p><p><a href="https://sunra.top/posts/dfdf7442/">https://sunra.top/posts/dfdf7442/</a> : ARP principle and defense</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/0db71eb445c8">https://www.jianshu.com/p/0db71eb445c8</a> : Example of OAuth authentication process</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html">https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html</a> ：OAuth2.0中的安全考虑</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.cnblogs.com/linianhui/p/openid-connect-core.html">https://www.cnblogs.com/linianhui/p/openid-connect-core.html</a> ：OIDC文档</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.zhihu.com/question/19851243">https://www.zhihu.com/question/19851243</a> : OAuth1.0 and 2.0 difference</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.azure.cn/zh-cn/active-directory/azuread-dev/v1-protocols-openid-connect-code">https://docs.azure.cn/zh-cn/active-directory/azuread-dev/v1-protocols-openid-connect-code</a> ：OIDC + AAD</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.sciencedirect.com/science/article/pii/S2215098617316750">https://www.sciencedirect.com/science/article/pii/S2215098617316750</a> : Security issues faced in cloud services</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy</a> ：同源策略</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/46cef286/" title="OAuth and OIDC">https://sunra.top/en/posts/46cef286/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/44fbc7d1/" rel="prev" title="Session Fixation Principle and Defense"><i class="fa fa-chevron-left"></i> Session Fixation Principle and Defense</a></div><div class="post-nav-item"> <a href="/en/posts/a8bec924/" rel="next" title="passport-azure-ad_ infinite refresh problem">passport-azure-ad_ infinite refresh problem<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/46cef286/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>