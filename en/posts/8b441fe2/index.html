<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Loader is an important concept in Webpack that can help us do what we want when loading certain types of files, such as automatically adding try catch to all JavaScript functions."><meta property="og:type" content="article"><meta property="og:title" content="Webpack Loader API"><meta property="og:url" content="https://sunra.top/en/posts/8b441fe2/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Loader is an important concept in Webpack that can help us do what we want when loading certain types of files, such as automatically adding try catch to all JavaScript functions."><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2020-02-22T02:44:20.000Z"><meta property="article:modified_time" content="2023-09-28T07:11:26.005Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/posts/8b441fe2/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/8b441fe2/","path":"posts/8b441fe2/","title":"Webpack Loader API"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Webpack Loader API | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-simplest-loader"><span class="nav-number">1.</span> <span class="nav-text">The simplest loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Synchronization"><span class="nav-number">1.1.</span> <span class="nav-text">Synchronization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Asynchronous"><span class="nav-number">1.2.</span> <span class="nav-text">Asynchronous</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Loader"><span class="nav-number">2.</span> <span class="nav-text">Loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#this-query"><span class="nav-number">2.1.</span> <span class="nav-text">this.query&#96;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-callback"><span class="nav-number">2.2.</span> <span class="nav-text">this.callback</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-async"><span class="nav-number">2.3.</span> <span class="nav-text">this.async</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-version"><span class="nav-number">2.4.</span> <span class="nav-text">this.version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-context"><span class="nav-number">2.5.</span> <span class="nav-text">this.context</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-rootContext"><span class="nav-number">2.6.</span> <span class="nav-text">this.rootContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-request"><span class="nav-number">2.7.</span> <span class="nav-text">this.request</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Advanced-Loader"><span class="nav-number">3.</span> <span class="nav-text">Advanced Loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%9CRaw%E2%80%9D"><span class="nav-number">3.1.</span> <span class="nav-text">“Raw”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crossed"><span class="nav-number">3.2.</span> <span class="nav-text">Crossed</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/8b441fe2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Webpack Loader API | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Webpack Loader API</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-02-22 10:44:20" itemprop="dateCreated datePublished" datetime="2020-02-22T10:44:20+08:00">2020-02-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-09-28 15:11:26" itemprop="dateModified" datetime="2023-09-28T15:11:26+08:00">2023-09-28</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Webpack/" itemprop="url" rel="index"><span itemprop="name">Webpack</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/8b441fe2/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/8b441fe2/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Loader is an important concept in Webpack that can help us do what we want when loading certain types of files, such as automatically adding try catch to all JavaScript functions.</p><span id="more"></span><p>The so-called loader is just a JavaScript module exported as a function.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/webpack/loader-runner">loader runner</a> The function will be called, and then the result of the previous loader or resource file will be passed in. The’this’ context of the function will be filled by webpack, and <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/webpack/loader-runner">loader runner</a> There are some useful methods to change the loader to be called asynchronously, or to obtain query parameters.</p><p>The first loader has only one input parameter: the content of the resource file. The compiler needs to get the processing result produced by the last loader. This processing result should be’String ‘or’Buffer’ (converted to a string), representing the JavaScript source code of the module. In addition, an optional SourceMap result (formatted as a JSON object) can be passed.</p><p>If it is a single processing result, it can be returned directly in <strong>Synchronization Mode</strong> . If there are multiple processing results, ‘this.callback () ‘ must be called. In <strong>Asynchronous Mode</strong> , ‘this.async () ‘ must be called to indicate <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/webpack/loader-runner">loader runner</a> Waiting for the asynchronous result, it will return’this.callback () ‘callback function, and then the loader must return’undefined’ and call the callback function.</p><h2 id="The-simplest-loader"><a href="#The-simplest-loader" class="headerlink" title="The simplest loader"></a>The simplest loader</h2><h3 id="Synchronization"><a href="#Synchronization" class="headerlink" title="Synchronization"></a>Synchronization</h3><p>Either’return ‘or’this.callback’ can return the converted’content ‘content synchronously:</p><p><strong>sync-loader.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">someSyncOperation</span>(content);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>The this.callback method is more flexible because it allows multiple parameters to be passed, not just content.</p><p>The content here is the incoming source code. someSyncOperation is our custom method for processing the source code, and finally returns the processing result through return.</p><p><strong>sync-loader-with-multiple-results.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">callback</span>(<span class="literal">null</span>, <span class="title function_">someSyncOperation</span>(content), map, meta);</span><br><span class="line">  <span class="title class_">Return</span>;<span class="comment">//always returns undefined when calling callback ()</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>The map here is actually scourceMap.</p><h3 id="Asynchronous"><a href="#Asynchronous" class="headerlink" title="Asynchronous"></a>Asynchronous</h3><p>For asynchronous loaders, use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/api/loaders#this-async"><code>this.async</code></a> To get the callback function:</p><p><strong>async-loader.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  <span class="title class_">Var</span> callback = <span class="variable language_">this</span>.<span class="property">async</span> (); <span class="comment">// tell the loader-runner to wait for the return of the function</span></span><br><span class="line">  <span class="title function_">someAsyncOperation</span>(content, <span class="keyword">function</span>(<span class="params">err, result</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">callback</span>(err);</span><br><span class="line">    <span class="title function_">callback</span>(<span class="literal">null</span>, result, map, meta);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>async-loader-with-multiple-results.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> callback = <span class="variable language_">this</span>.<span class="title function_">async</span>();</span><br><span class="line">  <span class="title function_">someAsyncOperation</span>(content, <span class="keyword">function</span>(<span class="params">err, result, sourceMaps, meta</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">callback</span>(err);</span><br><span class="line">    <span class="title function_">callback</span>(<span class="literal">null</span>, result, sourceMaps, meta);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>This. aysnc told <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/webpack/loader-runner">loader-runner</a> The loader will call back asynchronously. Returns’this.callback ‘. So its parameters are the same as this.callback.</p><h2 id="Loader"><a href="#Loader" class="headerlink" title="Loader"></a>Loader</h2><p>Here only the commonly used methods and parameters are listed, explained and added some notes. More configuration can be seen directly<a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/api/loaders/#this-version">文档</a></p><p>The loader context represents some method or property that can be accessed within the loader using’this’.</p><p>Suppose we request to load another module like this: In ‘/abc/file.js’:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./loader1?xyz!loader2!./resource?rrr&#x27;</span>);</span><br></pre></td></tr></table></figure><p>The above import method is a method provided by webpack. This import method specifies which loader is used to load the final file. The loader is specified before the exclamation mark. This method can override the configuration in webpack.config.</p><p>You can see the specifics.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/concepts/loaders/">loader 概念文档</a></p><h3 id="this-query"><a href="#this-query" class="headerlink" title="this.query`"></a>this.query`</h3><ol><li>If this loader is configured <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/configuration/module/#useentry"><code>options</code></a> Object, ‘this.query’ points to this option object.</li><li>If there is no’options’ in the loader and it is called with query string as an argument, ‘this.query’ is a string starting with ‘?’.</li></ol><p>In the official doc, we are prompted to use the getOptions method provided by loader-utils to get options, because if the value in options is not a simple string, there will occasionally be some problems. The specific usage method is:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack config</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: ...,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">            		<span class="attr">loader</span>: <span class="string">&#x27;loader.js&#x27;</span>,</span><br><span class="line">            		<span class="attr">options</span>: &#123;</span><br><span class="line">            			<span class="attr">name</span>: <span class="string">&#x27;Ray&#x27;</span></span><br><span class="line">        			&#125;</span><br><span class="line">            	&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader.js</span></span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">&#x27;loader-utils&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">content</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> options = loaderUtils.<span class="title function_">getOptions</span>(<span class="variable language_">this</span>)</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(options.<span class="property">name</span>);  <span class="comment">//Ray</span></span><br><span class="line">	<span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="this-callback"><a href="#this-callback" class="headerlink" title="this.callback"></a><code>this.callback</code></h3><p>A function that returns multiple results and can be called synchronously or asynchronously. The expected parameters are:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">callback</span>(</span><br><span class="line">  <span class="attr">err</span>: <span class="title class_">Error</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">content</span>: string | <span class="title class_">Buffer</span>,</span><br><span class="line">  sourceMap?: <span class="title class_">SourceMap</span>,</span><br><span class="line">  meta?: any</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol><li>The first argument must be’Error ‘or’null’</li><li>The second parameter is a’string ‘or <a target="_blank" rel="external nofollow noopener noreferrer" href="https://nodejs.org/api/buffer.html"><code>Buffer</code></a>。<br>Optional: The third parameter must be one that can be used by<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/mozilla/source-map">这个模块</a>Parsed source map.</li><li>Optional: The fourth option, which will be ignored by webpack, can be anything (such as some metadata).</li></ol><blockquote><p>Syntax Tree (abstract)</p></blockquote><p>If this function is called, you should return undefined to avoid ambiguous loader results.</p><h3 id="this-async"><a href="#this-async" class="headerlink" title="this.async"></a><code>this.async</code></h3><p>Tell <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/webpack/loader-runner">loader-runner</a> The loader will call back asynchronously. Returns’this.callback ‘.</p><h3 id="this-version"><a href="#this-version" class="headerlink" title="this.version"></a><code>this.version</code></h3><p> <strong>The version number of the loader API.</strong> Currently ‘2’. This has some use for backward compatibility. With this version number, you can write different logic for breaking changes between different versions, or downgrade.</p><h3 id="this-context"><a href="#this-context" class="headerlink" title="this.context"></a><code>this.context</code></h3><p> <strong>Directory where the module is located.</strong> Can be used as a context for resolving paths to other modules.</p><p>In our example: this attribute is’/abc ‘because’resource.js’ is in this directory</p><h3 id="this-rootContext"><a href="#this-rootContext" class="headerlink" title="this.rootContext"></a><code>this.rootContext</code></h3><p>Starting from webpack 4, the original’this.options.context ‘has been improved to’this.rootContext’.</p><h3 id="this-request"><a href="#this-request" class="headerlink" title="this.request"></a><code>this.request</code></h3><p>The parsed request string.</p><p>In our example:</p><p><code>&quot;/abc/loader1.js?xyz!/abc/node_modules/loader2/index.js!/abc/resource.js?rrr&quot;</code></p><p>How did this result come about?</p><p>First of all, because our resource.js, loader1, loader2 root directory abc directory, so the front will add “abc/“, and loader2 in front of no relative path, so it is considered to be node_modules module, will add a “node_modules/“</p><h2 id="Advanced-Loader"><a href="#Advanced-Loader" class="headerlink" title="Advanced Loader"></a>Advanced Loader</h2><h3 id="“Raw”"><a href="#“Raw”" class="headerlink" title="“Raw”"></a>“Raw”</h3><p>By default, the resource file will be converted to a UTF-8 string and then passed to the loader. By setting’raw ‘, the loader can receive the original’Buffer’. Each loader can pass its processing results as’String ‘or’Buffer’. Complier will convert them to and from loaders.</p><p><strong>raw-loader.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="title function_">assert</span>(content <span class="keyword">instanceof</span> <span class="title class_">Buffer</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">someSyncOperation</span>(content);</span><br><span class="line">  <span class="title class_">The</span> <span class="keyword">return</span> value can also be a<span class="string">&#x27;Buffer &#x27;</span>.</span><br><span class="line">  <span class="comment">//Even if it&#x27;s not a raw loader, it&#x27;s fine</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">raw</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><h3 id="Crossed"><a href="#Crossed" class="headerlink" title="Crossed"></a>Crossed</h3><p>The loader <strong>is always</strong> called from right to left. In some cases, the loader only cares about the <strong>Metadata (metadata)</strong> after the request and ignores the result of the previous loader. <strong>The’pitch ‘method on the loader is called from left to right before the actual (right-to-left) execution of the loader</strong> . For the following <a target="_blank" rel="external nofollow noopener noreferrer" href="https://webpack.docschina.org/configuration/module#rule-use"><code>use</code></a> Configuration:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&#x27;a-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;b-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;c-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>These steps will occur:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|- a-loader `pitch`</span><br><span class="line">  |- b-loader `pitch`</span><br><span class="line">    |- c-loader `pitch`</span><br><span class="line">      |- requested module is picked up as a dependency</span><br><span class="line">    |- c-loader normal execution</span><br><span class="line">  |- b-loader normal execution</span><br><span class="line">|- a-loader normal execution</span><br></pre></td></tr></table></figure><p>So why can loaders take advantage of the “pitching” phase?</p><p>First, the’data ‘passed to the’pitch’ method is also exposed under the ‘this.data ‘during execution and can be used to capture and share previous information during looping.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">someSyncOperation</span>(content, <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">value</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">pitch</span> = <span class="keyword">function</span>(<span class="params">remainingRequest, precedingRequest, data</span>) &#123;</span><br><span class="line">  data.<span class="property">value</span> = <span class="number">42</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Second, if a loader gives a result in the’pitch ‘method, then the process will turn around and skip the remaining loaders. In our example above, if the’pitch’ method of’b-loader ‘returned something:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">someSyncOperation</span>(content);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">pitch</span> = <span class="keyword">function</span>(<span class="params">remainingRequest, precedingRequest, data</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">someCondition</span>()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;module.exports = require(&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;-!&#x27;</span> + remainingRequest) + <span class="string">&#x27;);&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>The above steps will be shortened to:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|- a-loader `pitch`</span><br><span class="line">  |- b-loader `pitch` returns a module</span><br><span class="line">|- a-loader normal execution</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/8b441fe2/" title="Webpack Loader API">https://sunra.top/en/posts/8b441fe2/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/e726988d/" rel="prev" title="Solace Endpoints"><i class="fa fa-chevron-left"></i> Solace Endpoints</a></div><div class="post-nav-item"> <a href="/en/posts/22dc037c/" rel="next" title="spring-boot-mongodb-transaction">spring-boot-mongodb-transaction<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/8b441fe2/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>