<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Recently encountered a strange problem, achieve the following effect: sum(2, 3).result &#x3D; 5; sum(2, 3)(4, 5).result &#x3D; 14; sum(1, 2)(3).result &#x3D; 6; This topic looks very strange, in fact, it is a functi"><meta property="og:type" content="article"><meta property="og:title" content="Currying functions"><meta property="og:url" content="https://sunra.top/en/posts/d56cb4fa/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Recently encountered a strange problem, achieve the following effect: sum(2, 3).result &#x3D; 5; sum(2, 3)(4, 5).result &#x3D; 14; sum(1, 2)(3).result &#x3D; 6; This topic looks very strange, in fact, it is a functi"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2020-05-08T03:46:37.000Z"><meta property="article:modified_time" content="2023-09-09T02:41:46.323Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/posts/d56cb4fa/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/d56cb4fa/","path":"posts/d56cb4fa/","title":"Currying functions"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Currying functions | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-currying"><span class="nav-number">1.</span> <span class="nav-text">What is currying?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Uses-of-currying"><span class="nav-number">2.</span> <span class="nav-text">Uses of currying</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Parameters-to-reuse"><span class="nav-number">2.1.</span> <span class="nav-text">Parameters to reuse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delayed-execution"><span class="nav-number">2.2.</span> <span class="nav-text">Delayed execution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Curried-tool-function"><span class="nav-number">3.</span> <span class="nav-text">Curried tool function</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Answer"><span class="nav-number">4.</span> <span class="nav-text">Answer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Currying"><span class="nav-number">4.1.</span> <span class="nav-text">Currying</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thunk-function-updated-on-2020-06-03"><span class="nav-number">5.</span> <span class="nav-text">Thunk function (updated on 2020.06.03)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Parameter-evaluation-strategy"><span class="nav-number">5.1.</span> <span class="nav-text">Parameter evaluation strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thunk"><span class="nav-number">5.2.</span> <span class="nav-text">Thunk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JavaScript"><span class="nav-number">5.3.</span> <span class="nav-text">JavaScript</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thunkify"><span class="nav-number">5.4.</span> <span class="nav-text">Thunkify</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generator"><span class="nav-number">5.5.</span> <span class="nav-text">Generator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thunk-1"><span class="nav-number">5.6.</span> <span class="nav-text">Thunk</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Encapsulating-duplicate-logic-with-curried-functions-2020-10-10-update"><span class="nav-number">6.</span> <span class="nav-text">Encapsulating duplicate logic with curried functions (2020.10.10 update)</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/d56cb4fa/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Currying functions | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Currying functions</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-05-08 11:46:37" itemprop="dateCreated datePublished" datetime="2020-05-08T11:46:37+08:00">2020-05-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-09-09 10:41:46" itemprop="dateModified" datetime="2023-09-09T10:41:46+08:00">2023-09-09</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/d56cb4fa/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/d56cb4fa/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Recently encountered a strange problem, achieve the following effect:</p><p>sum(2, 3).result = 5;</p><p>sum(2, 3)(4, 5).result = 14;</p><p>sum(1, 2)(3).result = 6;</p><p>This topic looks very strange, in fact, it is a function currying plus a brain teaser, here to record the idea of this topic, if you do not understand currying, after reading the introduction of currying, you can first think about how to achieve this effect, anyway, the author thought for half an hour to slow down the mind turned out to be so simple, in the final analysis, the theory is sufficient, but less knowledge.</p><span id="more"></span><h2 id="What-is-currying"><a href="#What-is-currying" class="headerlink" title="What is currying?"></a>What is currying?</h2><p>Currying is the transliteration of Currying. Currying is a technology that implements multi-parameter functions at the compile principle level. Currying - only passes a part of the parameters to the function to call it, and it returns a function to handle the remaining parameters…</p><p>Before talking about currying in JavaScript, let’s talk about what the original currying is and where it came from.</p><p>In the coding process, as coders, our essential job is to decompose complex problems into multiple programmable small problems.</p><p>Currying provides an implementation idea of recursion degradation for implementing multi-parameter functions - transforming a function that accepts multiple parameters into a function that accepts a single parameter (the first parameter of the original function), and returns a new function that accepts the remaining parameters and returns the result. In some programming languages (such as Haskell), the language feature of multi-parameter functions is supported through Currying technology.</p><p>For the JavaScript language, the concept of currying function that we usually talk about is not exactly the same as the concept of currying in mathematics and computer science.</p><p>Curried functions in mathematics and computer science can only pass one parameter at a time.</p><p>The curried function in our actual JavaScript application can pass one or more parameters.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//normal function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">a,b,c,d,e</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a,b,c,d,e)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//generated curried function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _fn = <span class="title function_">curry</span>(fn);</span><br><span class="line"></span><br><span class="line"><span class="title function_">_fn</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);     <span class="comment">// print: 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">_fn</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);   <span class="comment">// print: 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">_fn</span>(<span class="number">1</span>,<span class="number">2</span>)(<span class="number">3</span>,<span class="number">4</span>)(<span class="number">5</span>);   <span class="comment">// print: 1,2,3,4,5</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">_fn</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>); <span class="comment">// print: 1,2,3,4,5</span></span><br></pre></td></tr></table></figure><h2 id="Uses-of-currying"><a href="#Uses-of-currying" class="headerlink" title="Uses of currying"></a>Uses of currying</h2><h3 id="Parameters-to-reuse"><a href="#Parameters-to-reuse" class="headerlink" title="Parameters to reuse"></a>Parameters to reuse</h3><p>Currying actually complicates the problem of short answers, but at the same time, we have more freedom when using functions. And the free handling of function parameters here is the core of currying. Currying essentially reduces generality and improves applicability.</p><p>Its purpose can also be called parameter to reuse, which means that the parameters you pass in front will have an impact on the function generated later.</p><p>For example, if we don’t use currying to encapsulate the check function, it looks like this</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkByRegExp</span>(<span class="params">regExp,string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> regExp.<span class="title function_">test</span>(string);  </span><br><span class="line">&#125;</span><br><span class="line">checkByRegExp (<span class="regexp">/^ 1\ d &#123;10&#125; $/</span>, <span class="string">&#x27;18642838455 &#x27;</span>); <span class="comment">// Verify phone number</span></span><br><span class="line"></span><br><span class="line">checkByRegExp (<span class="regexp">/^ (\ w) + (\.\ w +) * @(\ w )+((\.\ w +)+)$/</span>, <span class="string">&#x27; test@163.com &#x27;</span>); <span class="comment">// check mailbox</span></span><br></pre></td></tr></table></figure><p>Each number passed into this function has no effect on the following.</p><p>However, if the curried method is used:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Curried</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _check = <span class="title function_">curry</span>(checkByRegExp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Generate tool function to verify phone number</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> checkCellPhone = <span class="title function_">_check</span>(<span class="regexp">/^1\d&#123;10&#125;$/</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Generate tool function, verify mailbox</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> checkEmail = <span class="title function_">_check</span>(<span class="regexp">/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/</span>);</span><br><span class="line"></span><br><span class="line">checkCellPhone (<span class="string">&#x27;18642838455 &#x27;</span>); <span class="comment">// Verify phone number</span></span><br><span class="line"></span><br><span class="line">checkCellPhone (<span class="string">&#x27;13109840560 &#x27;</span>); <span class="comment">// Verify phone number</span></span><br><span class="line"></span><br><span class="line">checkCellPhone (<span class="string">&#x27;13204061212 &#x27;</span>); <span class="comment">// Verify phone number</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">CheckEmail</span> (<span class="string">&#x27;test@163.com &#x27;</span>); <span class="comment">// Check mailbox</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">CheckEmail</span> (<span class="string">&#x27;test@qq.com &#x27;</span>); <span class="comment">// Check mailbox</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">CheckEmail</span> (<span class="string">&#x27;test@gmail.com &#x27;</span>); <span class="comment">// Check mailbox</span></span><br></pre></td></tr></table></figure><p>The Regular Expression you passed in earlier will have an impact on the subsequent calculation results.</p><h3 id="Delayed-execution"><a href="#Delayed-execution" class="headerlink" title="Delayed execution"></a>Delayed execution</h3><p>Deferred execution is also an important usage scenario for Currying. The delayed evaluation feature of Currying requires the use of scope in JavaScript - to put it more colloquially, we need to use scope to save the last passed parameter. Similarly, bind and arrow functions can also achieve the same function.</p><p>In front-end development, a common scenario is to bind onClick events to tags, while considering passing parameters to bound methods.</p><h2 id="Curried-tool-function"><a href="#Curried-tool-function" class="headerlink" title="Curried tool function"></a>Curried tool function</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> Curry the function</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fn Original function to be curried</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Param</span> len The number of parameters required, the default is the number of parameters of the original function</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn,len = fn.length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> _curry.<span class="title function_">call</span>(<span class="variable language_">this</span>,fn,len)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Transfer function</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fn Original function to be curried</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> len Number of parameters required</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args List of received arguments</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_curry</span>(<span class="params">fn,len,...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...params</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> _args = [...args,...params];</span><br><span class="line">        <span class="keyword">if</span>(_args.<span class="property">length</span> &gt;= len)&#123;</span><br><span class="line">            <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>,_args);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _curry.<span class="title function_">call</span>(<span class="variable language_">this</span>,fn,len,..._args)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h2><h3 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">cur</span>) =&gt;</span> &#123;</span><br><span class="line">        result += cur;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tempresult</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">cur</span>) =&gt;</span> &#123;</span><br><span class="line">        result += cur;</span><br><span class="line">      &#125;);</span><br><span class="line">      tempresult.<span class="property">result</span> = result;</span><br><span class="line">      <span class="keyword">return</span> tempresult;</span><br><span class="line">    &#125;</span><br><span class="line">    tempresult.<span class="property">result</span> = result;</span><br><span class="line">    <span class="keyword">return</span> tempresult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Yes, this brain teaser is that function is also an object, just plug a result directly.</p><h2 id="Thunk-function-updated-on-2020-06-03"><a href="#Thunk-function-updated-on-2020-06-03" class="headerlink" title="Thunk function (updated on 2020.06.03)"></a>Thunk function (updated on 2020.06.03)</h2><p>Recently, when looking at the Generator function, I found that there is a function called Thunk function, which looks very similar to the curried function. Record it here. The main content comes from<a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.ruanyifeng.com/blog/2015/05/thunk.html">阮一峰老师的博客</a>, with minor modifications and comments.</p><h3 id="Parameter-evaluation-strategy"><a href="#Parameter-evaluation-strategy" class="headerlink" title="Parameter evaluation strategy"></a>Parameter evaluation strategy</h3><p>Thunk functions have been around since the 1960s.</p><p>At that time, programming languages were just getting started, and computer scientists were still researching how to write compilers better. <strong>One point of contention is<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh.wikipedia.org/wiki/求值策略">“求值策略”</a>, that is, when the parameters of the function should be evaluated.</strong></p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>(x</span><br></pre></td></tr></table></figure></blockquote><p>The above code defines function f first, and then passes it the expression x + 5. Excuse me, when should this expression be evaluated?</p><p>One view was<a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_value">“传值调用”</a>(Call by value), that is, before entering the function body, the value of x + 5 (equal to 6) is calculated, and then the value is passed to function f. C language adopts this strategy.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">f</span>(x</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="title function_">f</span>(<span class="number">6</span>)</span><br></pre></td></tr></table></figure></blockquote><p>Another view was<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh.wikipedia.org/wiki/求值策略#.E4.BC.A0.E5.90.8D.E8.B0.83.E7.94.A8_.28Call_by_name.29">“传名调用”</a>(Call by name), that is, pass the expression x + 5 directly to the function body and only evaluate it when it is used. The Hskell language adopts this strategy.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">f</span>(x</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">(x</span><br></pre></td></tr></table></figure></blockquote><p> <strong>Call by value or call by name, which is better? The answer is that each has its own advantages and disadvantages.</strong> Call by value is relatively simple, but when evaluating the parameter, this parameter has not actually been used, which may cause performance losses.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>(<span class="number">3</span></span><br></pre></td></tr></table></figure></blockquote><p>In the above code, the first parameter of function f is a complex expression, but it is not used in the function body at all. Evaluating this parameter is actually unnecessary.</p><p>Therefore, some computer scientists prefer to “call by name”, that is, only evaluate at execution time.</p><h3 id="Thunk"><a href="#Thunk" class="headerlink" title="Thunk"></a>Thunk</h3><p>The “call by name” implementation of the compiler often puts the parameters into a temporary function, and then passes the temporary function to the function body. This temporary function is called a Thunk function.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>(x</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>In the above code, the parameter x + 5 of function f is replaced by a function. Where the original parameter is used, just evaluate the Thunk function.</p><p> <strong>This is the definition of a Thunk function, which is an implementation strategy of “call by name” to replace an expression.</strong></p><h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><p>JavaScript language is called by value, and its Thunk function has a different meaning. <strong>In JavaScript language, Thunk function replaces not an expression, but a multi-parameter function, replacing it with a single-parameter version that only accepts a callback function as an argument.</strong></p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(fileName,</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"><span class="title function_">readFileThunk</span>(callback);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><p>In the above code, the readFile method of the fs module is a multi-parameter function with two parameters: the file name and the callback function. After the converter process, it becomes a single-parameter function that only accepts the callback function as a parameter. This single-parameter version is called Thunk function.</p><p>Any function, as long as the parameter has a callback function, can be written as a Thunk function. Here is a simple Thunk function converter.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><p>Using the above converter, generate the Thunk function of fs.readFile.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line"><span class="title function_">readFileThunk</span>(fileA)(callback);</span><br></pre></td></tr></table></figure></blockquote><h3 id="Thunkify"><a href="#Thunkify" class="headerlink" title="Thunkify"></a>Thunkify</h3><p>Converter for production environment, recommended use <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/tj/node-thunkify">Thunkify 模块</a>。</p><p>First the installation.</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$</span><br></pre></td></tr></table></figure></blockquote><p>Use as follows.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"><span class="title function_">read</span>(<span class="string">&#x27;package.json&#x27;</span>)(<span class="keyword">function</span>(<span class="params">err,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">&#125;</span>);</span><br></pre></td></tr></table></figure></blockquote><p>Thunkified<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/tj/node-thunkify/blob/master/index.js">源码</a>Very similar to the simple converter in the previous section.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><p>Its source code mainly has an additional checking mechanism.<a target="_blank" rel="external nofollow noopener noreferrer" href="http://segmentfault.com/q/1010000000524121">变量 called</a> Make sure that the callback function only runs once. This design is related to the Generator function below. See the example below.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"><span class="title function_">ft</span>(<span class="number">1</span>,</span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure></blockquote><p>In the above code, since thunkify only allows the callback function to be executed once, only one line of result is output.</p><h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><p>You may ask, what is the use of Thunk function? The answer is that it was really useless before, but ES6 has Generator function, and Thunk function can now be used for automatic Process management of Generator function.</p><p>Take reading a file as an example. The following Generator function encapsulates two asynchronous operations.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></blockquote><p>In the above code, the yield command is used to move the execution right of the program out of the Generator function, so a way is needed to return the execution right to the Generator function.</p><p>This method is the Thunk function, because it can return the execution right to the Generator function in the callback function. For ease of understanding, let’s first look at how to manually execute the above Generator function.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">r1.<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">err,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">&#125;</span>);</span><br></pre></td></tr></table></figure></blockquote><p>In the above code, the variable g is the internal pointer of the Generator function, indicating which step is currently executed. The next method is responsible for moving the pointer to the next step and returning the information of that step (value attribute and done attribute).</p><p>Looking closely at the above code, you can find that the execution process of the Generator function is actually passing the same callback function repeatedly into the value property of the next method. This allows us to use recursion to automate this process.</p><h3 id="Thunk-1"><a href="#Thunk-1" class="headerlink" title="Thunk"></a>Thunk</h3><p>The real power of the Thunk function is that it can automatically execute the Generator function. The following is a Generator actuator based on the Thunk function.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">run</span>(gen);</span><br></pre></td></tr></table></figure></blockquote><p>The run function of the above code is an automatic executor of the Generator function. The internal next function is the callback function of Thunk. Next function first moves the pointer to the next step of the Generator function (gen.next method), and then determines whether the Generator function ends (result.done property). If it does not end, pass the next function to the Thunk function (result.value property), otherwise exit directly.</p><p>With this executor, executing the Generator function is much easier. No matter how many asynchronous operations there are, just pass in the run function directly. Of course, the premise is that each asynchronous operation must be a Thunk function, that is, the yield command must be followed by a Thunk function.</p><blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">run</span>(gen);</span><br></pre></td></tr></table></figure></blockquote><p>In the above code, function gen encapsulates n asynchronous read file operations, which will be automatically completed as long as the run function is executed. In this way, asynchronous operations can not only be written like synchronous operations, but also executed in one line of code.</p><p>Thunk function is not the only solution for automatic execution of Generator function. Because the key to automatic execution is that there must be a mechanism to automatically control the flow of Generator function, receive and return the execution rights of the program. The callback function can do this, and so can the Promise object.</p><h2 id="Encapsulating-duplicate-logic-with-curried-functions-2020-10-10-update"><a href="#Encapsulating-duplicate-logic-with-curried-functions-2020-10-10-update" class="headerlink" title="Encapsulating duplicate logic with curried functions (2020.10.10 update)"></a>Encapsulating duplicate logic with curried functions (2020.10.10 update)</h2><p>Recently read some vue source code, which for the platform judgment logic will be encapsulated in the curried function, through the incoming platform configuration, return a new function, so that each call to return the function can be omitted each time for the platform judgment.</p><p>This idea has been absorbed, coupled with recent work that requires encapsulating some utility classes for encapsulating CRUDs for specific datasets, such as user and userProfile.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">createRepositoryUtilForModelProfile</span> = (<span class="params">mainModel, profileModel, foreignKey</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">selectSearchModels</span>(<span class="params">where</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> conditions = _.<span class="title function_">keys</span>(where);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; conditions.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (mainModelKeys.<span class="title function_">indexOf</span>(conditions[i]) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">searchModel</span>: mainModel.<span class="property">name</span>,</span><br><span class="line">          <span class="attr">supplementModel</span>: profileModel.<span class="property">name</span></span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">searchModel</span>: profileModel.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">supplementModel</span>: mainModel.<span class="property">name</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> mainModelKeys = _.<span class="title function_">keys</span>(mainModel.<span class="property">properties</span>);</span><br><span class="line">  <span class="keyword">const</span> profileModelKeys = _.<span class="title function_">keys</span>(profileModel.<span class="property">properties</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> createUtil = <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">data, operator</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> savedMain = <span class="keyword">await</span> <span class="title function_">create</span>(&#123;</span><br><span class="line">      <span class="attr">model</span>: mainModel.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">data</span>: _.<span class="title function_">pick</span>(data, mainModelKeys),</span><br><span class="line">      operator &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> profile = <span class="keyword">await</span> <span class="title function_">create</span>(&#123;</span><br><span class="line">      <span class="attr">model</span>: profileModel.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">data</span>: _.<span class="title function_">pick</span>(data, profileModelKeys),</span><br><span class="line">      operator</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _.<span class="title function_">merge</span>(savedMain, profile);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> findUtil = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">where, pageNumber, pageSize, fields</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; searchModel, supplementModel &#125; = <span class="title function_">selectSearchModels</span>(where);</span><br><span class="line">    <span class="keyword">let</span> skip = _.<span class="title function_">toNumber</span>(pageNumber - <span class="number">1</span>) * _.<span class="title function_">toNumber</span>(pageSize);</span><br><span class="line">    <span class="keyword">let</span> mainList = <span class="keyword">await</span> <span class="title function_">find</span>(&#123;</span><br><span class="line">      <span class="attr">model</span>: searchModel,</span><br><span class="line">      where,</span><br><span class="line">      <span class="attr">skip</span>: skip &gt;= <span class="number">0</span> ? skip : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">limit</span>: _.<span class="title function_">toNumber</span>(pageSize),</span><br><span class="line">      fields</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; mainList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> supplement = <span class="keyword">await</span> <span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">model</span>: supplementModel,</span><br><span class="line">        <span class="attr">where</span>: &#123; [<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>]: mainList[i][<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>] &#125;,</span><br><span class="line">        fields &#125;);</span><br><span class="line">      _.<span class="title function_">merge</span>(mainList[i], supplement);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mainList;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> findOneUtil = <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">where, fields</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; searchModel, supplementModel &#125; = <span class="title function_">selectSearchModels</span>(where);</span><br><span class="line">    <span class="keyword">let</span> main = <span class="keyword">await</span> <span class="title function_">findOne</span>(&#123; <span class="attr">model</span>: searchModel, where, fields &#125;);</span><br><span class="line">    <span class="keyword">if</span> (main) &#123;</span><br><span class="line">      <span class="keyword">let</span> supplement = <span class="keyword">await</span> <span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">model</span>: supplementModel,</span><br><span class="line">        <span class="attr">where</span>: &#123; [<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>]: main[<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>] &#125;,</span><br><span class="line">        fields &#125;);</span><br><span class="line">      <span class="keyword">return</span> _.<span class="title function_">merge</span>(main, supplement);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> main;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> updateAllUtil = <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> updated = <span class="keyword">await</span> <span class="title function_">updateAll</span>(&#123;</span><br><span class="line">      <span class="attr">model</span>: mainModel.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">where</span>: &#123; [<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>]: data[<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>] &#125;,</span><br><span class="line">      <span class="attr">data</span>: _.<span class="title function_">pick</span>(data, mainModelKeys)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> profile = <span class="keyword">await</span> <span class="title function_">updateAll</span>(&#123;</span><br><span class="line">      <span class="attr">model</span>: profileModel.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">where</span>: &#123; [<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>]: data[<span class="string">`<span class="subst">$&#123;foreignKey&#125;</span>`</span>] &#125;,</span><br><span class="line">      <span class="attr">data</span>: _.<span class="title function_">pick</span>(data, profileModelKeys)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(updated, profile);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    findUtil,</span><br><span class="line">    findOneUtil,</span><br><span class="line">    createUtil,</span><br><span class="line">    updateAllUtil</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Reference link:</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://juejin.im/post/5af13664f265da0ba266efcf#heading-1">https://juejin.im/post/5af13664f265da0ba266efcf#heading-1</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://juejin.im/post/5d2299faf265da1bb67a3b65">https://juejin.im/post/5d2299faf265da1bb67a3b65</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/d56cb4fa/" title="Currying functions">https://sunra.top/en/posts/d56cb4fa/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/7474c898/" rel="prev" title="divide and conquer algorithm"><i class="fa fa-chevron-left"></i> divide and conquer algorithm</a></div><div class="post-nav-item"> <a href="/en/posts/efdea9ac/" rel="next" title="Browser Rendering HTML Process">Browser Rendering HTML Process<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/d56cb4fa/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>