<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Recently read a few articles on the principle of the browser, the browser rendering process has a more systematic understanding, here is a brief summary and by the way under the cliché rearrangement a"><meta property="og:type" content="article"><meta property="og:title" content="Browser Rendering Process"><meta property="og:url" content="https://sunra.top/en/posts/29f9a977/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Recently read a few articles on the principle of the browser, the browser rendering process has a more systematic understanding, here is a brief summary and by the way under the cliché rearrangement a"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606480548/Blog/975fcbf7f83cc20d216f3d68a85d0f37_aiymmq.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606481480/Blog/b3ed565230fe4f5c1886304a8ff754e5_ensz6f.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606481522/Blog/3c1b7310648cccbf6aa4a42ad0202b03_nikkto.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606481570/Blog/024bf6c83b8146d267f476555d953a2c_whdgtc.png"><meta property="article:published_time" content="2020-11-26T13:27:50.000Z"><meta property="article:modified_time" content="2023-07-21T07:32:11.805Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606480548/Blog/975fcbf7f83cc20d216f3d68a85d0f37_aiymmq.png"><link rel="canonical" href="https://sunra.top/en/posts/29f9a977/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/29f9a977/","path":"posts/29f9a977/","title":"Browser Rendering Process"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Browser Rendering Process | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-role-of-each-step-in-the-rendering-process"><span class="nav-number">1.</span> <span class="nav-text">The role of each step in the rendering process</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Building-the-DOM-tree"><span class="nav-number">1.1.</span> <span class="nav-text">Building the DOM tree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Style-calculation-Recalculate"><span class="nav-number">1.2.</span> <span class="nav-text">Style calculation (Recalculate</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Put"><span class="nav-number">1.2.1.</span> <span class="nav-text">Put</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Convert-property-values-in-style-sheets-to-standardize-them"><span class="nav-number">1.2.2.</span> <span class="nav-text">Convert property values in style sheets to standardize them</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Calculated"><span class="nav-number">1.2.3.</span> <span class="nav-text">Calculated</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Layout-phase"><span class="nav-number">1.3.</span> <span class="nav-text">Layout phase</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Create-a-layout-tree"><span class="nav-number">1.3.1.</span> <span class="nav-text">Create a layout tree</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Layout-calculation"><span class="nav-number">1.3.2.</span> <span class="nav-text">Layout calculation</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stratification"><span class="nav-number">1.4.</span> <span class="nav-text">Stratification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Layer-rendering"><span class="nav-number">1.5.</span> <span class="nav-text">Layer rendering</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Raster-operation"><span class="nav-number">1.6.</span> <span class="nav-text">Raster operation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Synthesis-and-display"><span class="nav-number">1.7.</span> <span class="nav-text">Synthesis and display</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rearrangement-repaint-compositing"><span class="nav-number">2.</span> <span class="nav-text">Rearrangement, repaint, compositing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Updated-geometric-properties-of-elements-rearranged"><span class="nav-number">2.1.</span> <span class="nav-text">Updated geometric properties of elements (rearranged)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update-drawing-properties-of-elements-repaint"><span class="nav-number">2.2.</span> <span class="nav-text">Update drawing properties of elements (repaint)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Direct-synthesis-stage"><span class="nav-number">2.3.</span> <span class="nav-text">Direct synthesis stage</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/29f9a977/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Browser Rendering Process | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Browser Rendering Process</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-11-26 21:27:50" itemprop="dateCreated datePublished" datetime="2020-11-26T21:27:50+08:00">2020-11-26</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-07-21 15:32:11" itemprop="dateModified" datetime="2023-07-21T15:32:11+08:00">2023-07-21</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Sundry/" itemprop="url" rel="index"><span itemprop="name">Sundry</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/29f9a977/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/29f9a977/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Recently read a few articles on the principle of the browser, the browser rendering process has a more systematic understanding, here is a brief summary and by the way under the cliché rearrangement and repaint is how to go.</p><span id="more"></span><p>First, create a complete rendering flowchart</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606480548/Blog/975fcbf7f83cc20d216f3d68a85d0f37_aiymmq.png" alt></p><p>Combined with the above figure, a complete rendering process can be roughly summarized as follows:</p><p>The rendering process converts HTML content into a readable DOM tree structure.</p><ul><li>The rendering engine converts CSS style sheets into styleSheets that the browser can understand, and calculates the style of DOM nodes.<br>Create a layout tree and calculate the layout information of elements.<br>Layer the layout tree and generate a hierarchical tree.</li><li>Generate a draw list for each layer and submit it to the compositing thread.</li><li>The compositing thread divides the layer into tiles and converts the tiles into bitmaps in the pool of grating threads.</li><li>The compositing thread sends the DrawQuad command to the browser process.</li><li>The browser process generates pages based on DrawQuad messages and displays them on the display.</li></ul><p>For the first few processes, in fact, there is nothing to say in terms of function, and everyone understands, but if you specifically say how to achieve it, you can open a new blog, such as how html-parser converts html doc into DOM tree and so on.</p><p>So for the previous few processes, we will only briefly mention them.</p><h2 id="The-role-of-each-step-in-the-rendering-process"><a href="#The-role-of-each-step-in-the-rendering-process" class="headerlink" title="The role of each step in the rendering process"></a>The role of each step in the rendering process</h2><h3 id="Building-the-DOM-tree"><a href="#Building-the-DOM-tree" class="headerlink" title="Building the DOM tree"></a>Building the DOM tree</h3><p>Why build a DOM tree?</p><p>This is because the browser cannot directly understand and use HTML, so it needs to convert HTML into a structure that the browser can understand - DOM tree.</p><p>However, we still don’t know the style of the DOM node. To make the DOM node have the correct style, this requires style calculation.</p><h3 id="Style-calculation-Recalculate"><a href="#Style-calculation-Recalculate" class="headerlink" title="Style calculation (Recalculate"></a>Style calculation (Recalculate</h3><p>The purpose of style calculation is to calculate the specific style of each element in the DOM node. This stage can be roughly divided into three steps to complete.</p><h4 id="Put"><a href="#Put" class="headerlink" title="Put"></a>Put</h4><p>There are three main sources of CSS styles:</p><ul><li><p>External CSS files referenced by link</p></li><li><p>Css inside the ‘&lt; style &gt;’ tag.</p></li><li>element style attribute embedded css</li></ul><p>Like HTML files, browsers cannot directly understand the CSS styles of these plain text, so when the rendering engine receives the CSS text, it will perform a conversion operation to convert the CSS text into a structure that the browser can understand - styleSheets.</p><h4 id="Convert-property-values-in-style-sheets-to-standardize-them"><a href="#Convert-property-values-in-style-sheets-to-standardize-them" class="headerlink" title="Convert property values in style sheets to standardize them"></a>Convert property values in style sheets to standardize them</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123; <span class="attribute">font-size</span>: <span class="number">2em</span> &#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;<span class="attribute">color</span>:blue;&#125;</span><br><span class="line"><span class="selector-tag">span</span>  &#123;<span class="attribute">display</span>: none&#125;</span><br><span class="line"><span class="selector-tag">div</span> &#123;<span class="attribute">font-weight</span>: bold&#125;</span><br><span class="line"><span class="selector-tag">div</span>  <span class="selector-tag">p</span> &#123;<span class="attribute">color</span>:green;&#125;</span><br><span class="line"><span class="selector-tag">div</span> &#123;<span class="attribute">color</span>:red; &#125;</span><br></pre></td></tr></table></figure><p>You can see that there are many property values in the CSS text above, such as 2em, blue, bold. These types of values are not easy to be understood by the rendering engine, so all values need to be converted into standardized calculation values that are easy for the rendering engine to understand. This process is to standardize the property value.</p><h4 id="Calculated"><a href="#Calculated" class="headerlink" title="Calculated"></a>Calculated</h4><h3 id="Layout-phase"><a href="#Layout-phase" class="headerlink" title="Layout phase"></a>Layout phase</h3><p>Now, we have the DOM tree and the styles of the elements in the DOM tree, but this is not enough to display the page because we don’t know the geometric position information of the DOM elements yet. Then we need to calculate the geometric position of the visible elements in the DOM tree. We call this calculation process layout.</p><p>Chrome need to complete two tasks during the layout phase: create the layout tree and calculate the layout.</p><h4 id="Create-a-layout-tree"><a href="#Create-a-layout-tree" class="headerlink" title="Create a layout tree"></a>Create a layout tree</h4><p>In order to build the layout tree, the browser generally completes the following tasks:</p><ul><li><p>traverse all visible nodes in the DOM tree and add these nodes to the layout tree;</p></li><li><p>Invisible nodes are ignored by the layout tree, such as all content below the head tag, and the element body.p.span, which is not included in the layout tree because its attribute contains dispaly: none.</p></li></ul><h4 id="Layout-calculation"><a href="#Layout-calculation" class="headerlink" title="Layout calculation"></a>Layout calculation</h4><p>Now we have a complete layout tree. Next, we need to calculate the coordinate positions of the layout tree nodes.</p><h3 id="Stratification"><a href="#Stratification" class="headerlink" title="Stratification"></a>Stratification</h3><p>Now that we have the layout tree and the specific position information of each element has been calculated, is it time to start drawing the page? The answer is still no.</p><p>Because there are many complex effects in the page, such as some complex 3D transformations, page scrolling, or using z-indexing to do z-axis sorting, etc. In order to achieve these effects more conveniently, the <strong>rendering engine also needs to generate special for specific nodes layer, and generate a corresponding layer tree</strong> (LayerTree). If you are familiar with PS, I believe you will easily understand the concept of layers, which are superimposed together to form the final page image.</p><p> <strong>The browser page is actually divided into many layers, and these layers are superimposed to form the final page</strong></p><p>Usually, not every node in the layout tree contains a layer. If a node does not have a corresponding layer, then this node belongs to the parent node’s layer.</p><p>So what conditions need to be met before the rendering engine will create a new layer for a specific node? Usually, elements that meet any of the following two points can be promoted to a separate layer.</p><ul><li><p>First, elements with the Cascading Context attribute are promoted to a separate layer.</p></li><li><p>Second, the places that need to be clipped will also be created as layers.</p></li></ul><h3 id="Layer-rendering"><a href="#Layer-rendering" class="headerlink" title="Layer rendering"></a>Layer rendering</h3><p>After completing the construction of the layer tree, the rendering engine will draw each layer in the layer tree, so let’s take a look at how the rendering engine implements layer drawing?</p><p>Imagine if you were given a piece of paper and asked to paint the background blue, then draw a red circle in the middle, and finally draw a green triangle on the circle. How would you do it?</p><p>Usually, you will break down your drawing operation into three steps:</p><ul><li>Draw a blue background;</li></ul><p>Draw a red circle in the middle.</p><ul><li>Draw a green triangle on the circle again.</li></ul><p>The rendering engine implements layer drawing similarly, splitting the drawing of a layer into many small drawing instructions, and then forming a list of instructions to be drawn in order</p><h3 id="Raster-operation"><a href="#Raster-operation" class="headerlink" title="Raster operation"></a>Raster operation</h3><p>The drawing list is only a list used to record the drawing order and drawing instructions. In fact, the drawing operation is completed by the compositing thread in the rendering engine.</p><p>When the drawing list of the layer is ready, the main thread will commit the drawing list to the compositing thread, so how does the compositing thread work next?</p><p>Then we need to first take a look at what a viewport is</p><p>Usually a page may be very large, but the user can only see a part of it. We call this part that the user can see the viewport.</p><p>In some cases, some layers can be very large. For example, there are pages that you need to scroll for a long time to scroll to the bottom using the scroll bar, but through the viewport, the user can only see a small part of the page, so in this case, It would be too expensive to draw all the contents of the layer, and it would not be necessary.</p><p>For this reason, the compositing thread divides the layer into tiles, which are usually 256x256 or 512x512 in size, as shown in the image below:</p><p>Then the compositing thread will preferentially generate bitmaps according to the tiles near the viewport. The actual operation of generating bitmaps is performed by rasterization. <strong>The so-called rasterization refers to converting tiles into bitmaps. The tile is the smallest unit of rasterization execution</strong> . The rendering process maintains a rasterized thread pool, and all tile rasterization is performed in the thread pool. The operation mode is shown in the following figure:</p><h3 id="Synthesis-and-display"><a href="#Synthesis-and-display" class="headerlink" title="Synthesis and display"></a>Synthesis and display</h3><p>Once all tiles have been grated, the compositing thread generates a command to draw the tiles - “DrawQuad” - and then submits the command to the browser process.</p><p>There is a component called viz in the browser process, which is used to receive the DrawQuad command sent by the synthetic thread, and then draw the page content into memory according to the DrawQuad command, and finally display the memory on the screen.</p><p>At this point, after this series of stages, the written HTML, CSS, JavaScript and other files will display beautiful pages through the browser.</p><h2 id="Rearrangement-repaint-compositing"><a href="#Rearrangement-repaint-compositing" class="headerlink" title="Rearrangement, repaint, compositing"></a>Rearrangement, repaint, compositing</h2><h3 id="Updated-geometric-properties-of-elements-rearranged"><a href="#Updated-geometric-properties-of-elements-rearranged" class="headerlink" title="Updated geometric properties of elements (rearranged)"></a>Updated geometric properties of elements (rearranged)</h3><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606481480/Blog/b3ed565230fe4f5c1886304a8ff754e5_ensz6f.png" alt></p><p>As can be seen from the above figure, if you modify the geometric position properties of an element through JavaScript or CSS, such as changing the width, height, etc., then the browser will trigger a relayout and a series of sub-stages after parsing. This process is called rearrangement. Undoubtedly, rearrangement requires updating the complete rendering pipeline, so the overhead is also the largest.</p><h3 id="Update-drawing-properties-of-elements-repaint"><a href="#Update-drawing-properties-of-elements-repaint" class="headerlink" title="Update drawing properties of elements (repaint)"></a>Update drawing properties of elements (repaint)</h3><p>Next, let’s take a look at repainting, such as changing the background color of some elements through JavaScript, how will the rendering pipeline be adjusted? You can refer to the following image:</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606481522/Blog/3c1b7310648cccbf6aa4a42ad0202b03_nikkto.png" alt></p><p>As can be seen from the figure, if the background color of the element is modified, the layout stage will not be executed, because it does not cause the transformation of the geometric position, so it directly enters the drawing stage, and then executes a series of sub-stages. This process is called repaint. Compared to the rearrangement operation, the redrawing eliminates the layout and layering stages, so the execution efficiency will be higher than the rearrangement operation.</p><h3 id="Direct-synthesis-stage"><a href="#Direct-synthesis-stage" class="headerlink" title="Direct synthesis stage"></a>Direct synthesis stage</h3><p>So what happens if you change a property that neither layouts nor draws? The rendering engine will skip layout and drawing and only perform subsequent compositing operations. We call this process compositing. For details, please refer to the following figure:</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1606481570/Blog/024bf6c83b8146d267f476555d953a2c_whdgtc.png" alt></p><p>In the above figure, we use the CSS transform to achieve the animation effect, which can avoid the rearrangement and repaint stages and directly perform the compositing animation operation on the non-main thread. This is the most efficient, because it is composited on the non-main thread and does not occupy the resources of the main thread. In addition, the two sub-stages of layout and drawing are avoided, so compared with repaint and rearrangement, compositing can greatly improve rendering efficiency.</p><p>Note:</p><p>The pictures in this article are all from Geek Time “Browser Working Principle and Practice”</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/29f9a977/" title="Browser Rendering Process">https://sunra.top/en/posts/29f9a977/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/48445981/" rel="prev" title="JavaScript Execution Mechanism (2) Scope"><i class="fa fa-chevron-left"></i> JavaScript Execution Mechanism (2) Scope</a></div><div class="post-nav-item"> <a href="/en/posts/bbe10e1c/" rel="next" title="Browser Architecture">Browser Architecture<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/29f9a977/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>