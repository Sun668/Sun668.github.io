<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Recently, I read the doc of loopback4 on a whim. To be honest, I vomited a little blood when I read it. It may be that I am too bad. I don’t say the English one. This is okay. There are no strange wor"><meta property="og:type" content="article"><meta property="og:title" content="loopback4 experience"><meta property="og:url" content="https://sunra.top/en/posts/41669/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Recently, I read the doc of loopback4 on a whim. To be honest, I vomited a little blood when I read it. It may be that I am too bad. I don’t say the English one. This is okay. There are no strange wor"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2021-03-13T13:16:23.000Z"><meta property="article:modified_time" content="2023-07-18T07:44:34.844Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/posts/41669/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/41669/","path":"posts/41669/","title":"loopback4 experience"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>loopback4 experience | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Scaffolding"><span class="nav-number">1.</span> <span class="nav-text">Install Scaffolding</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-a-new-project"><span class="nav-number">2.</span> <span class="nav-text">Create a new project</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-an-Empty-Controller"><span class="nav-number">2.1.</span> <span class="nav-text">Creating an Empty Controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-CRUD"><span class="nav-number">2.2.</span> <span class="nav-text">Creating a CRUD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Create-a-model"><span class="nav-number">2.2.1.</span> <span class="nav-text">Create a model</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-a-DataSource"><span class="nav-number">2.2.2.</span> <span class="nav-text">Creating a DataSource</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BARepository"><span class="nav-number">2.2.3.</span> <span class="nav-text">创建Repository</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-a-Controller"><span class="nav-number">2.2.4.</span> <span class="nav-text">Creating a Controller</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-Relations"><span class="nav-number">2.3.</span> <span class="nav-text">Create Relations</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Add-JWT-validation"><span class="nav-number">3.</span> <span class="nav-text">Add JWT validation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-Components"><span class="nav-number">3.1.</span> <span class="nav-text">Binding Components</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-UserController"><span class="nav-number">3.2.</span> <span class="nav-text">Create UserController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Add-JWT-validation-1"><span class="nav-number">3.3.</span> <span class="nav-text">Add JWT validation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Question"><span class="nav-number">4.</span> <span class="nav-text">Question</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Update-on-2021-03-20-fill-in-the-problems-in-the-previous-issue"><span class="nav-number">5.</span> <span class="nav-text">Update on 2021.03.20 (fill in the problems in the previous issue)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-Customize-RequestBody"><span class="nav-number">5.1.</span> <span class="nav-text">How to Customize RequestBody</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-use-your-own-model-for-JWT-verification"><span class="nav-number">6.</span> <span class="nav-text">How to use your own model for JWT verification</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/41669/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="loopback4 experience | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> loopback4 experience</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-03-13 21:16:23" itemprop="dateCreated datePublished" datetime="2021-03-13T21:16:23+08:00">2021-03-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-07-18 15:44:34" itemprop="dateModified" datetime="2023-07-18T15:44:34+08:00">2023-07-18</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/41669/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/41669/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Recently, I read the doc of loopback4 on a whim. To be honest, I vomited a little blood when I read it. It may be that I am too bad. I don’t say the English one. This is okay. There are no strange words, but they are from east to west. Overall, there are two feelings. First, it seems that typing a few lines of command code will come out, but if you don’t understand those strange syntactic sugar words, you can’t type your own code, which is inflexible. Second, doc does not see A complete example, all of which suddenly give you a github link halfway through, asking you to see the project.</p><p>But after watching it for so long, let me briefly summarize how to use it to build a project</p><span id="more"></span><h2 id="Install-Scaffolding"><a href="#Install-Scaffolding" class="headerlink" title="Install Scaffolding"></a>Install Scaffolding</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g @loopback/cli</span><br></pre></td></tr></table></figure><p>If you are using</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add @loopback/cli</span><br></pre></td></tr></table></figure><p>Be careful to add your yarn bin to the environment variables, otherwise you will not be able to perform the following step</p><h2 id="Create-a-new-project"><a href="#Create-a-new-project" class="headerlink" title="Create a new project"></a>Create a new project</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lb4 app</span><br></pre></td></tr></table></figure><p>Answer the prompts as follows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">? Project name: getting-started</span><br><span class="line">? Project description: Getting started tutorial</span><br><span class="line">? Project root directory: (getting-started)</span><br><span class="line">? Application class name: StarterApplication</span><br><span class="line">? Select features to enable in the project:</span><br><span class="line">❯◉ Enable eslint: add a linter with pre-configured lint rules</span><br><span class="line"> ◉ Enable prettier: install prettier to format code conforming to rules</span><br><span class="line"> ◉ Enable mocha: install mocha to run tests</span><br><span class="line"> ◉ Enable loopbackBuild: use @loopback/build helpers (e.g. lb-eslint)</span><br><span class="line"> ◉ Enable vscode: add VSCode config files</span><br><span class="line"> ◉ Enable docker: include Dockerfile and .dockerignore</span><br><span class="line"> ◉ Enable repositories: include repository imports and RepositoryMixin</span><br><span class="line"> ◉ Enable services: include service-proxy imports and ServiceMixin</span><br></pre></td></tr></table></figure><p>Then, you can start running your own project.</p><h3 id="Creating-an-Empty-Controller"><a href="#Creating-an-Empty-Controller" class="headerlink" title="Creating an Empty Controller"></a>Creating an Empty Controller</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lb4 controller</span><br></pre></td></tr></table></figure><ul><li><p><em>Note: If your application is still running, press <strong>CTRL+C</strong> to stop it before calling the command</em></p></li><li><p>Answer the prompts as follows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">? Controller class name: hello</span><br><span class="line">? What kind of controller would you like to generate? Empty Controller</span><br><span class="line">  create src/controllers/hello.controller.ts</span><br><span class="line">  update src/controllers/index.ts</span><br><span class="line"></span><br><span class="line">Controller hello was now created in src/controllers/</span><br></pre></td></tr></table></figure></li><li><p>Paste the following contents into the file <code>/src/controllers/hello.controller.ts</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123;get&#125; from &#x27;@loopback/rest&#x27;;</span><br><span class="line"></span><br><span class="line">export class HelloController &#123;</span><br><span class="line">  @get(&#x27;/hello&#x27;)</span><br><span class="line">  hello(): string &#123;</span><br><span class="line">    return &#x27;Hello world!&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Start the application using <code>npm start</code>.</p></li><li><p>Visit <a target="_blank" rel="external nofollow noopener noreferrer" href="http://127.0.0.1:3000/hello">http://127.0.0.1:3000/hello</a> to see <code>Hello world!</code></p></li></ul><p>Everything looks good together so far.</p><h3 id="Creating-a-CRUD"><a href="#Creating-a-CRUD" class="headerlink" title="Creating a CRUD"></a>Creating a CRUD</h3><p>To create a Controller with a CRUD project, first you need to have a model, or borrow the official doc, and these steps cannot be messed up</p><h4 id="Create-a-model"><a href="#Create-a-model" class="headerlink" title="Create a model"></a>Create a model</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">lb4 model</span><br><span class="line">? Model class name: todo</span><br><span class="line">? Please select the model base class Entity (A persisted model with an ID)</span><br><span class="line">? Allow additional (free-form) properties? No</span><br><span class="line">Model Todo will be created in src/models/todo.model.ts</span><br><span class="line"></span><br><span class="line">Let&#x27;s add a property to Todo</span><br><span class="line">Enter an empty property name when done</span><br><span class="line"></span><br><span class="line">? Enter the property name: id</span><br><span class="line">? Property type: number</span><br><span class="line">? Is id the ID property? Yes</span><br><span class="line">? Is id generated automatically? No</span><br><span class="line">? Is it required?: No</span><br><span class="line">? Default value [leave blank for none]:</span><br><span class="line"></span><br><span class="line">Let&#x27;s add another property to Todo</span><br><span class="line">Enter an empty property name when done</span><br><span class="line"></span><br><span class="line">? Enter the property name: title</span><br><span class="line">? Property type: string</span><br><span class="line">? Is it required?: Yes</span><br><span class="line">? Default value [leave blank for none]:</span><br><span class="line"></span><br><span class="line">Let&#x27;s add another property to Todo</span><br><span class="line">Enter an empty property name when done</span><br><span class="line"></span><br><span class="line">? Enter the property name: desc</span><br><span class="line">? Property type: string</span><br><span class="line">? Is it required?: No</span><br><span class="line">? Default value [leave blank for none]:</span><br><span class="line"></span><br><span class="line">Let&#x27;s add another property to Todo</span><br><span class="line">Enter an empty property name when done</span><br><span class="line"></span><br><span class="line">? Enter the property name: isComplete</span><br><span class="line">? Property type: boolean</span><br><span class="line">? Is it required?: No</span><br><span class="line">? Default value [leave blank for none]:</span><br><span class="line"></span><br><span class="line">Let&#x27;s add another property to Todo</span><br><span class="line">Enter an empty property name when done</span><br><span class="line"></span><br><span class="line">? Enter the property name:</span><br><span class="line"></span><br><span class="line">   create src/models/todo.model.ts</span><br><span class="line">   update src/models/index.ts</span><br><span class="line"></span><br><span class="line">Model Todo was created in src/models/</span><br></pre></td></tr></table></figure><h4 id="Creating-a-DataSource"><a href="#Creating-a-DataSource" class="headerlink" title="Creating a DataSource"></a>Creating a DataSource</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lb4 datasource</span><br><span class="line">? Datasource name: db</span><br><span class="line">? Select the connector for db: In-memory db (supported by StrongLoop)</span><br><span class="line">? window.localStorage key to use for persistence (browser only):</span><br><span class="line">? Full path to file for persistence (server only): ./data/db.json</span><br><span class="line"></span><br><span class="line">  create src/datasources/db.datasource.ts</span><br><span class="line">  update src/datasources/index.ts</span><br><span class="line"></span><br><span class="line">Datasource Db was created in src/datasources/</span><br></pre></td></tr></table></figure><h4 id="创建Repository"><a href="#创建Repository" class="headerlink" title="创建Repository"></a>创建Repository</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lb4 repository</span><br><span class="line">? Please select the datasource DbDatasource</span><br><span class="line">? Select the model(s) you want to generate a repository Todo</span><br><span class="line">? Please select the repository base class DefaultCrudRepository (Juggler bridge)</span><br><span class="line"></span><br><span class="line">   create src/repositories/todo.repository.ts</span><br><span class="line">   update src/repositories/index.ts</span><br><span class="line"></span><br><span class="line">Repository TodoRepository was created in src/repositories/</span><br></pre></td></tr></table></figure><h4 id="Creating-a-Controller"><a href="#Creating-a-Controller" class="headerlink" title="Creating a Controller"></a>Creating a Controller</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">lb4 controller</span><br><span class="line">? Controller class name: todo</span><br><span class="line">Controller Todo will be created in src/controllers/todo.controller.ts</span><br><span class="line"></span><br><span class="line">? What kind of controller would you like to generate? REST Controller with CRUD functions</span><br><span class="line">? What is the name of the model to use with this CRUD repository? Todo</span><br><span class="line">? What is the name of your CRUD repository? TodoRepository</span><br><span class="line">? What is the name of ID property? id</span><br><span class="line">? What is the type of your ID? number</span><br><span class="line">? Is the id omitted when creating a new instance? Yes</span><br><span class="line">? What is the base HTTP path name of the CRUD operations? /todos</span><br><span class="line">   create src/controllers/todo.controller.ts</span><br><span class="line">   update src/controllers/index.ts</span><br><span class="line"></span><br><span class="line">Controller Todo was created in src/controllers/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Create-Relations"><a href="#Create-Relations" class="headerlink" title="Create Relations"></a>Create Relations</h3><p>Through the above steps, we create a TodoList model and repositorie.</p><p>Then we create a connection between the two of them</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lb4 relation</span></span><br><span class="line">? Please select the relation type hasMany</span><br><span class="line">? Please select source model TodoList</span><br><span class="line">? Please select target model Todo</span><br><span class="line">? Foreign key name to define on the target model todoListId</span><br><span class="line">? Source property name for the relation getter (will be the relation name) todos</span><br><span class="line">? Allow TodoList queries to include data from related Todo instances? Yes</span><br><span class="line">   create src/controllers/todo-list-todo.controller.ts</span><br><span class="line"></span><br><span class="line">Relation HasMany was created in src/</span><br></pre></td></tr></table></figure><p>This creates a connection between the two models.</p><p>Note that both must have a repositorie, otherwise the association cannot be created.</p><p>Because the Create Association step will create a Controller.</p><h2 id="Add-JWT-validation"><a href="#Add-JWT-validation" class="headerlink" title="Add JWT validation"></a>Add JWT validation</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lb4 example todo</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> loopback4-example-todo</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm i --save @loopback/authentication @loopback/authentication-jwt</span></span><br></pre></td></tr></table></figure><h3 id="Binding-Components"><a href="#Binding-Components" class="headerlink" title="Binding Components"></a>Binding Components</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">src/application.<span class="property">ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------- ADD IMPORTS -------------</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">AuthenticationComponent</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/authentication&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">JWTAuthenticationComponent</span>,</span><br><span class="line">  <span class="variable constant_">SECURITY_SCHEME_SPEC</span>,</span><br><span class="line">  <span class="title class_">UserServiceBindings</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/authentication-jwt&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">DbDataSource</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./datasources&#x27;</span>;</span><br><span class="line"><span class="comment">// ------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TodoListApplication</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BootMixin</span>(</span><br><span class="line">  <span class="title class_">ServiceMixin</span>(<span class="title class_">RepositoryMixin</span>(<span class="title class_">RestApplication</span>)),</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options: ApplicationConfig = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="comment">// ------ ADD SNIPPET AT THE BOTTOM ---------</span></span><br><span class="line">    <span class="comment">// Mount authentication system</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">component</span>(<span class="title class_">AuthenticationComponent</span>);</span><br><span class="line">    <span class="comment">// Mount jwt component</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">component</span>(<span class="title class_">JWTAuthenticationComponent</span>);</span><br><span class="line">    <span class="comment">// Bind datasource</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">dataSource</span>(<span class="title class_">DbDataSource</span>, <span class="title class_">UserServiceBindings</span>.<span class="property">DATASOURCE_NAME</span>);</span><br><span class="line">    <span class="comment">// ------------- END OF SNIPPET -------------</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Create-UserController"><a href="#Create-UserController" class="headerlink" title="Create UserController"></a>Create UserController</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lb4 controller</span></span><br><span class="line">? Controller class name: User</span><br><span class="line">Controller User will be created in src/controllers/user.controller.ts</span><br><span class="line"></span><br><span class="line">? What kind of controller would you like to generate? Empty Controller</span><br><span class="line"></span><br><span class="line">create src/controllers/user.controller.ts</span><br><span class="line">   update src/controllers/index.ts</span><br><span class="line"></span><br><span class="line">Controller User was created in src/controllers/</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/src/controllers/user.<span class="property">controller</span>.<span class="property">ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------- ADD IMPORTS -------------</span></span><br><span class="line"><span class="keyword">import</span> &#123;inject&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">TokenServiceBindings</span>,</span><br><span class="line">  <span class="title class_">MyUserService</span>,</span><br><span class="line">  <span class="title class_">UserServiceBindings</span>,</span><br><span class="line">  <span class="title class_">UserRepository</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/authentication-jwt&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">TokenService</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/authentication&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">SecurityBindings</span>, <span class="title class_">UserProfile</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/security&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;repository&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/repository&#x27;</span>;</span><br><span class="line"><span class="comment">// ----------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(TokenServiceBindings.TOKEN_SERVICE)</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> jwtService: TokenService,</span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(UserServiceBindings.USER_SERVICE)</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> userService: MyUserService,</span></span><br><span class="line"><span class="params">    <span class="meta">@inject</span>(SecurityBindings.USER, &#123;optional: <span class="literal">true</span>&#125;)</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> user: UserProfile,</span></span><br><span class="line"><span class="params">    <span class="meta">@repository</span>(UserRepository) <span class="keyword">protected</span> userRepository: UserRepository,</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="Add-JWT-validation-1"><a href="#Add-JWT-validation-1" class="headerlink" title="Add JWT validation"></a>Add JWT validation</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ---------- ADD IMPORTS -------------</span></span><br><span class="line"><span class="keyword">import</span> &#123;authenticate&#125; <span class="keyword">from</span> <span class="string">&#x27;@loopback/authentication&#x27;</span>;</span><br><span class="line"><span class="comment">// ------------------------------------</span></span><br><span class="line"><span class="meta">@authenticate</span>(<span class="string">&#x27;jwt&#x27;</span>) <span class="comment">// &lt;---- Apply the @authenticate decorator at the class level</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TodoController</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h2><p>So far, you can do todo CRUD through the api provided by loopback, it looks happy, doesn’t it?</p><p>But there are a few questions I didn’t find the answers to in the doc</p><ul><li><p>I can’t find a place where I can update two models with one request, such as TodoList and Todo above. I want to update these two related models, I have to make two requests.</p></li><li><p>Customizing the Request body is very cumbersome, and you must strictly follow its specifications.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> requestBodyObject = &#123;</span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;data&#x27;</span>,</span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">schema</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        <span class="attr">properties</span>: &#123;</span><br><span class="line">          <span class="attr">name</span>: &#123;<span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>&#125;,</span><br><span class="line">          <span class="attr">location</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">            <span class="attr">properties</span>: &#123;</span><br><span class="line">              <span class="attr">lat</span>: &#123;<span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span>&#125;,</span><br><span class="line">              <span class="attr">lng</span>: &#123;<span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span>&#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">tags</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;array&#x27;</span>,</span><br><span class="line">            <span class="attr">items</span>: &#123;<span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>&#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>The type of a variable I defined in Model is an enum type I defined, and the project cannot be started. The reason for the error is that the type I defined cannot be resolved.</p></li><li>With its JWT verification, you can not customize the UserModel, although it is convenient, but I did not find a place where I can customize the User, so I can not add the field I need to the User.</li><li>I used a package called casbin for authentication, and the doc is also all English, so I don’t quite understand it.</li></ul><p>These are some of the problems I have encountered, and I hope that as I deepen my understanding of it, I can solve it.</p><h2 id="Update-on-2021-03-20-fill-in-the-problems-in-the-previous-issue"><a href="#Update-on-2021-03-20-fill-in-the-problems-in-the-previous-issue" class="headerlink" title="Update on 2021.03.20 (fill in the problems in the previous issue)"></a>Update on 2021.03.20 (fill in the problems in the previous issue)</h2><h3 id="How-to-Customize-RequestBody"><a href="#How-to-Customize-RequestBody" class="headerlink" title="How to Customize RequestBody"></a>How to Customize RequestBody</h3><p>At present, the fastest way is to create a Model through’lb4 model ‘, the format is the RequestBody you need, of course, you can also completely type one yourself, for example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_">model</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">NewUserRequest</span> <span class="keyword">extends</span> <span class="title class_ inherited__">User</span> &#123;</span><br><span class="line">  @<span class="title function_">property</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="attr">password</span>: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then on the request</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_">requestBody</span>(&#123;</span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">            <span class="attr">schema</span>: <span class="title function_">getModelSchemaRef</span>(<span class="title class_">NewUserRequest</span>, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;NewUser&#x27;</span>,</span><br><span class="line">            &#125;),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="How-to-use-your-own-model-for-JWT-verification"><a href="#How-to-use-your-own-model-for-JWT-verification" class="headerlink" title="How to use your own model for JWT verification"></a>How to use your own model for JWT verification</h2><p>Change the binding of User, UserCredentials, RefreshToken, Model, Repository, Service in application.ts</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//application.ts</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Mount authentication system</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">component</span>(<span class="title class_">AuthenticationComponent</span>);</span><br><span class="line"><span class="comment">// Mount jwt component</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">component</span>(<span class="title class_">JWTAuthenticationComponent</span>);</span><br><span class="line"><span class="comment">// Bind datasource</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">dataSource</span>(<span class="title class_">MemoryDataSource</span>, <span class="title class_">UserServiceBindings</span>.<span class="property">DATASOURCE_NAME</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">UserServiceBindings</span>.<span class="property">USER_REPOSITORY</span>).<span class="title function_">toClass</span>(<span class="title class_">UserRepository</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">UserServiceBindings</span>.<span class="property">USER_CREDENTIALS_REPOSITORY</span>).<span class="title function_">toClass</span>(</span><br><span class="line">    <span class="title class_">UserCredentialsRepository</span>,</span><br><span class="line">);</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">UserServiceBindings</span>.<span class="property">USER_SERVICE</span>).<span class="title function_">toClass</span>(<span class="title class_">MyUserService</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">TokenServiceBindings</span>.<span class="property">TOKEN_SECRET</span>).<span class="title function_">to</span>(<span class="string">&#x27;my-secret&#x27;</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">TokenServiceBindings</span>.<span class="property">TOKEN_SERVICE</span>).<span class="title function_">toClass</span>(<span class="title class_">JWTService</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">RefreshTokenServiceBindings</span>.<span class="property">REFRESH_REPOSITORY</span>).<span class="title function_">toClass</span>(<span class="title class_">RefreshTokenRepository</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">RefreshTokenServiceBindings</span>.<span class="property">REFRESH_TOKEN_SERVICE</span>).<span class="title function_">toClass</span>(<span class="title class_">RefreshtokenService</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">RefreshTokenServiceBindings</span>.<span class="property">REFRESH_SECRET</span>).<span class="title function_">to</span>(</span><br><span class="line">    <span class="string">&#x27;my-refresh-secret&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">TokenServiceBindings</span>.<span class="property">TOKEN_EXPIRES_IN</span>).<span class="title function_">to</span>((<span class="number">60</span> * <span class="number">60</span>).<span class="title function_">toString</span>());</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="title class_">RefreshTokenServiceBindings</span>.<span class="property">REFRESH_EXPIRES_IN</span>).<span class="title function_">to</span>(</span><br><span class="line">    (<span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>).<span class="title function_">toString</span>(),</span><br><span class="line">);</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/41669/" title="loopback4 experience">https://sunra.top/en/posts/41669/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/54964/" rel="prev" title="The Thought and Application of Monotone Stack"><i class="fa fa-chevron-left"></i> The Thought and Application of Monotone Stack</a></div><div class="post-nav-item"> <a href="/en/posts/10540/" rel="next" title="React Introductory Series (1) A First Reading of Syntax and Concepts">React Introductory Series (1) A First Reading of Syntax and Concepts<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/41669/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>