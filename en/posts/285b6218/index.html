<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Some time ago, I made a grease monkey plugin to sort out the urls of commonly used projects in different environments for ease of use.Recently, I have been a little annoyed by the db configuration of"><meta property="og:type" content="article"><meta property="og:title" content="TamperMonkey for Content Protection"><meta property="og:url" content="https://sunra.top/en/posts/285b6218/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Some time ago, I made a grease monkey plugin to sort out the urls of commonly used projects in different environments for ease of use.Recently, I have been a little annoyed by the db configuration of"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2020-07-31T10:32:31.000Z"><meta property="article:modified_time" content="2023-11-05T02:51:35.098Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/posts/285b6218/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/285b6218/","path":"posts/285b6218/","title":"TamperMonkey for Content Protection"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>TamperMonkey for Content Protection | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Independent-operating-environment"><span class="nav-number">1.</span> <span class="nav-text">Independent operating environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Closure"><span class="nav-number">2.</span> <span class="nav-text">Closure</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">3.</span> <span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Expand"><span class="nav-number">4.</span> <span class="nav-text">Expand</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chrome"><span class="nav-number">4.1.</span> <span class="nav-text">Chrome</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Prohibit-Xray"><span class="nav-number">4.1.1.</span> <span class="nav-text">Prohibit Xray</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Xray"><span class="nav-number">4.1.2.</span> <span class="nav-text">Xray</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Xray-1"><span class="nav-number">4.1.3.</span> <span class="nav-text">Xray</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Extensions"><span class="nav-number">4.2.</span> <span class="nav-text">Extensions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Architecture"><span class="nav-number">4.2.1.</span> <span class="nav-text">Architecture</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Manifest"><span class="nav-number">4.2.2.</span> <span class="nav-text">Manifest</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Content"><span class="nav-number">4.2.3.</span> <span class="nav-text">Content</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#DOM-access"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">DOM access</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WebExtensions"><span class="nav-number">4.2.3.2.</span> <span class="nav-text">WebExtensions</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/285b6218/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="TamperMonkey for Content Protection | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> TamperMonkey for Content Protection</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-07-31 18:32:31" itemprop="dateCreated datePublished" datetime="2020-07-31T18:32:31+08:00">2020-07-31</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-11-05 10:51:35" itemprop="dateModified" datetime="2023-11-05T10:51:35+08:00">2023-11-05</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Sundry/" itemprop="url" rel="index"><span itemprop="name">Sundry</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/285b6218/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/285b6218/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Some time ago, I made a grease monkey plugin to sort out the urls of commonly used projects in different environments for ease of use.<br>Recently, I have been a little annoyed by the db configuration of various projects in various environments, so I thought about putting the db configuration into the script, but there are still some sensitive information in these db configurations, and there may be security problems if I put it rashly. In order to study the security of TamperMonkey, I studied the doc of TamperMonkey and its principle.<br><span id="more"></span></p><h2 id="Independent-operating-environment"><a href="#Independent-operating-environment" class="headerlink" title="Independent operating environment"></a>Independent operating environment</h2><p>First, stick to the conclusion of a foreign forum:</p><p>See <a target="_blank" rel="external nofollow noopener noreferrer" href="https://stackoverflow.com/q/6617361/331508">“Are Chrome user-scripts separated from the global namespace like Greasemonkey scripts?”</a>. Both Chrome userscripts/content-scripts and Greasemonkey scripts are isolated from the page’s javascript. This is done to help keep you from being hacked, but it also reduces conflicts and unexpected side-effects.</p><p>However, the methods are different for each browser…</p><p><strong>Firefox:</strong></p><ol><li>Runs scripts in <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/en/XPCNativeWrapper">an XPCNativeWrapper sandbox</a>, unless <a target="_blank" rel="external nofollow noopener noreferrer" href="http://wiki.greasespot.net/@grant">@grant none</a> is in effect (as of GM 1.0).</li><li>Wraps the script in an anonymous function by default.</li><li>Provides unsafeWindow to access the target page’s javascript. But beware that it is <em>possible</em> for hostile webmasters to follow unsafeWindow usage back to the script’s context and thus gain elevated privileges to pwn you with.</li></ol><p><strong>Chrome:</strong></p><ol><li><p>Runs scripts in <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/content_scripts.html#execution-environment">an “isolated world”</a>.</p></li><li><p>Wraps the script in an anonymous function.</p></li><li><p><strong>Strictly</strong> blocks any access to the page’s JS by the script and vice-versa.</p><p>Recent versions of Chrome now provide an object named unsafeWindow, for very-limited compatibility, but this object does not provide any access to the target page’s JS. It is the same as window in the script scope (which is not window in the page scope).</p></li></ol><p>The above conclusion can be roughly summarized as follows: TamperMonkey’s runtime environment is not the same as the page’s JS script. The script in TamperMonkey runs in a sandbox environment, but both can operate the page.</p><p>The sandbox environment is also different. If your @grant value is none, then if you mount some properties to the window object, other scripts can theoretically access it.</p><p>But if your @grant is not none, then even the window object is separate, and the properties you mounted in the script cannot be accessed in other scripts.</p><h2 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h2><p>Let’s take a look at the basic format of the TamperMonkey script:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserScript</span></span><br><span class="line"><span class="comment">// @name         New Userscript</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Xray_vision</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// /UserScript</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Your code here...</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>We can see at a glance that this is a closure and an immediate function, so all variables defined in it are inaccessible externally unless we consciously mount them on the window.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>To sum up, the script in TamperMonkey runs in another environment that is completely independent of the page’s JS, and each script will not affect each other. At the same time, because the actual content of the script is in a closure, only if the grant is None and we consciously mount a property on the window object, otherwise this property will not be accessed externally.</p><h2 id="Expand"><a href="#Expand" class="headerlink" title="Expand"></a>Expand</h2><h3 id="Chrome"><a href="#Chrome" class="headerlink" title="Chrome"></a>Chrome</h3><p>Gecko runs JavaScript from a variety of sources and at a variety of privilege levels:</p><ul><li><p>The JavaScript code that implements the browser itself together with the C ++ core is called chrome code and runs with system privileges. If the chrome privileged code is compromised, an attacker can take over the user’s computer.</p></li><li><p>JavaScript loaded from a normal webpage is called content code. Because this code is loaded from an arbitrary webpage, it is considered untrusted and potentially hostile to other websites and users.</p></li><li><p>In addition to these two privilege levels, chrome code can also create sandboxes. Determine its privilege level for the security principal defined by the sandbox. If an extended principal is used, the sandbox will gain certain privileges over the content code and is protected by direct access to the content code.</p></li></ul><p>Security mechanisms in Gecko ensure asymmetric access between code with different privilege levels: for example, content code cannot access objects created by chrome code, but chrome code can access objects created by content.</p><p>However, even the ability to access content objects may pose a security risk to chrome code. JavaScript is a highly extensible language. Scripts running in web pages can add additional attributes (also known as expando attributes) to DOM objects, and even redefine standard DOM objects to perform unexpected operations. If chrome code relies on such modified objects, it can be tricked into doing things it shouldn’t.</p><p>For example: window.confirm () is a DOM API that should let users confirm an action and return a boolean value based on whether they click “OK” or “Cancel”. Web pages can redefine it to return true:</p><p>Any privileged code that calls this function and expects its result to represent user confirmation will be tricked. Of course, this is very naive, but accessing content objects from chrome can cause security issues in a more nuanced way.</p><p>This is the problem that Xray aims to solve. When a script accesses an object using Xray, it will only see the native version of that object. Any expandos are not visible, and if any properties of the object have been redefined, it will see the original implementation, not the redefined version.</p><p>Therefore, in the example above, the chrome code that calls window.confirm () of the content will get the original version of Confirm (), not the redefined version.</p><p>Privileged code automatically gets Xray when accessing objects belonging to less privileged code. Therefore, when chrome code accesses content objects, it will see them through Xray.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// chrome code</span></span><br><span class="line"><span class="keyword">var</span> transfer = gBrowser.<span class="property">contentWindow</span>.<span class="title function_">confirm</span>(<span class="string">&quot;Transfer all my money?&quot;</span>);</span><br><span class="line"><span class="comment">// calls the native implementation</span></span><br></pre></td></tr></table></figure><h4 id="Prohibit-Xray"><a href="#Prohibit-Xray" class="headerlink" title="Prohibit Xray"></a>Prohibit Xray</h4><p>Xray is a security heuristic designed to make the most common operations on untrusted objects simple and safe. However, some operations are too restrictive on them: for example, if you need to see expandos on DOM objects. In this case, you can give up Xray protection, but then you will no longer rely on any properties or functions that are being or are being executed. Any of them, even setters and getters, may have been redefined by untrusted code.</p><p>To discard the Xray of an object, you can use Components.utils.waiveXrays (object), or you can use the wrappedJSObject property of the object</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// chrome code</span></span><br><span class="line"><span class="keyword">var</span> waivedWindow = <span class="title class_">Components</span>.<span class="property">utils</span>.<span class="title function_">waiveXrays</span>(gBrowser.<span class="property">contentWindow</span>);</span><br><span class="line"><span class="keyword">var</span> transfer = waivedWindow.<span class="title function_">confirm</span>(<span class="string">&quot;Transfer all my money?&quot;</span>);</span><br><span class="line"><span class="comment">// calls the redefined implementation</span></span><br><span class="line"><span class="comment">// chrome code</span></span><br><span class="line"><span class="keyword">var</span> waivedWindow = gBrowser.<span class="property">contentWindow</span>.<span class="property">wrappedJSObject</span>;</span><br><span class="line"><span class="keyword">var</span> transfer = waivedWindow.<span class="title function_">confirm</span>(<span class="string">&quot;Transfer all my money?&quot;</span>);</span><br><span class="line"><span class="comment">// calls the redefined implementation</span></span><br></pre></td></tr></table></figure><p>The exemption is transitive: therefore, if you discard the Xray of an object, all its object properties are automatically discarded. For example, window.wrappedJSObject.document lets you discard the doc version.</p><p>To undo the waiver again, call Components.utils.unwaiveXrays (waivedObject):</p><h4 id="Xray"><a href="#Xray" class="headerlink" title="Xray"></a>Xray</h4><p>The main use of Xray is for DOM objects: objects that represent parts of a web page.</p><p>In Gecko, DOM objects have a dual representation: the canonical representation is in C ++, and in order to reflect the advantages of JavaScript code, this is reflected in JavaScript. Any modifications to these objects (such as adding expandos or redefining standard properties) are retained in JavaScript reflection and do not affect the C ++ representation.</p><p>Dual representation enables an elegant implementation of Xrays: Xray simply accesses the C ++ representation of the original object directly, and does not involve JavaScript reflection of the content at all. Instead of completely filtering out changes made to the content, Xray shorts the content completely.</p><p>This also makes the semantics of Xrays for DOM objects clearer: they are the same as the DOM specification because it is defined using WebIDL, and WebIDL also defines a C ++ representation.</p><h4 id="Xray-1"><a href="#Xray-1" class="headerlink" title="Xray"></a>Xray</h4><p>Until recently, built-in JavaScript objects that do not belong to the DOM (such as Date, Error, and Object) could not obtain Xrays when accessed through more privileged code.</p><p>In most cases, this is not a problem: the main problem Xrays solve is handling untrusted web content manipulation objects, and web content usually works with DOM objects. For example, if the content code creates a new Date object, it is usually created as a property of the DOM object, which is then filtered out by the DOM Xray.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// content code</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// redefine Date.getFullYear()</span></span><br><span class="line"><span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getFullYear</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="number">1000</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">// chrome code</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// contentWindow is an Xray, and date is an expando on contentWindow</span></span><br><span class="line"><span class="comment">// so date is filtered out</span></span><br><span class="line">gBrowser.<span class="property">contentWindow</span>.<span class="property">date</span>.<span class="title function_">getFullYear</span>()</span><br><span class="line"><span class="comment">// -&gt; TypeError: gBrowser.contentWindow.date is undefined</span></span><br></pre></td></tr></table></figure><h3 id="Extensions"><a href="#Extensions" class="headerlink" title="Extensions"></a>Extensions</h3><p>Extensions are made of different, but cohesive, components. Components can include <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/background_pages.html">background scripts</a>, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/content_scripts.html">content scripts</a>, an <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/options">options page</a>, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/user_interface.html">UI elements</a> and various logic files. Extension components are created with web development technologies: HTML, CSS, and JavaScript. An extension’s components will depend on its functionality and may not require every option</p><h4 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h4><p>An extension’s architecture will depend on its functionality, but many robust extensions will include multiple components:</p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/extensions/manifest">Manifest</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/overview#background_script">Background Script</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/overview#pages">UI Elements</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/overview#contentScripts">Content Script</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/overview#optionsPage">Options Page</a></li></ul><h4 id="Manifest"><a href="#Manifest" class="headerlink" title="Manifest"></a>Manifest</h4><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/manifest">https://developer.chrome.com/extensions/manifest</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Getting Started Example&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Build an Extension!&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;activeTab&quot;</span><span class="punctuation">,</span> <span class="string">&quot;declarativeContent&quot;</span><span class="punctuation">,</span> <span class="string">&quot;storage&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;background.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;page_action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started16.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;32&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started32.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started48.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started128.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started16.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;32&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started32.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started48.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/get_started128.png&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Content"><a href="#Content" class="headerlink" title="Content"></a>Content</h4><p> <strong>Content script</strong> is a part of your extension that runs in a specific webpage environment (and <strong>is not a backend script</strong> , which is part of the extension, nor is it a script loaded by the webpage using ‘&lt; script &gt;’, the script loaded by ‘&lt; script &gt;’ is part of the webpage).</p><p> <strong>Background scripts can access all WebExtension JavaScript APIs, but they cannot directly access the content of the webpage</strong> , so if you need Content Scripts to do this.</p><p>Just like a normal web page loading script, Content Scripts can read and modify page content using standard DOM APIS.</p><p>Content Scripts can only access a small subset of WebExtension APIS, but they can use the communication system to communicate with backend scripts to indirectly access WebExtension APIS.</p><h5 id="DOM-access"><a href="#DOM-access" class="headerlink" title="DOM access"></a>DOM access</h5><p>Content scripts can access and modify the DOM of the page, just like regular page scripts. They can also detect any changes made to the page by the page script.</p><p>However, content scripts get a “clean DOM view”, which means:</p><ul><li>content scripts cannot see javascript variables defined by page scripts.<br>If a page script redefines a DOM built-in property, content scripts will retrieve the original version of the property instead of the redefined version.</li></ul><p>At Gecko, this behavior is called X-ray vision (Xray).</p><p>For example, consider a webpage as follows:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;content-type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;page-scripts/page-script.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>The script file “page-script.js” is as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page-script.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add a new element to the DOM</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">p.<span class="property">textContent</span> = <span class="string">&quot;This paragraph was added by a page script.&quot;</span>;</span><br><span class="line">p.<span class="title function_">setAttribute</span>(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;page-script-para&quot;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(p);</span><br><span class="line"></span><br><span class="line"><span class="comment">// define a new property on the window</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">foo</span> = <span class="string">&quot;This global variable was added by a page script&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// redefine the built-in window.confirm() function</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">confirm</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;The page script has also redefined &#x27;confirm&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now an extension inserts a content script as follows:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// content-script.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// can access and modify the DOM</span></span><br><span class="line"><span class="keyword">var</span> pageScriptPara = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;page-script-para&quot;</span>);</span><br><span class="line">pageScriptPara.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;blue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// can&#x27;t see page-script-added properties</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">foo</span>);  <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sees the original form of redefined properties</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&quot;Are you sure?&quot;</span>); <span class="comment">// calls the original window.confirm()</span></span><br></pre></td></tr></table></figure><p>The opposite is also true: Page scripts are not aware of JavaScript properties added via content scripts.</p><p>This means that content scripts can <strong>rely on DOM properties to obtain predictable behavior</strong></p><p>One consequence of this behavior is that content script ** cannot retrieve any Javascript libraries loaded through the page. Therefore, if the page contains JQuery, content script will not care about it.</p><p>If a content script wants to use a Javascript library, the library itself must be inserted next to the content script like a content script:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*://*.mozilla.org/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;jquery.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;content-script.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h5 id="WebExtensions"><a href="#WebExtensions" class="headerlink" title="WebExtensions"></a>WebExtensions</h5><p>In addition to the standard DOM APIS, content scripts can use the following WebExtension APIS:</p><p>From <code>extension</code>:</p><ul><li><code>getURL()</code></li><li><code>inIncognitoContext</code></li></ul><p>From <code>runtime</code>:</p><ul><li><code>connect()</code></li><li><code>getManifest()</code></li><li><code>getURL()</code></li><li><code>onConnect</code></li><li><code>onMessage</code></li><li><code>sendMessage()</code></li></ul><p>From <code>i18n</code>:</p><ul><li><code>getMessage()</code></li><li><code>getAcceptLanguages()</code></li><li><code>getUILanguage()</code></li><li><code>detectLanguage()</code></li></ul><p>All’storage ‘.</p><p>Reference link:</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Xray_vision">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Xray_vision</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://stackoverflow.com/questions/10824697/why-is-window-and-unsafewindow-not-the-same-from-a-userscript-as-from-a-scrip">https://stackoverflow.com/questions/10824697/why-is-window-and-unsafewindow-not-the-same-from-a-userscript-as-from-a-scrip</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions/content_scripts#execution-environment">https://developer.chrome.com/extensions/content_scripts#execution-environment</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.chrome.com/extensions">https://developer.chrome.com/extensions</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/Content_scripts</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM">https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/285b6218/" title="TamperMonkey for Content Protection">https://sunra.top/en/posts/285b6218/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/a3d8e8d3/" rel="prev" title="Blob, Multipart Upload"><i class="fa fa-chevron-left"></i> Blob, Multipart Upload</a></div><div class="post-nav-item"> <a href="/en/posts/67f282b/" rel="next" title="ES6 Symbol">ES6 Symbol<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/285b6218/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>