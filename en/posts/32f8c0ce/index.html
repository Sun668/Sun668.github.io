<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="As one of the core features of the component, ‘Props’ is also one of the features we usually contact the most in the development of Vue projects. It can enrich the functions of the component and is al"><meta property="og:type" content="article"><meta property="og:title" content="Vue Source Code Learning (6) Props Attribute Analysis"><meta property="og:url" content="https://sunra.top/en/posts/32f8c0ce/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="As one of the core features of the component, ‘Props’ is also one of the features we usually contact the most in the development of Vue projects. It can enrich the functions of the component and is al"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2020-10-01T00:19:49.000Z"><meta property="article:modified_time" content="2024-06-26T23:38:47.877Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/en/posts/32f8c0ce/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/32f8c0ce/","path":"posts/32f8c0ce/","title":"Vue Source Code Learning (6) Props Attribute Analysis"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Vue Source Code Learning (6) Props Attribute Analysis | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#standardization"><span class="nav-number">1.</span> <span class="nav-text">Standardization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#initialization"><span class="nav-number">2.</span> <span class="nav-text">Initialization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#verification"><span class="nav-number">2.1.</span> <span class="nav-text">Verification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#responsive"><span class="nav-number">2.2.</span> <span class="nav-text">Responsive</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#agent"><span class="nav-number">2.3.</span> <span class="nav-text">Agent</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#props"><span class="nav-number">3.</span> <span class="nav-text">Props</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#subassembly"><span class="nav-number">3.1.</span> <span class="nav-text">Subassembly</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#subcomponent-re-rendering"><span class="nav-number">3.2.</span> <span class="nav-text">Subcomponent re-rendering</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#toggleobserving"><span class="nav-number">4.</span> <span class="nav-text">toggleObserving</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#summary"><span class="nav-number">5.</span> <span class="nav-text">Summary</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/32f8c0ce/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Vue Source Code Learning (6) Props Attribute Analysis | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Vue Source Code Learning (6) Props Attribute Analysis</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-10-01 08:19:49" itemprop="dateCreated datePublished" datetime="2020-10-01T08:19:49+08:00">2020-10-01</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-06-27 07:38:47" itemprop="dateModified" datetime="2024-06-27T07:38:47+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/32f8c0ce/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/32f8c0ce/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>As one of the core features of the component, ‘Props’ is also one of the features we usually contact the most in the development of Vue projects. It can enrich the functions of the component and is also a channel for communication between parent and child components.</p><p>Here thanks<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.imooc.com/t/3017249">ustbhuangyi</a>Boss massive open online course.</p><span id="more"></span><h2 id="standardization"><a class="markdownIt-Anchor" href="#standardization"></a> Standardization</h2><p>Before initializing’props’, ‘props’ will first be’normalized ‘once, which happens when’mergeOptions’, in’src/core/util/options.js’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mergeOptions</span> (</span><br><span class="line">  <span class="attr">parent</span>: <span class="title class_">Object</span>,</span><br><span class="line">  <span class="attr">child</span>: <span class="title class_">Object</span>,</span><br><span class="line">  vm?: <span class="title class_">Component</span></span><br><span class="line">): <span class="title class_">Object</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="title function_">normalizeProps</span>(child, vm)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeProps</span> (<span class="attr">options</span>: <span class="title class_">Object</span>, <span class="attr">vm</span>: ?<span class="title class_">Component</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> props = options.<span class="property">props</span></span><br><span class="line">  <span class="keyword">if</span> (!props) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="keyword">let</span> i, val, name</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(props)) &#123;</span><br><span class="line">    i = props.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      val = props[i]</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> val = <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        name = <span class="title function_">camelize</span>(val)</span><br><span class="line">        res[name] = &#123; <span class="attr">type</span>: <span class="literal">null</span> &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(<span class="string">&#x27;props must be strings when using array syntax.&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(props)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">      val = props[key]</span><br><span class="line">      name = <span class="title function_">camelize</span>(key)</span><br><span class="line">      res[name] = <span class="title function_">isPlainObject</span>(val)</span><br><span class="line">        ? val</span><br><span class="line">        : &#123; <span class="attr">type</span>: val &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">`Invalid value for option &quot;props&quot;: expected an Array or an Object, `</span> +</span><br><span class="line">      <span class="string">`but got <span class="subst">$&#123;toRawType(props)&#125;</span>.`</span>,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  options.<span class="property">props</span> = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Merge configuration We talked about it in the component section, which mainly deals with the object’option ‘that we define the component, and then mounts it to the instance’this. $options’ of the component.</p><p>We next focus on the implementation of’normalizeProps’. In fact, the main purpose of this function is to convert the’props’ we have written into object format, because in fact’props’ allows to be written in array format in addition to object format.</p><p>When’props’ is an array, each array element’prop ‘can only be a’string’, representing the’key ‘of’prop’, converted to hump format, and the type of’prop 'is null.</p><p>When’props’ is an object, for the’key ‘of each’prop’ in’props’, we convert the camel format, and its’value ', if not an object, we normalize it to an object.</p><p>If’props’ is neither an array nor an object, a warning is thrown.</p><p>For example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;nick-name&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>After normalizeProps, it will be normalized to:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options.<span class="property">props</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: &#123; <span class="attr">type</span>: <span class="literal">null</span> &#125;,</span><br><span class="line">  <span class="attr">nickName</span>: &#123; <span class="attr">type</span>: <span class="literal">null</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">nickName</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Boolean</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>After normalizeProps, it will be normalized to:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options.<span class="property">props</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: &#123; <span class="attr">type</span>: <span class="title class_">String</span> &#125;,</span><br><span class="line">  <span class="attr">nickName</span>: &#123; <span class="attr">type</span>: <span class="title class_">Boolean</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Since props in object form can specify the type of each prop and define other properties, it is recommended to define props in object form.</p><h2 id="initialization"><a class="markdownIt-Anchor" href="#initialization"></a> Initialization</h2><p>The initialization of’Props’ mainly occurs in the’initState ‘stage in’new Vue’, in’src/core/instance/state.js’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initState</span> (<span class="attr">vm</span>: <span class="title class_">Component</span>) &#123;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">  <span class="keyword">const</span> opts = vm.<span class="property">$options</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">props</span>) <span class="title function_">initProps</span>(vm, opts.<span class="property">props</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initProps</span> (<span class="attr">vm</span>: <span class="title class_">Component</span>, <span class="attr">propsOptions</span>: <span class="title class_">Object</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> propsData = vm.<span class="property">$options</span>.<span class="property">propsData</span> || &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> props = vm.<span class="property">_props</span> = &#123;&#125;</span><br><span class="line">  <span class="comment">// cache prop keys so that future props updates can iterate using Array</span></span><br><span class="line">  <span class="comment">// instead of dynamic object key enumeration.</span></span><br><span class="line">  <span class="keyword">const</span> keys = vm.<span class="property">$options</span>.<span class="property">_propKeys</span> = []</span><br><span class="line">  <span class="keyword">const</span> isRoot = !vm.<span class="property">$parent</span></span><br><span class="line">  <span class="comment">// root instance props should be converted</span></span><br><span class="line">  <span class="keyword">if</span> (!isRoot) &#123;</span><br><span class="line">    <span class="title function_">toggleObserving</span>(<span class="literal">false</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> propsOptions) &#123;</span><br><span class="line">    keys.<span class="title function_">push</span>(key)</span><br><span class="line">    <span class="keyword">const</span> value = <span class="title function_">validateProp</span>(key, propsOptions, propsData, vm)</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> hyphenatedKey = <span class="title function_">hyphenate</span>(key)</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isReservedAttribute</span>(hyphenatedKey) ||</span><br><span class="line">          config.<span class="title function_">isReservedAttr</span>(hyphenatedKey)) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">`&quot;<span class="subst">$&#123;hyphenatedKey&#125;</span>&quot; is a reserved attribute and cannot be used as component prop.`</span>,</span><br><span class="line">          vm</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">defineReactive</span>(props, key, value, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isRoot &amp;&amp; !isUpdatingChildComponent) &#123;</span><br><span class="line">          <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`Avoid mutating a prop directly since the value will be `</span> +</span><br><span class="line">            <span class="string">`overwritten whenever the parent component re-renders. `</span> +</span><br><span class="line">            <span class="string">`Instead, use a data or computed property based on the prop&#x27;s `</span> +</span><br><span class="line">            <span class="string">`value. Prop being mutated: &quot;<span class="subst">$&#123;key&#125;</span>&quot;`</span>,</span><br><span class="line">            vm</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">defineReactive</span>(props, key, value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// static props are already proxied on the component&#x27;s prototype</span></span><br><span class="line">    <span class="comment">// during Vue.extend(). We only need to proxy props defined at</span></span><br><span class="line">    <span class="comment">// instantiation here.</span></span><br><span class="line">    <span class="keyword">if</span> (!(key <span class="keyword">in</span> vm)) &#123;</span><br><span class="line">      <span class="title function_">proxy</span>(vm, <span class="string">`_props`</span>, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">toggleObserving</span>(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>‘initProps’ mainly does three things: validation, responsiveness, and proxying.</p><h3 id="verification"><a class="markdownIt-Anchor" href="#verification"></a> Verification</h3><p>The logic of the verification is simple, traverse’propsOptions’ and execute the’validateProp (key, propsOptions, propsData, vm) ‘method. The’propsOptions’ here is the’options.props’ object generated by the’props’ we defined after the specification, and’propsData ‘is the’prop’ data passed from the parent component. The purpose of the so-called verification is to check whether the data we pass meets the definition specification of’prop ‘. Let’s take a look at the’validateProp’ method, which is defined in’src/core/util/props.js’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">validateProp</span> (</span><br><span class="line">  <span class="attr">key</span>: string,</span><br><span class="line">  <span class="attr">propOptions</span>: <span class="title class_">Object</span>,</span><br><span class="line">  <span class="attr">propsData</span>: <span class="title class_">Object</span>,</span><br><span class="line">  vm?: <span class="title class_">Component</span></span><br><span class="line">): any &#123;</span><br><span class="line">  <span class="keyword">const</span> prop = propOptions[key]</span><br><span class="line">  <span class="keyword">const</span> absent = !<span class="title function_">hasOwn</span>(propsData, key)</span><br><span class="line">  <span class="keyword">let</span> value = propsData[key]</span><br><span class="line">  <span class="comment">// boolean casting</span></span><br><span class="line">  <span class="keyword">const</span> booleanIndex = <span class="title function_">getTypeIndex</span>(<span class="title class_">Boolean</span>, prop.<span class="property">type</span>)</span><br><span class="line">  <span class="keyword">if</span> (booleanIndex &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (absent &amp;&amp; !<span class="title function_">hasOwn</span>(prop, <span class="string">&#x27;default&#x27;</span>)) &#123;</span><br><span class="line">      value = <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value = <span class="string">&#x27;&#x27;</span> || value = <span class="title function_">hyphenate</span>(key)) &#123;</span><br><span class="line">      <span class="comment">// only cast empty string / same name to boolean if</span></span><br><span class="line">      <span class="comment">// boolean has higher priority</span></span><br><span class="line">      <span class="keyword">const</span> stringIndex = <span class="title function_">getTypeIndex</span>(<span class="title class_">String</span>, prop.<span class="property">type</span>)</span><br><span class="line">      <span class="keyword">if</span> (stringIndex &lt; <span class="number">0</span> || booleanIndex &lt; stringIndex) &#123;</span><br><span class="line">        value = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// check default value</span></span><br><span class="line">  <span class="keyword">if</span> (value = <span class="literal">undefined</span>) &#123;</span><br><span class="line">    value = <span class="title function_">getPropDefaultValue</span>(vm, prop, key)</span><br><span class="line">    <span class="comment">// since the default value is a fresh copy,</span></span><br><span class="line">    <span class="comment">// make sure to observe it.</span></span><br><span class="line">    <span class="keyword">const</span> prevShouldObserve = shouldObserve</span><br><span class="line">    <span class="title function_">toggleObserving</span>(<span class="literal">true</span>)</span><br><span class="line">    <span class="title function_">observe</span>(value)</span><br><span class="line">    <span class="title function_">toggleObserving</span>(prevShouldObserve)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">    <span class="comment">// skip validation for weex recycle-list child component props</span></span><br><span class="line">    !(__WEEX__ &amp;&amp; <span class="title function_">isObject</span>(value) &amp;&amp; (<span class="string">&#x27;@binding&#x27;</span> <span class="keyword">in</span> value))</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">assertProp</span>(prop, key, value, vm, absent)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ValidateProp does three main things: handles Boolean data, handles default data, asserts prop, and ultimately returns the value of prop.</p><p>Let’s first look at the processing logic of’Boolean 'type data.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> prop = propOptions[key]</span><br><span class="line"><span class="keyword">const</span> absent = !<span class="title function_">hasOwn</span>(propsData, key)</span><br><span class="line"><span class="keyword">let</span> value = propsData[key]</span><br><span class="line"><span class="comment">// boolean casting</span></span><br><span class="line"><span class="keyword">const</span> booleanIndex = <span class="title function_">getTypeIndex</span>(<span class="title class_">Boolean</span>, prop.<span class="property">type</span>)</span><br><span class="line"><span class="keyword">if</span> (booleanIndex &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (absent &amp;&amp; !<span class="title function_">hasOwn</span>(prop, <span class="string">&#x27;default&#x27;</span>)) &#123;</span><br><span class="line">    value = <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value = <span class="string">&#x27;&#x27;</span> || value = <span class="title function_">hyphenate</span>(key)) &#123;</span><br><span class="line">    <span class="comment">// only cast empty string / same name to boolean if</span></span><br><span class="line">    <span class="comment">// boolean has higher priority</span></span><br><span class="line">    <span class="keyword">const</span> stringIndex = <span class="title function_">getTypeIndex</span>(<span class="title class_">String</span>, prop.<span class="property">type</span>)</span><br><span class="line">    <span class="keyword">if</span> (stringIndex &lt; <span class="number">0</span> || booleanIndex &lt; stringIndex) &#123;</span><br><span class="line">      value = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>First, use’const booleanIndex = getTypeIndex (Boolean, prop.type) ‘to determine whether the definition of’prop’ is of type’Boolean '.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getType</span> (fn) &#123;</span><br><span class="line">  <span class="keyword">const</span> match = fn &amp;&amp; fn.<span class="title function_">toString</span>().<span class="title function_">match</span>(<span class="regexp">/^\s*function (\w+)/</span>)</span><br><span class="line">  <span class="keyword">return</span> match ? match[<span class="number">1</span>] : <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isSameType</span> (a, b) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">getType</span>(a) = <span class="title function_">getType</span>(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTypeIndex</span> (type, expectedTypes): number &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(expectedTypes)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isSameType</span>(expectedTypes, type) ? <span class="number">0</span> : -<span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = expectedTypes.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isSameType</span>(expectedTypes[i], type)) &#123;</span><br><span class="line">      <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The getTypeIndex function finds the index that matches type and expectedTypes and returns it.</p><p>The’prop 'type can be defined as a native constructor function or an array of native constructors, for example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">value</span>: [<span class="title class_">String</span>, <span class="title class_">Boolean</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If expectedTypes is a single constructor function, execute isSameType to determine whether it is the same type; if it is an array, then traverse the array, find the first one of the same type, and return its index.</p><p>Returning to the’validateProp ‘function, get’booleanIndex’ by’const booleanIndex = getTypeIndex (Boolean, prop.type) ‘, if’prop.type’ is a’Boolean ‘type, then use’absent &amp; &amp;! hasOwn (prop,’ default ') ’ to determine if the parent component did not pass this’prop ‘data and did not set’default’, then’value 'is false.</p><p>Then judge the value. = ‘’ || value In the case of = hyphenate (key) ‘, if it is satisfied, first obtain the index matching the type of’String’ through’const stringIndex = getTypeIndex (String, prop.type) ‘, and then judge the value of’stringIndex &lt; 0 | | booleanIndex &lt; stringIndex’ to determine whether the value of’value ‘is’true’. This logic is a bit confusing, we give 2 examples to illustrate:</p><p>For example, if you define a component’Student ':</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">nickName</span>: [<span class="title class_">Boolean</span>, <span class="title class_">String</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then introduce this component in the parent component.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;student name=&quot;Kate&quot; nick-name&gt;&lt;/student&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>Or:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;student name=&quot;Kate&quot; nick-name=&quot;nick-name&quot;&gt;&lt;/student&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>The first case does not write the value of the attribute, satisfying 'value = ‘’<code>，第二种满足</code> value = hyphenate (key) ‘, in addition, the’prop’ of’nickName ‘is of type’Boolean’ or’String ‘, and satisfies’booleanIndex &lt; stringIndex’, so the’value ‘of’nickName’ is’true ‘for’prop’.</p><p>Next, let’s take a look at the default data processing logic.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check default value</span></span><br><span class="line"><span class="keyword">if</span> (value = <span class="literal">undefined</span>) &#123;</span><br><span class="line">  value = <span class="title function_">getPropDefaultValue</span>(vm, prop, key)</span><br><span class="line">  <span class="comment">// since the default value is a fresh copy,</span></span><br><span class="line">  <span class="comment">// make sure to observe it.</span></span><br><span class="line">  <span class="keyword">const</span> prevShouldObserve = shouldObserve</span><br><span class="line">  <span class="title function_">toggleObserving</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="title function_">observe</span>(value)</span><br><span class="line">  <span class="title function_">toggleObserving</span>(prevShouldObserve)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When the value of’value ‘is’undefined’, it means that the parent component did not pass this’prop ‘at all, so we need to get the default value of this’prop’ through’getPropDefaultValue (vm, prop, key) ‘. We only focus on the implementation of’getPropDefaultValue’ here, the role of’toggleObserving ‘and’observe’ we will talk about later.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPropDefaultValue</span> (<span class="attr">vm</span>: ?<span class="title class_">Component</span>, <span class="attr">prop</span>: <span class="title class_">PropOptions</span>, <span class="attr">key</span>: string): any &#123;</span><br><span class="line">  <span class="comment">// no default, return undefined</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">hasOwn</span>(prop, <span class="string">&#x27;default&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> def = prop.<span class="property">default</span></span><br><span class="line">  <span class="comment">// warn against non-factory defaults for Object &amp; Array</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span> &amp;&amp; <span class="title function_">isObject</span>(def)) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&#x27;Invalid default value for prop &quot;&#x27;</span> + key + <span class="string">&#x27;&quot;: &#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;Props with type Object/Array must use a factory function &#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;to return the default value.&#x27;</span>,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// the raw prop value was also undefined from previous render,</span></span><br><span class="line">  <span class="comment">// return previous default value to avoid unnecessary watcher trigger</span></span><br><span class="line">  <span class="keyword">if</span> (vm &amp;&amp; vm.<span class="property">$options</span>.<span class="property">propsData</span> &amp;&amp;</span><br><span class="line">    vm.<span class="property">$options</span>.<span class="property">propsData</span>[key] = <span class="literal">undefined</span> &amp;&amp;</span><br><span class="line">    vm.<span class="property">_props</span>[key] ! <span class="literal">undefined</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> vm.<span class="property">_props</span>[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// call factory function for non-Function types</span></span><br><span class="line">  <span class="comment">// a value is Function if its prototype is function even across different execution context</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> def = <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="title function_">getType</span>(prop.<span class="property">type</span>) ! <span class="string">&#x27;Function&#x27;</span></span><br><span class="line">    ? def.<span class="title function_">call</span>(vm)</span><br><span class="line">    : def</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Check if’prop ‘does not define the’default’ property, then return’undefined ‘. Through this logic, we know that except for data of type’Boolean’, the default value of’prop ‘without setting the’default’ property is’undefined '.</p><p>Next is the determination of whether the default value of’prop ‘in the Development Environment is an object or array type. If so, a warning will be issued, because the default values of’prop’ of object and array type must return a factory function.</p><p>The next judgment is that if the value of’prop ‘passed by the parent component of the previous component rendering is’undefined’, it will directly return the default value of’vm._props [key] ‘from the previous time, which can avoid triggering unnecessary’watcher’ updates.</p><p>Finally, it is judged that if’def ‘is a factory function and the type of’prop’ is not’Function ‘, return the return value of the factory function, otherwise return’def’ directly.</p><p>At this point, we have covered the processing logic of the’Boolean ‘type data of the’validateProp’ function and the default data processing logic, and finally look at the assertion logic of’prop '.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line"><span class="comment">// skip validation for weex recycle-list child component props</span></span><br><span class="line">!(__WEEX__ &amp;&amp; <span class="title function_">isObject</span>(value) &amp;&amp; (<span class="string">&#x27;@binding&#x27;</span> <span class="keyword">in</span> value))</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="title function_">assertProp</span>(prop, key, value, vm, absent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the Development Environment and some environment other than weex, execute assertProp to make attribute assertions.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">assertProp</span> (</span><br><span class="line">  <span class="attr">prop</span>: <span class="title class_">PropOptions</span>,</span><br><span class="line">  <span class="attr">name</span>: string,</span><br><span class="line">  <span class="attr">value</span>: any,</span><br><span class="line">  <span class="attr">vm</span>: ?<span class="title class_">Component</span>,</span><br><span class="line">  <span class="attr">absent</span>: boolean</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (prop.<span class="property">required</span> &amp;&amp; absent) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&#x27;Missing required prop: &quot;&#x27;</span> + name + <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (value  <span class="literal">null</span> &amp;&amp; !prop.<span class="property">required</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> type = prop.<span class="property">type</span></span><br><span class="line">  <span class="keyword">let</span> valid = !type || type = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">const</span> expectedTypes = []</span><br><span class="line">  <span class="keyword">if</span> (type) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(type)) &#123;</span><br><span class="line">      type = [type]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; type.<span class="property">length</span> &amp;&amp; !valid; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> assertedType = <span class="title function_">assertType</span>(value, type[i])</span><br><span class="line">      expectedTypes.<span class="title function_">push</span>(assertedType.<span class="property">expectedType</span> || <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      valid = assertedType.<span class="property">valid</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!valid) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="title function_">getInvalidTypeMessage</span>(name, value, expectedTypes),</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> validator = prop.<span class="property">validator</span></span><br><span class="line">  <span class="keyword">if</span> (validator) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">validator</span>(value)) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;Invalid prop: custom validator check failed for prop &quot;&#x27;</span> + name + <span class="string">&#x27;&quot;.&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The purpose of the assertProp function is to assert whether the prop is valid.</p><p>First, if’prop ‘defines the’required’ attribute but the parent component does not pass this’prop 'data, a warning will be issued.</p><p>Then it is determined that if’value ‘is empty and’prop’ does not define the’required 'attribute, it will be returned directly.</p><p>Then go to check the type of’prop ‘, first get the type’type’ defined in’prop ', and try to convert it into an array of types, and then traverse this array in turn, execute’assertType (value, type [i]) ’ to get the result of the assertion, until the traversal is completed or’valid ‘is’true’ when the loop jumps out.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> simpleCheckRE = <span class="regexp">/^(String|Number|Boolean|Function|Symbol)$/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">assertType</span> (<span class="attr">value</span>: any, <span class="attr">type</span>: <span class="title class_">Function</span>): &#123;</span><br><span class="line">  <span class="attr">valid</span>: boolean;</span><br><span class="line">  <span class="attr">expectedType</span>: string;</span><br><span class="line">&#125; &#123;</span><br><span class="line">  <span class="keyword">let</span> valid</span><br><span class="line">  <span class="keyword">const</span> expectedType = <span class="title function_">getType</span>(type)</span><br><span class="line">  <span class="keyword">if</span> (simpleCheckRE.<span class="title function_">test</span>(expectedType)) &#123;</span><br><span class="line">    <span class="keyword">const</span> t = <span class="keyword">typeof</span> value</span><br><span class="line">    valid = t = expectedType.<span class="title function_">toLowerCase</span>()</span><br><span class="line">    <span class="comment">// for primitive wrapper objects</span></span><br><span class="line">    <span class="keyword">if</span> (!valid &amp;&amp; t = <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      valid = value <span class="keyword">instanceof</span> type</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (expectedType = <span class="string">&#x27;Object&#x27;</span>) &#123;</span><br><span class="line">    valid = <span class="title function_">isPlainObject</span>(value)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (expectedType = <span class="string">&#x27;Array&#x27;</span>) &#123;</span><br><span class="line">    valid = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(value)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    valid = value <span class="keyword">instanceof</span> type</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    valid,</span><br><span class="line">    expectedType</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The logic of assertType is very simple. First, get the expected type of prop expectedType through getType (type), then compare the value of prop value and expectedType according to several different situations, and finally return the matching result.</p><p>If “valid” is still “false” after the loop ends, then the value “value” of “prop” does not match the type defined by “prop”, then a warning message generated by &quot;getInvalidTypeMessage (name, value, expectedTypes) &quot; will be output, without going into detail.</p><p>Finally, it is determined that when’prop ‘defines its own’validator’ custom validator, the’validator 'validator method is executed, and a warning message is output if the verification does not pass.</p><h3 id="responsive"><a class="markdownIt-Anchor" href="#responsive"></a> Responsive</h3><p>Returning to the’initProps’ method, when we verify the’prop 'with’const value = validateProp (key, propsOptions, propsData, vm) ’ and get the value of’prop ‘, we need to use’defineReactive’ to turn’prop 'into a response.</p><p>We have already introduced’defineReactive ‘before. It should be noted here that in the Development Environment, we will check whether the’key’ of’prop ‘is a reserved attribute of’HTML’, and we will add a custom’setter ‘when’defineReactive’. When we assign a value to’prop 'directly, a warning will be output:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> ! <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hyphenatedKey = <span class="title function_">hyphenate</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isReservedAttribute</span>(hyphenatedKey) ||</span><br><span class="line">      config.<span class="title function_">isReservedAttr</span>(hyphenatedKey)) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">`&quot;<span class="subst">$&#123;hyphenatedKey&#125;</span>&quot; is a reserved attribute and cannot be used as component prop.`</span>,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">defineReactive</span>(props, key, value, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isRoot &amp;&amp; !isUpdatingChildComponent) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">`Avoid mutating a prop directly since the value will be `</span> +</span><br><span class="line">        <span class="string">`overwritten whenever the parent component re-renders. `</span> +</span><br><span class="line">        <span class="string">`Instead, use a data or computed property based on the prop&#x27;s `</span> +</span><br><span class="line">        <span class="string">`value. Prop being mutated: &quot;<span class="subst">$&#123;key&#125;</span>&quot;`</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>The one difference about the response of’prop ‘is that when’vm’ is not the root instance, it will perform’toggleObserving (false) 'first. Its purpose is to optimize the response. We will skip it first and explain it in detail later.</p><h3 id="agent"><a class="markdownIt-Anchor" href="#agent"></a> Agent</h3><p>After reactive processing, we will add the value of’prop 'to’vm.<em>props’, such as’prop ‘with key’name’, its value is stored in’vm.</em> <a target="_blank" rel="external nofollow noopener noreferrer" href="http://props.name">props.name</a> ‘, but we can access this’prop’ in the component through '<a target="_blank" rel="external nofollow noopener noreferrer" href="http://this.name">this.name</a> ', which is what the proxy does.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// static props are already proxied on the component&#x27;s prototype</span></span><br><span class="line"><span class="comment">// during Vue.extend(). We only need to proxy props defined at</span></span><br><span class="line"><span class="comment">// instantiation here.</span></span><br><span class="line"><span class="keyword">if</span> (!(key <span class="keyword">in</span> vm)) &#123;</span><br><span class="line">  <span class="title function_">proxy</span>(vm, <span class="string">`_props`</span>, key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above requirements are achieved through the’proxy 'function.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sharedPropertyDefinition = &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">get</span>: noop,</span><br><span class="line">  <span class="attr">set</span>: noop</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">proxy</span> (<span class="attr">target</span>: <span class="title class_">Object</span>, <span class="attr">sourceKey</span>: string, <span class="attr">key</span>: string) &#123;</span><br><span class="line">  sharedPropertyDefinition.<span class="property">get</span> = <span class="keyword">function</span> <span class="title function_">proxyGetter</span> () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>[sourceKey][key]</span><br><span class="line">  &#125;</span><br><span class="line">  sharedPropertyDefinition.<span class="property">set</span> = <span class="keyword">function</span> <span class="title function_">proxySetter</span> (val) &#123;</span><br><span class="line">    <span class="variable language_">this</span>[sourceKey][key] = val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, sharedPropertyDefinition)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When visiting <a target="_blank" rel="external nofollow noopener noreferrer" href="http://this.name">this.name</a> is equivalent to visiting _ <a target="_blank" rel="external nofollow noopener noreferrer" href="http://props.name">props.name</a>.</p><p>In fact, for subcomponents that are not root instances, the proxy for’prop ‘occurs in the’Vue.extend’ stage, in’src/core/global-api/extende.js’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">extend</span> = <span class="keyword">function</span> (<span class="params">extendOptions: <span class="built_in">Object</span></span>): <span class="title class_">Function</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Sub</span> = <span class="keyword">function</span> <span class="title function_">VueComponent</span> (options) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_init</span>(options)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// For props and computed properties, we define the proxy getters on</span></span><br><span class="line">  <span class="comment">// the Vue instances at extension time, on the extended prototype. This</span></span><br><span class="line">  <span class="comment">// avoids Object.defineProperty calls for each instance created.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="title function_">initProps</span>(<span class="title class_">Sub</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">computed</span>) &#123;</span><br><span class="line">    <span class="title function_">initComputed</span>(<span class="title class_">Sub</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Sub</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initProps</span> (<span class="title class_">Comp</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> props = <span class="title class_">Comp</span>.<span class="property">options</span>.<span class="property">props</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">    <span class="title function_">proxy</span>(<span class="title class_">Comp</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">`_props`</span>, key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The advantage of this is that there is no need to do a layer of’proxy 'for each component instance, which is an optimization method.</p><h2 id="props"><a class="markdownIt-Anchor" href="#props"></a> Props</h2><p>We know that when the’props’ value passed by the parent component to the child component changes, the corresponding value of the child component will also change, and it will trigger the re-rendering of the child component. Then we will analyze these two processes from the source code point of view.</p><h3 id="subassembly"><a class="markdownIt-Anchor" href="#subassembly"></a> Subassembly</h3><p>First of all, the value of the’prop ‘data changes in the parent component. We know that the’prop’ data will be accessed during the’render ‘process of the parent component, so when the’prop’ data changes, it will definitely trigger the re-rendering of the parent component, so how does the re-rendering update the value of the’prop 'corresponding to the child component?</p><p>At the end of the parent component re-rendering, the’patch ‘process will be executed, and then the’patchVnode’ function will be executed. The’patchVnode ‘is usually a recursion process. When it encounters the component’vnode’, it will execute the’prepatch ‘hook function of the component update process, in’src/core/vdom/patch.js’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">patchVnode</span> (</span><br><span class="line">  oldVnode,</span><br><span class="line">  vnode,</span><br><span class="line">  insertedVnodeQueue,</span><br><span class="line">  ownerArray,</span><br><span class="line">  index,</span><br><span class="line">  removeOnly</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> i</span><br><span class="line">  <span class="keyword">const</span> data = vnode.<span class="property">data</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(data) &amp;&amp; <span class="title function_">isDef</span>(i = data.<span class="property">hook</span>) &amp;&amp; <span class="title function_">isDef</span>(i = i.<span class="property">prepatch</span>)) &#123;</span><br><span class="line">    <span class="title function_">i</span>(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The prepatch function is defined in src/core/vdom/create-component .js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">prepatch (<span class="attr">oldVnode</span>: <span class="title class_">MountedComponentVNode</span>, <span class="attr">vnode</span>: <span class="title class_">MountedComponentVNode</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> options = vnode.<span class="property">componentOptions</span></span><br><span class="line">  <span class="keyword">const</span> child = vnode.<span class="property">componentInstance</span> = oldVnode.<span class="property">componentInstance</span></span><br><span class="line">  <span class="title function_">updateChildComponent</span>(</span><br><span class="line">    child,</span><br><span class="line">    options.<span class="property">propsData</span>, <span class="comment">// updated props</span></span><br><span class="line">    options.<span class="property">listeners</span>, <span class="comment">// updated listeners</span></span><br><span class="line">    vnode, <span class="comment">// new parent vnode</span></span><br><span class="line">    options.<span class="property">children</span> <span class="comment">// new children</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The’updateChildComponent ‘method will be called internally to update the’props’. Note that the second parameter is the’propData ‘of the parent component, so why is’vnode.assementOptions.propsData’ the’prop ‘data passed by the parent component to the child component? (This also explains the source of the’propsData’ for the first rendering)? It turns out that during the’render ‘process of the component, the component node will be created through the’createComponent’ method:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createComponent</span> (</span><br><span class="line">  <span class="title class_">Ctor</span>: <span class="title class_">Class</span>&lt;<span class="title class_">Component</span>&gt; | <span class="title class_">Function</span> | <span class="title class_">Object</span> | <span class="keyword">void</span>,</span><br><span class="line">  <span class="attr">data</span>: ?<span class="title class_">VNodeData</span>,</span><br><span class="line">  <span class="attr">context</span>: <span class="title class_">Component</span>,</span><br><span class="line">  <span class="attr">children</span>: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;,</span><br><span class="line">  tag?: string</span><br><span class="line">): <span class="title class_">VNode</span> | <span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt; | <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// extract props</span></span><br><span class="line">  <span class="keyword">const</span> propsData = <span class="title function_">extractPropsFromVNodeData</span>(data, <span class="title class_">Ctor</span>, tag)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">    <span class="string">`vue-component-<span class="subst">$&#123;Ctor.cid&#125;</span><span class="subst">$&#123;name ? <span class="string">`-<span class="subst">$&#123;name&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>,</span><br><span class="line">    data, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, context,</span><br><span class="line">    &#123; <span class="title class_">Ctor</span>, propsData, listeners, tag, children &#125;,</span><br><span class="line">    asyncFactory</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the process of creating the component vnode, first extract the propData from the data, and then in the new VNode, as the seventh parameter VNodeComponentOptions in a property passed, so we can get the prop data through the vnode.assementOptions.propsData.</p><p>Then look at the’updateChildComponent ‘function, which is defined in’src/core/instance/lifecycle.js’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updateChildComponent</span> (</span><br><span class="line">  <span class="attr">vm</span>: <span class="title class_">Component</span>,</span><br><span class="line">  <span class="attr">propsData</span>: ?<span class="title class_">Object</span>,</span><br><span class="line">  <span class="attr">listeners</span>: ?<span class="title class_">Object</span>,</span><br><span class="line">  <span class="attr">parentVnode</span>: <span class="title class_">MountedComponentVNode</span>,</span><br><span class="line">  <span class="attr">renderChildren</span>: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// update props</span></span><br><span class="line">  <span class="keyword">if</span> (propsData &amp;&amp; vm.<span class="property">$options</span>.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="title function_">toggleObserving</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> props = vm.<span class="property">_props</span></span><br><span class="line">    <span class="keyword">const</span> propKeys = vm.<span class="property">$options</span>.<span class="property">_propKeys</span> || []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; propKeys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> key = propKeys[i]</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">propOptions</span>: any = vm.<span class="property">$options</span>.<span class="property">props</span> <span class="comment">// wtf flow?</span></span><br><span class="line">      props[key] = <span class="title function_">validateProp</span>(key, propOptions, propsData, vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">toggleObserving</span>(<span class="literal">true</span>)</span><br><span class="line">    <span class="comment">// keep a copy of raw propsData</span></span><br><span class="line">    vm.<span class="property">$options</span>.<span class="property">propsData</span> = propsData</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Let’s focus on the relevant logic of updating’props’. Here’propsData ‘is the’props’ data passed by the parent component, and’vm ‘is the instance of the child component.’ vm._props ‘points to the’props’ value of the child component, and’propKeys’ is the’key ‘of all the’props’ defined in the cached child component during the previous’initProps’ process. The main logic is to traverse’propKeys’, and then execute’props [key] = validateProp (key, propOptions, propsData, vm) ‘to revalidate and calculate the new’prop’ data, and update’vm._props ‘, that is, the’props’ of the subcomponent, which is the update process of the subcomponent’props’.</p><h3 id="subcomponent-re-rendering"><a class="markdownIt-Anchor" href="#subcomponent-re-rendering"></a> Subcomponent re-rendering</h3><p>In fact, there are two cases of re-rendering of subcomponents, one is the value of’prop ‘is modified, and the other is the change of the internal property of’prop’ of the object type.</p><p>Let’s take a look at the situation where the value of’prop 'is modified. When executing’props [key] = validateProp (key, propOptions, propsData, vm) ’ to update the subcomponent’prop ‘, it will trigger the’setter’ process of’prop ‘. As long as the’prop’ value is accessed when rendering the subcomponent, then according to the principle of responsiveness, the rerendering of the subcomponent will be triggered.</p><p>Let’s take a look again. When the internal properties of the object type’prop ‘change, the update of the subcomponent’prop’ is not actually triggered at this time. However, during the rendering process of the child component, this object’prop ‘has been accessed, so this object’prop’ will collect the’render watcher ‘of the child component into the dependency when it triggers the’getter’, and then when we update the parent component When a property of this object’prop ‘is used, the’setter’ process will be triggered, and the’update ‘of the child component’render watcher’ will be notified, which in turn triggers the re-rendering of the child component.</p><p>These are the two situations when the parent component’props’ is updated, triggering a child component to re-render.</p><h2 id="toggleobserving"><a class="markdownIt-Anchor" href="#toggleobserving"></a> toggleObserving</h2><p>Finally, let’s talk about’toggleObserving ‘, which is defined in’src/core/observer/index.js’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> <span class="attr">shouldObserve</span>: boolean = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">toggleObserving</span> (<span class="attr">value</span>: boolean) &#123;</span><br><span class="line">  shouldObserve = value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It defines the’shouldObserve ‘variable in the current module to control whether the current value needs to be turned into an’Observer’ object during the’observe 'process.</p><p>So why do we execute toggleObserving (false) multiple times during the initialization and update of props? Next, we will analyze these situations.</p><p>In the process of’initProps’:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isRoot = !vm.<span class="property">$parent</span></span><br><span class="line"><span class="comment">// root instance props should be converted</span></span><br><span class="line"><span class="keyword">if</span> (!isRoot) &#123;</span><br><span class="line">  <span class="title function_">toggleObserving</span>(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> propsOptions) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">validateProp</span>(key, propsOptions, propsData, vm)</span><br><span class="line">  <span class="title function_">defineReactive</span>(props, key, value)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">toggleObserving</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>For non-root instances, we do toggleObserving (false), and then for each prop value, we do defineReactive (props, key, value) to turn it into a response.</p><p>Recall the definition of’defineReactive ':</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">defineReactive</span> (</span><br><span class="line">  <span class="attr">obj</span>: <span class="title class_">Object</span>,</span><br><span class="line">  <span class="attr">key</span>: string,</span><br><span class="line">  <span class="attr">val</span>: any,</span><br><span class="line">  customSetter?: ?<span class="title class_">Function</span>,</span><br><span class="line">  shallow?: boolean</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> childOb = !shallow &amp;&amp; <span class="title function_">observe</span>(val)</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> <span class="title function_">reactiveGetter</span> () &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> <span class="title function_">reactiveSetter</span> (newVal) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Usually the observe function is executed for the value val, and then the recursion is executed when val is an object or array, and the defineReactive is executed to make their child properties responsive, but since the value of shouldObserve becomes false, this recursion process is omitted. Why is this so?</p><p>Because as we analyzed earlier, for the’prop ‘value of the object, the’prop’ value of the child component always points to the’prop ‘value of the parent component, and as long as the’prop’ value of the parent component changes, it will trigger the re-rendering of the child component, so this’observe 'process can be omitted.</p><p>Finally, execute toggleObserving (true) to restore shouldObserve to true.</p><p>In the process of validateProp:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check default value</span></span><br><span class="line"><span class="keyword">if</span> (value = <span class="literal">undefined</span>) &#123;</span><br><span class="line">  value = <span class="title function_">getPropDefaultValue</span>(vm, prop, key)</span><br><span class="line">  <span class="comment">// since the default value is a fresh copy,</span></span><br><span class="line">  <span class="comment">// make sure to observe it.</span></span><br><span class="line">  <span class="keyword">const</span> prevShouldObserve = shouldObserve</span><br><span class="line">  <span class="title function_">toggleObserving</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="title function_">observe</span>(value)</span><br><span class="line">  <span class="title function_">toggleObserving</span>(prevShouldObserve)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is the logic of the parent component not passing the’prop 'value to the default value, because this value is a copy, so we need’toggleObserving (true) ', and then execute’observe (value) 'to turn the value into a response.</p><p>During the updateChildComponent process:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update props</span></span><br><span class="line"><span class="keyword">if</span> (propsData &amp;&amp; vm.<span class="property">$options</span>.<span class="property">props</span>) &#123;</span><br><span class="line">  <span class="title function_">toggleObserving</span>(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> props = vm.<span class="property">_props</span></span><br><span class="line">  <span class="keyword">const</span> propKeys = vm.<span class="property">$options</span>.<span class="property">_propKeys</span> || []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; propKeys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = propKeys[i]</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">propOptions</span>: any = vm.<span class="property">$options</span>.<span class="property">props</span> <span class="comment">// wtf flow?</span></span><br><span class="line">    props[key] = <span class="title function_">validateProp</span>(key, propOptions, propsData, vm)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">toggleObserving</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="comment">// keep a copy of raw propsData</span></span><br><span class="line">  vm.<span class="property">$options</span>.<span class="property">propsData</span> = propsData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In fact, like the logic of’initProps’, there is no need to do reactive processing on the reference type’props’ recursion, so’toggleObserving (false) 'is also needed.</p><h2 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h2><p>Through the analysis of this section, we understand the implementation principle of the normalization, initialization, update and other processes of’props’; also understand how to optimize’props’ responsively within Vue; at the same time, we also understand how the change of’props’ triggers the update of subcomponents. Understanding these will be of great help to our usual application of’props’ and location tracking when encountering problems.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/32f8c0ce/" title="Vue Source Code Learning (6) Props Attribute Analysis">https://sunra.top/en/posts/32f8c0ce/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/4c20763f/" rel="prev" title="Vue source code learning (5) diff algorithm analysis"><i class="fa fa-chevron-left"></i> Vue source code learning (5) diff algorithm analysis</a></div><div class="post-nav-item"> <a href="/en/posts/8a7b9568/" rel="next" title="Basic Data Structure - Queue">Basic Data Structure - Queue<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/32f8c0ce/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>