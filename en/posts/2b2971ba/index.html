<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="The Chinese name of OAuth is the Open Authorization Protocol. This name is carefully tested by everyone. It is an authorization protocol. ** Any website that implements this protocol can grant corresp"><meta property="og:type" content="article"><meta property="og:title" content="Development and Design of OAuth"><meta property="og:url" content="https://sunra.top/en/posts/2b2971ba/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="The Chinese name of OAuth is the Open Authorization Protocol. This name is carefully tested by everyone. It is an authorization protocol. ** Any website that implements this protocol can grant corresp"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586583310/Cloud/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200411133437_kt05s5.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586584078/Cloud/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200411134737_w5ftzj.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586587044/Cloud/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200411143642_a7kkr8.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1608117974/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20201216192144_wzrlgz.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1608118806/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20201216193951_hiq7je.png"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1608119884/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20201216195014_gz6sjt.png"><meta property="article:published_time" content="2020-04-11T05:26:14.000Z"><meta property="article:modified_time" content="2025-07-02T04:39:58.336Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586583310/Cloud/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200411133437_kt05s5.png"><link rel="canonical" href="https://sunra.top/en/posts/2b2971ba/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/2b2971ba/","path":"posts/2b2971ba/","title":"Development and Design of OAuth"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Development and Design of OAuth | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#examples-of-practical-applications"><span class="nav-number">1.</span> <span class="nav-text">Examples of practical applications</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#the-development-process-of-landing-methods"><span class="nav-number">2.</span> <span class="nav-text">The development process of landing methods</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#username-password"><span class="nav-number">2.1.</span> <span class="nav-text">Username Password</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#session%E5%92%8Ccookie"><span class="nav-number">2.2.</span> <span class="nav-text">Session和Cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#token"><span class="nav-number">2.3.</span> <span class="nav-text">Token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sso"><span class="nav-number">2.4.</span> <span class="nav-text">SSO</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#take-a-practical-look-at-the-request-for-oauth-during-the-sso-process"><span class="nav-number">3.</span> <span class="nav-text">Take a practical look at the request for OAuth during the SSO process</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#describe-some-details-of-the-oauth20-design-in-authorization-code-mode"><span class="nav-number">4.</span> <span class="nav-text">Describe some details of the OAuth2.0 design in authorization code mode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-do-these-parameters-represent"><span class="nav-number">4.1.</span> <span class="nav-text">What do these parameters represent?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#why-send-a-redirect_uri-to-the-idp-in-the-first-place"><span class="nav-number">4.2.</span> <span class="nav-text">Why send a redirect_uri to the IDP in the first place?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#why-go-around-such-a-big-circle-why-do-you-need-to-change-the-code-one-more-step-access_token"><span class="nav-number">4.3.</span> <span class="nav-text">Why go around such a big circle, why do you need to change the code one more step access_token?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#whats-the-use-of-secrets"><span class="nav-number">4.4.</span> <span class="nav-text">What’s the use of secrets?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-the-use-of-the-state"><span class="nav-number">4.5.</span> <span class="nav-text">What is the use of the State?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#why-did-it-return-two-tokens-in-the-end"><span class="nav-number">4.6.</span> <span class="nav-text">Why did it return two tokens in the end?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#other-modes-in-oauth20"><span class="nav-number">5.</span> <span class="nav-text">Other modes in OAuth2.0</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#simplified-mode"><span class="nav-number">5.1.</span> <span class="nav-text">Simplified mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#password-mode"><span class="nav-number">5.2.</span> <span class="nav-text">Password mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#client-mode"><span class="nav-number">5.3.</span> <span class="nav-text">Client mode</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#oauth10"><span class="nav-number">6.</span> <span class="nav-text">OAuth1.0</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10a"><span class="nav-number">6.1.</span> <span class="nav-text">1.0a</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/2b2971ba/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Development and Design of OAuth | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Development and Design of OAuth</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-04-11 13:26:14" itemprop="dateCreated datePublished" datetime="2020-04-11T13:26:14+08:00">2020-04-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2025-07-02 12:39:58" itemprop="dateModified" datetime="2025-07-02T12:39:58+08:00">2025-07-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/Security/" itemprop="url" rel="index"><span itemprop="name">Security</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/2b2971ba/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/2b2971ba/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>The Chinese name of OAuth is the Open Authorization Protocol. This name is carefully tested by everyone. It is an authorization protocol. ** Any website that implements this protocol can grant corresponding users to certain applications registered here under the conditions of user consent. Permission ** for certain resources on this website, and this permission is generally represented by token.</p><span id="more"></span><h2 id="examples-of-practical-applications"><a class="markdownIt-Anchor" href="#examples-of-practical-applications"></a> Examples of practical applications</h2><p>When you go to leetcode to log in, the following page will pop up</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586583310/Cloud/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200411133437_kt05s5.png" alt="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586583310/Cloud/微信截图_20200411133437_kt05s5.png"></p><p>Here we have two options, one is to register an account directly, and the other is to choose a third-party login, such as QQ login, which uses OAuth in the third-party login.</p><p>For this second method, a few points should be emphasized here:</p><ul><li>** The number of your accounts has not decreased at all, you still have both leetcode and qq accounts **, but qq provides the OAuth protocol, you authorize leetcode to obtain your information in qq, leetcode uses this information To create your account in leetcode, your account in leetcode will not be stored in qq at all, which is a bit similar to the real life you need to take your ID card when you register an account in the relevant institution, this institution uses your ID card Go to the Public Security Bureau system to find your information, and then use this information to create your account in this institution. You give these institutions an ID card is similar to a process of authorizing it to go to the Public Security Bureau to manipulate your information.</li><li>The OAuth protocol is just an authorization protocol, and the above process is called ** third-party authorized login. The login action is not specified in the OAuth protocol, that is to say, OAuth alone cannot complete the set of authorized login actions **, and OAuth is not only It is used for third-party login. Although we talk about OAuth most of the time with third-party authorized login, we need to break this limiting thinking.</li></ul><h2 id="the-development-process-of-landing-methods"><a class="markdownIt-Anchor" href="#the-development-process-of-landing-methods"></a> The development process of landing methods</h2><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586584078/Cloud/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200411134737_w5ftzj.png" alt="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586584078/Cloud/微信截图_20200411134737_w5ftzj.png"></p><h3 id="username-password"><a class="markdownIt-Anchor" href="#username-password"></a> Username Password</h3><p>At the beginning of our server-side rendering and static pages, we only authenticate through username and password, which is the basis of all authentication, and most of the future authentication methods are still based on this method.</p><p>This method is very useful at the beginning, the website first gives you a landing page, you log in successfully to return another page from the server, you get this page to show that you have been logged in, and your identity information has been returned before writing the page, but you can not see.</p><p>But the biggest problem with doing this is that once you close the page, the next time you open it, you have to log in again, which will have a poor User Experience. So we started to think of a way to save the user’s login status? So there is a second way, Session and Cookie.</p><h3 id="session和cookie"><a class="markdownIt-Anchor" href="#session和cookie"></a> Session和Cookie</h3><p>In this way, after the user successfully logs in for the first time, the user’s information will be saved in the session and stored in the server, and then a sessionId flag will be generated to mark the session and returned to the front end through the set-cookie header. In this way, due to the implementation decision of the browser, every same-origin request initiated will automatically bring the cookie under the source, which also brings the sessionId, so that each time the server only needs to check the cookie sessionId, verify its validity to find user information.</p><p>But this has a problem, the browser is very unreliable, basically the browser knows it is likely to know the whole world, here is recommended to take a closer look at the same origin policy, this thing is not as strict as imagined, recently I It has a few more cognitions:</p><ul><li>The same-origin policy generally only restricts requests such as XMLHttpRequest, such as Ajax. For requests made directly by the address bar, there is no restriction, and whether the request for Retargeting this request is restricted is still being explored.</li><li>Cross-domain write operations such as Form Submission, Retargeting, etc. are generally unrestricted</li><li>Cross-origin resource embedding is generally unlimited.</li><li>Cross-domain read operations are generally not allowed, but can be broken by the previous one, such as using the script tag to load scripts across domains</li><li>Scripts from different domains cannot operate on dom.</li></ul><p>Through the above cognition, we can find a more critical thing, the same origin policy of the browser is not limited to the direct request initiated by the src, and as long as the cookie under the same domain name as the link you requested will be automatically brought.</p><p>Here is a classic example, that is, if you go to the bank website to log in, the sessionid is stored in the cookie, before the cookie expires, you open an attacker’s website, there is an img tag, its src attribute is <a target="_blank" rel="external nofollow noopener noreferrer" href="http://bank.com/tran/1000">bank.com/tran/1000</a>, that is, the meaning of the transfer of 1000 yuan, because it is src, so the browser will automatically initiate this request, although there is certainly no picture return, but the request has been issued, and will automatically bring the bank’s cookie that has not expired, because the browser sees that the address you requested is the bank, it will automatically help you bring it.</p><p>The above example is a relatively simple CSRF attack.</p><p>The main purpose of the above example is to show that ** cookies are not secure, even with the same origin policy **.</p><p>And with the development of distributed systems, if you store identities in this way, you have to maintain a copy of the identity on each server and ensure its consistency.</p><p>Based on the above two reasons, we are thinking again, is there any way to throw the identity information back to the front end, so that every time the front end comes with the identity information, I can verify whether I granted it to him, and make this method safer? So, we came up with a Token. These are also two characteristics of a token, one is stored on the front end, and the other is generated by the server, which is generally not stored in cookies.</p><h3 id="token"><a class="markdownIt-Anchor" href="#token"></a> Token</h3><p>Just now we said that Token is the proof of our identity generated by the server and stored on the front end, so how can we ensure its security? An older practice is if your page is server-side rendering, insert your token in each place where you need to submit a request before returning, so that this token can not be stored in a cookie, and cross-domain scripts cannot operate dom and cannot obtain your token.</p><p>But in this way, it seems to be back to the beginning. As soon as the page is closed, the token is gone, and the consumption is relatively large.</p><p>Another way is to put this token in the http header, which is the x-csrf header.</p><p>There are also many ways to use tokens, which are not the focus of this time, so I will not explain them in detail.</p><h3 id="sso"><a class="markdownIt-Anchor" href="#sso"></a> SSO</h3><p>When all the problems of our identity authentication have been better solved, there is a new problem, that is, with the increase of applications, we need to remember more and more accounts, we need a way to help us remember All accounts or only one account, the second way is SSO, which has a variety of implementation foundations, one of which is today’s topic OAuth.</p><p>Let’s define a few keywords before discussing this topic.</p><p>User: User</p><p>User Agent: User agent, such as a browser</p><p>Consumer: Information consumer, such as Leetcode</p><p>Service Provider: There are two types, namely Identity Provider (IDP), such as QQ, and Resource Provider (Resource Provider), but the two are generally the same.</p><p>Therefore:</p><ul><li>The emergence of SSO is not to solve some security or process problems on login, it is to help us remember some accounts, OAuth is just the basis of its implementation.</li><li>OAuth is only responsible for the user authorizing the consumer to manipulate some resources belonging to the user in the SP, but in SSO it is used to create an account in the consumer after the SP obtains user information, so that the next time as long as the user passes the authentication in the SP, it is equal to The consumer passed the authentication.</li><li>The user’s identity and permissions in the consumer have nothing to do with OAuth, it is a matter between the two, it has nothing to do with OAuth, and it has nothing to do with SSO. The authentication between them will return to the first three methods. SP does not care about or store the user’s identity or permissions in the consumer.</li><li>OAuth alone cannot complete the entire process of authorized login.</li></ul><h2 id="take-a-practical-look-at-the-request-for-oauth-during-the-sso-process"><a class="markdownIt-Anchor" href="#take-a-practical-look-at-the-request-for-oauth-during-the-sso-process"></a> Take a practical look at the request for OAuth during the SSO process</h2><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586587044/Cloud/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200411143642_a7kkr8.png" alt="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1586587044/Cloud/微信截图_20200411143642_a7kkr8.png"></p><p>This picture is the request I took to log in to the front end of leetcode with qq, which is roughly divided into the following steps:</p><ul><li>Go to the qq authentication server to pull the authorization page. The parameters include some parameters generated by the leetcode server for the next authorization request. Only with these parameters can it pass the verification of the qq authentication server and return the authorization page. At the same time, the authorization page needs to use these parameters for the next request</li><li>After selecting authorization, a second request will be sent, which includes some parameters defined in the OAuth protocol and parameters required by qq itself.</li><li>After the second request reaches qq, it is verified and returns a 302. Location is the redirect_uri in the second request parameter, and then splice the code and state generated by qq in the parameter.</li><li>After the browser receives the 302 return, it takes out the location again to send the request, so this location is generally its own background.</li><li>After receiving the request in the background, take out the code to QQ to exchange for the token.</li></ul><p>** OAuth protocol has done these things, so now do we have an account in leetcode? No **, then leetcode will create a leetcode account after taking the token to qq to exchange for identity information</p><h2 id="describe-some-details-of-the-oauth20-design-in-authorization-code-mode"><a class="markdownIt-Anchor" href="#describe-some-details-of-the-oauth20-design-in-authorization-code-mode"></a> Describe some details of the OAuth2.0 design in authorization code mode</h2><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1608117974/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20201216192144_wzrlgz.png" alt></p><p>The A request here is the first request just now, B is the second authorization request, C is the return of B, the status code is 302, and the location is redirect_uri? code = XXX &amp; state = XXX. After the browser receives it, re-request the location of C. The request goes to the leetcode background. After the background gets the code, it goes to qq to exchange the token with some parameters.</p><p>You may have a lot of questions here:</p><h3 id="what-do-these-parameters-represent"><a class="markdownIt-Anchor" href="#what-do-these-parameters-represent"></a> What do these parameters represent?</h3><p>redirect_uri: The domain name filled in by the consumer when the SP applies for a third-party authorized login service is generally the domain name of its own server.</p><p>client_id: The unique id of the consumer generated by SP after the consumer applies for third-party authorization to log in to the service.</p><p>client_secret: After the consumer applies for a third-party authorized login service in SP, the only certificate of the consumer generated by SP can prove that you are a consumer only if the id and secret are given at the same time.</p><p>Scope: The permission you want to apply for is generally specified by SP.</p><p>State: A random string, generated by the consumer itself</p><p>Code: The code returned by SP to the browser after user authorization, and the consumer can exchange this code for token.</p><p>access_token: the ultimate goal.</p><h3 id="why-send-a-redirect_uri-to-the-idp-in-the-first-place"><a class="markdownIt-Anchor" href="#why-send-a-redirect_uri-to-the-idp-in-the-first-place"></a> Why send a redirect_uri to the IDP in the first place?</h3><p>The first time is to set the Location in the return 302 of the IDP, you can not verify whether it is set by the consumer. The second time is to verify whether the redirect_uri is set by you in the IDP at the beginning, and whether it is the same as the first time over. This step must be verified, because this step is the most critical, and this step will return the token.</p><h3 id="why-go-around-such-a-big-circle-why-do-you-need-to-change-the-code-one-more-step-access_token"><a class="markdownIt-Anchor" href="#why-go-around-such-a-big-circle-why-do-you-need-to-change-the-code-one-more-step-access_token"></a> Why go around such a big circle, why do you need to change the code one more step access_token?</h3><p>In the end, I still can’t trust the browser comrade, let him be a tool man, let it help my background to apply for an authorization code from a third party, and then give this authorization code to my background, and then my background uses this code to go to a third party Apply for a token, and don’t tell the browser what the token is when you’re done, you stay, that is to say, the browser comrade has never seen the token from beginning to end.</p><h3 id="whats-the-use-of-secrets"><a class="markdownIt-Anchor" href="#whats-the-use-of-secrets"></a> What’s the use of secrets?</h3><p>The reason is that IDP does not believe anyone, so it believes the secret it gives itself. Because redirect_uri is a domain name, it still depends on the IP Address in the end. If the domain name is correct, but the domain name is pointed to by the attacker’s own IP, the attacker will receive the token. How to modify this DNS pointing involves DNS pollution, because DNS will be cached layer by layer, but there is time. If you keep broadcasting to tell the router or host that I am leetcode and I am leetcode, after a long time, you will be in this area. Network is considered leetcode. But if there is a secret, even if you bring the code to the IDP, without the secret I gave you, the IDP will not give the token. So client_id show who you are, only if you give client_secret, the IDP will believe what you say and give you the token, so this secret is very important, our background will not believe the browser comrade, so our browser comrade has never touched the secret from beginning to end.</p><h3 id="what-is-the-use-of-the-state"><a class="markdownIt-Anchor" href="#what-is-the-use-of-the-state"></a> What is the use of the State?</h3><p>Similar to the defense CSRF, to ensure the consistency of the requesting device, but unlike the CSRF, which forges the victim’s request, but allows the victim to log in to his account. If the victim saves a Bitcoin account in it, wouldn’t it be beautiful? The specific implementation is that after the attacker logs in, he applies normally, but after returning to the IDP 302, he stops the request, prevents the browser from sending a request to his background, and then links the request with code to the victim. After the victim clicks in You can get the access_token successfully log in. If you don’t pay attention to whether this account is your own, you will upload sensitive information, which is very happy. If there is a state, different devices in the background generate a random string to the front end. Even if the attacker sends the request to the victim, he does not know the state in the victim’s device. When the background sees your state, it will directly throw away the request. Of course, it is absolutely necessary to say that the attacker stole your state from a certain request of the huge Internet. This is a fixed-point blasting. To deal with you, most of this person has already been mixed around you.</p><h3 id="why-did-it-return-two-tokens-in-the-end"><a class="markdownIt-Anchor" href="#why-did-it-return-two-tokens-in-the-end"></a> Why did it return two tokens in the end?</h3><p>Because one represents who you are, one represents what you can do, and the things you can do can be changed by the administrator at any time, but who you are is fixed, and generally access_token expiration time is relatively short. If I use it, it will expire. It can’t let the user log in again, isn’t it back to the starting point?</p><h2 id="other-modes-in-oauth20"><a class="markdownIt-Anchor" href="#other-modes-in-oauth20"></a> Other modes in OAuth2.0</h2><h3 id="simplified-mode"><a class="markdownIt-Anchor" href="#simplified-mode"></a> Simplified mode</h3><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1608118806/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20201216193951_hiq7je.png" alt=" "></p><p>This method is different from the authorization code mode. It is suitable for situations where there is no server side, such as mobile applications. The front end gets the token directly from the SP, but it should be noted that this token is not spelled like the code in the authorization code mode. After “?”, but after “#”, it can effectively reduce the risk of leaks.</p><h3 id="password-mode"><a class="markdownIt-Anchor" href="#password-mode"></a> Password mode</h3><p>In Resource Owner Password Credentials Grant, users provide their username and password to the client. The client uses this information to request authorization from the “service provider”.</p><p>In this mode, the user must give their password to the client, but the client must not store the password. This is usually used in situations where the user has a high level of trust in the client, such as when the client is part of the operating system, or produced by a well-known company. The authentication server can only consider using this mode if other authorization modes cannot be implemented.</p><h3 id="client-mode"><a class="markdownIt-Anchor" href="#client-mode"></a> Client mode</h3><p>Client mode (Client Credentials Grant) means that the Client authenticates to the “service provider” in its own name, not in the name of the user. Strictly speaking, Client mode does not belong to the problem to be solved by the OAuth framework. In this mode, the user registers directly with the Client, and the Client requires the “service provider” to provide services in his own name, but there is no authorization problem.</p><h2 id="oauth10"><a class="markdownIt-Anchor" href="#oauth10"></a> OAuth1.0</h2><p>A brief introduction to 1.0 and why it developed into 2.0</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1608119884/origin-of-ray/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20201216195014_gz6sjt.png" alt="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1608119884/origin-of-ray/微信截图_20201216195014_gz6sjt.png"></p><p>The biggest difference is more AB two steps, that is, 1.0 will first go to SP to apply for an uncertified state of the request_token (can be compared to 2.0 code), the next purpose is to change the request_token into a certified state, and then you can take this request_token to change access_token.</p><p>Adding this step will cause problems, such as<a href="https://sunra.top/posts/44fbc7d1/">会话固定</a></p><p>There is for mobile phones or Client applications, Retargeting this step is not achieved, can only throw a connection to allow users to open their own browser paste into the next step. This will give the attacker a great opportunity.</p><p>It can be seen from this that version 1.0 has great security problems, and the experience is relatively poor for non-web applications, so 2.0 was launched.</p><p>For example, the simplified mode of 2.0 is to adapt to Client applications, and those who are interested can learn about it themselves.</p><h3 id="10a"><a class="markdownIt-Anchor" href="#10a"></a> 1.0a</h3><p>In order to fix the security issues in 1.0, 1.0a was proposed, and he mainly made the following changes:</p><ul><li><p>When a Consumer applies for a Request Token, it must pass the ** oauth ** _callback, while when a Consumer applies for an Access Token, it does not need to pass the ** oauth ** _callback. By passing the time of the pre ** oauth ** _callback, let the ** oauth ** _callback participate in the signature, so as to prevent the attacker from impersonating the ** oauth ** _callback.</p></li><li><p>After the Service Provider obtains the authorization of the User, when Retargeting the User to the Consumer, it returns ** oauth ** _verifier, which will be used in the process of the Consumer applying for an Access Token. Attackers cannot guess its value.</p></li></ul><p>Reference materials:</p><p><a href="https://sunra.top/posts/46cef286/">https://sunra.top/2019/11/16/OAuth%20and%20OIDC/</a> ：OAuth，OIDC简介</p><p><a href="https://sunra.top/posts/74ee5df7/:">https://sunra.top/posts/74ee5df7/:</a> Routing Protocol</p><p><a href="https://sunra.top/posts/dfdf7442/:">https://sunra.top/posts/dfdf7442/:</a> ARP Principle and Defense</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.jianshu.com/p/0db71eb445c8:">https://www.jianshu.com/p/0db71eb445c8:</a> Examples of OAuth Authentication Processes</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html:">https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html:</a> Security Considerations in OAuth2.0</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.cnblogs.com/linianhui/p/openid-connect-core.html:">https://www.cnblogs.com/linianhui/p/openid-connect-core.html:</a> OIDC doc</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.zhihu.com/question/19851243:">https://www.zhihu.com/question/19851243:</a> Difference between OAuth1.0 and 2.0</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.azure.cn/zh-cn/active-directory/azuread-dev/v1-protocols-openid-connect-code">https://docs.azure.cn/zh-cn/active-directory/azuread-dev/v1-protocols-openid-connect-code</a> ：OIDC + AAD</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.sciencedirect.com/science/article/pii/S2215098617316750:">https://www.sciencedirect.com/science/article/pii/S2215098617316750:</a> Security Issues in Cloud as a Service</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy:">https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy:</a> Same Origin Strategy</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/2b2971ba/" title="Development and Design of OAuth">https://sunra.top/en/posts/2b2971ba/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/9fba193f/" rel="prev" title="Double pointer algorithm"><i class="fa fa-chevron-left"></i> Double pointer algorithm</a></div><div class="post-nav-item"> <a href="/en/posts/4f2bae2e/" rel="next" title="Introduction to TCP Protocol">Introduction to TCP Protocol<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/2b2971ba/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>