<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="Thinking Before Reading  What method can be used to find a file in the directory? What is the difference between the logical and physical structure of a file? Are there any constraints between the lo"><meta property="og:type" content="article"><meta property="og:title" content="Operating System Learning Notes (6) Implementation of File Management System"><meta property="og:url" content="https://sunra.top/en/posts/65518/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="Thinking Before Reading  What method can be used to find a file in the directory? What is the difference between the logical and physical structure of a file? Are there any constraints between the lo"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=MjNkMTljMmYzNTA4MDg5YWI5MzY1ODdkYzg4ZGJmMDhfa1poRVoyZTVQSmV0MmFnNW1CTnFIOXZ6UFRxTUpuejhfVG9rZW46Ym94Y25KUkg1M1E0NXNwbFB6TUJsQXZVbFliXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA"><meta property="og:image" content="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDZkOTY5ZDYzZjllMWMzY2RkOWVjMjg0NjI3MDllNmNfUU94d3duenUzajVzcHlGSmJ2b25MeUNtbUdkRWNDazFfVG9rZW46Ym94Y25BZ21tcmJaWnExWTU1WGlHWVhSNHRiXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA"><meta property="og:image" content="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmY1MmJlNzc2ODMyZGEzNzYzNzhiZThlZmRjNThhZDdfQXM3NHpTdDdmZWhDaVoyMkRFbXJQNjhNRGw5MmV2aHpfVG9rZW46Ym94Y25SV214OTNOakZrNXdXeFZNNmxMT0lkXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA"><meta property="og:image" content="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmUyYjE0MjVkOWFhZTg1MzNkNjc4NDgzYmRlMmY0ODNfamdHOXpzaklPUzFCR3VNZ2J2ZWdJOUo5SzE4WG8zdUhfVG9rZW46Ym94Y25xT1NQYUVwZ2NBNlJ3UDZtQks3cXpjXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA"><meta property="og:image" content="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWJhN2NkZGQ4NWYzYThjNjVhYzlhODNlNDkyMzIwZGZfWU5WQWo4eVk0T2hYVW9NemZiR1pUczRTaXNzTjVCWHdfVG9rZW46Ym94Y241THZNYmE1SkZqZVdCcWJTVm9xblBiXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA"><meta property="og:image" content="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=MmI3YTEzMzY2OWM4NGE5ODc1Yjk4OGFhOTA3OTNlMDBfMWFwaUM4dU1UUDlBYXJYbE1YQmJUSUp4ZTRBdVlra1FfVG9rZW46Ym94Y25OSmRlTTRUNms1cUhTTnUySk9PMjBkXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA"><meta property="article:published_time" content="2022-01-01T23:56:20.000Z"><meta property="article:modified_time" content="2024-07-02T00:25:58.765Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=MjNkMTljMmYzNTA4MDg5YWI5MzY1ODdkYzg4ZGJmMDhfa1poRVoyZTVQSmV0MmFnNW1CTnFIOXZ6UFRxTUpuejhfVG9rZW46Ym94Y25KUkg1M1E0NXNwbFB6TUJsQXZVbFliXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA"><link rel="canonical" href="https://sunra.top/en/posts/65518/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/65518/","path":"posts/65518/","title":"Operating System Learning Notes (6) Implementation of File Management System"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Operating System Learning Notes (6) Implementation of File Management System | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#thinking-before-reading"><span class="nav-number">1.</span> <span class="nav-text">Thinking Before Reading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hierarchy-of-file-systems"><span class="nav-number">2.</span> <span class="nav-text">Hierarchy of file systems</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#implementation-of-directory"><span class="nav-number">3.</span> <span class="nav-text">Implementation of directory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#document-implementation"><span class="nav-number">4.</span> <span class="nav-text">Document implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#distribution-of-files"><span class="nav-number">4.1.</span> <span class="nav-text">Distribution of files</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#continuous-distribution"><span class="nav-number">4.1.1.</span> <span class="nav-text">Continuous distribution</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#link-allocation"><span class="nav-number">4.1.2.</span> <span class="nav-text">Link allocation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-allocation"><span class="nav-number">4.1.3.</span> <span class="nav-text">Index allocation</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file-storage-space-management"><span class="nav-number">4.2.</span> <span class="nav-text">File storage space management</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#partitioning-and-initialization-of-file-storage-space"><span class="nav-number">4.2.1.</span> <span class="nav-text">Partitioning and initialization of file storage space</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#file-storage-space-management-2"><span class="nav-number">4.2.2.</span> <span class="nav-text">File storage space management</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#idle-table-method"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">Idle table method</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#idle-linked-list-method"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">Idle linked list method</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#potential-diagram-method"><span class="nav-number">4.2.2.3.</span> <span class="nav-text">Potential diagram method</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#group-linked-list-method"><span class="nav-number">4.2.2.4.</span> <span class="nav-text">Group linked list method</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#answer-the-opening-question"><span class="nav-number">5.</span> <span class="nav-text">Answer the opening question</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/65518/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Operating System Learning Notes (6) Implementation of File Management System | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Operating System Learning Notes (6) Implementation of File Management System</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-01-02 07:56:20" itemprop="dateCreated datePublished" datetime="2022-01-02T07:56:20+08:00">2022-01-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-07-02 08:25:58" itemprop="dateModified" datetime="2024-07-02T08:25:58+08:00">2024-07-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/65518/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/65518/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="thinking-before-reading"><a class="markdownIt-Anchor" href="#thinking-before-reading"></a> Thinking Before Reading</h2><ul><li>What method can be used to find a file in the directory?</li><li>What is the difference between the logical and physical structure of a file? Are there any constraints between the logical and physical structure of an individual file?</li></ul><p>The above file system basics introduced the logical structure of directories and files, now let’s introduce their physical structure.</p><span id="more"></span><h2 id="hierarchy-of-file-systems"><a class="markdownIt-Anchor" href="#hierarchy-of-file-systems"></a> Hierarchy of file systems</h2><p>Modern operating systems have multiple file system types, such as FAT32, NTFS, ext2, ext3, ext4, etc., so the hierarchy of file systems is also different. The following is a more general hierarchy.</p><p>Pasting blocks outside Docs is not supported.</p><ol><li>User call interface</li></ol><p>The file system provides users with calls related to files and directories, such as creating, opening, reading and writing, closing, deleting files, creating, deleting directories, etc. This layer consists of several modules, each module corresponds to a system call, and when the user issues a system call, control is transferred to the corresponding module.</p><ol><li>File directory system</li></ol><p>The main function of the file directory system is to manage the file directory, and its tasks are:</p><ul><li>Manage the active file directory table.</li><li>Manage read and write status information tables.</li><li>Manage user processes to open tables.</li><li>Manage and organize the directory structure of files on storage devices.</li><li>invoke the next level access control module.</li></ul><ol><li>Access control verification module</li></ol><p>The realization of file protection is mainly completed by this level of software, which compares the user’s access requirements with the access control permissions indicated in the FCB to confirm the legitimacy of the access.</p><ol><li>Logical file system and file information buffer</li></ol><p>According to the logical structure of the file, the logical record to be read and written by the user is converted into the corresponding block number in the logical structure of the file.</p><ol><li>Physical file system</li></ol><p>Convert the relative block number of the logical record into the actual physical address.</p><ol><li>Auxiliary distribution module</li></ol><p>The main function is to manage auxiliary storage space, that is, to allocate free auxiliary storage space and recycle auxiliary storage space</p><p>You should go back and contact the memory allocation here.</p><ol><li>Facility Management Program Module</li></ol><p>Allocating devices, allocating device read and write buffers, disk scheduling, starting devices, processing device interrupts, releasing device read and write buffers, releasing devices, etc.</p><h2 id="implementation-of-directory"><a class="markdownIt-Anchor" href="#implementation-of-directory"></a> Implementation of directory</h2><p>The basic methods of directory implementation are linear list and hash table. It should be noted that the implementation of directory is to search, so linear list corresponds to linear search, and hash table corresponds to hash search.</p><ol><li>Linear list</li></ol><p>The simplest way to implement a directory is to use a linear table that stores file names and data block pointers.</p><p>When creating a new file, you must search the directory for a file with the same name, then add a directory entry to the directory table, delete the file to search the directory according to the given file name, and then free up its space.</p><p>There are many ways to reuse directory entries.</p><ul><li>Catalog entries can be marked as no longer in use.</li><li>Add it to the free directory entry table.</li><li>You can copy the last directory entry in the directory table to a free location, reducing the length of the directory table.</li></ul><p>The idea of the free directory table here is a bit like the page allocation strategy of memory (fixed allocation local replacement, variable allocation global replacement, variable allocation local replacement).</p><p>The deletion time can be reduced by using the linked list structure, and the advantage is that it is simple to implement, but it is time-consuming due to the particularity of the linear table.</p><ol><li>Hash table</li></ol><p>The biggest difficulty is the fixed length of the hash table and the dependence of the hash function on the table length.</p><p>Directory query is done through repeated search on the disk, which requires continuous I/O operations and is expensive.</p><p>Therefore, in order to reduce I/O operations, copy the currently used file directory to memory.</p><h2 id="document-implementation"><a class="markdownIt-Anchor" href="#document-implementation"></a> Document implementation</h2><p>The implementation of files studies the physical structure of files, that is, how file data is distributed and organized on physical storage devices.</p><p>There are two aspects to this problem:</p><ul><li>File allocation method, talking about the management of non-free disk blocks.</li><li>File storage space management, management of free disk blocks.</li></ul><h3 id="distribution-of-files"><a class="markdownIt-Anchor" href="#distribution-of-files"></a> Distribution of files</h3><h4 id="continuous-distribution"><a class="markdownIt-Anchor" href="#continuous-distribution"></a> Continuous distribution</h4><p>The continuous allocation method requires each file to occupy a set of contiguous blocks on the disk. As shown in the figure below, the disk address defines a linear ordering on the disk. This ordering minimizes the number of seek and seek times required for jobs to access the disk.</p><p>Consecutive allocation of files can be defined by the disk address of the first block and the number of consecutive blocks. The directory entry of a file contains the address of the starting block and the length of the area allocated to the file.</p><p><img src="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=MjNkMTljMmYzNTA4MDg5YWI5MzY1ODdkYzg4ZGJmMDhfa1poRVoyZTVQSmV0MmFnNW1CTnFIOXZ6UFRxTUpuejhfVG9rZW46Ym94Y25KUkg1M1E0NXNwbFB6TUJsQXZVbFliXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA" alt="img"></p><p>Continuous allocation supports ** sequential access and direct access **, which has the advantages of simple implementation and fast access speed. The disadvantage is that the length should not be dynamically increased, because the disk block at the end of a file may have been allocated to other files. Once it needs to be increased, it is necessary to find a larger contiguous memory and then copy the data. Therefore, this method is only suitable for files of fixed length.</p><h4 id="link-allocation"><a class="markdownIt-Anchor" href="#link-allocation"></a> Link allocation</h4><p>Link allocation takes the form of discrete allocation, eliminates external fragmentation, significantly improves disk utilization, and files can easily grow dynamically without prior guidance on file size.</p><p>Link allocation can be divided into two forms: implicit links and explicit links.</p><ol><li>Implicit links</li></ol><p>Implicit link as shown, each file corresponds to a linked list of disk blocks, disk blocks distributed anywhere on the disk, excluding the last disk block, each disk block has a pointer to the next disk block.</p><p><img src="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDZkOTY5ZDYzZjllMWMzY2RkOWVjMjg0NjI3MDllNmNfUU94d3duenUzajVzcHlGSmJ2b25MeUNtbUdkRWNDazFfVG9rZW46Ym94Y25BZ21tcmJaWnExWTU1WGlHWVhSNHRiXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA" alt="img"></p><p>When creating a new file, an entry is added to the directory. Each directory entry has a pointer to the first block of the file. The pointer is initialized to NULL for an empty file, and the size field is 0. Writing to the file will find the space block through the free space management system, link the block to the end of the file, and then write.</p><p>The disadvantage of implicit links is that disk blocks cannot be accessed directly, files can only be accessed sequentially through pointers, and disk block pointers will consume a certain amount of space, and their stability is also a problem. Once a pointer is lost, file data will be lost.</p><ol><li>Explicit linking</li></ol><p>The pointers used to link each physical block of the file are extracted from the end of each physical block and explicitly stored in a linked list in memory. This table is set only once in the entire disk (that is, not every file has its own table), which is called the File Allocation Table (FAT). Each table entry stores the next block link pointer of the corresponding block, that is, the next disk block number. The first disk block number of the file is recorded in the directory, and the subsequent disk block numbers are found by checking FAT.</p><p><img src="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmY1MmJlNzc2ODMyZGEzNzYzNzhiZThlZmRjNThhZDdfQXM3NHpTdDdmZWhDaVoyMkRFbXJQNjhNRGw5MmV2aHpfVG9rZW46Ym94Y25SV214OTNOakZrNXdXeFZNNmxMT0lkXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA" alt="img"></p><p>Note that the disk block number in the above figure is just an implicit sequence number and does not occupy space, just like the index of an array.</p><p>FAT entries correspond to all disk blocks one-to-one. Use a special number -1 to represent the end of the file, and -2 to represent free blocks.</p><p>FAT is read into memory at system start-up.</p><h4 id="index-allocation"><a class="markdownIt-Anchor" href="#index-allocation"></a> Index allocation</h4><p>Link allocation solves the problem of continuous allocation of external fragments and file size management, but link allocation does not effectively support direct access (except FAT). Index allocation solves this problem by combining all disk block numbers of each file to form an index block.</p><p><img src="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmUyYjE0MjVkOWFhZTg1MzNkNjc4NDgzYmRlMmY0ODNfamdHOXpzaklPUzFCR3VNZ2J2ZWdJOUo5SzE4WG8zdUhfVG9rZW46Ym94Y25xT1NQYUVwZ2NBNlJ3UDZtQks3cXpjXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA" alt="img"></p><p>Each file has its own index block. This is an array of disk block addresses. The i-th entry of the index block points to the i-th block of the file. The directory entry includes the index block address. To read the i-th block, find and read the required block through the pointer to the i-th entry of the index block.</p><p>When creating a file, all pointers of the index block are set to null. When writing the i-th block for the first time, take a block from the free block space and write its address to the i-th entry of the index block.</p><p>The size of the index block is an important issue. Every file must have an index block, so the index block should be as small as possible. However, if the index block is too small, it cannot support large files. We have several solutions to solve this problem:</p><ul><li>Linking scheme. An index block is usually a disk block, so it can be read and written directly. In order to handle large files, multiple disk blocks can be linked together.</li><li>Multi-layer indexing. Multi-layer indexing makes the first layer index block point to the second layer index block, and the second layer index block points to the file block. This method can continue to the third or fourth layer according to the requirements of the maximum file size.</li><li>Hybrid index. Allocation method that combines multiple index methods. For example, the system uses both direct address, click index allocation method or secondary index allocation method.</li></ul><table><thead><tr><th></th><th>Accessing the nth record</th><th>Advantages</th><th>Disadvantages</th></tr></thead><tbody><tr><td>Continuous allocation</td><td>Need to access the disk once</td><td>Fast speed when accessing sequentially, and random access according to the file starting address and record length when the file is fixed length.</td><td>File storage requires continuous storage space, which will generate fragmentation, which is not conducive to dynamic expansion of files.</td></tr><tr><td>Link allocation</td><td>Need to access disk n times</td><td>Can solve the problem of external memory fragmentation, improve the utilization of external memory space, and dynamic growth is more convenient.</td><td>Can only be accessed in the order of the pointer chain of the file, the search efficiency is low, and the storage of pointer information consumes extra space.</td></tr><tr><td>Index allocation</td><td>m level requires access to disk m + 1 times</td><td>can be accessed randomly, files are easy to add and delete</td><td>index table increases the cost of storage space, and the search strategy of index table has a great impact on file system efficiency.</td></tr></tbody></table><p>All three schemes require the address of the index block stored in the directory entry or in the index node (i-node).</p><h3 id="file-storage-space-management"><a class="markdownIt-Anchor" href="#file-storage-space-management"></a> File storage space management</h3><h4 id="partitioning-and-initialization-of-file-storage-space"><a class="markdownIt-Anchor" href="#partitioning-and-initialization-of-file-storage-space"></a> Partitioning and initialization of file storage space</h4><p>Generally speaking, a file is stored in a file volume. A file volume can be part of a physical disk or the entire physical disk. A file volume that supports oversized files can also be composed of multiple physical disks.</p><p><img src="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWJhN2NkZGQ4NWYzYThjNjVhYzlhODNlNDkyMzIwZGZfWU5WQWo4eVk0T2hYVW9NemZiR1pUczRTaXNzTjVCWHdfVG9rZW46Ym94Y241THZNYmE1SkZqZVdCcWJTVm9xblBiXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA" alt="img"></p><p>In a file volume, the space for file data information (file area) and the space for storing file control information FCB (directory area) are separated. Due to the existence of many types of file representation and storage formats, modern operating systems generally have many different file management modules through which files in different formats of logical volumes can be accessed.</p><p>Logical volume before providing file services, must be initialized by the corresponding file program, a good directory area and the file area, the establishment of a free space management table and a logical volume information storage superblock.</p><h4 id="file-storage-space-management-2"><a class="markdownIt-Anchor" href="#file-storage-space-management-2"></a> File storage space management</h4><p>File storage devices are divided into many physical blocks of the same size and exchange information in blocks. Therefore, the management of file storage devices is essentially the organization and management of free blocks. It contains the organization, allocation and recycling of free blocks.</p><p>This physical block division idea is somewhat like the division of pages in memory, called pages in processes, and page boxes in memory.</p><h5 id="idle-table-method"><a class="markdownIt-Anchor" href="#idle-table-method"></a> Idle table method</h5><p>The free table method is a continuous allocation method, which is similar to the dynamic allocation scheme of memory, allocating a contiguous storage space for each file.</p><p>The system establishes a free disk block table for all free areas on the external memory. Each free area corresponds to a free table entry, including the entry number, the first block number of the free area, the number of disk blocks in the free area, etc. Then arrange all free areas in the order of increasing their starting disk block numbers.</p><p>First of all, here belongs to the continuous allocation, refers to the organization of the free extent is continuous manner.</p><p>Secondly, after looking at this method, there will be a familiar feeling, much like the page allocation of memory (the strategy has the best adaptation algorithm, etc.).</p><h5 id="idle-linked-list-method"><a class="markdownIt-Anchor" href="#idle-linked-list-method"></a> Idle linked list method</h5><p>Pull all free extents into a free chain, depending on the basic elements used to form the chain, the linked list can be divided into two forms, free disk block chain and free extent chain.</p><p>The free disk block chain pulls all the free space on the disk into a chain in units of disk blocks. When a user requests to allocate space due to creating a file, the system starts at the beginning of the chain and removes the appropriate number of free disk blocks in turn to allocate to the user. When the user frees up storage space due to deleting files, the system inserts the recovered disk blocks into the end of the free disk block chain in turn. The advantage of this method is that the process of allocating and recycling a disk block is very simple, but the operation may be repeated multiple times when allocating disk blocks for a file.</p><p>The free extent chain is a chain of all free extents on a disk (each extent may contain multiple blocks). In addition to containing a pointer to indicate the next free extent, there should also be information indicating the size of the extent on each extent. The method of allocating extents is similar to dynamic partitioning of memory. The first adaptation algorithm is usually used. When reclaiming extents, the reclaimed area should also be merged with adjacent free extents.</p><p>Free table method, the free sector chain is similar, similar to the dynamic partition of memory.</p><h5 id="potential-diagram-method"><a class="markdownIt-Anchor" href="#potential-diagram-method"></a> Potential diagram method</h5><p>Use one bit in binary to represent the usage of a disk block in the disk, and all disk blocks on the disk have a binary corresponding to it. When its value is 0, it means that the disk block is idle, and when it is 1, it means that it has been allocated.</p><h5 id="group-linked-list-method"><a class="markdownIt-Anchor" href="#group-linked-list-method"></a> Group linked list method</h5><p>Neither the free list method nor the free linked list method is suitable for large file systems, because this will make the free list or free linked list too large.</p><p>In UNIX, the group linked list method is used, which combines two methods of free list and free linked list to overcome the disadvantage of too large table</p><p>The general idea is: the sequence of n free sector address stored in the first free sector, followed by a free sector address is stored in another sequence of free sectors, and so on until all free sectors are linked.</p><p>Assuming that the disk is initially all free sectors, which are linked into groups as shown, in this way a large number of free block addresses can be quickly found.</p><p><img src="https://x8pzubgmif.feishu.cn/space/api/box/stream/download/asynccode/?code=MmI3YTEzMzY2OWM4NGE5ODc1Yjk4OGFhOTA3OTNlMDBfMWFwaUM4dU1UUDlBYXJYbE1YQmJUSUp4ZTRBdVlra1FfVG9rZW46Ym94Y25OSmRlTTRUNms1cUhTTnUySk9PMjBkXzE2NDExNjc3OTQ6MTY0MTE3MTM5NF9WNA" alt="img"></p><p>This group linked list method is not exactly the same as the idea of multi-level.</p><p>The “bit vector” table representing the free space of the file storage or the first group chained block, as well as the directory area in the volume. The file area division information needs to be stored in the secondary storage, usually in the volume header position, which is called a superblock in UNIX.</p><p>Before operating on files in the volume, the superblock needs to be read into the system’s free main memory in advance, and the consistency between the main memory superblock and the secondary memory superblock in the volume is often maintained.</p><h2 id="answer-the-opening-question"><a class="markdownIt-Anchor" href="#answer-the-opening-question"></a> Answer the opening question</h2><ol><li>What is the way to find a file in the directory?</li></ol><p>You can use linear list method or hash table method. Linear list organizes file names into a linear table, which is compared with each table entry in the linear table in turn when searching.</p><p>If the file names are sorted in order, the dichotomy can reduce the average search time, but creating new files will increase the cost of maintaining the linear table.</p><p>The hash table uses the file name to obtain a pointer to the file through the hash function. This method is very fast, but be aware of hash conflicts.</p><ol><li>What is the difference between the logical structure and the physical structure of a file? Is there some kind of restrictive relationship between the logical structure and the physical structure of a single file?</li></ol><p>The logical structure of the file is the visible structure of the user, that is, the structure of the file used by the user.</p><p>The physical structure of the file is the organizational structure of the file on the memory. It indicates the placement, linking, and cataloging method of a file on the auxiliary memory. It is closely related to the access method of the file and the characteristics of the auxiliary memory device.</p><p>Although there is no obvious constraint or correlation between the logical structure and the physical structure of a single file, if the physical structure is chosen inadvertently, it is difficult to reflect the characteristics of the logical structure. For example, a logical structure is a sequential structure, but the physical structure is an implicitly linked structure file. Even if it can be found quickly in theory, it still needs to be found piece by piece on the disk block.</p><p>Note again that logical structure refers to the management between file records, such as sorting by keyword order.</p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/65518/" title="Operating System Learning Notes (6) Implementation of File Management System">https://sunra.top/en/posts/65518/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/28755/" rel="prev" title="Operating System Learning Notes (5) Fundamentals of File Management System"><i class="fa fa-chevron-left"></i> Operating System Learning Notes (5) Fundamentals of File Management System</a></div><div class="post-nav-item"> <a href="/en/posts/3683/" rel="next" title="Operating System Learning Notes (7) Overview of I/O Management">Operating System Learning Notes (7) Overview of I/O Management<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/65518/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>