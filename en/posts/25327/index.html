<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png"><link rel="mask-icon" href="/en/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/en/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/en/","images":"/en/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/en/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/en/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="HookThe React team has focused on code reuse from the beginning Their solutions to reuse code: Mixin, HOC, Render Prop, and now Custom Hook Therefore, Custom Hook is not a product of a slap in the hea"><meta property="og:type" content="article"><meta property="og:title" content="History of React Hook and Pits in Actual Combat"><meta property="og:url" content="https://sunra.top/en/posts/25327/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="HookThe React team has focused on code reuse from the beginning Their solutions to reuse code: Mixin, HOC, Render Prop, and now Custom Hook Therefore, Custom Hook is not a product of a slap in the hea"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1620866482/origin-of-ray/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210513084055_cx2rak.jpg"><meta property="article:published_time" content="2021-05-12T23:35:27.000Z"><meta property="article:modified_time" content="2024-06-10T02:33:39.026Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="Technology Sharing Using Tutorials Principles Front End Computer Graphics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1620866482/origin-of-ray/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210513084055_cx2rak.jpg"><link rel="canonical" href="https://sunra.top/en/posts/25327/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://sunra.top/en/posts/25327/","path":"posts/25327/","title":"History of React Hook and Pits in Actual Combat"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>History of React Hook and Pits in Actual Combat | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/en/js/third-party/analytics/google-analytics.js"></script><script src="/en/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/en/css/noscript.css"></noscript><link rel="alternate" href="/en/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/en/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Lift the fog of the Internet together</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="Search" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/en/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/en/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/en/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook"><span class="nav-number">1.</span> <span class="nav-text">Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1"><span class="nav-number">1.1.</span> <span class="nav-text">1.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2"><span class="nav-number">1.2.</span> <span class="nav-text">2.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3"><span class="nav-number">1.3.</span> <span class="nav-text">3.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4"><span class="nav-number">1.4.</span> <span class="nav-text">4.</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Several-points-to-pay-attention-to-during-the-use-of-Hook"><span class="nav-number">2.</span> <span class="nav-text">Several points to pay attention to during the use of Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Closure-issues"><span class="nav-number">2.1.</span> <span class="nav-text">Closure issues</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useState-The-second-parameter-to-modify-state-is-asynchronous-and-needs-to-take-effect-on-the-next-render"><span class="nav-number">2.2.</span> <span class="nav-text">useState The second parameter to modify state is asynchronous and needs to take effect on the next render</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook%E2%80%99s-infinite-loop-rendering-problem"><span class="nav-number">2.3.</span> <span class="nav-text">Hook’s infinite loop rendering problem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useState-lazy-initialization"><span class="nav-number">2.4.</span> <span class="nav-text">useState lazy initialization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-value-returned-by-useRef-is-not-the-component-state-so-its-change-will-not-trigger-re-rendering-and-it-will-return-the-same-value-every-time-it-is-rendered"><span class="nav-number">2.5.</span> <span class="nav-text">The value returned by useRef is not the component state, so its change will not trigger re-rendering, and it will return the same value every time it is rendered</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#If-you-want-to-return-a-function-in-a-custom-hook-you-can-wrap-it-with-useCallback"><span class="nav-number">2.6.</span> <span class="nav-text">If you want to return a function in a custom hook, you can wrap it with useCallback</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">Lift the fog of the Internet together</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/en/archives/"><span class="site-state-item-count">268</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/en/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">categories</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://sunra.top/en/posts/25327/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="Lift the fog of the Internet together"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="History of React Hook and Pits in Actual Combat | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> History of React Hook and Pits in Actual Combat</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-05-13 07:35:27" itemprop="dateCreated datePublished" datetime="2021-05-13T07:35:27+08:00">2021-05-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2024-06-10 10:33:39" itemprop="dateModified" datetime="2024-06-10T10:33:39+08:00">2024-06-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/en/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline:</span><a title="waline" href="/en/posts/25327/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/en/posts/25327/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h2><p>The React team has focused on code reuse from the beginning</p><p>Their solutions to reuse code: Mixin, HOC, Render Prop, and now Custom Hook</p><p>Therefore, Custom Hook is not a product of a slap in the head, even many developers with rich development experience in Custom Hook do not understand how Hook came to be and what role it plays in React</p><p>It is impossible to deeply understand Custom Hook without understanding this design idea. Today we will learn together</p><span id="more"></span><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p>This method is very common in Vue2 and is also an important part of its source code, such as the merge of the parent child component lifecycle function</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">SetIntervalMixin</span> = &#123;</span><br><span class="line">  <span class="attr">componentWillMount</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intervals</span> = [];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">setInterval</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intervals</span>.<span class="title function_">push</span>(<span class="built_in">setInterval</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, <span class="variable language_">arguments</span>));</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">componentWillUnmount</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intervals</span>.<span class="title function_">forEach</span>(<span class="built_in">clearInterval</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> createReactClass = <span class="built_in">require</span>(<span class="string">&#x27;create-react-class&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">TickTock</span> = <span class="title function_">createReactClass</span>(&#123;</span><br><span class="line">  <span class="title class_">Mixins</span>: [<span class="title class_">SetIntervalMixin</span>],<span class="comment">//use mixin</span></span><br><span class="line">  <span class="attr">getInitialState</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">seconds</span>: <span class="number">0</span>&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">componentDidMount</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">This</span>.<span class="property">setInterval</span> (<span class="variable language_">this</span>.<span class="property">tick</span>, <span class="number">1000</span>);<span class="comment">//call the method on the mixin</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">tick</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">seconds</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">seconds</span> + <span class="number">1</span>&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        React has been running for &#123;this.state.seconds&#125; seconds.</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">TickTock</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>Advantages:</p><ol><li>It does play the role of reusing code</li></ol><p>Disadvantages:</p><ol><li>It is an implicit dependency, and implicit dependencies are considered bad in React</li><li>Name conflict issues</li><li>Can only work in’React.createClass’, does not support ES6 Class Component</li><li>Found in practice: difficult to maintain</li></ol><p>It has been marked as’not recommended ‘on the official website of React, the official complain point<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/blog/2016/07/13/mixins-considered-harmful.html">这里</a></p><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>Beginning in 2015, the React team announced that it did not recommend using Mixin, and recommended that everyone use the HOC mode</p><p>HOC adopts’decorator pattern ‘to reuse code</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">withWindowWidth</span>(<span class="params">BaseComponent</span>) &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">DerivedClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">      <span class="attr">windowWidth</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onResize = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">windowWidth</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onResize</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onResize</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">BaseComponent</span> &#123;<span class="attr">...this.props</span>&#125; &#123;<span class="attr">...this.state</span>&#125;/&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">DerivedClass</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyComponent</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Window width is: &#123;props.windowWidth&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>The classic separation of container presidential components starts here</p><p>The following is the most classic HOC container component and display component separation, case - Redux in the connect example code</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">createInfoScreen</span> = (<span class="params">ChildComponent, fetchData, dataName</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">HOComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    state = &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;</span><br><span class="line">    handleIncrementCounter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">counter</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">counter</span> + <span class="number">1</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">fetchData</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data = &#123;&#125;, isFetching, error &#125; = <span class="variable language_">this</span>.<span class="property">props</span>[dataName]; </span><br><span class="line">      <span class="keyword">if</span> (isFetching) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Something is wrong. Please try again!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isEmpty</span>(data)) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>No Data!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">ChildComponent</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">counter</span>=<span class="string">&#123;this.state.counter&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onIncrementCounterClick</span>=<span class="string">&#123;this.handleIncrementCounter&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123;<span class="attr">...this.props</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">dataSelector</span> = state =&gt; state[dataName];</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getData</span> = (<span class="params"></span>) =&gt; <span class="title function_">createSelector</span>(dataSelector, <span class="function"><span class="params">data</span> =&gt;</span> data);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = state =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">getData</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      [dataName]: <span class="title function_">data</span>(state),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">HOComponent</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">    <span class="attr">fetchData</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>.<span class="property">isRequired</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">HOComponent</span>.<span class="property">displayName</span> = <span class="string">`createInfoScreen(<span class="subst">$&#123;getDisplayName(HOComponent)&#125;</span>)`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">connect</span>(</span><br><span class="line">    mapStateToProps,</span><br><span class="line">    &#123; fetchData &#125;,</span><br><span class="line">  )(<span class="title class_">HOComponent</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Advantages:</p><ol><li>Can work in any component including Class Component</li><li>The principle of separating container components from display components, which it advocates, has been achieved: separation of concerns</li></ol><p>Disadvantages:</p><ol><li>Not intuitive and difficult to read</li><li>Name conflicts</li><li>Components are nested layer by layer</li></ol><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><p>Since 2017, Render Prop has become popular</p><p>Render Prop uses’proxy mode ‘to reuse code</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WindowWidth</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  propTypes = &#123;</span><br><span class="line">    <span class="attr">children</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>.<span class="property">isRequired</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">windowWidth</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onResize = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">windowWidth</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onResize</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onResize</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">children</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">windowWidth</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">WindowWidth</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;width =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>Window width is: &#123;width&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">WindowWidth</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React Router also uses this API design:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path = &quot;/about&quot; render= &#123; (props) =&gt; &lt;About &#123;...props&#125; /&gt;&#125;&gt;</span><br></pre></td></tr></table></figure><p>Advantages:</p><ol><li>Be flexible</li></ol><p>Disadvantages:</p><ol><li>Difficult to read, difficult to understand</li></ol><h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><p>In 2018, the React team announced a new way to reuse code - React Hook</p><p>Its core change is to allow function components to store their own state, before which function components cannot have their own state</p><p>This change allows us to abstract the logic of a React component just as we abstract a normal function</p><p>Principle of implementation: closure</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useWindowsWidth</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [isScreenSmall, setIsScreenSmall] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="title function_">checkScreenSize</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setIsScreenSmall</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span> &lt; <span class="number">600</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">checkScreenSize</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, checkScreenSize);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;resize&quot;</span>, checkScreenSize);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isScreenSmall;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useWindowsWidth;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useWindowWidth <span class="keyword">from</span> <span class="string">&#x27;./useWindowWidth.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> onSmallScreen = <span class="title function_">useWindowWidth</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// Return some elements</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Advantages:</p><ol><li>Extracting logic is very easy</li><li>Very easy to combine</li><li>Very readable</li><li>No name conflict issues</li></ol><p>Disadvantages:</p><ol><li>Hook has its own usage restrictions: it can only be used at the top level of the component, and it can only be used in the component</li><li>Since the principle is closure, there will be difficult to understand problems in rare cases</li></ol><h2 id="Several-points-to-pay-attention-to-during-the-use-of-Hook"><a href="#Several-points-to-pay-attention-to-during-the-use-of-Hook" class="headerlink" title="Several points to pay attention to during the use of Hook"></a>Several points to pay attention to during the use of Hook</h2><h3 id="Closure-issues"><a href="#Closure-issues" class="headerlink" title="Closure issues"></a>Closure issues</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function WatchCount() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(function() &#123;</span><br><span class="line">    setInterval(function log() &#123;</span><br><span class="line">      console.log(`Count is: $&#123;count&#125;`);</span><br><span class="line">    &#125;, 2000);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1) &#125;&gt;</span><br><span class="line">        Add 1</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>What do you think this code will print?<br>That’s right, every time it prints out “Count is 0”</p><p>Because when we set the timer, we pass in a function closure, which has already cached the value of count, so we call the same log function every time.</p><p>The solution is also very simple</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function WatchCount() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(function() &#123;</span><br><span class="line">    const id = setInterval(function log() &#123;</span><br><span class="line">      console.log(`Count is: $&#123;count&#125;`);</span><br><span class="line">    &#125;, 2000);</span><br><span class="line">    return function() &#123;</span><br><span class="line">      clearInterval(id);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [count ]); // look here, this line is the point</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1) &#125;&gt;</span><br><span class="line">        Increase</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This tells useEffect to recreate the side effect function whenever the count changes.</p><p>The closure problem is not just a useEffect problem, but a common problem for all hooks that may use function closures.</p><h3 id="useState-The-second-parameter-to-modify-state-is-asynchronous-and-needs-to-take-effect-on-the-next-render"><a href="#useState-The-second-parameter-to-modify-state-is-asynchronous-and-needs-to-take-effect-on-the-next-render" class="headerlink" title="useState The second parameter to modify state is asynchronous and needs to take effect on the next render"></a>useState The second parameter to modify state is asynchronous and needs to take effect on the next render</h3><h3 id="Hook’s-infinite-loop-rendering-problem"><a href="#Hook’s-infinite-loop-rendering-problem" class="headerlink" title="Hook’s infinite loop rendering problem"></a>Hook’s infinite loop rendering problem</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">export default function App() &#123;</span><br><span class="line">  //When obj is a primitive type, there will be no infinite loop</span><br><span class="line">  //When obj is an object, it will loop indefinitely</span><br><span class="line">  //When obj is the state of an object, there is no infinite loop</span><br><span class="line">  const [obj, setObj] = useState(&#123; name: &quot;Jack&quot; &#125;);</span><br><span class="line">  // const obj = 1;</span><br><span class="line">  // const obj = &#123;name: &#x27;Jack&#x27;&#125;</span><br><span class="line">  const [num, setNum] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;effect&quot;);</span><br><span class="line">    setNum(num + 1);</span><br><span class="line">  &#125;, [obj]);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &#123;num&#125;</span><br><span class="line">      &lt;h1&gt;Hello CodeSandbox&lt;/h1&gt;</span><br><span class="line">      &lt;h2&gt;Start editing to see some magic happen!&lt;/h2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>Let&#39;s analyze why obj triggers infinite rendering when it is a normal object
</code></pre><p>The first time rendering, the side effect of executing useEffect will call setNum to update num</p><p>Calling setNum will update num, causing the component to be re-rendered. At this time, obj is already another object (although the property and value are exactly the same, the address has changed, and the way react compares useEffect is very rude, it should also be for performance reasons, just a simple judgment), so it will re-execute setNum, and it will start to re-render, so it enters an infinite loop.</p><p>Understanding why obj is infinitely rendered when it is an object, we can understand why obj does not enter an infinite loop when it is a basic type.</p><p>When obj is a state, unless the corresponding setState is manually called, react will not consider the state to have changed.</p><h3 id="useState-lazy-initialization"><a href="#useState-lazy-initialization" class="headerlink" title="useState lazy initialization"></a>useState lazy initialization</h3><p>If the first parameter is passed to a function, the function is not used as the initial value of the state, but the return value of the function as the initial value, which is called lazy initialization. So try not to use useState to save function.</p><h3 id="The-value-returned-by-useRef-is-not-the-component-state-so-its-change-will-not-trigger-re-rendering-and-it-will-return-the-same-value-every-time-it-is-rendered"><a href="#The-value-returned-by-useRef-is-not-the-component-state-so-its-change-will-not-trigger-re-rendering-and-it-will-return-the-same-value-every-time-it-is-rendered" class="headerlink" title="The value returned by useRef is not the component state, so its change will not trigger re-rendering, and it will return the same value every time it is rendered"></a>The value returned by useRef is not the component state, so its change will not trigger re-rendering, and it will return the same value every time it is rendered</h3><p>In essence, useRef is like a “box” that can hold a mutable value in its .current property.</p><p>You should be familiar with this kind of ref<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">访问 DOM</a> If you pass a ref object to a component as &lt; div ref = {myRef}/&gt;, React will set the ref object’s .current property to the corresponding DOM node no matter how the node changes.</p><p>However, useRef () is more useful than the ref attribute. It can<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables">很方便地保存任何可变值</a>, which is similar to the way instance fields are used in a class.</p><p>This is because it creates a normal Javascript object. The only difference between useRef () and a self-built {current:…} object is that useRef returns the same ref object every time it is rendered.</p><p>Remember that useRef <em>does not</em> notify you when the ref object content changes. Changing the .current property does not trigger component re-rendering. If you want to run some code when React binds or unbinds the ref of a DOM node, you need to use<a target="_blank" rel="external nofollow noopener noreferrer" href="https://zh-hans.reactjs.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node">回调 ref</a> To achieve.</p><p><img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1620866482/origin-of-ray/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210513084055_cx2rak.jpg" alt><code></code></p><p>That is to say, this code will not trigger re-rendering even if you click setCallback, so clicking call callback calls the original callback.</p><p>You can change the onClick of call callback to () =&gt; callbackRef.current ()</p><blockquote><p>Note that changing it to onclick = {callbackRef.current} is invalid. This is no different from the form on the figure.</p></blockquote><h3 id="If-you-want-to-return-a-function-in-a-custom-hook-you-can-wrap-it-with-useCallback"><a href="#If-you-want-to-return-a-function-in-a-custom-hook-you-can-wrap-it-with-useCallback" class="headerlink" title="If you want to return a function in a custom hook, you can wrap it with useCallback"></a>If you want to return a function in a custom hook, you can wrap it with useCallback</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedCallback = <span class="title function_">useCallback</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">doSomething</span>(a, b);</span><br><span class="line">  &#125;,</span><br><span class="line">  [a, b],</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>Returns a <a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Memoization">memoized</a> Callback function.</p><p>Pass the internal connection callback function and an array of dependencies as arguments to useCallback, which will return a memoized version of the callback function that will only be updated when a dependency changes. It is useful when you pass the callback function to a child component that is optimized and uses reference equality to avoid unnecessary rendering (such as shouldComponentUpdate).</p><p><code>useCallback(fn, deps)</code> 相当于 <code>useMemo(() =&gt; fn, deps)</code>。</p><blockquote><p>Attention</p><p>The dependency array will not be passed as a parameter to the callback function. Although conceptually it shows that all values referenced in the callback function should appear in the dependency array. The compiler will be more intelligent in the future, and it will be possible to create arrays automatically.</p><p>We recommend enabling</p></blockquote><p>Reference link: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.notion.so/10-7-React-Hook-14e8a28e607f45e2a4787ad9cebbbe66">https://www.notion.so/10-7-React-Hook-14e8a28e607f45e2a4787ad9cebbbe66</a></p></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>Post author:</strong> Ray Sun</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://sunra.top/en/posts/25327/" title="History of React Hook and Pits in Actual Combat">https://sunra.top/en/posts/25327/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div class="followme"> <span>Welcome to my other publishing channels</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/en/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/en/posts/33643/" rel="prev" title="Redux Introduction Notes"><i class="fa fa-chevron-left"></i> Redux Introduction Notes</a></div><div class="post-nav-item"> <a href="/en/posts/19234/" rel="next" title="How codesandbox runs the npm module in the browser">How codesandbox runs the npm module in the browser<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/en/js/comments.js"></script><script src="/en/js/utils.js"></script><script src="/en/js/motion.js"></script><script src="/en/js/schemes/muse.js"></script><script src="/en/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/en/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/en/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/en/posts/25327/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>