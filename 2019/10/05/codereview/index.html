<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="7yRqtT6cCpC-_R-rzM9gUoQGmheV9OZAUKIXrbAsyqE"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"sunra.top","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8623125811074939" crossorigin="anonymous"></script><script>!function(e,p,s,r){if(void 0===e.webpushr){e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var d,t=p.getElementsByTagName(s)[0];(d=p.createElement(s)).id="webpushr-jssdk",d.async=1,d.src="https://cdn.webpushr.com/app.min.js",t.parentNode.appendChild(d)}}(window,document,"script"),webpushr("setup",{key:"BEQjc-0d1Q1CubrYZ2e2XXv5Is0ZCd3CtrNLet06owkUWK68qkxHpho2mKdnj2vpGdxddRDxRYthLuMwrTqfSB4"})</script><meta name="description" content="就在大家 happy 的这几天期间，Google 公开了两个文档，我感觉作为程序员和工程师非常有必要了解一下。作者在阅读之后截取部分原文并精简了其他一些部分总结下来。"><meta property="og:type" content="article"><meta property="og:title" content="codereview"><meta property="og:url" content="https://sunra.top/2019/10/05/codereview/index.html"><meta property="og:site_name" content="Origin of Ray"><meta property="og:description" content="就在大家 happy 的这几天期间，Google 公开了两个文档，我感觉作为程序员和工程师非常有必要了解一下。作者在阅读之后截取部分原文并精简了其他一些部分总结下来。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-10-05T03:46:37.000Z"><meta property="article:modified_time" content="2024-06-10T23:29:32.089Z"><meta property="article:author" content="Ray Sun"><meta property="article:tag" content="技术分享 使用教程 原理 前端 计算机图形学"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://sunra.top/2019/10/05/codereview/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://sunra.top/2019/10/05/codereview/","path":"2019/10/05/codereview/","title":"codereview"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>codereview | Origin of Ray</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-KEJ1L66CKC"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-KEJ1L66CKC","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script src="/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?cc2e15dfd66849cf1d7843d0d532438e"></script><link rel="dns-prefetch" href="https://blog-comments-3w44.vercel.app/"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Origin of Ray" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Origin of Ray</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">一起探索互联网的秘密</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-english"><a href="https://sunra.top/en" rel="section"><i class="fa fa-language fa-fw"></i>English</a></li><li class="menu-item menu-item-中文"><a href="https://sunra.top/" rel="section"><i class="fa fa-language fa-fw"></i>中文</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#the-cl-authors-guide-to-getting-through-code-review"><span class="nav-number">1.</span> <span class="nav-text">The CL author’s guide to getting through code review</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#writing-good-cl-descriptions"><span class="nav-number">1.1.</span> <span class="nav-text">Writing good CL descriptions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#first-line"><span class="nav-number">1.1.1.</span> <span class="nav-text">First Line</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#body-is-informative"><span class="nav-number">1.1.2.</span> <span class="nav-text">Body is informative</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bad-cl-description"><span class="nav-number">1.1.3.</span> <span class="nav-text">Bad CL Description</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#good-cl-descriptions"><span class="nav-number">1.1.4.</span> <span class="nav-text">Good CL Descriptions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#functionality-change"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">Functionality change</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#small-cls"><span class="nav-number">1.2.</span> <span class="nav-text">Small CLs</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#why-write-small-cls"><span class="nav-number">1.2.1.</span> <span class="nav-text">Why write small CLs?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#what-is-small"><span class="nav-number">1.2.2.</span> <span class="nav-text">What is small?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#when-are-large-cls-okay"><span class="nav-number">1.2.3.</span> <span class="nav-text">When are large CLs okay?</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#splitting-by-files"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">Splitting by Files</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#separate-out-refactoring"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">Separate Out Refactoring</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#keep-related-test-code-in-the-same-cl"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">Keep related test code in the same CL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#dont-break-the-build"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">Don’t break the build</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cant-make-it-small-enough"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">Can’t Make it small enough</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-to-handle-reviewer-comments"><span class="nav-number">1.3.</span> <span class="nav-text">How to handle reviewer comments</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#dont-take-it-personally"><span class="nav-number">1.3.1.</span> <span class="nav-text">Don’t take it personally</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fix-the-code"><span class="nav-number">1.3.2.</span> <span class="nav-text">Fix the code</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#think-for-yourself"><span class="nav-number">1.3.3.</span> <span class="nav-text">Think for yourself</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resolving-conflicts"><span class="nav-number">1.3.4.</span> <span class="nav-text">Resolving conflicts</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-do-a-code-review"><span class="nav-number">2.</span> <span class="nav-text">How to do a code review</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#the-standard-of-code-review"><span class="nav-number">2.1.</span> <span class="nav-text">The standard of code review</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mentoring"><span class="nav-number">2.1.1.</span> <span class="nav-text">Mentoring</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#principles"><span class="nav-number">2.1.2.</span> <span class="nav-text">Principles</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-to-look-for-in-a-code-review"><span class="nav-number">2.2.</span> <span class="nav-text">What to look for in a code review</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#design"><span class="nav-number">2.2.1.</span> <span class="nav-text">Design</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#functionality"><span class="nav-number">2.2.2.</span> <span class="nav-text">Functionality</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#complex"><span class="nav-number">2.2.3.</span> <span class="nav-text">Complex</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tests"><span class="nav-number">2.2.4.</span> <span class="nav-text">Tests</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#naming"><span class="nav-number">2.2.5.</span> <span class="nav-text">Naming</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#comments"><span class="nav-number">2.2.6.</span> <span class="nav-text">Comments</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#style"><span class="nav-number">2.2.7.</span> <span class="nav-text">Style</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#documentation"><span class="nav-number">2.2.8.</span> <span class="nav-text">Documentation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#every-line"><span class="nav-number">2.2.9.</span> <span class="nav-text">Every Line</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#context"><span class="nav-number">2.2.10.</span> <span class="nav-text">Context</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#good-things"><span class="nav-number">2.2.11.</span> <span class="nav-text">Good Things</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#summary"><span class="nav-number">2.2.12.</span> <span class="nav-text">Summary</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#navigating-a-cl-in-review"><span class="nav-number">2.3.</span> <span class="nav-text">Navigating a CL in review</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#speed-of-code-reviews"><span class="nav-number">2.4.</span> <span class="nav-text">Speed of Code Reviews</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#why-should-code-reviews-be-fase"><span class="nav-number">2.4.1.</span> <span class="nav-text">Why should code reviews be fase?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#how-to-write-code-revieww-comment"><span class="nav-number">2.5.</span> <span class="nav-text">How to write code revieww comment</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Ray Sun" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><p class="site-author-name" itemprop="name">Ray Sun</p><div class="site-description" itemprop="description">一起探索互联网的秘密</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">304</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Sun668" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sun668" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:947692259@qq.com" title="E-Mail → mailto:947692259@qq.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license animated" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div><div class="wechat_channel" style="width:50%;margin-left:25%;margin-bottom:5px"><br> <img src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="wechat_channel" style="width:50%;margin-left:25%"><br> <span>一站式程序员工具平台</span> <img src="https://origin-of-ray.oss-cn-shenzhen.aliyuncs.com/rannie_share.png"></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sunra.top/2019/10/05/codereview/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1592617514/avatar_rpap6c.jpg"><meta itemprop="name" content="Ray Sun"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Origin of Ray"><meta itemprop="description" content="一起探索互联网的秘密"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="codereview | Origin of Ray"><meta itemprop="description" content></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> codereview</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-05 11:46:37" itemprop="dateCreated datePublished" datetime="2019-10-05T11:46:37+08:00">2019-10-05</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-11 07:29:32" itemprop="dateModified" datetime="2024-06-11T07:29:32+08:00">2024-06-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Sundry/" itemprop="url" rel="index"><span itemprop="name">Sundry</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline：</span><a title="waline" href="/2019/10/05/codereview/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/2019/10/05/codereview/" itemprop="commentCount"></span></a></span></div></div></header><div class="post-body" itemprop="articleBody"><p>就在大家 happy 的这几天期间，Google 公开了两个文档，我感觉作为程序员和工程师非常有必要了解一下。作者在阅读之后截取部分原文并精简了其他一些部分总结下来。</p><span id="more"></span><h2 id="the-cl-authors-guide-to-getting-through-code-review"><a class="markdownIt-Anchor" href="#the-cl-authors-guide-to-getting-through-code-review"></a> The CL author’s guide to getting through code review</h2><p>简单来讲就是 CL 作者指南去指导通过代码审查。那么 CL 是什么意思呢？就是 change list ，变更记录和日志的意思。</p><p>这个指南可帮助您更快地完成代码审核并获得更高质量的结果。适用于每个 Google 开发人员，阅读这份指南非常有帮助。</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://google.github.io/eng-practices/review/developer/">https://google.github.io/eng-practices/review/developer/</a></p><h3 id="writing-good-cl-descriptions"><a class="markdownIt-Anchor" href="#writing-good-cl-descriptions"></a> Writing good CL descriptions</h3><h4 id="first-line"><a class="markdownIt-Anchor" href="#first-line"></a> First Line</h4><ul><li>Short summary of what is being done.</li><li>Complete sentence, written as though it was an order.</li><li>Follow by empty line.</li></ul><p>首先，CL的第一行最好是一个做了什么的简短的描述，并且后面跟着一个空行，其次应该将其写成命令式的，当然接下来的部分可以没有必要写成这样。</p><h4 id="body-is-informative"><a class="markdownIt-Anchor" href="#body-is-informative"></a> Body is informative</h4><p>其余的描述应提供信息。它可能包括对要解决的问题的简要说明，以及为什么这是最好的方法。如果该方法有任何缺点，则应予以提及。如果相关，请包括背景信息，例如错误号，基准测试结果以及设计文档的链接.。</p><h4 id="bad-cl-description"><a class="markdownIt-Anchor" href="#bad-cl-description"></a> Bad CL Description</h4><p>“Fix bug” is an inadequate CL description. What bug? What did you do to fix it? Other similarly bad descriptions include:</p><ul><li>“Fix build.”</li><li>“Add patch.”</li><li>“Moving code from A to B.”</li><li>“Phase 1.”</li><li>“Add convenience functions.”</li><li>“kill weird URLs.”</li></ul><p>Some of those are real CL descriptions. Their authors may believe they are providing useful information, but they are not serving the purpose of a CL description.</p><h4 id="good-cl-descriptions"><a class="markdownIt-Anchor" href="#good-cl-descriptions"></a> Good CL Descriptions</h4><p>Here are some examples of good descriptions.</p><h5 id="functionality-change"><a class="markdownIt-Anchor" href="#functionality-change"></a> Functionality change</h5><blockquote><p>rpc: remove size limit on RPC server message freelist.</p><p>Servers like FizzBuzz have very large messages and would benefit from reuse. Make the freelist larger, and add a goroutine that frees the freelist entries slowly over time, so that idle servers eventually release all freelist entries.</p></blockquote><p>The first few words describe what the CL actually does. The rest of the description talks about the problem being solved, why this is a good solution, and a bit more information about the specific implementation.</p><p>文档中还有很多好的CL的举例说明，大家可以自己去看一下。同时记住，CL最好是全英的。</p><h3 id="small-cls"><a class="markdownIt-Anchor" href="#small-cls"></a> Small CLs</h3><h4 id="why-write-small-cls"><a class="markdownIt-Anchor" href="#why-write-small-cls"></a> Why write small CLs?</h4><ul><li><strong>Reviewed more quickly.</strong> It’s easier for a reviewer to find five minutes several times to review small CLs than to set aside a 30 minute block to review one large CL.</li><li><strong>Reviewed more thoroughly.</strong> With large changes, reviewers and authors tend to get frustrated by large volumes of detailed commentary shifting back and forth—sometimes to the point where important points get missed or dropped.</li><li><strong>Less likely to introduce bugs.</strong> Since you’re making fewer changes, it’s easier for you and your reviewer to reason effectively about the impact of the CL and see if a bug has been introduced.</li><li><strong>Less wasted work if they are rejected.</strong> If you write a huge CL and then your reviewer says that the overall direction is wrong, you’ve wasted a lot of work.</li><li><strong>Easier to merge.</strong> Working on a large CL takes a long time, so you will have lots of conflicts when you merge, and you will have to merge frequently.</li><li><strong>Easier to design well.</strong> It’s a lot easier to polish the design and code health of a small change than it is to refine all the details of a large change.</li><li><strong>Less blocking on reviews.</strong> Sending self-contained portions of your overall change allows you to continue coding while you wait for your current CL in review.</li><li><strong>Simpler to roll back.</strong> A large CL will more likely touch files that get updated between the initial CL submission and a rollback CL, complicating the rollback (the intermediate CLs will probably need to be rolled back too).</li></ul><p>简单来讲，就是小步提交可以更容易地知道你每一次提交在做什么，这样一来，当你有什么问题的时候，可以非常快速地定位问题，如果该问题需要回滚时，也不会对现有代码产生什么影响。</p><h4 id="what-is-small"><a class="markdownIt-Anchor" href="#what-is-small"></a> What is small?</h4><p>In general, the right size for a CL is <strong>one self-contained change</strong>. This means that:</p><ul><li>The CL makes a minimal change that addresses <strong>just one thing</strong>. This is usually just one part of a feature, rather than a whole feature at once. In general it’s better to err on the side of writing CLs that are too small vs. CLs that are too large. Work with your reviewer to find out what an acceptable size is.</li><li>Everything the reviewer needs to understand about the CL (except future development) is in the CL, the CL’s description, the existing codebase, or a CL they’ve already reviewed.</li><li>The system will continue to work well for its users and for the developers after the CL is checked in.</li><li>The CL is not so small that its implications are difficult to understand. If you add a new API, you should include a usage of the API in the same CL so that reviewers can better understand how the API will be used. This also prevents checking in unused APIs.</li></ul><p>对于每次提交的大小，每次100行左右的是一个比较合理的大小，而1000行就太大了。但这也不是绝对的判断标准，如果100行代码分布在50个文件中，那也算一次很大的修改。</p><h4 id="when-are-large-cls-okay"><a class="markdownIt-Anchor" href="#when-are-large-cls-okay"></a> When are large CLs okay?</h4><p>There are a few situations in which large changes aren’t as bad:</p><ul><li>You can usually count deletion of an entire file as being just one line of change, because it doesn’t take the reviewer very long to review.</li><li>Sometimes a large CL has been generated by an automatic refactoring tool that you trust completely, and the reviewer’s job is just to sanity check and say that they really do want the change. These CLs can be larger, although some of the caveats from above (such as merging and testing) still apply.</li></ul><h5 id="splitting-by-files"><a class="markdownIt-Anchor" href="#splitting-by-files"></a> Splitting by Files</h5><p>可以将需要不同reviewer的相对独立的更改拆分为不同的CL</p><h5 id="separate-out-refactoring"><a class="markdownIt-Anchor" href="#separate-out-refactoring"></a> Separate Out Refactoring</h5><p>通常最好是在单独的CL中进行重构，而不包含功能更改或错误修复。例如，修改某个类以及调用该类应该放到不同的两个CL中。</p><h5 id="keep-related-test-code-in-the-same-cl"><a class="markdownIt-Anchor" href="#keep-related-test-code-in-the-same-cl"></a> Keep related test code in the same CL</h5><p>尽量不要把测试代码放到不同的CL中，因为测试会保证你的这段代码的正确性，即使测试代码可能会使你的提交变得庞大。</p><p>但是，我们可以将独立的测试放到单独的CL中，比如：</p><ul><li>validating pre-existing, submitted code with new tests.</li><li>refactoring the test code (e.g. introduce helper functions).</li><li>introducing larger test framework code (e.g. an integration test).</li></ul><h5 id="dont-break-the-build"><a class="markdownIt-Anchor" href="#dont-break-the-build"></a> Don’t break the build</h5><p>如果多个CL会相互依赖，最好是能够保证在每个CL被提交修改之后，系统能够正常运行。</p><h5 id="cant-make-it-small-enough"><a class="markdownIt-Anchor" href="#cant-make-it-small-enough"></a> Can’t Make it small enough</h5><h3 id="how-to-handle-reviewer-comments"><a class="markdownIt-Anchor" href="#how-to-handle-reviewer-comments"></a> How to handle reviewer comments</h3><p>When you’ve sent a CL out for review, it’s likely that your reviewer will respond with several comments on your CL. Here are some useful things to know about handling reviewer comments.</p><h4 id="dont-take-it-personally"><a class="markdownIt-Anchor" href="#dont-take-it-personally"></a> Don’t take it personally</h4><p>The goal of review is to maintain the quality of our codebase and our products. When a reviewer provides a critique of your code, think of it as their attempt to help you, the codebase, and Google, rather than as a personal attack on you or your abilities.</p><p>也就是说，尽量不要再代码审查中加入自己的负面情绪，如果有人在你的代码审查过程中加入了负面情绪，首先考虑一下他们真正想说的是什么，然后再想办法和他们私下交流，比如面谈或者邮件。</p><h4 id="fix-the-code"><a class="markdownIt-Anchor" href="#fix-the-code"></a> Fix the code</h4><p>如果审阅者说不明白你的代码，那你应该想办法解释清楚你的代码在做什么。因为你的审阅者看不懂，将来其他的同事也可能看不懂。</p><h4 id="think-for-yourself"><a class="markdownIt-Anchor" href="#think-for-yourself"></a> Think for yourself</h4><p>因为我们每次提交可能是花费了大量的时间，所以当我们看到审阅者给我们提出意见的时候，我们的第一反应是拒绝。</p><p>但是我们最好先考虑一下，审阅者的意见是否是正确的，如果我们没办法回答这个问题，我们就可能需要去找到审阅者让他说清楚自己的观点，然后再去判断。</p><h4 id="resolving-conflicts"><a class="markdownIt-Anchor" href="#resolving-conflicts"></a> Resolving conflicts</h4><p>Your first step in resolving conflicts should always be to try to come to consensus with your reviewer. If you can’t achieve consensus, see <a target="_blank" rel="external nofollow noopener noreferrer" href="https://google.github.io/eng-practices/review/reviewer/standard.html">The Standard of Code Review</a>, which gives principles to follow in such a situation.</p><h2 id="how-to-do-a-code-review"><a class="markdownIt-Anchor" href="#how-to-do-a-code-review"></a> How to do a code review</h2><p>这份文档中包含有关进行代码审查的最佳方式的建议。是一个非常完整的文档，分为许多单独的部分。阅读这个文档，对于大家来看，肯定会非常有帮助，绝对让大家受益匪浅的一件事。</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://google.github.io/eng-practices/review/reviewer/">https://google.github.io/eng-practices/review/reviewer/</a></p><h3 id="the-standard-of-code-review"><a class="markdownIt-Anchor" href="#the-standard-of-code-review"></a> The standard of code review</h3><p>代码审查的主要目的是确保Google代码库的整体代码运行状况随着时间的推移而不断改善。</p><p>首先，开发人员必须能够在其任务上取得进展。如果您从未向代码库提交过改进，那么代码库将永远不会得到改进。另外，如果审阅者很难进行任何更改，那么开发人员就没有动力在将来进行改进。</p><p>另一方面，审阅者有责任确保每个CL的质量都使得其代码库的整体代码运行状况不会随着时间的流逝而减少。</p><p>Thus, we get the following rule as the standard we expect in code reviews:</p><p><strong>In general, reviewers should favor approving a CL once it is in a state where it definitely improves the overall code health of the system being worked on, even if the CL isn’t perfect.</strong></p><p>That is <em>the</em> senior principle among all of the code review guidelines.</p><h4 id="mentoring"><a class="markdownIt-Anchor" href="#mentoring"></a> Mentoring</h4><p>代码审查具有重要的功能，可以教给开发人员有关语言，框架或通用软件设计原理的新知识。留下有助于开发人员学习新知识的评论总是很好的。共享知识是随着时间的推移改善系统代码运行状况的一部分。</p><h4 id="principles"><a class="markdownIt-Anchor" href="#principles"></a> Principles</h4><ul><li>Technical facts and data overrule opinions and personal preferences.</li><li>On matters of style, the <a target="_blank" rel="external nofollow noopener noreferrer" href="http://google.github.io/styleguide/">style guide</a> is the absolute authority. Any purely style point (whitespace, etc.) that is not in the style guide is a matter of personal preference. The style should be consistent with what is there. If there is no previous style, accept the author’s.</li><li><strong>Aspects of software design are almost never a pure style issue or just a personal preference.</strong> They are based on underlying principles and should be weighed on those principles, not simply by personal opinion. Sometimes there are a few valid options. If the author can demonstrate (either through data or based on solid engineering principles) that several approaches are equally valid, then the reviewer should accept the preference of the author. Otherwise the choice is dictated by standard principles of software design.</li><li>If no other rule applies, then the reviewer may ask the author to be consistent with what is in the current codebase, as long as that doesn’t worsen the overall code health of the system.</li></ul><h3 id="what-to-look-for-in-a-code-review"><a class="markdownIt-Anchor" href="#what-to-look-for-in-a-code-review"></a> What to look for in a code review</h3><h4 id="design"><a class="markdownIt-Anchor" href="#design"></a> Design</h4><p>审查中最重要的内容是CL的总体设计。CL中各种代码的交互是否有意义？</p><h4 id="functionality"><a class="markdownIt-Anchor" href="#functionality"></a> Functionality</h4><p>此CL是否达到开发人员的预期目的？开发人员打算为该代码的用户带来什么好处？</p><p>“用户”通常既是最终用户（当他们受到更改影响时）又是开发人员（将来他们将不得不“使用”此代码）。通常，我们希望开发人员能够对CL进行良好的测试，以确保它们在进行代码审查时能够正常工作。</p><p>但是，作为审阅者，您仍然应该考虑边缘情况，寻找并发性问题，尝试像用户一样思考，并确保没有仅仅通过阅读代码就能看到的错误。</p><p>您可以根据需要验证CL，对于审阅者而言，检查CL的行为最重要的时间是对用户的影响（如UI更改）。</p><p>当您仅阅读代码时，很难理解某些更改将如何影响用户。进行此类更改时，如果过于麻烦以致无法在CL中打补丁并自己尝试，则可以让开发人员向您演示该功能。</p><p>另外一次在代码审查期间考虑功能特别重要的时候是，CL中是否正在进行某种并行编程，从理论上讲可能会导致死锁或竞争状况。仅通过运行代码很难检测到这类问题，通常需要有人（开发人员和审阅者）仔细考虑它们，以确保不会引入问题。</p><h4 id="complex"><a class="markdownIt-Anchor" href="#complex"></a> Complex</h4><p>简单来说就是不要过度设计。</p><h4 id="tests"><a class="markdownIt-Anchor" href="#tests"></a> Tests</h4><p>根据更改要求进行单元测试，集成测试或端到端测试。通常，除非CL处理紧急情况，否则应在与生产代码相同的CL中添加测试。确保CL中的测试正确，合理且有用。测试不会自我测试，我们很少为测试编写测试-人员必须确保测试有效。</p><h4 id="naming"><a class="markdownIt-Anchor" href="#naming"></a> Naming</h4><p>名字要足够长，直到他可以完全表达清楚它是什么或者它想做什么。</p><h4 id="comments"><a class="markdownIt-Anchor" href="#comments"></a> Comments</h4><p>开发人员是否用可理解的英语写下清晰的评论？所有评论实际上都是必要的吗？通常，当注释解释了为什么存在某些代码，而不应该解释某些代码在做什么时，它们很有用。如果代码不够清晰，无法说明自身，则应简化代码。有一些例外情况（例如，正则表达式和复杂算法通常会从注释中解释它们的作用而受益匪浅），但大多数注释是针对代码本身可能无法包含的信息，例如决策背后的原因。</p><h4 id="style"><a class="markdownIt-Anchor" href="#style"></a> Style</h4><p>确保CL遵循适当的样式指南。如果您想改善样式指南中没有的样式点，请在注释前面加上“ Nit：”，以使开发人员知道这是您认为可以改善代码但不是强制性的选择。</p><p>CL的作者不应将主要样式更改与其他更改结合在一起。这使得很难看到CL中的更改，使合并和回滚更加复杂，并导致其他问题。</p><h4 id="documentation"><a class="markdownIt-Anchor" href="#documentation"></a> Documentation</h4><p>如果CL改变了用户构建，测试，与代码交互或释放代码的方式，请检查其是否还更新了相关文档，包括自述文件</p><h4 id="every-line"><a class="markdownIt-Anchor" href="#every-line"></a> Every Line</h4><p>查看已分配给您检查的每一行代码。有时您可以扫描数据文件，生成的代码或大型数据结构之类的东西，但不扫描人工编写的类，函数或代码块，并认为其中的内容是可以的。显然，某些代码比其他代码更需要仔细检查-这是您必须做出的判断调用-但您至少应确保您了解所有代码在做什么。如果您阅读代码太困难，并且使审查速度变慢，那么您应该让开发人员知道这一点，并等待他们澄清，然后再尝试审查</p><h4 id="context"><a class="markdownIt-Anchor" href="#context"></a> Context</h4><p>通常，代码查看工具只会向您显示围绕要更改的部分的几行代码。有时，您必须查看整个文件，以确保更改确实有意义。</p><h4 id="good-things"><a class="markdownIt-Anchor" href="#good-things"></a> Good Things</h4><p>如果您在CL中看到不错的东西，请告诉开发人员，尤其是当他们以出色的方式回答了您的评论之一时。</p><h4 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h4><p>In doing a code review, you should make sure that:</p><ul><li>The code is well-designed.</li><li>The functionality is good for the users of the code.</li><li>Any UI changes are sensible and look good.</li><li>Any parallel programming is done safely.</li><li>The code isn’t more complex than it needs to be.</li><li>The developer isn’t implementing things they <em>might</em> need in the future but don’t know they need now.</li><li>Code has appropriate unit tests.</li><li>Tests are well-designed.</li><li>The developer used clear names for everything.</li><li>Comments are clear and useful, and mostly explain <em>why</em> instead of <em>what</em>.</li><li>Code is appropriately documented (generally in g3doc).</li><li>The code conforms to our style guides.</li></ul><h3 id="navigating-a-cl-in-review"><a class="markdownIt-Anchor" href="#navigating-a-cl-in-review"></a> Navigating a CL in review</h3><p>Now that you know <a target="_blank" rel="external nofollow noopener noreferrer" href="https://google.github.io/eng-practices/review/reviewer/looking-for.html">what to look for</a>, what’s the most efficient way to manage a review that’s spread across multiple files?</p><ol><li>Does the change make sense? Does it have a good <a target="_blank" rel="external nofollow noopener noreferrer" href="https://google.github.io/eng-practices/review/developer/cl-descriptions.html">description</a>?</li><li>Look at the most important part of the change first. Is it well-designed overall?</li><li>Look at the rest of the CL in an appropriate sequence.</li></ol><h3 id="speed-of-code-reviews"><a class="markdownIt-Anchor" href="#speed-of-code-reviews"></a> Speed of Code Reviews</h3><h4 id="why-should-code-reviews-be-fase"><a class="markdownIt-Anchor" href="#why-should-code-reviews-be-fase"></a> Why should code reviews be fase?</h4><p><strong>At Google, we optimize for the speed at which a team of developers can produce a product together</strong>, as opposed to optimizing for the speed at which an individual developer can write code. The speed of individual development is important, it’s just not <em>as</em> important as the velocity of the entire team.</p><p>When code reviews are slow, several things happen:</p><ul><li><strong>The velocity of the team as a whole is decreased.</strong> Yes, the individual, who doesn’t respond quickly to the review, gets other work done. However, new features and bug fixes for the rest of the team are delayed by days, weeks, or months as each CL waits for review and re-review.</li><li><strong>Developers start to protest the code review process.</strong> If a reviewer only responds every few days, but requests major changes to the CL each time, that can be frustrating and difficult for developers. Often, this is expressed as complaints about how “strict” the reviewer is being. If the reviewer requests the <em>same</em> substantial changes (changes which really do improve code health) but responds <em>quickly</em> every time the developer makes an update, the complaints tend to disappear. <strong>Most complaints about the code review process are actually resolved by making the process faster.</strong></li><li><strong>Code health can be impacted.</strong> When reviews are slow, there is increased pressure to allow developers to submit CLs that are not as good as they could be. Slow reviews also discourage code cleanups, refactorings, and further improvements to existing CLs.</li></ul><h3 id="how-to-write-code-revieww-comment"><a class="markdownIt-Anchor" href="#how-to-write-code-revieww-comment"></a> How to write code revieww comment</h3><ul><li>Be kind.</li><li>Explain your reasoning.</li><li>Balance giving explicit directions with just pointing out problems and letting the developer decide.</li><li>Encourage developers to simplify code or add code comments instead of just explaining the complexity to you.</li></ul></div><footer class="post-footer"><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Ray Sun</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://sunra.top/2019/10/05/codereview/" title="codereview">https://sunra.top/2019/10/05/codereview/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"> <span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></span> <img class="social-item-img" src="https://res.cloudinary.com/dvtfhjxi4/image/upload/v1685836114/origin-of-ray/wechat_channel_zmg0hw.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/2019/09/28/node_pipline_attention/" rel="prev" title="Node 并行处理时共享变量需注意"><i class="fa fa-chevron-left"></i> Node 并行处理时共享变量需注意</a></div><div class="post-nav-item"> <a href="/2019/10/12/iterator/" rel="next" title="迭代器">迭代器<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Ray Sun</span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" integrity="sha256-hLTCMFlKxdNgPXyWlSSxYN0ykJmxxq9Yt3MNfdRGWeA=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://blog-comments-3w44.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"欢迎大家交流学习","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":[],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/2019/10/05/codereview/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>